// env=undefined => env=publish 
Cube("datav:/com/datavmap-canvas2d-honeycomb/2.0.24/src/utils/intensity",[],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=c("datav:/com/datavmap-canvas2d-honeycomb/2.0.24/src/utils/canvas"),g=function(){function a(b){d(this,a),b=b||{},this.gradient=b.gradient||{1:"rgba(255, 0, 0, 1)",0.25:"rgba(0, 0, 255, 1)",0.55:"rgba(0, 255, 0, 1)",0.85:"rgba(255, 255, 0, 1)"},this.maxSize=b.maxSize||35,this.minSize=b.minSize||0,this.max=b.max||100,this.min=b.min||0,this.initPalette()}return e(a,[{key:"initPalette",value:function(){var a=this.gradient,b=new f(256,1),c=this.ctx=b.getContext("2d"),d=c.createLinearGradient(0,0,256,1);for(var e in a)d.addColorStop(parseFloat(e),a[e]);c.fillStyle=d,c.fillRect(0,0,256,1)}},{key:"setMax",value:function(a){this.max=a||100}},{key:"setMax",value:function(a){this.max=a||100}},{key:"setMin",value:function(a){this.min=a||0}},{key:"setMaxSize",value:function(a){this.maxSize=a||35}},{key:"setMinSize",value:function(a){this.minSize=a||0}},{key:"getColor",value:function(a){var b=this.getImageData(a);return"rgba("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]/256+")"}},{key:"getImageData",value:function(a){var b=this.ctx.getImageData(0,0,256,1).data;if(void 0===a)return imageData;var c=this.max,d=this.min;a>c&&(a=c),a<d&&(a=d);var e=4*Math.floor(255*((a-d)/(c-d)));return[b[e],b[e+1],b[e+2],b[e+3]]}},{key:"getSize",value:function(a){var b=0,c=this.max,d=this.min,e=this.maxSize,f=this.minSize;return a>c&&(a=c),a<d&&(a=d),b=f+(a-d)/(c-d)*(e-f),b}},{key:"getLegend",value:function(a){var b=this.gradient,c=a.width||20,d=a.height||180,e=new f(c,d),g=e.getContext("2d"),h=g.createLinearGradient(0,d,0,0);for(var i in b)h.addColorStop(parseFloat(i),b[i]);return g.fillStyle=h,g.fillRect(0,0,c,d),e}}]),a}();return a.exports=g,a.exports});;
Cube("datav:/com/datavmap-canvas2d-honeycomb/2.0.24/src/utils/canvas",[],function(a){return a.exports=function(a,b){var c;if("undefined"===typeof document);else{var c=document.createElement("canvas");a&&(c.width=a),b&&(c.height=b)}return c},a.exports});;
Cube("datav:/com/datavmap-canvas2d-honeycomb/2.0.24/src/utils",[],function(a,b,c){var d=c("datav:/com/datavmap-canvas2d-honeycomb/2.0.24/src/utils/canvas"),e=c("datav:/com/datavmap-canvas2d-honeycomb/2.0.24/src/utils/intensity");return a.exports={Canvas:d,Intensity:e},a.exports});;
Cube("datav:/com/datavmap-canvas2d-honeycomb/2.0.24/src/honeycomb",[],function(a,b,c){var d=c("datav:/com/datavmap-canvas2d-honeycomb/2.0.24/src/utils"),e=d.Intensity;return a.exports=function(a,b,c,d){b.save();var f,g;for(f in d)b[f]=d[f];var h=d.offset||{x:10,y:10},i=d._size||d.size||40;i=i/2/Math.sin(Math.PI/3);var j=2*i*Math.sin(Math.PI/3),k=1.5*i,l={},m=void 0,n=1,o=1;for(g=0;g<c.length;g++){m=c[g].geometry._coordinates||c[g].geometry.coordinates;var p=(m[1]-h.y)/k,q=Math.round(p),s=(m[0]-h.x)/j-(1&q?.5:0),t=Math.round(s),u=p-q;if(1<3*Math.abs(u)){var v=s-t,w=t+(s<t?-1:1)/2,z=q+(p<q?-1:1),A=s-w,B=p-z;v*v+u*u>A*A+B*B&&(t=w+(1&q?1:-1)/2,q=z)}var C=t+"-"+q,D=l[C];D?D.push(c[g]):(D=l[C]=[c[g]],D.i=t,D.j=q,D.x=(t+(1&q?1/2:0))*j,D.y=q*k)}for(f in l){var E=l[f];E.length<n&&(n=E.length),E.length>o&&(o=E.length)}var F=new e({min:n,max:o,maxSize:i,gradient:d.gradient});for(f in b.globalAlpha=d.globalAlpha,b.shadowBlur=d.shadowBlur,b.lineWidth=d.lineWidth,l){var G=l[f];for(b.beginPath(),g=0;6>g;g++){var H={x:G.x+h.x,y:G.y+h.y},I=Math.PI/180*(60*g+30),J=H.x+i*Math.cos(I),x=H.y+i*Math.sin(I),y=a.layerPointToContainerPoint([J,x]);b.lineTo(y.x,y.y)}b.closePath();var K=0;for(g=0;g<G.length;g++)K+=G[g].count||1;G.count=K,b.fillStyle=F.getColor(K),b.fill(),d.strokeStyle&&d.lineWidth&&b.stroke()}if(b.save(),d.label&&d.label.show)for(f in b.globalAlpha=1,b.fillStyle=d.label.fillStyle||"white",d.label.font&&(b.font=d.label.font),d.label.shadowColor&&(b.shadowColor=d.label.shadowColor),d.label.shadowBlur&&(b.shadowBlur=d.label.shadowBlur),l){var L=l[f],M=L.count;M=0>M?M.toFixed(2):~~M;var N=b.measureText(M).width,O=a.layerPointToContainerPoint([L.x,L.y]);b.fillText(M,O.x+h.x-N/2,O.y+h.y+5)}b.save()},a.exports});;
Cube("datav:/com/datavmap-canvas2d-honeycomb/2.0.24/src/honeycombLayer",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1","datav:/npm/chroma-js/1.3.3"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/npm/chroma-js/1.3.3"),k=c("datav:/com/datavmap-canvas2d-honeycomb/2.0.24/src/honeycomb"),l=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=i({zoomRange:[0,18],minZoom:0,maxZoom:22,honeycombStyle:{size:32,opacity:0.5,fill:{minFillColor:"#00E7FF",maxFillColor:"#FF0000",colorLevel:5},shadow:{shadowColor:"rgba(7,245,22,0.24)",shadowBlur:5},stroke:{color:"rgba(43,228,25,0.8)",weight:2}},labelStyle:{show:!0,textStyle:{fontFamily:"Microsoft Yahei",fontSize:12,color:"#FFFFFF",fontWeight:"normal"}}},c),f.options.minZoom=c.zoomRange[0],f.options.maxZoom=c.zoomRange[1],f.options.visibility=!0,f.map=a,f.init(),f}return f(b,a),g(b,[{key:"init",value:function(){this.container=document.createElement("canvas");var a=this.padding=this.map.canvasLayer&&this.map.canvasLayer.options&&this.map.canvasLayer.options.padding?this.map.canvasLayer.options.padding:0.1,b=this.map.getSize();this.offset=b.multiplyBy(-a).round();var c=b.x-2*this.offset.x,d=b.y-2*this.offset.y,e=this.map.devicePixelRatio||1;this.container.width=c*e,this.container.height=d*e,this.container.style.width=c+"px",this.container.style.height=d+"px",this.ctx=this.container.getContext("2d"),this.ctx.scale(e,e),this.bounds=null,this.geojson=null,this.getHoneycombOptions(this.options)}},{key:"render",value:function(a){if(this.data=[],a&&0<a.length){var b,c;for(b=0;b<a.length;b++)c=a[b],c.hasOwnProperty("lng")&&c.hasOwnProperty("lat")&&this.data.push(c)}var d=this.map.L.datavUtils.arr2geojson(this.data);this.geojson=JSON.parse(JSON.stringify(d)),this.genGeojson()}},{key:"genGeojson",value:function(){this.onRender()}},{key:"onRender",value:function(){if(this.ctx.clearRect(0,0,this.container.width,this.container.height),0!==this.options.honeycombStyle.opacity&&this.geojson&&this.geojson.features){for(var a=0;a<this.geojson.features.length;a++){var b=this.geojson.features[a],c=b.geometry.coordinates,d=this.map.latLngToLayerPoint([c[1],c[0]]),e=d.x-this.offset.x,f=d.y-this.offset.y;b.geometry._coordinates=[e,f]}this.draw()}}},{key:"draw",value:function(){this.options.visibility&&this.geojson&&k(this.map,this.ctx,this.geojson.features,this.honeycombOptions)}},{key:"onResize",value:function(a,b){var c=this.map.devicePixelRatio||1;this.container.width=a*c,this.container.height=b*c,this.container.style.width=a+"px",this.container.style.height=b+"px",this.ctx.scale(c,c)}},{key:"updateOptions",value:function(a){this.options=i(this.options,a),this.options.minZoom=a.zoomRange[0],this.options.maxZoom=a.zoomRange[1],this.getHoneycombOptions(this.options),this.genGeojson()}},{key:"getHoneycombOptions",value:function(a){for(var b,c=a.honeycombStyle,d=a.labelStyle.textStyle,e=c.fill,f=j.scale([e.minFillColor,e.maxFillColor]).mode("hsl").colors(e.colorLevel),g={},h=0;h<f.length;h++)b=((h+1)/f.length).toFixed(2),g[b]=f[h];this.honeycombOptions={shadowColor:c.shadow.shadowColor||"rgba(255, 250, 50, 0.8)",shadowBlur:c.shadow.shadowBlur,globalAlpha:c.opacity,size:c.size,gradient:g,strokeStyle:c.stroke.color,lineWidth:c.stroke.weight,label:{show:a.labelStyle.show,font:""+d.fontWeight+" "+d.fontSize+"px "+d.fontFamily,fillStyle:d.color||"white"}}}},{key:"show",value:function(){this.options.visibility=!0,this.onRender()}},{key:"hide",value:function(){this.options.visibility=!1,this.ctx.clearRect(0,0,this.container.width,this.container.height)}},{key:"destroy",value:function(){this.options=null,this.ctx=null,this.container=null,delete this.options,this.ctx,this.container}}]),b}(h);return a.exports=l,a.exports});;
Cube("datav:/com/datavmap-canvas2d-honeycomb/2.0.24",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/com/datavmap-canvas2d-honeycomb/2.0.24/src/honeycombLayer"),k=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=i({renderer:"canvas"},c),f.options.minZoom=c.zoomRange[0],f.options.maxZoom=c.zoomRange[1],f.options.visibility=!0,f}return f(b,a),g(b,[{key:"addTo",value:function(a,b){return this.options.id=b,this.layer=new j(a,this.options),this}},{key:"onRender",value:function(){this.layer&&this.layer.onRender&&this.layer.onRender()}},{key:"render",value:function(a){this.layer&&this.layer.render&&this.layer.render(a)}},{key:"onResize",value:function(a,b){this.layer&&this.layer.onResize&&this.layer.onResize(a,b)}},{key:"updateOptions",value:function(a){this.options=i(this.options,a),this.options.minZoom=a.zoomRange[0],this.options.maxZoom=a.zoomRange[1],this.layer&&this.layer.updateOptions&&this.layer.updateOptions(a)}},{key:"show",value:function(){this.options.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.options.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"destroy",value:function(){this.layer&&this.layer.destroy&&this.layer.destroy(),this.layer=null,this.options=null,delete this.layer,this.options}}]),b}(h);return a.exports=k,a.exports});