// env=undefined => env=publish 
Cube("datav:/com/datav-2dmap-honeycomb-cluster/3.0.8/src/honeycomb",[],function(t,o,a,e,i,n){var r=function(t,o,a){return o&&s(t.prototype,o),a&&s(t,a),t};function s(t,o){for(var a=0;a<o.length;a++){var e=o[a];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return t.exports=function(t){var x=t.map,o=(t.L,t.Utils),T=t.GuiUtils,B=o._,a=(o.Chroma,o.mergeOptions),i=x.options.offset;return r(e,[{key:"setData",value:function(t){this.geojson=t}},{key:"setOptions",value:function(t){this.options=a(this.options,t);var o=this.options.graph,t=o.label.textStyle;this.honeycombOptions={graph:o,label:{show:o.label.show,font:t.fontWeight+" "+t.fontSize+"px "+t.fontFamily,fillStyle:t.color||"white"}}}},{key:"onRender",value:function(t,o){o&&this.getFeatures(),this.dataProcess(),this.draw(t)}},{key:"getFeatures",value:function(){if(this.features=[],this.geojson&&this.geojson.features)for(var t=void 0,o=void 0,t=0;t<this.geojson.features.length;t++){var a=(o=Object.assign({},this.geojson.features[t])).geometry.coordinates,e=x.latLngToLayerPoint([a[1],a[0]]);o.geometry._coordinates=[e.x-i.x,e.y-i.y],this.features.push(o)}}},{key:"dataProcess",value:function(){for(var t,o=this.honeycombOptions.graph,a=o.sizeMapping,e=B.get(T,"scale.size"),i=B.get(this.options,"graph.sizeMapping"),a=i.mapping?a.scale.range[1]:i.fixed,n=2*(a/=Math.sin(Math.PI/3))*Math.sin(Math.PI/3),r=1.5*a,s=void 0,l=void 0,h=void 0,d=1,f=1,u={},s=0;s<this.features.length;s++){var c=(h=(l=this.features[s]).geometry._coordinates||l.geometry.coordinates)[1]/r,g=Math.round(c),v=h[0]/n-(1&g?.5:0),p=Math.round(v),y=c-g;1<3*Math.abs(y)&&((m=v-(w=p+(v<p?-1:1)/2))*m+(c=c-(m=g+(c<g?-1:1)))*c<(v=v-p)*v+y*y&&(p=w+(1&g?1:-1)/2,g=m));var w=p+"-"+g,m=u[w];m?m.push(l):((m=u[w]=[l]).i=p,m.j=g,m.x=(p+(1&g?.5:0))*n,m.y=g*r)}for(t in u){var b=u[t];b.length<d&&(d=b.length),b.length>f&&(f=b.length)}var x,M=this._data={};for(x in u){var P=u[x],C=P.length;M[C]||(M[C]={value:C,data:[]}),M[C].data.push([P.x,P.y])}var _,k=[];for(_ in this._data)k.push({radiusField:_,colorField:_});var j,F=e({config:i,data:k,field:"radiusField"}),O=B.get(T,"scale.color")({config:B.get(this.options,"graph.colorMapping"),data:k,field:"colorField"});for(j in this._data){var S=F(j);this._data[j].radius=(S-o.padding/2)/Math.sin(Math.PI/3),this._data[j].fillColor=O(j)}}},{key:"draw",value:function(t){var o,a=this.honeycombOptions,e=a.graph,i=a.label,a=e.shadow,n=e.stroke;for(o in t.shadowColor=a.shadowColor,t.shadowBlur=a.shadowBlur,t.strokeStyle=n.color,t.lineWidth=n.weight,this._data){var r=this._data[o],s=r.fillColor,l=r.data,h=r.radius;t.fillStyle=s,t.beginPath();for(var d,f=void 0,u=void 0,f=0;f<l.length;f++){for(d=l[f],u=0;u<6;u++){var c=Math.PI/180*(60*u+30),g=d[0]+h*Math.cos(c),c=d[1]+h*Math.sin(c),c=x.layerPointToContainerPoint([g,c]);0===u?t.moveTo(c.x,c.y):t.lineTo(c.x,c.y)}t.closePath()}t.fill(),n.color&&n.weight&&t.stroke()}if(i.show)for(var v in t.textAlign="center",t.textBaseline="middle",this._data){var v=this._data[v],p=v.value,y=v.data;t.fillStyle=i.fillStyle||"white",i.font&&(t.font=i.font),i.shadowColor&&(t.shadowColor=i.shadowColor),i.shadowBlur&&(t.shadowBlur=i.shadowBlur);for(var w=void 0,w=0;w<y.length;w++){var m=y[w],b=x.layerPointToContainerPoint([m[0],m[1]]);t.fillText(p,b.x,b.y)}}}}]),e;function e(t){!function(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=a({zIndex:0,tolerance:3,smoothFactor:1},t),this.setOptions()}},t.exports});;
Cube("datav:/com/datav-2dmap-honeycomb-cluster/3.0.8/config",[],function(o,a,e,r,t,n){return o.exports={DEFAULT_OPTIONS:{renderer:"canvas",general:{zoomRange:[0,18],minZoom:0,maxZoom:22},graph:{shadow:{shadowColor:"rgba(7,245,22,0.24)",shadowBlur:5},stroke:{color:"rgba(43,228,25,0.8)",weight:2},label:{textStyle:{fontFamily:"Microsoft Yahei",fontSize:12,color:"#FFFFFF",fontWeight:"normal"}}}}},o.exports});;
Cube("datav:/com/datav-2dmap-honeycomb-cluster/3.0.8/src/honeycombLayer",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(t,e,s,o,n,i){var l=function(t,e,o){return e&&r(t.prototype,e),o&&r(t,o),t};function r(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0!==n){if("value"in n)return n.value;n=n.get;return void 0!==n?n.call(o):void 0}if(null!==(t=Object.getPrototypeOf(t)))return c(t,e,o)}s("datav:/npm/eventemitter3/3.0.0");var p=s("datav:/npm/safely-merge/1.0.1");return t.exports=function(t){t.L;var o=t.map,e=t.Utils,n=t.Layer,i=e.arr2geojson,r=s("datav:/com/datav-2dmap-honeycomb-cluster/3.0.8/src/honeycomb")(t);return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(a,n),l(a,[{key:"init",value:function(){var t=p({zIndex:0},this.options);this.honeycomb=new r(t),this.addLayer(this.honeycomb)}},{key:"render",value:function(t){if(this.data=[],t&&0<t.length)for(var e=void 0,o=void 0,e=0;e<t.length;e++)(o=t[e]).hasOwnProperty("lng")&&o.hasOwnProperty("lat")&&this.data.push(o);var n=i(this.data);this.honeycomb.setData(n),this.onRender(!0)}},{key:"updateOptions",value:function(t){this.options=p({},t),this.options.general.minZoom=t.general.zoomRange[0],this.options.general.maxZoom=t.general.zoomRange[1],this.honeycomb.setOptions(this.options),this.onRender(!0)}},{key:"draw",value:function(t){var e=this.options.general;t.globalAlpha=.01*e.opacity,this.container&&t.drawImage(this.container,0,0,this.container.width,this.container.height)}},{key:"show",value:function(){this.onRender(!0),this.options.visibility=!0}},{key:"hide",value:function(){c(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"hide",this).call(this),this.options.visibility=!1}},{key:"destroy",value:function(){this.options=null,delete this.options}}]),a;function a(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return e.addTo(o),e.options=p({},t),e.options.general.minZoom=t.general.zoomRange[0],e.options.general.maxZoom=t.general.zoomRange[1],e.options.visibility=!0,e.init(),e}},t.exports});;
Cube("datav:/com/datav-2dmap-honeycomb-cluster/3.0.8",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(e,t,o,n,i,r){var a=function(e,t,o){return t&&s(e.prototype,t),o&&s(e,o),e};function s(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=o("datav:/npm/eventemitter3/3.0.0"),h=o("datav:/npm/safely-merge/1.0.1"),y=o("datav:/com/datav-2dmap-honeycomb-cluster/3.0.8/src/honeycombLayer"),u=o("datav:/com/datav-2dmap-honeycomb-cluster/3.0.8/config").DEFAULT_OPTIONS,a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(p,l),a(p,[{key:"addTo",value:function(e,t){this.options.id=t;e=y(e);return this.layer=new e(this.options),this}},{key:"onRender",value:function(e){this.layer&&this.layer.onRender&&this.layer.onRender(e)}},{key:"render",value:function(e){var t=[],o=0;if(e&&e.length){for(var n,i=void 0,i=0;i<e.length;i++)n=e[i],Number.isFinite(parseFloat(n.lng))&&Number.isFinite(parseFloat(n.lat))?t.push(n):o++;0<o&&console.log("蜂窝聚合层：有 "+o+" 条异常数据。")}this.layer&&this.layer.render&&this.layer.render(t)}},{key:"resize",value:function(e,t){this.layer&&this.layer.resize&&this.layer.resize(e,t)}},{key:"updateOptions",value:function(e){e=e.options;this.options=h(this.options,e),this.options.general.minZoom=e.general.zoomRange[0],this.options.general.maxZoom=e.general.zoomRange[1],this.layer&&this.layer.updateOptions&&this.layer.updateOptions(this.options)}},{key:"draw",value:function(e){this.layer&&this.layer.draw&&this.layer.draw(e)}},{key:"show",value:function(){this.options.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.options.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"destroy",value:function(){this.layer&&this.layer.destroy&&this.layer.destroy(),this.layer=null,this.options=null,delete this.layer,this.options}}]),p);function p(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(p.__proto__||Object.getPrototypeOf(p)).call(this)),t=t.options;return o.options=h(u,t),o.options.general.minZoom=t.general.zoomRange[0],o.options.general.maxZoom=t.general.zoomRange[1],o.options.visibility=!0,o}return e.exports=a,e.exports});