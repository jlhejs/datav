// env=undefined => env=publish 
Cube("datav:/com/arrow-plotting/0.1.6",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1","datav:/npm/lodash/4.6.1","datav:/npm/jquery/2.1.4"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/npm/lodash/4.6.1"),k=c("datav:/npm/jquery/2.1.4"),l=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=Object.assign({},c),f.container="string"===typeof a?document.querySelector(a):a,f.container=k(a),f.init(),f}return f(b,a),g(b,[{key:"init",value:function(){this.width=this.container[0].clientWidth,this.height=this.container[0].clientHeight,this.text=""}},{key:"render",value:function(a){return a&&a.length?void(this.data=a,this.updateOptions(this.options)):void console.log("\u6570\u636E\u914D\u7F6E\u4E0D\u6B63\u786E")}},{key:"resize",value:function(a,b){this.width=a,this.height=b,this.updateOptions(this.options)}},{key:"updateOptions",value:function(a){this.options=i(this.options,a),this.text="",this.options.textStyle.visibility&&(this.text=this.data[0].content);var b=this.options.lineStyle.lineType.split(","),c=(this.height-2*this.options.lineStyle.weight)*this.options.lineStyle.leftTop+this.options.arrowStyle.height/2,d=(this.height-2*this.options.lineStyle.weight)*this.options.lineStyle.rightTop+this.options.arrowStyle.height/2+2,e="M0 "+(this.options.lineStyle.weight+c)+" C"+this.width*+b[0]+","+(this.options.lineStyle.weight+c)+" "+this.width*+b[1]+","+(this.options.lineStyle.weight+d)+" "+(this.width-this.options.arrowStyle.width)+", "+(this.options.lineStyle.weight+d),f="M"+(this.options.arrowStyle.width-1)+","+this.options.arrowStyle.height/2+" L0,"+this.options.arrowStyle.height+" L0,0 z",g="M0,"+this.options.arrowStyle.height/2+" L"+(this.options.arrowStyle.width-1)+","+this.options.arrowStyle.height+" L"+(this.options.arrowStyle.width-1)+",0 z",h="";this.options.textStyle.timeLength&&this.data[0].textAnimate&&("\u5411\u53F3"==this.options.textStyle.animateDirection?h="<animate attributeName=\"startOffset\" from=\"0\" to =\""+this.width+"\" begin=\"0s\" dur=\""+this.options.textStyle.timeLength+"s\" repeatCount=\"indefinite\"/>":h="<animate attributeName=\"startOffset\" from=\""+this.width+"\" to =\"0\" begin=\"0s\" dur=\""+this.options.textStyle.timeLength+"s\" repeatCount=\"indefinite\"/>");var k="arrowStart"+this.getRandomCode(20),l="arrowEnd"+this.getRandomCode(20),m="";this.options.arrowStyle.visibilityArrowLeft&&(m="marker-start=\"url(#"+k+")\"");var n="";this.options.arrowStyle.visibilityArrowRight&&(n="marker-end=\"url(#"+l+")\"");var o="";this.data[0].lineAnimate&&("\u5411\u53F3"==this.options.lineStyle.animateDirection?o="<animate attributeName=\"stroke-dashoffset\" from=\""+10*this.options.lineStyle.speed+"\" to=\"0\" begin=\"0s\" dur=\"10s\" repeatCount=\"indefinite\" />":o="<animate attributeName=\"stroke-dashoffset\" from=\""+10*-this.options.lineStyle.speed+"\" to=\"0\" begin=\"0s\" dur=\"10s\" repeatCount=\"indefinite\" />");var p=this.options.textStyle.padding+4;"\u6587\u5B57\u5728\u4E0B"==this.options.textStyle.textPosition&&(p=-this.options.textStyle.padding-this.options.textStyle.fontSize);var q="path"+this.getRandomCode(20),r=this.data[0].arrowColor?this.data[0].arrowColor:this.options.arrowStyle.strokeColor,s="<text text-anchor=\"middle\" style='fill:"+(this.data[0].textColor?this.data[0].textColor:this.options.textStyle.color)+";'>\n        <textPath xlink:href=\"#"+q+"\" startOffset=\"50%\" style=\"baseline-shift: "+p+"px;\">\n          "+this.text+h+"\n        </textPath>\n    </text>";this.data[0].alink&&(s="<a href='"+this.data[0].alink+"' target='_blank'>"+s+"</a>");var t="<svg width=\""+this.width+"\" height=\""+this.height+"\">\n      <defs>\n        <marker id=\""+k+"\" markerWidth=\""+this.options.arrowStyle.width+"\" markerHeight=\""+this.options.arrowStyle.height+"\" refx=\"0\" refy=\""+this.options.arrowStyle.height/2+"\" orient=\"auto\" markerUnits=\"userSpaceOnUse\"><path d=\""+g+"\" fill=\""+r+"\" stroke=\""+r+"\" style=\"stroke-width: 0px;\"/></marker>\n        <marker id=\""+l+"\" markerWidth=\""+this.options.arrowStyle.width+"\" markerHeight=\""+this.options.arrowStyle.height+"\" refx=\"0\" refy=\""+this.options.arrowStyle.height/2+"\" orient=\"auto\" markerUnits=\"userSpaceOnUse\"><path d=\""+f+"\" fill=\""+r+"\" stroke=\""+r+"\" style=\"stroke-width: 0px;\"/></marker>\n      </defs>\n      <path id='"+q+"' d=\""+e+"\" stroke=\"red\" fill=\"none\" style=\"stroke-width: 1px;\" "+m+" "+n+">\n        "+o+"\n      </path>\n      "+s+"\n    </svg>";this.container.html(t),this.container.find("path").css({stroke:this.data[0].lineColor?this.data[0].lineColor:this.options.lineStyle.strokeColor,"stroke-width":this.options.lineStyle.weight+"px","stroke-linecap":this.options.lineStyle.strokeLinecap,"stroke-dasharray":this.options.lineStyle.strokeDasharray}),this.container.find("marker").find("path").css({"stroke-width":"0px"}),this.container.find("text").css(j.pick(this.options.textStyle,["fontSize","color","fontWeight","fontFamily"]))}},{key:"getRandomCode",value:function(a){if(0<a){for(var b,c=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],d="",e=0;e<a;e++)b=parseInt(61*Math.random()),d+=c[b];return d}return!1}},{key:"remove",value:function(){this.width=0,this.height=0,this.container.remove()}}]),b}(h);return a.exports=l,a.exports});