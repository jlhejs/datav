// env=undefined => env=publish 
Cube("datav:/com/@datav-city-pro-v2/datav-city-pro/2.2.18",["datav:/npm/eventemitter3/3.0.0","datav:/npm/leaflet/1.6.0","datav:/npm/@ali/datav-vangogh/2.2.10","datav:/npm/safely-merge/1.0.1","datav:/npm/d3/5.16.0","datav:/npm/lodash/4.17.21/cloneDeep"],function(r,n,s,e,i,o){function A(t){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}return function(t,e){"object"==(void 0===n?"undefined":A(n))&&"object"==(void 0===r?"undefined":A(r))?r.exports=e(s("datav:/npm/eventemitter3/3.0.0"),s("datav:/npm/leaflet/1.6.0"),s("datav:/npm/@ali/datav-vangogh/2.2.10"),s("datav:/npm/safely-merge/1.0.1"),s("datav:/npm/d3/5.16.0")):"function"==typeof define&&define.amd?define(["eventemitter3","leaflet","@ali/datav-vangogh","safely-merge","d3"],e):"object"==(void 0===n?"undefined":A(n))?n.Chart=e(s("datav:/npm/eventemitter3/3.0.0"),s("datav:/npm/leaflet/1.6.0"),s("datav:/npm/@ali/datav-vangogh/2.2.10"),s("datav:/npm/safely-merge/1.0.1"),s("datav:/npm/d3/5.16.0")):t.Chart=e(t.eventemitter3,t.leaflet,t["@ali/datav-vangogh"],t["safely-merge"],t.d3)}(window,function(r,n,i,o,a){return function(r){var n={};function i(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}return i.m=r,i.c=n,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==A(e)&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=9)}([function(t,e){t.exports=r},function(t,e){t.exports=n},function(t,e){t.exports=i},function(t,e){t.exports={fov:"setCameraFov",position:"setCameraPosition",rotation:"setCameraRotation",time:"solarChangeTo",size:"updateSize",speed:"updateSpeed",color:"updateColor",sideColor:"updateSideColor",opacity:"updateOpacity",intensity:"updateIntensity",colorScalar:"updateColorScalar",waveDensity:"updateWaveDensity",emissiveIntensity:"updateEmissiveIntensity",envMapIntensityFactor:"updateEnvMapIntensityFactor",scaleFactor:"updateScaleFactor",light:"updateLight",verticalOffset:"updateVerticalOffset",defaultInnerColor:"updateDefaultInnerColor",defaultOuterColor:"updateDefaultOuterColor",defaultScale:"updateDefaultScale",defaultHeight:"updateDefaultHeight",defaultBase:"updateDefaultBase",defaultHeightRatio:"updateDefaultHeightRatio",length:"updateLength",angle:"updateAngle",bokehRadius:"updateBokehRadius",aperture:"updateBokehAperture",focalDistance:"updateBokehFocalDistance",focalSize:"updateBokehFocalSize"}},function(t,e,i){function o(t){return(o="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function u(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=c(r);return function(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n?(t=c(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=i(1),r=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}(n,i(0));var t,e,r=u(n);function n(t){var e;return function(t){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this),(e=r.call(this)).map=t,e.latlng=l.latLng(0,0),e.pixelCoord=l.point(0,0),e}return e=[{key:"pixelCoord2latlng",value:function(t,e){e=l.point(e.x,e.y);return t.layerPointToLatLng(e)}}],a((t=n).prototype,[{key:"setLatlng",value:function(t){var e=t;if(1<arguments.length)e=l.latLng(t,arguments[1]);else if(!t instanceof l.latLng){if(void 0===t.lat||void 0===t.lng)return console.log("Invalid paramter in SuperMarker.setLatlng: ".concat(t,"!"));e=l.latLng(t.lat,t.lng)}this.latlng=e}},{key:"getLatlng",value:function(){return this.latlng}},{key:"lat",get:function(){return this.latlng.lat}},{key:"lng",get:function(){return this.latlng.lng}},{key:"setPixelCoord",value:function(t){t=l.point(t.x,t.y),this.latlng=this.map.layerPointToLatLng(t)}},{key:"getPixelCoord",value:function(){return this.map.latLngToLayerPoint(this.latlng)}}]),a(t,e),Object.defineProperty(t,"prototype",{writable:!1}),n}();t.exports=r},function(t,e){function o(t){return r.includes(t)}var r=["solar","camera","globe_light","postprocessing_postprocessing_bokeh"];t.exports={isGlobalVar:o,getEntity:function(t,e,r){var n,i=null;return o(t)?(i=e["".concat(t,"Node")])||(n=t.split("_"))[0]&&(i=e["".concat(n[0],"Node")]):i=r.get(t),i},getSubcoms:function(t,r){var n=[];return t.forEach(function(t,e){o(e)||n.push(r.get(e))}),n},getSubcomsIdAndAttributeName:function(t){var r={};return t.forEach(function(t,e){o(e)||(t=Array.from(t.attrsSet),r[e]=t)}),r}}},function(e,r,n){function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function f(t){return(f="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var y=n(7),b=n(36),h=Math.abs,a=Math.min,u=Math.max,m=Math.cos,v=Math.sin,o=Math.acos,d=Math.sqrt,c=Math.PI,n=function(){function p(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,p);var r,e=t&&t.forEach?t:Array.from(arguments).slice(),n=!1,i=("object"===f(e[0])&&(n=e.length,r=[],e.forEach(function(e){["x","y","z"].forEach(function(t){void 0!==e[t]&&r.push(e[t])})}),e=r),!1),o=e.length;if(n){if(4<n){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");i=!0}}else if(6!==o&&8!==o&&9!==o&&12!==o&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");for(var a=this._3d=!i&&(9===o||12===o)||t&&t[0]&&void 0!==t[0].z,s=this.points=[],u=0,c=a?3:2;u<o;u+=c){var l={x:e[u],y:e[u+1]};a&&(l.z=e[u+2]),s.push(l)}n=this.order=s.length-1,i=this.dims=["x","y"],a&&i.push("z"),this.dimlen=i.length,i=y.align(s,{p1:s[0],p2:s[n]});this._linear=!i.some(function(t){return 1e-4<h(t.y)}),this._lut=[],this._t1=0,this._t2=1,this.update()}var e=p,r=[{key:"quadraticFromPoints",value:function(t,e,r,n){if(0===(n=void 0===n?.5:n))return new p(e,e,r);if(1===n)return new p(t,e,e);e=p.getABC(2,t,e,r,n);return new p(t,e.A,r)}},{key:"cubicFromPoints",value:function(t,e,r,n,i){var o=p.getABC(3,t,e,r,n=void 0===n?.5:n),a=(i=void 0===i?y.dist(e,o.C):i)*(1-n)/n,s=y.dist(t,r),u=(r.x-t.x)/s,s=(r.y-t.y)/s,c=e.x-i*u,i=e.y-i*s,u=e.x+a*u,e=e.y+a*s,a=o.A,s=a.x+(c-a.x)/(1-n),o=a.y+(i-a.y)/(1-n),c=a.x+(u-a.x)/n,i=a.y+(e-a.y)/n;return new p(t,{x:t.x+(s-t.x)/n,y:t.y+(o-t.y)/n},{x:r.x+(c-r.x)/(1-n),y:r.y+(i-r.y)/(1-n)},r)}},{key:"getUtils",value:function(){return y}},{key:"PolyBezier",get:function(){return b}},{key:"getABC",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2,e=1<arguments.length?arguments[1]:void 0,r=2<arguments.length?arguments[2]:void 0,n=3<arguments.length?arguments[3]:void 0,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.5,o=y.projectionratio(i,t),a=1-o,o={x:o*e.x+a*n.x,y:o*e.y+a*n.y},a=y.abcratio(i,t);return{A:{x:r.x+(r.x-o.x)/a,y:r.y+(r.y-o.y)/a},B:r,C:o,S:e,E:n}}}];return i(e.prototype,[{key:"getUtils",value:function(){return p.getUtils()}},{key:"valueOf",value:function(){return this.toString()}},{key:"toString",value:function(){return y.pointsToString(this.points)}},{key:"toSVG",value:function(){if(this._3d)return!1;for(var t=this.points,e=["M",t[0].x,t[0].y,2===this.order?"Q":"C"],r=1,n=t.length;r<n;r++)e.push(t[r].x),e.push(t[r].y);return e.join(" ")}},{key:"setRatios",value:function(t){if(t.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=t,this._lut=[]}},{key:"verify",value:function(){var t=this.coordDigest();t!==this._print&&(this._print=t,this.update())}},{key:"coordDigest",value:function(){return this.points.map(function(t,e){return"".concat(e).concat(t.x).concat(t.y).concat(t.z||0)}).join("")}},{key:"update",value:function(){this._lut=[],this.dpoints=y.derive(this.points,this._3d),this.computedirection()}},{key:"computedirection",value:function(){var t=this.points,t=y.angle(t[0],t[this.order],t[1]);this.clockwise=0<t}},{key:"length",value:function(){return y.length(this.derivative.bind(this))}},{key:"getABC",value:function(t,e){e=e||this.get(t);var r=this.points[0],n=this.points[this.order];return p.getABC(this.order,r,e,n,t)}},{key:"getLUT",value:function(t){if(this.verify(),this._lut.length!==(t=t||100)){this._lut=[],t--;for(var e,r,n=0;n<t;n++)(e=this.compute(r=n/(t-1))).t=r,this._lut.push(e)}return this._lut}},{key:"on",value:function(e,r){r=r||5;for(var n,i=this.getLUT(),o=[],a=0;a<i.length;a++)n=i[a],y.dist(n,e)<r&&(o.push(n),i.length);return!!o.length&&(t/=o.length)}},{key:"project",value:function(t){var e,r,n=this.getLUT(),i=n.length-1,n=y.closest(n,t),o=n.mpos,a=(o+1)/i,s=.1/i,u=n.mdist,c=(o-1)/i,l=c;for(u+=1;c<a+s;c+=s)e=this.compute(c),(r=y.dist(t,e))<u&&(u=r,l=c);return(e=this.compute(l=l<0?0:1<l?1:l)).t=l,e.d=u,e}},{key:"get",value:function(t){return this.compute(t)}},{key:"point",value:function(t){return this.points[t]}},{key:"compute",value:function(t){return this.ratios?y.computeWithRatios(t,this.points,this.ratios,this._3d):y.compute(t,this.points,this._3d,this.ratios)}},{key:"raise",value:function(){for(var t,e,r=this.points,n=[r[0]],i=r.length,o=1;o<i;o++)t=r[o],e=r[o-1],n[o]={x:(i-o)/i*t.x+o/i*e.x,y:(i-o)/i*t.y+o/i*e.y};return n[i]=r[i-1],new p(n)}},{key:"derivative",value:function(t){return y.compute(t,this.dpoints[0],this._3d)}},{key:"dderivative",value:function(t){return y.compute(t,this.dpoints[1],this._3d)}},{key:"align",value:function(){var t=this.points;return new p(y.align(t,{p1:t[0],p2:t[t.length-1]}))}},{key:"curvature",value:function(t){return y.curvature(t,this.dpoints[0],this.dpoints[1],this._3d)}},{key:"inflections",value:function(){return y.inflections(this.points)}},{key:"normal",value:function(t){return this._3d?this.__normal3(t):this.__normal2(t)}},{key:"__normal2",value:function(t){var t=this.derivative(t),e=d(t.x*t.x+t.y*t.y);return{x:-t.y/e,y:t.x/e}}},{key:"__normal3",value:function(t){var e=this.derivative(t),t=this.derivative(t+.01),r=d(e.x*e.x+e.y*e.y+e.z*e.z),n=d(t.x*t.x+t.y*t.y+t.z*t.z),r=(e.x/=r,e.y/=r,e.z/=r,t.x/=n,t.y/=n,t.z/=n,{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}),n=d(r.x*r.x+r.y*r.y+r.z*r.z),t=(r.x/=n,r.y/=n,r.z/=n,[r.x*r.x,r.x*r.y-r.z,r.x*r.z+r.y,r.x*r.y+r.z,r.y*r.y,r.y*r.z-r.x,r.x*r.z-r.y,r.y*r.z+r.x,r.z*r.z]);return{x:t[0]*e.x+t[1]*e.y+t[2]*e.z,y:t[3]*e.x+t[4]*e.y+t[5]*e.z,z:t[6]*e.x+t[7]*e.y+t[8]*e.z}}},{key:"hull",value:function(t){var e=this.points,r=[],n=[],i=0;for(n[i++]=e[0],n[i++]=e[1],n[i++]=e[2],3===this.order&&(n[i++]=e[3]);1<e.length;){for(var o,r=[],a=0,s=e.length-1;a<s;a++)o=y.lerp(t,e[a],e[a+1]),n[i++]=o,r.push(o);e=r}return n}},{key:"split",value:function(t,e){if(0===t&&e)return this.split(e).left;if(1===e)return this.split(t).right;var r=this.hull(t),r={left:2===this.order?new p([r[0],r[3],r[5]]):new p([r[0],r[4],r[7],r[9]]),right:2===this.order?new p([r[5],r[4],r[2]]):new p([r[9],r[8],r[6],r[3]]),span:r};return r.left._t1=y.map(0,0,1,this._t1,this._t2),r.left._t2=y.map(t,0,1,this._t1,this._t2),r.right._t1=y.map(t,0,1,this._t1,this._t2),r.right._t2=y.map(1,0,1,this._t1,this._t2),e?(e=y.map(e,t,1,0,1),r.right.split(e).left):r}},{key:"extrema",value:function(){var n={},i=[];return this.dims.forEach(function(e){function t(t){return t[e]}var r=this.dpoints[0].map(t);n[e]=y.droots(r),3===this.order&&(r=this.dpoints[1].map(t),n[e]=n[e].concat(y.droots(r))),n[e]=n[e].filter(function(t){return 0<=t&&t<=1}),i=i.concat(n[e].sort(y.numberSort))}.bind(this)),n.values=i.sort(y.numberSort).filter(function(t,e){return i.indexOf(t)===e}),n}},{key:"bbox",value:function(){var e=this.extrema(),r={};return this.dims.forEach(function(t){r[t]=y.getminmax(this,t,e[t])}.bind(this)),r}},{key:"overlaps",value:function(t){var e=this.bbox(),t=t.bbox();return y.bboxoverlap(e,t)}},{key:"offset",value:function(r,t){var e,n,i,o;return void 0!==t?(i={c:e=this.get(r),n:n=this.normal(r),x:e.x+n.x*t,y:e.y+n.y*t},this._3d&&(i.z=e.z+n.z*t),i):this._linear?(o=this.normal(0),[new p(this.points.map(function(t){var e={x:t.x+r*o.x,y:t.y+r*o.y};return t.z&&o.z&&(e.z=t.z+r*o.z),e}))]):this.reduce().map(function(t){return t._linear?t.offset(r)[0]:t.scale(r)})}},{key:"simple",value:function(){if(3===this.order){var t=y.angle(this.points[0],this.points[3],this.points[1]),e=y.angle(this.points[0],this.points[3],this.points[2]);if(0<t&&e<0||t<0&&0<e)return!1}var t=this.normal(0),e=this.normal(1),r=t.x*e.x+t.y*e.y;return this._3d&&(r+=t.z*e.z),h(o(r))<c/3}},{key:"reduce",value:function(){var t,e,r=0,n=0,i=[],o=[],a=this.extrema().values;for(-1===(a=-1===a.indexOf(0)?[0].concat(a):a).indexOf(1)&&a.push(1),r=a[0],t=1;t<a.length;t++)n=a[t],(e=this.split(r,n))._t1=r,e._t2=n,i.push(e),r=n;return i.forEach(function(t){for(n=r=0;n<=1;)for(n=r+.01;n<=1.01;n+=.01)if(!(e=t.split(r,n)).simple()){if(h(r-(n-=.01))<.01)return[];(e=t.split(r,n))._t1=y.map(r,0,1,t._t1,t._t2),e._t2=y.map(n,0,1,t._t1,t._t2),o.push(e),r=n;break}r<1&&((e=t.split(r,1))._t1=y.map(r,0,1,t._t1,t._t2),e._t2=t._t2,o.push(e))}),o}},{key:"scale",value:function(o){var n=this,a=this.order,s="function"==typeof o?o:!1;if(s&&2===a)return this.raise().scale(s);var u=this.clockwise,r=s?s(0):o,i=s?s(1):o,c=[this.offset(0,10),this.offset(1,10)],l=this.points,f=[],h=y.lli4(c[0],c[0].c,c[1],c[1].c);if(h)return[0,1].forEach(function(t){var e=f[t*a]=y.copy(l[t*a]);e.x+=(t?i:r)*c[t].n.x,e.y+=(t?i:r)*c[t].n.y}),[0,1].forEach(s?function(t){var e,r,n,i;2===a&&t||(r={x:(e=l[t+1]).x-h.x,y:e.y-h.y},n=s?s((t+1)/a):o,s&&!u&&(n=-n),i=d(r.x*r.x+r.y*r.y),r.x/=i,r.y/=i,f[t+1]={x:e.x+n*r.x,y:e.y+n*r.y})}:function(t){var e,r;2===a&&t||(e=f[t*a],r=n.derivative(t),r={x:e.x+r.x,y:e.y+r.y},f[t+1]=y.lli4(e,r,h,l[t+1]))}),new p(f);throw new Error("cannot scale this curve. Try reducing it first.")}},{key:"outline",value:function(r,n,i,o){n=void 0===n?r:n;var e,t=this.reduce(),a=t.length,s=[],u=[],c=0,l=this.length(),f=void 0!==i&&void 0!==o;function h(r,n,i,o,a){return function(t){var e=n-r;return y.map(t,0,1,r+o/i*e,r+(o+a)/i*e)}}t.forEach(function(t){var e=t.length();f?(s.push(t.scale(h(r,i,l,c,e))),u.push(t.scale(h(-n,-o,l,c,e)))):(s.push(t.scale(r)),u.push(t.scale(-n))),c+=e});var u=u.map(function(t){return(e=t.points)[3]?t.points=[e[3],e[2],e[1],e[0]]:t.points=[e[2],e[1],e[0]],t}).reverse(),t=s[0].points[0],p=s[a-1].points[s[a-1].points.length-1],a=u[a-1].points[u[a-1].points.length-1],d=u[0].points[0],a=y.makeline(a,t),t=y.makeline(p,d),p=[a].concat(s).concat([t]).concat(u);return p.length,new b(p)}},{key:"outlineshapes",value:function(t,e,r){for(var n=this.outline(t,e=e||t).curves,i=[],o=1,a=n.length;o<a/2;o++){var s=y.makeshape(n[o],n[a-o],r);s.startcap.virtual=1<o,s.endcap.virtual=o<a/2-1,i.push(s)}return i}},{key:"intersects",value:function(t,e){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof p&&(t=t.reduce()),this.curveintersects(this.reduce(),t,e)):this.selfintersects(e)}},{key:"lineIntersects",value:function(t){var e=this,r=a(t.p1.x,t.p2.x),n=a(t.p1.y,t.p2.y),i=u(t.p1.x,t.p2.x),o=u(t.p1.y,t.p2.y);return y.roots(this.points,t).filter(function(t){t=e.get(t);return y.between(t.x,r,i)&&y.between(t.y,n,o)})}},{key:"selfintersects",value:function(t){for(var e,r,n=this.reduce(),i=n.length-2,o=[],a=0;a<i;a++)e=n.slice(a,a+1),r=n.slice(a+2),e=this.curveintersects(e,r,t),o.push.apply(o,function(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}()||function(t){if(t){if("string"==typeof t)return s(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(e="Object"===e&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?s(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e));return o}},{key:"curveintersects",value:function(t,r,e){var n=[],i=(t.forEach(function(e){r.forEach(function(t){e.overlaps(t)&&n.push({left:e,right:t})})}),[]);return n.forEach(function(t){t=y.pairiteration(t.left,t.right,e);0<t.length&&(i=i.concat(t))}),i}},{key:"arcs",value:function(t){return this._iterate(t=t||.5,[])}},{key:"_error",value:function(t,e,r,n){var i=(n-r)/4,r=this.get(r+i),n=this.get(n-i),i=y.dist(t,e),e=y.dist(t,r),r=y.dist(t,n);return h(e-i)+h(r-i)}},{key:"_iterate",value:function(t,e){var r=0,n=1;do{var i,o,a,s,u=0,n=1,c=this.get(r),l=void 0,f=void 0,h=!1,p=void 0,d=1;do{if(o=h,f=l,s=this.get(a=(r+n)/2),i=this.get(n),(l=y.getccenter(c,s,i)).interval={start:r,end:n},h=this._error(l,c,r,n)<=t,(p=o&&!h)||(d=n),h){if(1<=n){l.interval.end=d=1,f=l,1<n&&(s={x:l.x+l.r*m(l.e),y:l.y+l.r*v(l.e)},l.e+=y.angle({x:l.x,y:l.y},s,this.get(1)));break}n+=(n-r)/2}else n=a}while(!p&&u++<100)}while(!(100<=u)&&(e.push(f=f||l),r=d,n<1));return e}}]),i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),p}();e.exports=n},function(t,e,r){var a=r(6),f=Math.abs,h=Math.cos,p=Math.sin,u=Math.acos,d=Math.atan2,y=Math.sqrt,b=Math.pow;function c(t){return t<0?-b(-t,1/3):b(t,1/3)}var r=Math.PI,m=2*r,v=r/2,l=Number.MAX_SAFE_INTEGER||9007199254740991,g=Number.MIN_SAFE_INTEGER||-9007199254740991,_={x:0,y:0,z:0},k={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,e){e=e(t),t=e.x*e.x+e.y*e.y;return void 0!==e.z&&(t+=e.z*e.z),y(t)},compute:function(t,e,r){if(0===t)return e[0].t=0,e[0];var n=e.length-1;if(1===t)return e[n].t=1,e[n];var i,o,a,s,u,c,l=1-t,f=e;if(0==n)return e[0].t=t,e[0];if(1==n)return s={x:l*f[0].x+t*f[1].x,y:l*f[0].y+t*f[1].y,t:t},r&&(s.z=l*f[0].z+t*f[1].z),s;if(n<4)return s=l*l,u=t*t,c=0,2==n?(f=[f[0],f[1],f[2],_],i=s,o=l*t*2,a=u):3==n&&(i=s*l,o=s*t*3,a=l*u*3,c=t*u),n={x:i*f[0].x+o*f[1].x+a*f[2].x+c*f[3].x,y:i*f[0].y+o*f[1].y+a*f[2].y+c*f[3].y,t:t},r&&(n.z=i*f[0].z+o*f[1].z+a*f[2].z+c*f[3].z),n;for(var h=JSON.parse(JSON.stringify(e));1<h.length;){for(var p=0;p<h.length-1;p++)h[p]={x:h[p].x+(h[p+1].x-h[p].x)*t,y:h[p].y+(h[p+1].y-h[p].y)*t},void 0!==h[p].z&&(h[p]=h[p].z+(h[p+1].z-h[p].z)*t);h.splice(h.length-1,1)}return h[0].t=t,h[0]},computeWithRatios:function(t,e,r,n){var i,o=1-t,a=r[0],s=r[1],u=r[2],r=r[3];return a*=o,s*=t,2===e.length?{x:(a*e[0].x+s*e[1].x)/(i=a+s),y:(a*e[0].y+s*e[1].y)/i,z:!!n&&(a*e[0].z+s*e[1].z)/i,t:t}:(a*=o,s*=2*o,u*=t*t,3===e.length?{x:(a*e[0].x+s*e[1].x+u*e[2].x)/(i=a+s+u),y:(a*e[0].y+s*e[1].y+u*e[2].y)/i,z:!!n&&(a*e[0].z+s*e[1].z+u*e[2].z)/i,t:t}:(a*=o,s*=1.5*o,u*=3*o,r*=t*t*t,4===e.length?{x:(a*e[0].x+s*e[1].x+u*e[2].x+r*e[3].x)/(i=a+s+u+r),y:(a*e[0].y+s*e[1].y+u*e[2].y+r*e[3].y)/i,z:!!n&&(a*e[0].z+s*e[1].z+u*e[2].z+r*e[3].z)/i,t:t}:void 0))},derive:function(t,e){for(var r=[],n=t,i=n.length,o=i-1;1<i;i--,o--){for(var a,s=[],u=0;u<o;u++)a={x:o*(n[u+1].x-n[u].x),y:o*(n[u+1].y-n[u].y)},e&&(a.z=o*(n[u+1].z-n[u].z)),s.push(a);r.push(s),n=s}return r},between:function(t,e,r){return e<=t&&t<=r||k.approximately(t,e)||k.approximately(t,r)},approximately:function(t,e,r){return f(t-e)<=(r||1e-6)},length:function(t){for(var e,r=k.Tvalues.length,n=0,i=0;i<r;i++)e=.5*k.Tvalues[i]+.5,n+=k.Cvalues[i]*k.arcfn(e,t);return.5*n},map:function(t,e,r,n,i){return n+(t-e)/(r-e)*(i-n)},lerp:function(t,e,r){var n={x:e.x+t*(r.x-e.x),y:e.y+t*(r.y-e.y)};return void 0!==e.z&&void 0!==r.z&&(n.z=e.z+t*(r.z-e.z)),n},pointToString:function(t){var e="".concat(t.x,"/").concat(t.y);return void 0!==t.z&&(e+="/".concat(t.z)),e},pointsToString:function(t){return"[".concat(t.map(k.pointToString).join(", "),"]")},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,e,r){var n=e.x-t.x,e=e.y-t.y,i=r.x-t.x,r=r.y-t.y;return d(n*r-e*i,n*i+e*r)},round:function(t,e){var t="".concat(t),r=t.indexOf(".");return parseFloat(t.substring(0,r+1+e))},dist:function(t,e){var r=t.x-e.x,t=t.y-e.y;return y(r*r+t*t)},closest:function(t,r){var n,i,o=b(2,63);return t.forEach(function(t,e){(i=k.dist(r,t))<o&&(o=i,n=e)}),{mdist:o,mpos:n}},abcratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;t=b(t,e)+b(1-t,e);return f((t-1)/t)},projectionratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;var r=b(1-t,e);return r/(b(t,e)+r)},lli8:function(t,e,r,n,i,o,a,s){var u=(t-r)*(o-s)-(e-n)*(i-a);return 0!=u&&{x:((t*n-e*r)*(i-a)-(t-r)*(i*s-o*a))/u,y:((t*n-e*r)*(o-s)-(e-n)*(i*s-o*a))/u}},lli4:function(t,e,r,n){var i=t.x,t=t.y,o=e.x,e=e.y,a=r.x,r=r.y,s=n.x,n=n.y;return k.lli8(i,t,o,e,a,r,s,n)},lli:function(t,e){return k.lli4(t,t.c,e,e.c)},makeline:function(t,e){var r=t.x,t=t.y,n=e.x,e=e.y,i=(n-r)/3,o=(e-t)/3;return new a(r,t,r+i,t+o,r+2*i,t+2*o,n,e)},findbbox:function(t){var e=l,r=l,n=g,i=g;return t.forEach(function(t){t=t.bbox();e>t.x.min&&(e=t.x.min),r>t.y.min&&(r=t.y.min),n<t.x.max&&(n=t.x.max),i<t.y.max&&(i=t.y.max)}),{x:{min:e,mid:(e+n)/2,max:n,size:n-e},y:{min:r,mid:(r+i)/2,max:i,size:i-r}}},shapeintersections:function(n,t,i,e,o){if(!k.bboxoverlap(t,e))return[];var a=[],t=[n.startcap,n.forward,n.back,n.endcap],s=[i.startcap,i.forward,i.back,i.endcap];return t.forEach(function(r){r.virtual||s.forEach(function(t){var e;t.virtual||0<(e=r.intersects(t,o)).length&&(e.c1=r,e.c2=t,e.s1=n,e.s2=i,a.push(e))})}),a},makeshape:function(t,e,r){var n=e.points.length,i=t.points.length,n=k.makeline(e.points[n-1],t.points[0]),i=k.makeline(t.points[i-1],e.points[0]),o={startcap:n,forward:t,back:e,endcap:i,bbox:k.findbbox([n,t,e,i]),intersections:function(t){return k.shapeintersections(o,o.bbox,t,t.bbox,r)}};return o},getminmax:function(t,e,r){if(!r)return{min:0,max:0};var n,i=l,o=g;-1===(r=-1===r.indexOf(0)?[0].concat(r):r).indexOf(1)&&r.push(1);for(var a=0,s=r.length;a<s;a++)n=r[a],(n=t.get(n))[e]<i&&(i=n[e]),n[e]>o&&(o=n[e]);return{min:i,mid:(i+o)/2,max:o,size:o-i}},align:function(t,e){var r=e.p1.x,n=e.p1.y,i=-d(e.p2.y-n,e.p2.x-r);return t.map(function(t){return{x:(t.x-r)*h(i)-(t.y-n)*p(i),y:(t.x-r)*p(i)+(t.y-n)*h(i)}})},roots:function(t,e){function r(t){return 0<=t&&t<=1}var n=t.length-1,t=k.align(t,e=e||{p1:{x:0,y:0},p2:{x:1,y:0}});if(2==n)return 0!==(o=(e=t[0].y)-2*(n=t[1].y)+(a=t[2].y))?[-((i=-y(n*n-e*a))+(e=-e+n))/o,-(-i+e)/o].filter(r):n!==a&&0===o?[(2*n-a)/(2*n-2*a)].filter(r):[];var i=t[0].y,e=t[1].y,o=t[2].y,n=3*e-i-3*o+t[3].y,a=3*i-6*e+3*o,t=-3*i+3*e,o=i;if(k.approximately(n,0)){if(k.approximately(a,0))return k.approximately(t,0)?[]:[-o/t].filter(r);e=y(t*t-4*a*o),i=2*a;return[(e-t)/i,(-t-e)/i].filter(r)}var s,e=(3*(t/=n)-(a/=n)*a)/3,i=e/3,t=(2*a*a*a-9*a*t+27*(o/=n))/27,n=t/2,o=n*n+i*i*i;if(o<0)return e=y((i=-e/3)*i*i),t=u((i=-t/(2*e))<-1?-1:1<i?1:i),[(i=2*c(e))*h(t/3)-a/3,i*h((t+m)/3)-a/3,i*h((t+2*m)/3)-a/3].filter(r);if(0==o)return[2*(s=n<0?c(-n):-c(n))-a/3,-s-a/3].filter(r);e=y(o);return[(s=c(-n+e))-c(n+e)-a/3].filter(r)},droots:function(t){var e,r,n,i,o;return 3===t.length?0!==(n=(o=t[0])-2*(e=t[1])+(r=t[2]))?[-((i=-y(e*e-o*r))+(o=-o+e))/n,-(-i+o)/n]:e!==r&&0===n?[(2*e-r)/(2*(e-r))]:[]:2===t.length&&(i=t[0])!==(o=t[1])?[i/(i-o)]:[]},curvature:function(t,e,r,n,i){var o=k.compute(t,e),a=k.compute(t,r),s=o.x*o.x+o.y*o.y,o=n?(u=y(b(o.y*a.z-a.y*o.z,2)+b(o.z*a.x-a.z*o.x,2)+b(o.x*a.y-a.x*o.y,2)),b(s+o.z*o.z,1.5)):(u=o.x*a.y-o.y*a.x,b(s,1.5));if(0===u||0===o)return{k:0,r:0};var u,c,l,a=u/o,s=o/u;return i||(o=k.curvature(t-.001,e,r,n,!0).k,c=((u=k.curvature(t+.001,e,r,n,!0).k)-a+(a-o))/2,l=(f(u-a)+f(a-o))/2),{k:a,r:s,dk:c,adk:l}},inflections:function(t){if(t.length<4)return[];var t=k.align(t,{p1:t[0],p2:t.slice(-1)[0]}),e=t[2].x*t[1].y,r=t[3].x*t[1].y,n=t[1].x*t[2].y,t=18*(-3*e+2*r+3*n-t[3].x*t[2].y),r=18*(3*e-r-3*n),n=18*(n-e);if(k.approximately(t,0)){if(!k.approximately(r,0)){e=-n/r;if(0<=e&&e<=1)return[e]}return[]}e=Math.sqrt(r*r-4*t*n),n=2*t;return k.approximately(n,0)?[]:[(e-r)/n,-(r+e)/n].filter(function(t){return 0<=t&&t<=1})},bboxoverlap:function(t,e){for(var r,n,i,o=["x","y"],a=o.length,s=0;s<a;s++)if(r=t[i=o[s]].mid,n=e[i].mid,i=(t[i].size+e[i].size)/2,f(r-n)>=i)return!1;return!0},expandbox:function(t,e){e.x.min<t.x.min&&(t.x.min=e.x.min),e.y.min<t.y.min&&(t.y.min=e.y.min),e.z&&e.z.min<t.z.min&&(t.z.min=e.z.min),e.x.max>t.x.max&&(t.x.max=e.x.max),e.y.max>t.y.max&&(t.y.max=e.y.max),e.z&&e.z.max>t.z.max&&(t.z.max=e.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,e,r){var n=t.bbox(),i=e.bbox(),o=r||.5;if(n.x.size+n.y.size<o&&i.x.size+i.y.size<o)return["".concat((1e5*(t._t1+t._t2)/2|0)/1e5,"/").concat((1e5*(e._t1+e._t2)/2|0)/1e5)];var r=t.split(.5),n=e.split(.5),i=(i=[{left:r.left,right:n.left},{left:r.left,right:n.right},{left:r.right,right:n.right},{left:r.right,right:n.left}]).filter(function(t){return k.bboxoverlap(t.left.bbox(),t.right.bbox())}),a=[];return 0===i.length?a:(i.forEach(function(t){a=a.concat(k.pairiteration(t.left,t.right,o))}),a=a.filter(function(t,e){return a.indexOf(t)===e}))},getccenter:function(t,e,r){var n,i=e.x-t.x,o=e.y-t.y,a=r.x-e.x,s=r.y-e.y,u=i*h(v)-o*p(v),i=i*p(v)+o*h(v),o=a*h(v)-s*p(v),a=a*p(v)+s*h(v),s=(t.x+e.x)/2,c=(t.y+e.y)/2,l=(e.x+r.x)/2,f=(e.y+r.y)/2,s=k.lli8(s,c,s+u,c+i,l,f,l+o,f+a),u=k.dist(s,t),c=d(t.y-s.y,t.x-s.x),i=d(e.y-s.y,e.x-s.x),l=d(r.y-s.y,r.x-s.x);return c<l?((i<c||l<i)&&(c+=m),l<c&&(n=l,l=c,c=n)):l<i&&i<c?(n=l,l=c,c=n):l+=m,s.s=c,s.e=l,s.r=u,s},numberSort:function(t,e){return t-e}};t.exports=k},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,r){function i(t){return(i="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function n(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)),n}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){d(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,o=[],a=!0,s=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(o.push(n.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}}(t,e)||a(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){if(t){if("string"==typeof t)return u(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(r="Object"===r&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(t,e):void 0}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function f(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=p(r);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}(this,n?(t=p(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}var y,b,m=r(0),v=(r(10),r(11)),g=(r(12),r(16)),r=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}(n,m);var t,e,r=f(n);function n(t,e){!function(t){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this),d(h(a=r.call(this)),"_addInfoWrapper",function(t){var e=document.createElement("div");e.classList.add("city-pro-info-wrapper"),t.append(e),a.infoWrapper=e}),d(h(a),"_addNotify",function(t){var e,r,n;a.infoWrapper&&((e=document.createElement("div")).classList.add("notify-container","info-move-in"),(r=document.createElement("div")).classList.add("close-btn"),r.addEventListener("click",function(){a._removeNotify(e)}),(n=document.createElement("p")).innerText=t,e.append(r),e.append(n),a.infoWrapper.append(e),setTimeout(function(){a._removeNotify(e)},3e3))}),d(h(a),"_removeNotify",function(t){t&&(t.addEventListener("animationend",function(){t.remove(),t=null}),t.classList.remove("info-move-in"),t.classList.add("info-move-out"))}),d(h(a),"_addLoadingMask",function(t){var e=document.createElement("div"),t=(e.classList.add("loading-mask"),t.append(e),document.createElement("img")),r=(t.classList.add("loading-logo"),t.src=a.options.loadingImg||"https://img.alicdn.com/imgextra/i3/O1CN01yNBPKw1WB5XwLVTvg_!!6000000002749-2-tps-1404-720.png",t.alt="loading...",document.createElement("div")),n=(r.classList.add("loading-bar"),document.createElement("div")),i=(n.classList.add("loading-bar-foreground"),n.addEventListener("transitionend",function(){a.initialized&&(a.loadingTransitionEnd=!0,a._tryRemoveLoadingMask())}),document.createElement("div")),i=(i.classList.add("loading-lighting"),n.append(i),r.append(n),document.createElement("div")),o=(i.classList.add("text-wp"),i.innerText="场景正在载入...",document.createElement("div"));o.classList.add("enter-button"),o.innerText="立即进入",o.addEventListener("click",function(){a._tryRemoveLoadingMask(!0)}),e.append(t),e.append(i),e.append(r),e.append(o),setTimeout(function(){a._showEnterButton()},6e4),a.loadingMask=e,a.loadingBarFore=n,a.enterButton=o,a.lastDrawLoadingRatio=0}),d(h(a),"_addLoadingText",function(t){var e;a.loadingTextWp&&((e=document.createElement("p")).innerText=a.promiseList.length?"".concat(t," [").concat(a.renderedIdSet.size,"/").concat(a.promiseList.length,"]"):t,a.loadingTextWp.append(e),a.loadingTextWp.scrollTop=a.loadingTextWp.scrollHeight)}),a.container="string"==typeof t?document.querySelector(t):t,a.options=e,a.subComs=new Map,a.core=new g(a.container,a.options,a.subComs),a.core.initSceneEditor();var a,e=a.core.THREE;return y=new e.Vector2,b=new e.Vector3,a.dispatchCityproCoreEvents(),a.promiseList=[],a.basicFeaturePromiseList=[],a.renderedIdSet=new Set,a._anchorCoordsFlag=!1,a.anchorCoords=void 0,a.anchorViewVariedHandler=a.anchorViewVariedHandler.bind(h(a)),a.core.addEventListener(),a.core.sceneEditor.assetsNode.loadAssets(),a.initialized=!1,t.addEventListener("contextmenu",function(t){return t.preventDefault()}),a.resumePlayTimer=null,a.pausePlayByMouse(),a._addInfoWrapper(t),a.loadingTransitionEnd=!1,a.options.showLoadingInfo&&a._addLoadingMask(t),a.pausedDetail=0,a.needPlayAfterShow=!1,a}return e=[{key:"initCameraEditor",value:function(t,e,r){var n=e.cameraPathDom,i=e.cameraAltDom,o=e.planarTileUrlTemplate,e=e.cameraMarkerUrl,r=r.UI,t=t.instance,r=r.mapControlCreator;t.core.sceneEditor.initCameraEditor(n,i,r,o,e)}},{key:"toggleCameraPathPanel",value:function(t,e){t=t.instance,e=e.visible;t.core.sceneEditor.toggleCameraPathPanel(e)}},{key:"toggleCameraAltPanel",value:function(t,e){t=t.instance,e=e.visible;t.core.sceneEditor.toggleCameraAltPanel(e)}},{key:"resizeCameraPathPanel",value:function(t,e){var t=t.instance,r=e.width,e=e.height;t.core.sceneEditor.resize2dEditPanel(r,e)}},{key:"resizeCameraAltPanel",value:function(t,e){var t=t.instance,r=e.width,e=e.height;t.core.sceneEditor.resizeAltitudePanel(r,e)}},{key:"editBeforePublish",value:function(t){var t=t.componentData,e=t.instance,t=t.config,e=e.core.sceneEditor.interpolateCameraAttributes();return Promise.resolve({config:o(o({},t),{},{cameraKeyframeConfig:e})})}}],c((t=n).prototype,[{key:"dispatchCityproCoreEvents",value:function(){var u=this;this.core.on("currentFrameConfig",function(t){var e=t.frameNum,t=t.attributes;u.emit("frame.currentData.changed",{keyframeId:e,attributes:t})}),this.core.on("frameEvent",function(t){u.emit("".concat(t.sceneId,"-").concat(t.timelineId,"-frame_").concat(t.frameNum))}),this.core.on("completePlay",function(){return u.emit("play.completed")}),this.core.on("setCurrentKeyframeId",function(t){t=t.keyframeId;u.emit("update.frame.currentId",t)}),this.core.on("setExploreLngLat",function(t){var e=t.lng,r=t.lat,n=t.altitude;3!==t.emitOrigin&&u.emit("camera.currentAttr.changed",{key:"position",value:{lng:e,lat:r,altitude:n}})}),this.core.on("updatingAnchorLatlng",function(t){u.emit("camera.currentAttr.changed",{key:"position",value:t})}),this.core.viewer.controls.mouse.on("ViewVaried",function(){var t=u.core.viewer.controls.getCameraState(),e=t.position,t=t.rotation;u.emit("camera.currentAttr.changed",{key:"",value:{position:e,rotation:t}})}),this.core.on("updatingAnchorAltitude",function(t){t=t.altitude;u.emit("camera.currentAttr.changed",{key:"position.altitude",value:t})}),this.core.on("updateKeyframeState",function(t){var e=t.keyframeId,r=t.keyframeState,t=t.emitOrigin,n=r.lng,i=r.lat,o=r.altitude,a=r.tilt,s=r.pan,r={position:{lng:n,lat:i,altitude:o},rotation:{tilt:a,pan:s},positionBezireCtrls:r.positionBezireCtrls},r=(u.emit("update.camera.data",{keyframeId:e,attributes:r,emitOrigin:t}),{position:{lng:n,lat:i,altitude:o},rotation:{tilt:a,pan:s},fov:u.core.viewer.controls.object.fov});u.core.sceneEditor.keyframeTimelinesNode.timeline.updateKeyframe4cameraOnly(e,r)}),this.core.on("togglePathMode",function(t){u.emit("update.timeline.pathMode",t)})}},{key:"_showEnterButton",value:function(){this.loadingMask&&(this.enterButton.style.visibility="visible")}},{key:"_updateLoadingBar",value:function(){var t;this.loadingMask&&this.loadingBarFore&&(t=Math.max(this.renderedIdSet.size/this.promiseList.length,this.lastDrawLoadingRatio),this.loadingBarFore.style.width="".concat(parseInt(100*t,10),"%"),this.lastDrawLoadingRatio=t)}},{key:"_tryRemoveLoadingMask",value:function(t){(this.initialized&&this.loadingTransitionEnd||t)&&(this.loadingMask&&this.loadingMask.remove(),this.loadingMask=null,this.loadingBarFore=null,this.renderedIdSet.clear(),this.emit("loadingMaskRemoved"))}},{key:"_onSubComRendered",value:function(t,e){var r=this;(this.loadingTextWp||this.loadingMask)&&(t.on("rendered",function(t){r._subComRenderedCb(e,t)}),t.layer&&t.layer.on("rendered",function(t){r._subComRenderedCb(e,t)}))}},{key:"_subComRenderedCb",value:function(t,e){e=e||"图元元素加载成功",this.renderedIdSet.has(t)||(this.renderedIdSet.add(t),this._updateLoadingBar(),this._addLoadingText(e))}},{key:"resize",value:function(t,e){void 0!==t&&0!==t&&(this.core&&this.core.resize(t,e),this.anchorViewVariedHandler())}},{key:"get",value:function(t){return this.subComs.get(t)}},{key:"add",value:function(e,t){if(!e)return console.log("subcom ".concat(t," 没有定义"));var r=e.addTo(this.core,t);e.isBasicFeature?(r=r||new Promise(function(t){e.layer&&e.layer.on("rendered",function(){return t()})}),this._onSubComRendered(e,t),this.basicFeaturePromiseList.push(r),this.promiseList.push(r)):((r=!r&&e.layer&&e.layer.needsWait?new Promise(function(t){e.on("rendered",function(){return t()}),e.layer.on("rendered",function(){return t()})}):r)&&this._onSubComRendered(e,t),r&&this.promiseList.push(r)),this.subComs.set(t,e)}},{key:"remove",value:function(t,e){this.subComs.delete(e),this.core.viewer.removeLayer(e)}},{key:"show",value:function(){var t=new this.core.THREE.Vector2;this.core.viewer.engine.renderer.getSize(t),0!==t.x&&0!==t.y||(this.core.viewer.engine.renderer.setSize(1,1,!0),this.core.viewer.resize(1,1)),this.core.viewer.startRendering(),this.initialized&&this._tryRemoveLoadingMask(!0),this.container.style.visibility="visible",this.core.viewer.controls.enable=!0,this.needPlayAfterShow&&this.play()}},{key:"hide",value:function(){this.needPlayAfterShow=this.isInPlay()||this.isAutoplay(),this.isInPlay()&&this.pause(),this.core.viewer.stopRendering(),this.container.style.visibility="hidden",this.core.viewer.controls.enable=!1}},{key:"updateOptions",value:function(t){this.options=v(this.options,t||{}),this.core&&this.core.updateOptions(this.options)}},{key:"setSceneConfig",value:function(t,e){this.core&&this.core.sceneEditor.setSceneConfig(t,e)}},{key:"syncSceneOptions",value:function(t){this.core&&this.core.sceneEditor.syncSceneOptions(t)}},{key:"getCameraConfig",value:function(){return this.core.sceneEditor.cameraNode.camera.getCameraInfo()}},{key:"flyTo",value:function(t){var e,r,n,i;this.isInPlay()||(this.clearResumePlayTimer(),this.pausedDetail=2,e=this.core.sceneEditor.cameraNode,r=t.position,n=t.rotation,i=void 0===(i=t.duration)?1e3:i,t=void 0===(t=t.easeType)?"linear":t,e.registerFlyToFinished||e.on("flyToFinished",this.anchorViewVariedHandler),e.flyTo(r,n,i,t))}},{key:"focus",value:function(t){var e=t.data,e=void 0===e?{}:e,r=e.center,n=e.lng,i=e.lat,o=e.altitude,o=void 0===o?0:o;if(r?o=3<=r.length?(n=(a=s(r,3))[0],i=a[1],a[2]):(n=r.lng,i=r.lat,r.altitude):3<=e.length?(n=(a=s(e,3))[0],i=a[1],o=a[2]):"Feature"===e.type&&(e=(a=void 0===(r=e.geometry)?{}:r).type,r=a.coordinates,"Point"===e&&(n=(a=s(void 0===r?[]:r,3))[0],i=a[1],o=void 0===(e=a[2])?0:e)),void 0===n||void 0===i)return console.log("Invalid data for citypro.focus: ",t);var r=t.rotation,a=t.duration,e=t.easeType,t=t.altitudeOffset;this.flyTo({position:{lng:n,lat:i,altitude:o+(void 0===t?600:t)},rotation:void 0===r?{tilt:89,pan:1}:r,duration:void 0===a?2e3:a,easeType:void 0===e?"linear":e})}},{key:"pausePlayByMouse",value:function(){var t=this;this.core.viewer.controls.mouse.on("ViewVaried",function(){!t.isInPlay()&&1!==t.pausedDetail||(t.pause(!0),t.resumePlayTimer||t._addNotify("暂停关键帧动画播放"),t.clearResumePlayTimer(),t.resumePlayTimer=setTimeout(function(){t.resumePlay(),t.resumePlayTimer=null},3e3))})}},{key:"resumePlay",value:function(){this.isPaused()&&1===this.pausedDetail&&(this.play(),this._addNotify("继续关键帧动画播放"))}},{key:"clearResumePlayTimer",value:function(){this.resumePlayTimer&&clearTimeout(this.resumePlayTimer),this.resumePlayTimer=null}},{key:"getCurrentKfTimelinesConfig",value:function(){var t=this.core.sceneEditor.keyframeTimelinesNode;return{defaultTimelineId:t.defaultTimelineId,timelines:t.timelinesOptArr}}},{key:"getCurSceneAndTimelineId",value:function(){var t=this.core.sceneEditor.keyframeTimelinesNode.timeline;return{sceneId:t.sceneId,id:t.id}}},{key:"getCurrentKfTimeline",value:function(){return this.core.sceneEditor.keyframeTimelinesNode.timeline}},{key:"switchKeyframeTimeline",value:function(t,e){this.clearResumePlayTimer(),this.core.sceneEditor.keyframeTimelinesNode.switchTimeline(t,e)}},{key:"createKeyframeTimeline",value:function(t,e){return this.core.sceneEditor.keyframeTimelinesNode.createTimeline(t,e)}},{key:"deleteKeyframeTimeline",value:function(t,e){this.core.sceneEditor.keyframeTimelinesNode.deleteTimeline(t,e)}},{key:"getCurrentKeyframeConfig",value:function(){return this.core.sceneEditor.keyframeTimelinesNode.timeline.kfam.getCurrentAttrs()}},{key:"addKeyframe",value:function(t,e){this.core.sceneEditor.keyframeTimelinesNode.timeline.addKeyframe(t,e),t.attributes.camera&&this.core.sceneEditor.cameraEditor&&this.core.sceneEditor.cameraEditor.addKeyframe(t)}},{key:"updateKeyframe",value:function(t,e){this.core.sceneEditor.keyframeTimelinesNode.timeline.updateKeyframe(t,e);var r,n,i,o,e=t.id,t=t.attributes.camera;t&&this.core.sceneEditor.cameraEditor&&(i=t.position,t=t.rotation,r=i.lng,n=i.lat,i=i.altitude,o=t.tilt,t=t.pan,this.core.sceneEditor.cameraEditor.updateAnchor(e,{lat:n,lng:r,altitude:i,tilt:o,pan:t}))}},{key:"removeKeyframe",value:function(t,e){this.core.sceneEditor.keyframeTimelinesNode.timeline.removeKeyframe(t,e),this.core.sceneEditor.cameraEditor&&this.core.sceneEditor.cameraEditor.removeAnchor(t)}},{key:"addAttribute",value:function(t,e,r){this.core.sceneEditor.keyframeTimelinesNode.timeline.addAttribute(t,e,r)}},{key:"removeAttribute",value:function(t,e){this.core.sceneEditor.keyframeTimelinesNode.timeline.removeAttribute(t,e)}},{key:"enableAttribute",value:function(t){this.core.sceneEditor&&(t=this.core.sceneEditor.keyframeTimelinesNode.timeline.kfam.attrsEntityMap.get(t))&&(t.enable=!0)}},{key:"disableAttribute",value:function(t){this.core.sceneEditor&&(t=this.core.sceneEditor.keyframeTimelinesNode.timeline.kfam.attrsEntityMap.get(t))&&(t.enable=!1)}},{key:"stop",value:function(){this.core.sceneEditor.keyframeTimelinesNode.timeline.stop()}},{key:"play",value:function(){this.core.sceneEditor.keyframeTimelinesNode.timeline.play()}},{key:"autoplay",value:function(){"hidden"!==this.container.style.visibility&&this.core.sceneEditor.keyframeTimelinesNode.timeline.playKeyframes()}},{key:"pause",value:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.core.sceneEditor.keyframeTimelinesNode.timeline.pause(),this.pausedDetail=1,t||(this.clearResumePlayTimer(),this.pausedDetail=0)}},{key:"restart",value:function(){this.core.sceneEditor.keyframeTimelinesNode.timeline.restart()}},{key:"isAutoplay",value:function(){return this.core.sceneEditor.keyframeTimelinesNode.timeline.isAutoplay()}},{key:"isInPlay",value:function(){return this.core.sceneEditor.keyframeTimelinesNode.isInPlay()}},{key:"isPaused",value:function(){return this.core.sceneEditor.keyframeTimelinesNode.isPaused()}},{key:"isStopped",value:function(){return this.core.sceneEditor.keyframeTimelinesNode.isStopped()}},{key:"isInReady",value:function(){return this.core.sceneEditor.keyframeTimelinesNode.isInReady()}},{key:"previewAttribute",value:function(t,e,r){var n,i,o,a,s,u;"camera"===t&&this.core.sceneEditor.cameraEditor?(a=e.position,u=e.rotation,n=e.fov,i=a.lng,o=a.lat,a=a.altitude,s=u.tilt,u=u.pan,this.core.sceneEditor.cameraEditor.setCameraExploreStateFromKeyframePanel({lat:o,lng:i,altitude:a,tilt:s,pan:u}),this.core.sceneEditor.keyframeTimelinesNode.timeline.previewAttribute(t,{fov:n},r)):this.core.sceneEditor.keyframeTimelinesNode.timeline.previewAttribute(t,e,r)}},{key:"setFrameCount",value:function(t,e){this.core.sceneEditor.keyframeTimelinesNode.timeline.setDuration(t,e)}},{key:"setLoop",value:function(t){this.core.sceneEditor.keyframeTimelinesNode.timeline.setLoop(t)}},{key:"setCurrentFrameId",value:function(t,e){this.core.sceneEditor.setCurrentFrameId(t,e);e=this.core.sceneEditor.keyframeTimelinesNode.timeline.cameraKeyframeManager;e&&e.cursorIsKeyframeId(t)&&(e.currentKeyframeId={keyframeId:t,emitOrigin:0,force:!0})}},{key:"updateAttrUniforms",value:function(t,e){this.core.sceneEditor.updateAttrUniforms(t,e)}},{key:"moveToFrameId",value:function(t){this.core.sceneEditor.keyframeTimelinesNode.timeline.moveTo(t)}},{key:"getCurrentSceneId",value:function(){return this.core.sceneEditor.keyframeTimelinesNode.sceneId}},{key:"createScene",value:function(t){this.core.sceneEditor.createScene(t)}},{key:"deleteScene",value:function(t){this.core.sceneEditor.deleteScene(t)}},{key:"switchScene",value:function(t){this.clearResumePlayTimer(),this.core.sceneEditor.switchScene(t)}},{key:"updateScene",value:function(t){this.core.sceneEditor.updateScene(t)}},{key:"destroy",value:function(){if(this.core&&this.core.destroy&&this.core.destroy(),this.promiseList.length=0,this.basicFeaturePromiseList.length=0,this.subComs.clear(),this.container)for(;this.container.firstChild;)this.container.removeChild(this.container.firstChild)}},{key:"afterChildrenInit",value:function(t){var e=this;if(Promise.all(this.basicFeaturePromiseList||[]).then(function(){e.initialized||e.emit("basicFeatures.init"),e.basicFeaturePromiseList.length=0}),this.once("loadingMaskRemoved",function(){e.autoplay(),e.isInReady()&&e.moveToFrameId(0)}),Promise.all(this.promiseList||[]).then(function(){e.initialized||(e.emit("scene.init"),e.initialized=!0,e.promiseList.length?e.loadingMask?e._tryRemoveLoadingMask():e.emit("loadingMaskRemoved"):e._tryRemoveLoadingMask(!0),e._addLoadingText("场景载入完成")),e.promiseList.length=0}),Array.isArray(t))for(var r=0,n=t.length;r<n;r++){var i=this.subComs.get(t[r]);i&&this.core.sceneEditor.assetsNode.applySubCom(i)}}},{key:"getThemableConfig",value:function(){console.log("not implement yet.")}},{key:"setAnchorFlag",value:function(t){t=t.flag;this._anchorCoordsFlag!==t&&((this._anchorCoordsFlag=t)?(this.core&&this.core.viewer&&this.core.viewer.controls.mouse.on("ViewVaried",this.anchorViewVariedHandler),this.core.sceneEditor&&this.core.sceneEditor.keyframeTimelinesNode.timeline.kfam&&this.core.sceneEditor.keyframeTimelinesNode.timeline.kfam.on("movingFrame",this.anchorViewVariedHandler)):(this.anchorCoords&&this.anchorCoords.length&&(this.anchorCoords.length=0),this.core&&this.core.viewer&&this.core.viewer.controls.mouse.off("ViewVaried",this.anchorViewVariedHandler),this.core.sceneEditor&&this.core.sceneEditor.keyframeTimelinesNode.timeline.kfam&&this.core.sceneEditor.keyframeTimelinesNode.timeline.kfam.off("movingFrame",this.anchorViewVariedHandler)))}},{key:"addAnchors",value:function(t){var e=t.anchors,t=t.needClear,t=void 0===t||t;this._anchorCoordsFlag&&(this.anchorCoords||(this.anchorCoords=[]),t&&(this.anchorCoords.length=0),(t=this.anchorCoords).push.apply(t,function(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}()||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e)),this.anchorViewVariedHandler())}},{key:"getScreenAnchors",value:function(){var a,t,s,u,c=[];return this.anchorCoords&&this.anchorCoords.length&&(t=this.core,a=t.coordHelper,t=t.viewer,s=t.controls.object,u=t.engine.renderer.getSize(y),this.anchorCoords.forEach(function(t){var e,r=t.lat,n=t.lng,i=t.altitude,o=t.id;r&&n&&((e=t._pos)||(a.setFromValues(n,r,void 0===i?0:i),e=a.toArray(),t._pos=e),r=((n=b.set(e[0],e[1],e[2]).project(s)).x+1)/2*u.x,i=-(n.y-1)/2*u.y,c.push({x:r,y:i,id:o}))})),c}},{key:"anchorViewVariedHandler",value:function(){this.emit("anchorViewVaried",this.getScreenAnchors())}}]),c(t,e),Object.defineProperty(t,"prototype",{writable:!1}),n}();t.exports=r},function(t,e){t.exports=s("datav:/npm/lodash/4.17.21/cloneDeep")},function(t,e){t.exports=o},function(t,e,r){var n=r(13),r=r(14);n(r="string"==typeof(r=r.__esModule?r.default:r)?[[t.i,r,""]]:r,{insert:"head",singleton:!1}),t.exports=r.locals||{}},function(t,e,i){"use strict";var r,o=function(){var r={};return function(t){if(void 0===r[t]){var e=document.querySelector(t);if(window.HTMLIFrameElement&&e instanceof window.HTMLIFrameElement)try{e=e.contentDocument.head}catch(t){e=null}r[t]=e}return r[t]}}(),c=[];function l(t){for(var e=-1,r=0;r<c.length;r++)if(c[r].identifier===t){e=r;break}return e}function s(t,e){for(var r={},n=[],i=0;i<t.length;i++){var o=t[i],a=e.base?o[0]+e.base:o[0],s=r[a]||0,u="".concat(a," ").concat(s),a=(r[a]=s+1,l(u)),s={css:o[1],media:o[2],sourceMap:o[3]};-1!==a?(c[a].references++,c[a].updater(s)):c.push({identifier:u,updater:function(e,t){var r,n,i;{var o;i=t.singleton?(o=d++,r=p=p||f(t),n=h.bind(null,r,o,!1),h.bind(null,r,o,!0)):(r=f(t),n=function(t,e,r){var n=r.css,i=r.media,r=r.sourceMap;if(i?t.setAttribute("media",i):t.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}.bind(null,r,t),function(){!function(t){null!==t.parentNode&&t.parentNode.removeChild(t)}(r)})}return n(e),function(t){t?t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap||n(e=t):i()}}(s,e),references:1}),n.push(u)}return n}function f(t){var e=document.createElement("style"),r=t.attributes||{};if(void 0!==r.nonce||(n=i.nc)&&(r.nonce=n),Object.keys(r).forEach(function(t){e.setAttribute(t,r[t])}),"function"==typeof t.insert)t.insert(e);else{var n=o(t.insert||"head");if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(e)}return e}n=[];var n,a=function(t,e){return n[t]=e,n.filter(Boolean).join("\n")};function h(t,e,r,n){var r=r?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;t.styleSheet?t.styleSheet.cssText=a(e,r):(n=document.createTextNode(r),(r=t.childNodes)[e]&&t.removeChild(r[e]),r.length?t.insertBefore(n,r[e]):t.appendChild(n))}var p=null,d=0;t.exports=function(t,o){(o=o||{}).singleton||"boolean"==typeof o.singleton||(o.singleton=function(){return r=void 0===r?Boolean(window&&document&&document.all&&!window.atob):r}());var a=s(t=t||[],o);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var e=0;e<a.length;e++){var r=l(a[e]);c[r].references--}for(var t=s(t,o),n=0;n<a.length;n++){var i=l(a[n]);0===c[i].references&&(c[i].updater(),c.splice(i,1))}a=t}}}},function(t,e,r){(e=r(15)(!1)).push([t.i,".loading-mask {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  background-color: rgba(17, 19, 23, 0.9);\n  display: flex;\n  flex-flow: column nowrap;\n  justify-content: center;\n  align-items: center;\n}\n\n.loading-mask .loading-logo {\n  display: block;\n  width: 360px;\n  margin-top: -100px;\n}\n\n.loading-mask .text-wp {\n  color: #bcc9d4;\n  display: block;\n  width: 200px;\n  text-align: center;\n  margin-top: 20px;\n}\n\n.loading-mask .loading-bar {\n  position: relative;\n  background-color: rgba(255, 255, 255, .2);\n  border-radius: 5px;\n  overflow: hidden;\n  width: 500px;\n  height: 3px;\n  margin-top: 40px;\n}\n\n.loading-mask .loading-bar .loading-bar-foreground {\n  position: relative;\n  overflow: hidden;\n  background-color: #bbb;\n  border-radius: 5px;\n  height: 100%;\n  width: 0;\n  transition: width 3s;\n}\n\n@keyframes lightingAnimation {\n  from { transform: translateX(-100%); }\n  to { transform: translateX(500px); }\n}\n\n.loading-mask .loading-bar .loading-lighting {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 80%;\n  height: 100%;\n  background: linear-gradient(to right, rgba(255, 255, 255, 0), #fff, rgba(255, 255, 255, 0));\n  animation: lightingAnimation 1.5s infinite ease-in-out;\n}\n\n.loading-mask .enter-button {\n  visibility: hidden;\n  box-sizing: border-box;\n  border: 1px solid #bcc9d4;\n  height: 32px;\n  line-height: 32px;\n  color: #bcc9d4;\n  font-size: 14px;\n  cursor: pointer;\n  padding: 0 15px;\n  margin-top: 40px;\n  padding: 0 30px;\n  border-radius: 5px;\n}\n\n.loading-mask .enter-button:hover {\n  border: 1px solid #fff;\n  color: #fff;\n}\n\n.city-pro-info-wrapper {\n  position: absolute;\n  bottom: 20px;\n  left: 20px;\n}\n\n.city-pro-info-wrapper .close-btn {\n  position: absolute;\n  top: 8px;\n  right: 8px;\n  cursor: pointer;\n}\n.city-pro-info-wrapper .close-btn::after {\n  content: '\\2715';\n}\n\n.city-pro-info-wrapper .loading-container {\n  background: rgba(0, 0, 0, 0.5);\n  width: 200px;\n  height: 180px;\n  padding: 12px 0;\n  color: #fff;\n  overflow: hidden;\n  box-sizing: content-box;\n}\n\n.city-pro-info-wrapper .loading-container .text-wp {\n  height: 100%;\n  overflow: auto;\n  padding: 0 15px;\n  color: #bcc9d4;\n}\n\n.city-pro-info-wrapper .loading-container .text-wp p {\n  margin: 12px 0;\n  font-size: 12px;\n}\n\n.city-pro-info-wrapper .loading-container .text-wp p:first-child {\n  margin-top: 0;\n}\n\n.city-pro-info-wrapper .loading-container .text-wp p:last-child {\n  margin-bottom: 0;\n}\n\n.city-pro-info-wrapper .notify-container {\n  position: relative;\n  background: rgba(0, 0, 0, 0.5);\n  width: 200px;\n  color: #fff;\n  margin: 20px 0;\n  padding: 8px 15px;\n}\n\n.city-pro-info-wrapper .info-move-in {\n  animation-duration: .3s;\n  animation-name: infoMoveIn;\n}\n\n.city-pro-info-wrapper .info-move-out {\n  animation-duration: .3s;\n  animation-name: infoMoveOut;\n  opacity: 0;\n}\n\n@keyframes infoMoveIn {\n  from {\n    transform: translateY(60%);\n    opacity: 0;\n  }\n\n  to {\n    transform: translateY(0%);\n    opacity: 1;\n  }\n}\n\n@keyframes infoMoveOut {\n  from {\n    transform: translateY(0%);\n    opacity: 1;\n  }\n\n  to {\n    transform: translateY(-60%);\n    opacity: 0;\n  }\n}",""]),t.exports=e},function(t,e,r){"use strict";t.exports=function(o){var u=[];return u.toString=function(){return this.map(function(i){var t=function(){var t,e,r=i[1]||"",n=i[3];return n?o&&"function"==typeof btoa?(e=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),e="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(e),e="/*# ".concat(e," */"),t=n.sources.map(function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}),[r].concat(t).concat([e]).join("\n")):[r].join("\n"):r}();return i[2]?"@media ".concat(i[2]," {").concat(t,"}"):t}).join("")},u.i=function(t,e,r){"string"==typeof t&&(t=[[null,t,""]]);var n={};if(r)for(var i=0;i<this.length;i++){var o=this[i][0];null!=o&&(n[o]=!0)}for(var a=0;a<t.length;a++){var s=[].concat(t[a]);r&&n[s[0]]||(e&&(s[2]?s[2]="".concat(e," and ").concat(s[2]):s[2]=e),u.push(s))}},u}},function(t,e,a){function i(t){return(i="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function s(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(r);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return u(t)}(this,n?(t=o(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var c=a(2),l=a(0),f=a(17),h=a(44),p=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&n(t,e)}(o,l);var t,i=s(o);function o(t,e,r){var n;return function(t){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}(this),(n=i.call(this)).options=e,n.container=t,n.subcoms=r,n.subcomIds4click=[],n.subcomIds4ClickGPU=[],n.Utils=c.Utils,n.THREE=c.THREE,n.coordHelper=new c.Coordinates,n.coordHelper.crs=c.EPSG4978,n.VG=c,n.viewer=new c.GlobalViewer(t,{pbrSurfaceOptions:{materialOptions:e.sceneManager.scenes[0].config.globe.pbrSurfaceMap}}),n.engine=n.viewer.engine,n.viewer.controls.minDistance=.1,n.viewer.easyloop.setFrameRate(50),n.initWorkerUtils(),n.decode=a(45),n.decodeAsset=a(46),n.vtbundle=a(47),n.FormatTransformer=a(49),n.SpriteText=a(50)(n.THREE),n.geoUtils=h,n.viewer.vtbundle=n.vtbundle,n.viewer.decode=n.decode,n.viewer.decodeAsset=n.decodeAsset,n.prevSubCom=void 0,n.prevObj3d=void 0,n.prevInstancedMeshId=void 0,n.prevEventType=void 0,n.emitCurrentFrameConfig=n.emitCurrentFrameConfig.bind(u(n)),n.emitFrameEvent=n.emitFrameEvent.bind(u(n)),n.emitCompletePlay=n.emitCompletePlay.bind(u(n)),n.viewer.startRendering(),n}return r((t=o).prototype,[{key:"initSceneEditor",value:function(){return this.sceneEditor=new f(this,this.options),this.sceneEditor.initialize(),this.sceneEditor}},{key:"addEventListener",value:function(){function t(t){var e=t.type,r=t.originalEvent,n=t.interactiveObject,t=t.layerId;(e!==c.MOUSE_DOWN||2===r.button)&&(i.lastPickSubcom&&i.lastPickSubcom.inactive(),i.lastPickSubcom=null,n&&t)&&(e=i.subcoms.get(t))&&e.active&&e.active(r,n)&&(i.lastPickSubcom=e)}var i=this;this.viewer.addEventListener(c.CLICK,t,!0),this.viewer.addEventListener(c.MOUSE_DOWN,t,!0)}},{key:"initWorkerUtils",value:function(){this.superWorker=this.viewer.superWorker}},{key:"resize",value:function(t,e){this.viewer.resize(t,e),this.sceneEditor&&this.sceneEditor.resize(t,e)}},{key:"updateOptions",value:function(t){this.sceneEditor&&this.sceneEditor.updateOptions(t)}},{key:"emitCurrentFrameConfig",value:function(t){this.emit("currentFrameConfig",t)}},{key:"emitFrameEvent",value:function(t,e,r){this.emit("frameEvent",{sceneId:t,timelineId:e,frameNum:r})}},{key:"emitCompletePlay",value:function(){this.emit("completePlay")}},{key:"destroy",value:function(){this.viewer&&this.viewer.dispose(),this.sceneEditor&&this.sceneEditor.destroy()}}]),Object.defineProperty(t,"prototype",{writable:!1}),o}();t.exports=p},function(t,e,r){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=r(2).Console.error,a=r(18),s=r(19),u=r(20),c=r(21),l=r(22),f=r(24),h=r(39),p=r(42),d=["camera","globe","basic","scene","postprocessing","assets"],r=function(){function n(t,e){!function(t){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this);var r=(this.cityproCore=t).viewer,t=t.engine;this.viewer=r,this.engine=t,this.scene=t.scene,this.options=e,this.sceneId2keyframeTimelinesNode={},this.cameraEditor=null}var t=n;return i(t.prototype,[{key:"initialize",value:function(){var t=this.getOptions(this.options),e=(this.solarNode=new s,this.cameraNode=new l(this.cityproCore,t.camera),this.basicNode=new u(this.cityproCore,t.basic),this.sceneNode=new c(this.cityproCore,t.scene),this.postprocessingNode=new h(this.cityproCore,t.postprocessing),this.globeNode=new a(this.cityproCore,t.globe),t.scene.sceneId||t.scene.sceneName),r=t.defaultTimelineId,n=t.timelines,r=new f(e,r,n,this);this.keyframeTimelinesNode=r,this.sceneId2keyframeTimelinesNode[e]=r,this.assetsNode=new p(this.cityproCore,t.assets),this.assetsNode.sceneId=this.options.sceneManager.defaultSceneId,this.assetsNode.postprocessingNode=this.postprocessingNode,this.bindEvents()}},{key:"bindEvents",value:function(){this.solarNode.addFn(this.globeNode,this.globeNode.setDate),this.solarNode.addFn(this,this.setDate)}},{key:"setDate",value:function(e){var r,t=new Date(e);Number.isNaN(t.valueOf())||(t=(60*t.getHours()+t.getMinutes())/1440,r=Math.sin(t*Math.PI),this.cityproCore.subcoms&&this.cityproCore.subcoms.size&&this.cityproCore.subcoms.forEach(function(t){t.layer&&t.layer.setDate&&t.layer.setDate.call(t.layer,e,r)}))}},{key:"getOptions",value:function(t,e){var t=this.getSceneOptions(t,e),e=t.config,r=t.sceneId,n=t.timelines,t=t.defaultTimelineId,i={};return i.scene={sceneName:r},i.globe=e.globe,i.basic=e.basic,i.camera=e.camera,i.assets=e.assets,e.postprocessing.sceneId=r,i.postprocessing=e.postprocessing,i.timelines=n,i.defaultTimelineId=t,i}},{key:"getSceneOptions",value:function(t,e){var t=t.sceneManager,r=t.scenes,n=void 0===e?t.defaultSceneId:e,t=r.findIndex(function(t){return t.sceneId===n});if(-1!==t)return r[t];o("Failed to getSceneOptions in SceneEditor for secneId: ".concat(e,"!"),"CityPro")}},{key:"createScene",value:function(t){void 0!==t&&this.options.sceneManager.scenes.push(t)}},{key:"switchScene",value:function(t){var e,r;void 0!==t&&t!==this.options.sceneManager.defaultSceneId&&(this.options.sceneManager.defaultSceneId=t,this.assetsNode.sceneId=t,this.updateOptions(this.options,t),(e=this.sceneId2keyframeTimelinesNode[t])?((r=this.keyframeTimelinesNode.timeline).pause(),this.cameraEditor&&(this.cameraEditor.setCurTimeline(e.timeline),this.cameraEditor.viewAutoFit()),(this.keyframeTimelinesNode=e).timeline.recoverAttributesNotInKeyframe(r),e.moveToPaused()):console.log("Fail to switchScene:",t))}},{key:"updateScene",value:function(t){this.updateOptions(t)}},{key:"deleteScene",value:function(t){var e=this.sceneId2keyframeTimelinesNode[t];e&&e.destroy&&e.destroy(),this.sceneId2keyframeTimelinesNode[t]=null}},{key:"updateOptions",value:function(t,e){var r=this,n=this.getOptions(t,e),t=(d.forEach(function(t){r["".concat(t,"Node")].updateOptions(n[t])}),n.defaultTimelineId),i=n.timelines;this.updateKeyframeTimelinesNode(e,t,i)}},{key:"updatePostprocessingBokeh",value:function(t){this.postprocessingNode.updateBokeh(t)}},{key:"updateGlobeLight",value:function(t){this.globeNode.updateGlobeLight(t)}},{key:"setSceneConfig",value:function(e){var r,n=this,t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).sceneId;this.options.sceneManager.defaultSceneId===t&&(r=this.getSceneOptions(this.options).config,e.postprocessing.sceneId=this.options.sceneManager.defaultSceneId,["globe","basic","postprocessing","assets"].forEach(function(t){e[t]&&(n["".concat(t,"Node")].updateOptions(e[t]),r[t]=e[t])}))}},{key:"syncSceneOptions",value:function(t){var e=t.sceneId,r=t.sceneName,n=t.timelines,i=t.editingTimelineId,t=t.defaultTimelineId;void 0!==e&&((e=this.getSceneOptions(this.options,e)).sceneName=r,e.timelines=n,e.defaultTimelineId=i||t)}},{key:"updateKeyframeTimelinesNode",value:function(t,e,r){var n=this.sceneId2keyframeTimelinesNode[t];return n?n.updateOptions(e,r):(n=new f(t,e,r,this),this.sceneId2keyframeTimelinesNode[t]=n),n}},{key:"setCurrentFrameId",value:function(t,e){this.keyframeTimelinesNode&&this.keyframeTimelinesNode.timeline.setCurrentFrameNum(t,e)}},{key:"resize",value:function(t,e){this.globeNode&&this.globeNode.resize(t,e),this.cameraEditor&&this.cameraEditor.panel3dResizeHandler(t,e)}},{key:"updateAttrUniforms",value:function(t,e){this.keyframeTimelinesNode.updateAttrUniforms(t,e);var r,e=t.keyChain,t=t.value;e.length&&(r=e[0],"enable"===e[1]&&("postprocessing_postprocessing_bokeh"===r?this.postprocessingNode.switchBokeh(t):"globe_light"===r&&this.globeNode.switchGlobeLight(t)))}},{key:"destroy",value:function(){var e=this;d.forEach(function(t){e["".concat(t,"Node")].destroy()}),Object.keys(this.sceneId2keyframeTimelinesNode).forEach(function(t){t=e.sceneId2keyframeTimelinesNode[t];t&&t.destroy&&t.destroy()}),this.cameraEditor&&(this.cameraEditor.destroy(),this.cameraEditor=null)}}]),Object.defineProperty(t,"prototype",{writable:!1}),n}();t.exports=r},function(t,e){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var i=null,r=function(){function r(t,e){!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),this.cityproCore=t,this.viewer=t.viewer,this.options=e,this.keyframeAttrs={enableGlobeLight:!0,color:"#ffffff",intensity:6},i=t.Utils,this.initGlobe()}var t=r;return n(t.prototype,[{key:"surface",get:function(){return this.viewer&&this.viewer.surface}},{key:"sunLightDirection",get:function(){return this.viewer&&this.viewer.sunLightDirection}},{key:"sunLightColor",get:function(){return this.viewer&&this.viewer.sunLightColor}},{key:"sunLightShadow",get:function(){return this.viewer&&this.viewer.sunLightShadow}},{key:"setDate",value:function(t){this.viewer&&this.viewer.setDate(t)}},{key:"initGlobe",value:function(){this.atmospherePass=this.getPass("sky");var t=this.atmospherePass.sky;t.uniforms.sunLightDirection.value=this.sunLightDirection,t.alphaBias=1,t.useGlobeMode=!0,this.updateOptions(this.options)}},{key:"resize",value:function(){this.viewer&&this.viewer.surface.resize()}},{key:"getPass",value:function(t){return this.cityproCore.sceneEditor.postprocessingNode.postprocessing.layer.renderPipeline._pipelineCore.pipeline.skyPass}},{key:"updateOptions",value:function(t){var e,r,n;this.viewer&&(e=t.pbrSurfaceMap,r=t.atmosphere,n=t.visible,t=t.tileLOD,this.viewer.surface.group.visible=n,this.viewer.surface.pbrSurfaceLayer.updateOptions({materialOptions:e}),this.viewer.surface.updateGeometricError("performance"===t?.25:"balance"===t?.5:1),this.atmospherePass.updateOptions(r.sky))}},{key:"updateColor",value:function(t,e){var r=t,t=(t.r||t.g||t.b||t.a?r=[t.r,t.g,t.b,t.a]:Array.isArray(t)||(r=i.Chroma(t).gl()),this.keyframeAttrs.color);!e&&i.deepDiff(r,t)||(this.keyframeAttrs.color=r,this.viewer.sunLightColor.fromArray(r))}},{key:"updateIntensity",value:function(t,e){!e&&this.keyframeAttrs.intensity===t||(this.keyframeAttrs.intensity=t,this.viewer.sunLightIntensity=t)}},{key:"updateGlobeLight",value:function(t){var e=t.enableGlobeLight,e=void 0===e||e,r=t.color,r=void 0===r?"#ffffff":r,t=t.intensity,t=void 0===t?6:t;this.switchScene(),this.switchGlobeLight(e,!0),this.updateColor(r,!0),this.updateIntensity(t,!0)}},{key:"switchGlobeLight",value:function(t,e){!e&&this.keyframeAttrs.enableGlobeLight===t||(this.keyframeAttrs.enableGlobeLight=t,this.viewer.sunLightVisible=t)}},{key:"switchScene",value:function(){this.viewer.sunLightLayers=this.viewer.engine.camera.layers}},{key:"destroy",value:function(){this.viewer&&(this.viewer=null)}}]),Object.defineProperty(t,"prototype",{writable:!1}),r}();t.exports=r},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var n=function(){function e(){!function(t){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.fnList=[]}var t=e;return r(t.prototype,[{key:"solarChangeTo",value:function(t){var r=new Date(t);Array.isArray(this.fnList)&&this.fnList.length&&this.fnList.forEach(function(t){var e=t.obj,t=t.fn;e&&t&&t.call(e,r)})}},{key:"addFn",value:function(t,e){this.fnList.push({obj:t,fn:e})}},{key:"removeFn",value:function(t,e){t=this.fnList.indexOf({obj:t,fn:e});return-1<t&&(this.fnList.splice(t,1),!0)}},{key:"destroy",value:function(){this.fnList=[]}}]),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.exports=n},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=null,u=null,n=function(){function i(t,e){!function(t){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this);var r=t.viewer,n=t.engine;this.viewer=r,this.engine=n,this.options=e,o=t.Utils,u=t.THREE,this.setBasicStyle(e)}var t=i;return r(t.prototype,[{key:"setBasicStyle",value:function(t){var e=t.clearColor,r=t.isShadowMap,n=t.outputEncoding,i=t.isPhysicallyCorrect,o=t.toneMapping,a=t.fogColor,t=t.fogDensity,s=o.tmType,o=o.exposure;this.viewer.clearColor=e,this.viewer.toneMapping={type:u[s],exposure:o},this.viewer.physicallyCorrectLights=i,this.viewer.outputEncoding=u[n],this.viewer.shadow={type:u.PCFSoftShadowMap,enabled:r,autoUpdate:!0},this.engine.sceneMgr.updateAllMaterialsBySceneName("main",!0),this.viewer.fog={color:a,density:t}}},{key:"updateOptions",value:function(t){var e=o.deepClone(this.options);this.options=o.mergeOptions(this.options,t||{}),o.easyObjDiff(e,t)||this.setBasicStyle(t)}},{key:"destroy",value:function(){}}]),Object.defineProperty(t,"prototype",{writable:!1}),i}();t.exports=n},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var i=null,n=function(){function n(t,e){!function(t){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this);var r=t.viewer;this.viewer=r,this.options=e,i=t.Utils,this.setScene(e)}var t=n;return r(t.prototype,[{key:"setScene",value:function(){var t=this.options.sceneName;this.viewer.engine.setCameraLayer(t)}},{key:"updateOptions",value:function(t){var e=i.deepClone(this.options);this.options=i.mergeOptions(this.options,t||{}),e.crossfade||i.easyObjDiff(e,t)||this.setScene()}},{key:"destroy",value:function(){this.viewer=null,this.options=null}}]),Object.defineProperty(t,"prototype",{writable:!1}),n}();t.exports=n},function(t,e,r){function i(t){return(i="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function s(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(r);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n?(t=o(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var u=null,c=r(0),l=r(23),r=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}(o,c);var t,i=s(o);function o(t,e){!function(t){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}(this),r=i.call(this);var r,n=t.viewer;return r.viewer=n,r.options=e,r.camera=new l(t,e),u=t.Utils,r.registerFlyToFinished=!1,r}return n((t=o).prototype,[{key:"setCameraPosition",value:function(t){this.camera.setCameraPosition(t)}},{key:"setCameraRotation",value:function(t){this.camera.setCameraRotation(t)}},{key:"setCamera",value:function(){this.camera.setCamera(this.options)}},{key:"setCameraFov",value:function(t){this.camera.setCameraFov(t)}},{key:"flyTo",value:function(t,e,r,n){var i=this;this.viewer.flyTo({position:t,rotation:e,duration:r,easeType:n}),this.registerFlyToFinished||(this.viewer.animationAction.on("finished",function(){i.emit("flyToFinished")}),this.registerFlyToFinished=!0)}},{key:"updateOptions",value:function(t){var e=u.deepClone(this.options);this.options=u.mergeOptions(this.options,t||{}),u.easyObjDiff(e,t)||this.setCamera()}},{key:"destroy",value:function(){this.camera&&this.camera.destroy()}}]),Object.defineProperty(t,"prototype",{writable:!1}),o}();t.exports=r},function(t,e){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var i=null,o=null,r=function(){function r(t,e){!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),this.cityproCore=t,i=t.Utils,o=t.THREE,this.options=Object.assign({fov:60,position:{lng:120.13352394104005,lat:30.26614700786203,altitude:1e4},rotation:{tilt:89,pan:1}},e),this.coordHelper=this.cityproCore.coordHelper.clone(),this.initCamera(),this.setCamera(this.options)}var t=r;return n(t.prototype,[{key:"initCamera",value:function(){var t=this.options.fov;this.cityproCore.engine.createCamera({fov:t,far:1e7,near:1,name:"main",type:"perspective"})}},{key:"setCameraPosition",value:function(t){this.cityproCore.viewer.setCamera({position:t})}},{key:"setCameraRotation",value:function(t){this.cityproCore.viewer.setCamera({rotation:t})}},{key:"setCameraFov",value:function(t){this.cityproCore.viewer.setCamera({fov:t})}},{key:"setCamera",value:function(t){var e=t.fov,r=t.position,t=t.rotation;this.cityproCore.viewer.setCamera({fov:e,position:r,rotation:t})}},{key:"updateOptions",value:function(t){this.options=i.mergeOptions(this.options,t)}},{key:"getProjPos",value:function(t,e,r){var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=new o.Vector3;return this.coordHelper&&(this.coordHelper.setFromValues(t,e,r),this.coordHelper.toXYZ(i)),n?i:i.toArray([])}},{key:"getProjNormal",value:function(t,e,r){var n=new o.Vector3(1,1,1);return this.coordHelper&&(this.coordHelper.fromXYZ(t,e,r),n=this.coordHelper.normal),n.normalize()}},{key:"getCameraInfo",value:function(){return this.cityproCore.viewer.controls.getCameraState()}},{key:"destroy",value:function(){this.cityproCore.viewer.controls.dispose&&this.cityproCore.viewer.controls.dispose()}}]),Object.defineProperty(t,"prototype",{writable:!1}),r}();t.exports=r},function(t,e,r){function n(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)),n}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){!function(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=r(25),r=function(){function i(t,e,r,n){!function(t){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this),this.sceneId=t;t=n.cityproCore;this.defaultTimelineId=e,this.timelinesOptArr=r,this.cityproCore=t,this.sceneEditor=n,this.timelines=[],this._timeline=null,this.initTimelines()}var t=i;return a(t.prototype,[{key:"timeline",get:function(){return this._timeline},set:function(t){var e,r,n,i;(this._timeline=t)&&(r=(t=t.options).attrUniforms,t=t.keyframes,e=null==(e=r.postprocessing_postprocessing_bokeh)?void 0:e.enable,r=null==(r=r.globe_light)?void 0:r.enable,t&&t.length&&(n=(t=t[0].attributes).postprocessing_postprocessing_bokeh,t=void 0===(t=t.globe_light)?{}:t,(i=this.sceneEditor).updatePostprocessingBokeh(o({enableBokeh:e},void 0===n?{}:n)),i.updateGlobeLight(o({enableGlobeLight:r},t))))}},{key:"initTimelines",value:function(){var t=this.defaultTimelineId,e=this.timelinesOptArr;if(e)for(var r=this.timelines.length=0,n=e.length;r<n;r++){var i=this.createTimeline(e[r]);void 0!==t?i.id===t&&(this.timeline=i):0===r&&(this.timeline=i)}}},{key:"getTimelineById",value:function(t){for(var e=0,r=this.timelines.length;e<r;e++)if(this.timelines[e].id===t)return this.timelines[e]}},{key:"validateBeforeOperate",value:function(t){return!t||!t.sceneId||t.sceneId===this.sceneId}},{key:"createTimeline",value:function(t,e){if(this.validateBeforeOperate(e)){if(!(e=this.getTimelineById(t.id))){for(var e=new s(t,this),r=!0,n=0,i=this.timelinesOptArr.length;n<i;n++)if(this.timelinesOptArr[n].id===t.id){r=!1;break}r&&this.timelinesOptArr.push(t),this.timelines.push(e)}return e}}},{key:"_getKeyframeById",value:function(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r].id===e)return t[r]}},{key:"deleteTimeline",value:function(e,t){this.validateBeforeOperate(t)&&(t=this.getTimelineById(e),this.timelines=this.timelines.filter(function(t){return t.id!==e}),this.timelinesOptArr=this.timelinesOptArr.filter(function(t){return t.id!==e}),t&&t.destroy&&t.destroy())}},{key:"switchTimeline",value:function(t,e){if(this.validateBeforeOperate(e)){if(t===this.timeline.id||t.id===this.timeline.id)return!1;this.timeline.pause();e=this.timeline;if(t instanceof s)this.timeline=t;else{if("string"!=typeof t)return console.log("Invalid parameter in switchTimeline:",t);var r=this.getTimelineById(t);if(!r)return console.log("Invalid timeline id in switchTimeline:",t);this.timeline=r}t=this.sceneEditor.cameraEditor;return t&&t.setCurTimeline(this.timeline),this.defaultTimelineId=this.timeline.id,this.timeline.recoverAttributesNotInKeyframe(e),this.moveToPaused(),t&&t.viewAutoFit(),!0}}},{key:"isInPlay",value:function(){return this.timeline.isInPlay()}},{key:"isPaused",value:function(){return this.timeline.isPaused()}},{key:"isStopped",value:function(){return this.timeline.isStopped()}},{key:"isInReady",value:function(){return this.timeline.isInReady()}},{key:"isNotInEdit",value:function(){return!0}},{key:"updateAttrUniforms",value:function(t,e){this.timeline.updateAttrUniforms(t,e)}},{key:"moveToPaused",value:function(){this.isNotInEdit()&&this.timeline.moveToPaused()}},{key:"updateOptions",value:function(t,e){var r,n=this;Array.isArray(e)&&e.forEach(function(t){var e=n.getTimelineById(t.id);e&&e.updateOptions(t)}),void 0!==t&&(e=this.timeline,t!==this.defaultTimelineId?(this.defaultTimelineId=t,r=this.timeline,(e=this.getTimelineById(t))&&(this.timeline=e,this.timeline.recoverAttributesNotInKeyframe(r))):this.timeline=e)}},{key:"destroy",value:function(){this.timelines.forEach(function(t){t&&t.destroy()}),this.timelines.length=0,this.timeline=null}}]),Object.defineProperty(t,"prototype",{writable:!1}),i}();t.exports=r},function(t,e,r){function i(t){return(i="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function n(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)),n}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){!function(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function c(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=s(r);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=r(0),h=r(2),p=r(26),d=r(3),y=h.Utils,b=r(29),m=r(30),v=r(32),g=r(37),_=0,r=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}(u,l);var t,s=c(u);function u(t,e){!function(t){if(!(t instanceof u))throw new TypeError("Cannot call a class as a function")}(this),r=s.call(this);var r,n=e.cityproCore,i=e.sceneEditor,o=e.defaultTimelineId,e=e.sceneId,a=n.viewer,n=(r.cityproCore=n,r.viewer=a,r.sceneEditor=i,r.options=Object.assign({id:"timeline".concat(_),name:"轨道".concat(_),frameCount:450,currentFrameNum:0,mode:"FrameMode",autoplay:!1,isLoop:!1,pathMode:"Bezire",targetPathMode:"Linear",attrUniforms:{globe_light:{enable:!0},postprocessing_postprocessing_bokeh:{enable:!1}},keyframes:[]},t||{}),r.options.currentFrameNum=0,_++,r.sceneId=e,r.id=r.options.id,r.name=r.options.name,r.initAtomAnime(),r.initKeyframeAttrMap(),r.bindEvent(),r.options.keyframes);return 1===n.length&&delete n[0].attributes.camera.positionBezireCtrls,r.addKeyframes(n),r.id===o&&r.sceneEditor.cameraEditor&&r.initCameraEditorComponents(),r.stop(),r}return o((t=u).prototype,[{key:"getCurrentFrameCameraAttr",value:function(){var t=this.options,e=t.keyframes,t=t.currentFrameNum,e=e[void 0===t?0:t].attributes.camera;return y.deepClone(e)}},{key:"initCameraEditorComponents",value:function(){var t,e,a,r,l=this;this.cameraKeyframeManager||(t=(e=(e=this.options).keyframes[void 0===(e=e.currentFrameNum)?0:e].attributes.camera.position).lng,e=e.lat,r=this.sceneEditor.cameraEditor,a=r.map,r=r.cameraMarkerUrl,this.cameraKeyframeManager=new b(this),this.cameraPath=new v(a,this.cameraKeyframeManager),this.cameraMarker=new m(a,this.viewer,this.cameraKeyframeManager,this.cameraPath,e,t,r),this.cameraKeyframeManager.setCameraMarker(this.cameraMarker),this.cameraKeyframeManager.setCameraPath(this.cameraPath),this.cameraAltitudeEditor=new g(this.cameraKeyframeManager),this.cameraKeyframeManager.on("setCurrentKeyframeId",function(t){var e=t.emitOrigin,r=t.keyframeId,t=t.state,r=(0!==e&&(l.cityproCore.emit("setCurrentKeyframeId",{keyframeId:r}),l.setCurrentFrameNum(r)),t.lng),n=t.lat,i=t.altitude,o=t.tilt,t=t.pan;l.viewer.setCamera({position:{lng:r,lat:n,altitude:i},rotation:{tilt:o,pan:t}}),2!==e&&a.panTo({lat:n,lng:r})}),this.cameraKeyframeManager.on("setExploreLngLat",function(t){var e=t.lng,r=t.lat,n=t.altitude,i=t.emitOrigin;3!==i&&l.viewer.setCamera({position:{lng:e,lat:r,altitude:n}}),0!==i&&l.cityproCore.emit("setExploreLngLat",t)}),this.cameraKeyframeManager.on("updatingAnchorLatlng",function(t){var e=t.lng,r=t.lat,n=t.keyframeId,t=t.emitOrigin,n=l.cameraKeyframeManager.getKeyframeStateById(n).altitude;3!==t&&l.viewer.setCamera({position:{lng:e,lat:r,altitude:n}}),0!==t&&l.cityproCore.emit("updatingAnchorLatlng",{lng:e,lat:r})}),this.cameraKeyframeManager.on("updatingAnchorAltitude",function(t){0!==t.emitOrigin&&l.cityproCore.emit("updatingAnchorAltitude",t)}),this.cameraKeyframeManager.on("setExploreAltitude",function(t){var e=t.lng,r=t.lat,n=t.altitude;3!==t.emitOrigin&&l.viewer.setCamera({position:{lng:e,lat:r,altitude:n}})}),this.cameraKeyframeManager.on("setExploreTilt",function(t){var e=t.tilt,r=t.pan;3!==t.emitOrigin&&l.viewer.setCamera({rotation:{tilt:e,pan:r}})}),this.cameraKeyframeManager.on("setExplorePan",function(t){var e=t.tilt,r=t.pan;3!==t.emitOrigin&&l.viewer.setCamera({rotation:{tilt:e,pan:r}})}),this.cameraKeyframeManager.on("togglePathMode",function(t){l.cityproCore.emit("togglePathMode",t)}),this.cameraKeyframeManager.on("updateKeyframeState",function(t){var e=t.keyframeState,r=t.emitOrigin,n=e.lng,i=e.lat,o=e.altitude,a=e.tilt,s=e.pan,u=l.viewer.controls.getCameraState(),c=u.position,u=u.rotation;y.easyObjDiff(e,f(f({},c),u))?r=3:l.viewer.setCamera({position:{lng:n,lat:i,altitude:o},rotation:{tilt:a,pan:s}}),0!==r&&l.cityproCore.emit("updateKeyframeState",t)}))}},{key:"showCameraEditorComponents",value:function(){this.cameraKeyframeManager||this.initCameraEditorComponents(),this.cameraMarker&&this.cameraMarker.show(),this.cameraPath&&this.cameraPath.show()}},{key:"hideCameraEditorComponents",value:function(){this.cameraMarker&&this.cameraMarker.hide(),this.cameraPath&&this.cameraPath.hide()}},{key:"setName",value:function(t){this.name=t}},{key:"getSubcoms",value:function(){if(this.kfam)return this.kfam.getSubcoms()}},{key:"initAtomAnime",value:function(){var e=this,t=this.options,r=t.frameCount,n=t.mode,n=void 0===n?"FrameMode":n,t=t.isLoop,n=h[n]||h.FrameMode;this.atomAnime=this.viewer.timeline.createAtomAnime({name:"sceneEditor",mode:n,duration:r,from:{},to:{},delay:0,loop:t?0:1}),this.atomAnime.on("update",function(t){e.moveTo(t.frameNum,!1)})}},{key:"isInPlay",value:function(){return"PLAY"===this.atomAnime.state}},{key:"isPaused",value:function(){return"PAUSED"===this.atomAnime.state}},{key:"isStopped",value:function(){return"STOPED"===this.atomAnime.state}},{key:"isInReady",value:function(){return"READY"===this.atomAnime.state||"STOPED"===this.atomAnime.state}},{key:"initKeyframeAttrMap",value:function(){this.kfam=new p(this.cityproCore,this)}},{key:"updateOptions",value:function(t){var e=y.deepClone(this.options);this.options=y.mergeOptions(this.options,t||{}),y.deepDiff(e.keyframes,t.keyframes)||this.addKeyframes(t.keyframes),y.easyDiff(e.frameCount,t.frameCount)&&y.easyDiff(e.isLoop,t.isLoop)&&y.easyDiff(e.autoplay,t.autoplay)||this.playKeyframes()}},{key:"recoverAttributesNotInKeyframe",value:function(t){var r,n,i,e=this;t&&(r=t.kfam.getSubcomsIdAndAttributeName(),n=this.kfam.getSubcomsIdAndAttributeName(),i={},Object.keys(r).forEach(function(t){var e=r[t];n[t]||(i[t]=e)}),Object.keys(i).forEach(function(t){var n=e.cityproCore.subcoms.get(t);i[t].forEach(function(t){var e=n[d[t]],r=n["".concat(t,"InOption")];e&&"function"==typeof e&&r&&"function"==typeof r&&(r=r.call(n,t),r=y.attrValueConvert(t,r),e.call(n,r))})}))}},{key:"playKeyframes",value:function(){this.atomAnime&&(this.updateAtomAnime(),this.setPlayState())}},{key:"updateAtomAnime",value:function(){var t=this.options,e=t.frameCount,t=t.isLoop;this.setLoop(t),this.setDuration(e)}},{key:"validateBeforeOperate",value:function(t){var e,r=!0;return t&&(e=t.sceneId,t=t.timelineId,e&&e!==this.sceneEditor.options.sceneManager.defaultSceneId&&(r=!1),t&&t!==this.id&&(r=!1)),r}},{key:"setLoop",value:function(t){this.atomAnime.setRepeat(t?0:1)}},{key:"setDuration",value:function(t,e){this.validateBeforeOperate(e)&&(this.options.frameCount=t,this.atomAnime.updateOptions({duration:t}))}},{key:"setCurrentFrameNum",value:function(t,e){this.validateBeforeOperate(e)&&(this.atomAnime.currentFrameNum=t,this.options.currentFrameNum=t)}},{key:"updateAttrUniforms",value:function(t,e){var r,n;this.validateBeforeOperate(e)&&(e=this.options.attrUniforms,n=t.keyChain,t=t.value,n.length&&(r=n[0],n=n[1],e[r][n]=t))}},{key:"setPlayState",value:function(){this.options.autoplay?this.play():this.stop()}},{key:"isAutoplay",value:function(){return this.options.autoplay}},{key:"stop",value:function(){this.atomAnime&&this.atomAnime.stop()}},{key:"play",value:function(){this.atomAnime&&(this.atomAnime.play(),this.cameraPath&&this.cameraPath.viewAutoFit())}},{key:"pause",value:function(){this.atomAnime&&this.atomAnime.pause()}},{key:"restart",value:function(){this.atomAnime&&this.atomAnime.restart()}},{key:"addKeyframes",value:function(t){this.removeAllKeyframes(),this.kfam.addKeyframes(t)}},{key:"addKeyframe",value:function(t,e){this.validateBeforeOperate(e)&&(this.kfam.addKeyframe(t),this.options.keyframes.push(t))}},{key:"updateKeyframe",value:function(t,e){if(this.validateBeforeOperate(e)){this.kfam.updateKeyframe(t);for(var r=this.options.keyframes,n=0,i=r.length;n<i;n++)if(r[n].id===t.id){r[n]=f(f({},r[n]),t);break}}}},{key:"updateKeyframe4cameraOnly",value:function(t,e,r){for(var n=this.options.keyframes,i=null,o=0,a=n.length;o<a;o++)if(n[o].id===t){i=n[o];break}if(!i)return console.log("Failed to update camera keyframe with ".concat(t," and ").concat(e));var s=i.attributes.camera;i.attributes.camera=f(f({},s),e),this.updateKeyframe(i,r)}},{key:"removeAllKeyframes",value:function(){this.kfam.removeAllKeyframes()}},{key:"removeKeyframe",value:function(e,t){var r;this.validateBeforeOperate(t)&&(this.kfam.removeKeyframe(e),-1!==(r=(t=this.options.keyframes).findIndex(function(t){return t.id===e}))&&t.splice(r,1))}},{key:"removeAttribute",value:function(t,e){this.validateBeforeOperate(e)&&this.kfam.removeAttribute(t)}},{key:"addAttribute",value:function(t,e,r){this.kfam.addAttribute(t,e,r)}},{key:"previewAttribute",value:function(t,e,r){this.validateBeforeOperate(r)&&this.kfam.previewAttribute(t,e)}},{key:"moveTo",value:function(t){this.kfam.moveTo(t,!(1<arguments.length&&void 0!==arguments[1])||arguments[1])}},{key:"moveToPaused",value:function(){var t=this.atomAnime.currentFrameNum;this.moveTo(t)}},{key:"interpolateCameraAttr",value:function(){for(var t=[],e=0,r=this.options.frameCount;e<=r;e++)t.push(this.kfam.interpolateCameraAttr(e));return t}},{key:"bindEvent",value:function(){var r=this;this.kfam.on("currentFrameConfig",function(t){r.cityproCore.emitCurrentFrameConfig(t)}),this.kfam.on("frameEvent",function(t){var e=r.cityproCore.sceneEditor.options.sceneManager.defaultSceneId;r.cityproCore.emitFrameEvent(e,r.id,t.frameNum)}),this.kfam.on("completePlay",function(){r.cityproCore.emitCompletePlay()})}},{key:"destroy",value:function(){this.kfam&&this.kfam.destroy(),this.atomAnime&&this.atomAnime.remove(),this.cameraMarker&&this.cameraMarker.destroy(),this.cameraPath&&this.cameraPath.destroy(),this.cameraKeyframeManager&&this.cameraKeyframeManager.destroy(),this.cityproCore=null}}]),Object.defineProperty(t,"prototype",{writable:!1}),u}();t.exports=r},function(t,e,r){function i(t){return(i="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function a(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=s(r);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var c=null,l=r(0),f=r(27),h=r(3),r=r(5),p=r.getEntity,d=r.getSubcoms,y=r.getSubcomsIdAndAttributeName,r=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&o(t,e)}(u,l);var t,s=a(u);function u(t,e){!function(t){if(!(t instanceof u))throw new TypeError("Cannot call a class as a function")}(this),r=s.call(this);var r,n=t.viewer,i=t.subcoms,o=t.sceneEditor,a=t.Utils;return c=a,r.cityproCore=t,r.viewer=n,r.subcoms=i,r.sceneEditor=o,r.eventsMap=new Map,r.attrsEntityMap=new Map,r.currentFrame={frameNum:0,attributes:{}},r.timeline=e,r}return n((t=u).prototype,[{key:"addKeyframes",value:function(t){var e=this;Array.isArray(t)&&(t.forEach(function(t){e._addKeyframe(t)}),this.preInterpolate())}},{key:"_addKeyframe",value:function(t){var e=t.id;void 0!==e&&(this.removeKeyframe(e),this.createAttribute(t))}},{key:"addKeyframe",value:function(t){this._addKeyframe(t),this.preInterpolate()}},{key:"removeKeyframe",value:function(e){this.attrsEntityMap&&this.attrsEntityMap.forEach(function(t){t.removeAttr(e)}),this.eventsMap&&this.eventsMap.delete(e),this.preInterpolate()}},{key:"removeAllKeyframes",value:function(){this.attrsEntityMap&&(this.attrsEntityMap.forEach(function(t){t.destroy()}),this.attrsEntityMap.clear()),this.eventsMap&&this.eventsMap.clear()}},{key:"updateKeyframe",value:function(t){this.createAttribute(t),this.preInterpolate()}},{key:"addAttribute",value:function(t,e,r){var n=r.easingType,r=r.enableEmit;e&&(this.attrsEntityMap.has(t)||this.ininAttribute(t),n={attributes:e,easingType:n,originalAttrs:c.deepClone(e)},this.attrsEntityMap.get(t).updateAttr(0,n),r?this.eventsMap.set(0,r):this.eventsMap.delete(0))}},{key:"removeAttribute",value:function(t){this.attrsEntityMap.has(t)&&(this.attrsEntityMap.get(t).destroy(),this.attrsEntityMap.delete(t))}},{key:"createAttribute",value:function(t){var r=this,n=t.attributes,i=t.id,o=t.easingType,t=t.enableEmit;Object.keys(n).forEach(function(t){r.attrsEntityMap.has(t)||r.ininAttribute(t);var e=r.attrsEntityMap.get(t),t=n[t],t={attributes:t,easingType:o,originalAttrs:c.deepClone(t)};e.updateAttr(i,t)}),t?this.eventsMap.set(i,t):this.eventsMap.delete(i),this.attrsEntityMap.forEach(function(t){var e=t._name;void 0===n[e]&&t.removeAttr(i)})}},{key:"preInterpolate",value:function(){this.attrsEntityMap.forEach(function(t){t.preInterpolate()})}},{key:"ininAttribute",value:function(t){var e=this.timeline,r=e.sceneId,e=e.id,r=new f(this.cityproCore,t,r,e);this.attrsEntityMap.set(t,r)}},{key:"getEntity",value:function(t){return p(t,this.sceneEditor,this.subcoms)}},{key:"getSubcoms",value:function(){return d(this.attrsEntityMap,this.subcoms)}},{key:"getSubcomsIdAndAttributeName",value:function(){return y(this.attrsEntityMap)}},{key:"previewAttribute",value:function(t,r){var n=this.getEntity(t);Object.keys(r).forEach(function(t){var e;"time"===t&&(r[t]=new Date(r[t]).valueOf()),/\w*color\w*/i.test(t)&&(e=c.Chroma(r[t]).gl(),r[t]={r:e[0],g:e[1],b:e[2],a:e[3]}),n&&n[h[t]]&&"function"==typeof n[h[t]]&&n[h[t]](r[t])})}},{key:"moveTo",value:function(r,n){var t,e,i,o=this;this.currentFrame.attributes={},this.attrsEntityMap.forEach(function(t,e){t.moveTo(r,n),o.currentFrame.attributes[e]=t.currentAttr}),this.eventsMap.get(r)&&this.emit("frameEvent",{frameNum:r}),this.currentFrame.frameNum=r,this.emit("movingFrame"),this.timeline&&this.timeline.options&&(t=(e=this.timeline.options).frameCount,e=e.isLoop,(i=this.timeline.atomAnime).repeat,i=i.paused,r!==t||i||e||this.emit("completePlay"))}},{key:"interpolateCameraAttr",value:function(t){return this.attrsEntityMap.get("camera").interpolateCameraAttr(t)}},{key:"getCurrentAttrs",value:function(){return this.currentFrame}},{key:"destroy",value:function(){this.removeAllKeyframes(),this.timeline=null}}]),Object.defineProperty(t,"prototype",{writable:!1}),u}();t.exports=r},function(t,e,r){function o(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)),n}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function m(t){return(m="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function v(t,e,r){return(1-r)*t+r*e}var g=r(28),f=r(3),a=r(5).getEntity,_=null,u=["positionBezireCtrls"],r=function(){function s(t,e,r,n){!function(t){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}(this);var i=t.viewer,o=t.subcoms,a=t.sceneEditor,t=t.Utils;_=t,this.viewer=i,this.subcoms=o,this.sceneEditor=a,this._name=e,this._enable=!0,this.attrs=new Map,this.attrsSet=new Set,this._currentAttr={},this.sceneId=r,this.timelineId=n}var t=s;return i(t.prototype,[{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t}},{key:"currentAttr",get:function(){return this._currentAttr}},{key:"duration",set:function(t){this._duration=t}},{key:"getEntity",value:function(t){return a(t,this.sceneEditor,this.subcoms)}},{key:"updateAttr",value:function(t,e){var r=this.attrs.get(t),r=(void 0===e.easingType&&r&&(e.easingType=r.easingType),this.attrs.delete(t),this.convertAttr(e));this.attrs.set(t,r),this.calCursorRange()}},{key:"preInterpolate",value:function(){var n=this;this.attrsSet.forEach(function(r){n.attrs.forEach(function(t,e){void 0===t.originalAttrs[r]&&n.makeUpAttrs(e,r)})})}},{key:"makeUpAttrs",value:function(t,r){var n=[],i=(this.attrs.forEach(function(t,e){void 0!==t.originalAttrs[r]&&n.push(e)}),n.sort(function(t,e){return t-e}),this.getClosestTwoKeyframe(n,t)),e=this.attrs.get(n[i[0]]),o=this.attrs.get(n[i[1]]),a=e.attributes[r],s=o.attributes[r],u=null;"object"===m(a)&&(u={},Object.keys(a).forEach(function(t){var e=a[t],r=s[t],e=v(e,r,i[2]);u[t]=e})),"number"==typeof a&&(u=v(a,s,i[2])),this.attrs.get(t).attributes[r]=u}},{key:"getClosestTwoKeyframe",value:function(t,e){var r=t.length;if(0===r)return null;if(1===r||e<=t[0])return[0,0,1];if(e>=t[r-1])return[r-1,r-1,1];for(var n=0,i=0,o=0;o<r-1;o++){if(e===t[o]){i=n=o;break}if(e>t[o]&&e<t[o+1]){i=(n=o)+1;break}}var a=t[n],s=t[i];return[n,i,a===s?1:(e-a)/(s-a)]}},{key:"removeAttr",value:function(t){this.attrs.delete(t),this.calCursorRange()}},{key:"convertAttr",value:function(t){var e=this,r=t.attributes;return Object.keys(r).forEach(function(t){u.includes(t)||(e.attrsSet.add(t),_.attrValueConvert(t,r[t],r))}),t}},{key:"reverseConvertAttr",value:function(r){var n=this;return Object.keys(r).forEach(function(t){var e;"time"===t&&(r[t]=n.timestampToString(r[t])),/\w*color\w*/i.test(t)&&(e=r[t],r[t]="RGBA(".concat(~~(255*e.r),", ").concat(~~(255*e.g),", ").concat(~~(255*e.b),",").concat(e.a,")"))}),r}},{key:"timeFixed",value:function(t){return t=1===t.length?"0".concat(t):t}},{key:"timestampToString",value:function(t){var t=new Date(+t),e=t.getFullYear().toString(),r="".concat(Number.parseInt(t.getMonth(),10)+1),n="".concat(t.getDate()),i="".concat(t.getHours()),o="".concat(t.getMinutes()),t="".concat(t.getSeconds()),r=this.timeFixed(r),n=this.timeFixed(n),i=this.timeFixed(i),o=this.timeFixed(o),t=this.timeFixed(t);return"".concat(e,"-").concat(r,"-").concat(n," ").concat(i,":").concat(o,":").concat(t)}},{key:"calCursorRange",value:function(){this.cursorRange=function(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}()||function(t){if(t){if("string"==typeof t)return n(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(e="Object"===e&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?n(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.attrs.keys()),this.cursorRange.sort(function(t,e){return t-e})}},{key:"moveTo",value:function(t,e){var r;this._enable&&null!==(r=this.getClosestTwoKeyframe(this.cursorRange,t))&&this.doFunc(r,t,e)}},{key:"doFunc",value:function(t,e,r){var n,i,o=this.attrs.get(this.cursorRange[t[0]]),a=this.attrs.get(this.cursorRange[t[1]]).attributes,s=o.attributes,o=o.easingType,u=!1,c=this.sceneEditor.cameraEditor,l=("camera"===this._name&&c&&(i=(c=c.getCurrentSceneAndTimelineId()).sceneId,c=c.timelineId,i!==this.sceneId&&c!==this.timelineId||(u=!0)),n=u?this.doInterpolateWithCameraEditor(s,a,t,o,e,r):"camera"===this._name?this.doInterpolate4publish(this.sceneId,this.timelineId,e):this.doInterpolate(s,a,t,o),this._currentAttr=_.realDeepClone(n),this._currentAttr=this.reverseConvertAttr(this._currentAttr),this.getEntity(this._name));Object.keys(n).forEach(function(t){var e=n[t];l&&l[f[t]]&&"function"==typeof l[f[t]]&&l[f[t]](e)})}},{key:"doInterpolate",value:function(e,r,s,u){var c={};return _.easyObjDiff(e,r)?e:(Object.keys(e).forEach(function(n){var t,i,o=e[n],a=r[n];void 0===a?c[n]=o:(t=s[2],i=(void 0!==g[u]?g[u]:g.linear)(t),"object"===m(o)&&(c[n]={},Object.keys(o).forEach(function(t){var e=o[t],r=a[t],e=v(e,r,i);c[n][t]=e})),"number"==typeof o&&(c[n]=v(o,a,i)))}),c)}},{key:"doInterpolateWithCameraEditor",value:function(s,u,c,l,f,t){var e,r,n,i,o,h=this,p={},a=this.sceneEditor.cameraEditor,d=a.cameraPath,y=a.cameraAltitudeEditor,a=a.cameraKeyframeManager;if(a.setCurrentKeyframeIdByCursor(f),_.easyObjDiff(s,u))return(o=a.getKeyframeStateById(f))?(e=o.lng,r=o.lat,n=o.altitude,i=o.tilt,o=o.pan,d.emitMovingAlong({lng:e,lat:r,tilt:i,altitude:n,pan:o,cursor:f},!1),y.emitMovingAlong(f,n,!1),s.position={lng:e,lat:r,altitude:n},s.rotation={tilt:i,pan:o}):a.setExploreStateAfterLastKeyframe(),s;var b={cursor:f};return Object.keys(s).forEach(function(n){var i,t,e,r,o=s[n],a=u[n];void 0===a?p[n]=o:(e=c[2],i=(void 0!==g[l]?g[l]:g.linear)(e),"position"===n?(r=(e=h.interpolateCameraPosition(c,l,d,y,f)).lng,t=e.lat,e=e.altitude,p.position={lng:r,lat:t,altitude:e},b.lng=r,b.lat=t,b.altitude=e):"rotation"===n?(r=o.pan,t=a.pan,e=h.interpolateCameraPan(i,r,t),r=v(o.tilt,a.tilt,i),p.rotation={pan:e,tilt:r},b.tilt=r,b.pan=e):"positionBezireCtrls"!==n&&("object"===m(o)&&(p[n]={},Object.keys(o).forEach(function(t){var e=o[t],r=a[t],e=v(e,r,i);p[n][t]=e})),"number"==typeof o&&(p[n]=v(o,a,i))))}),d.emitMovingAlong(b,t),y.emitMovingAlong(f,b.altitude,t),p}},{key:"doInterpolate4publish",value:function(t,e,r){for(var n=this.sceneEditor.options.cameraKeyframeConfig,i=0,o=n.length;i<o;i++)if(n[i].sceneId===t)for(var a=n[i].cameraTimelines,s=0,u=a.length;s<u;s++){var c=a[s];if(c.id===e)return c.cameraAttrs[r]}console.error("发布态相机关键帧属性获取失败: ".concat(t,"-").concat(e,"-").concat(r,"."))}},{key:"interpolateCameraPosition",value:function(t,e,r,n,i){var o=this.cursorRange[t[0]],a=this.cursorRange[t[1]],s=this.cursorRange[this.cursorRange.length-1],u=0===t[0]?0:o/s,c=t[2],e=(u+=(void 0!==g[e]?g[e]:g.linear)(c)*(a-o)/s,u=Math.min(1,Math.max(0,u)),r.getPtByRatio(u)),c=n.getPtByRatio(t[2],i,o,a);return{lng:e.lng,lat:e.lat,altitude:c}}},{key:"interpolateCameraPan",value:function(t,e,r){var n=Math.abs(e-r),i=360-n;return 180<n?e<0?t<=(n=-(-180-e)/i)?v(e,-180,t/n):v(180,r,(t-n)/(1-n)):t<=(n=(180-e)/i)?v(e,180,t/n):v(-180,r,(t-n)/(1-n)):v(e,r,t)}},{key:"interpolateCameraAttr",value:function(s){var u=this,c={},l=this.getClosestTwoKeyframe(this.cursorRange,s);if(null===l)return c;var t,e,r,n=this.attrs.get(this.cursorRange[l[0]]),i=this.attrs.get(this.cursorRange[l[1]]),f=n.attributes,h=n.easingType,p=i.attributes,n=this.sceneEditor.cameraEditor||{},d=n.cameraPath,y=n.cameraAltitudeEditor,i=n.cameraKeyframeManager;return _.easyObjDiff(f,p)?((n=i.getKeyframeStateById(s))&&(i=n.lng,t=n.lat,e=n.altitude,r=n.tilt,n=n.pan,f.position={lng:i,lat:t,altitude:e},f.rotation={tilt:r,pan:n}),delete(c=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach(function(t){!function(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},f)).positionBezireCtrls):Object.keys(f).forEach(function(n){var i,t,e,r,o=f[n],a=p[n];void 0===a?c[n]=o:(e=l[2],i=(void 0!==g[h]?g[h]:g.linear)(e),"position"===n?(r=(e=u.interpolateCameraPosition(l,h,d,y,s)).lng,t=e.lat,e=e.altitude,c.position={lng:r,lat:t,altitude:e}):"rotation"===n?(r=o.pan,t=a.pan,e=u.interpolateCameraPan(i,r,t),r=v(o.tilt,a.tilt,i),c.rotation={pan:e,tilt:r}):"positionBezireCtrls"!==n&&("object"===m(o)&&(c[n]={},Object.keys(o).forEach(function(t){var e=o[t],r=a[t],e=v(e,r,i);c[n][t]=e})),"number"==typeof o&&(c[n]=v(o,a,i))))}),c}},{key:"destroy",value:function(){this.attrs&&(this.attrs.clear(),this.attrs=null)}}]),Object.defineProperty(t,"prototype",{writable:!1}),s}();t.exports=r},function(t,e){t.exports={linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return 1-(1-t)*(1-t)},easeInOutQuad:function(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return 1-Math.pow(1-t,3)},easeInOutCubic:function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2},easeInQuart:function(t){return t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeInExpo:function(t){return 0===t?0:Math.pow(2,10*t-10)},easeOutExpo:function(t){return 1===t?1:1-Math.pow(2,-10*t)}}},function(t,e,r){function i(t){return(i="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function n(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)),n}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){!function(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function a(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}()||function(t){if(t){if("string"==typeof t)return s(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(e="Object"===e&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?s(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function l(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=f(r);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n?(t=f(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var h=r(0),r=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e)}(i,h);var t,n=l(i);function i(t){!function(t){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this),(e=n.call(this))._exploreState={tilt:89,pan:1},e._keyframesState=new Map,e._currentKeyframeId=0,e._currentCursor=0;var e,r,t=(e.timeline=t).options;return t&&(r=t.pathMode,t=t.keyframes,e.addKeyframeStateFromOption(t),e.pathMode=r),e}return u((t=i).prototype,[{key:"setCameraMarker",value:function(t){this.cameraMarker=t}},{key:"setCameraPath",value:function(t){this.cameraPath=t}},{key:"getKeyframeIds",value:function(){return a(this._keyframesState.keys())}},{key:"whichKeyframe",value:function(t){for(var e=this.getKeyframeIds().sort(function(t,e){return t-e}),r=0,n=e.length;r<n;r++)if(e[r]===t)return r}},{key:"cursorIsKeyframeId",value:function(t){return t=void 0===t?this._currentCursor:t,this.getKeyframeIds().includes(t)}},{key:"cursorIsAfterLastKeyframe",value:function(t){var e=this.getKeyframeIds();return t>Math.max.apply(Math,a(e))}},{key:"setCurrentKeyframeIdByCursor",value:function(t){this._currentCursor=t,this.cursorIsKeyframeId(t)||(this._currentKeyframeId=-1,this.emit("moveToNonKeyframe"))}},{key:"currentKeyframeId",get:function(){return this._currentKeyframeId},set:function(t){var e=t.keyframeId,r=t.emitOrigin,t=t.force;this._currentKeyframeId===e&&!t||(this._currentKeyframeId=e,this._currentCursor=e,(t=this._keyframesState.get(e))&&this.emit("setCurrentKeyframeId",{keyframeId:e,state:o({},t),emitOrigin:r}))}},{key:"currentCursor",get:function(){return this._currentCursor}},{key:"exploreState",get:function(){return this._exploreState}},{key:"keyframesState",get:function(){return this._keyframesState}},{key:"exploreLngLat",set:function(t){var e=t.lng,r=t.lat,t=t.emitOrigin,n=this._exploreState,i=n.lng,o=n.lat,n=n.altitude;i===e&&o===r||(this._exploreState.lng=e,this._exploreState.lat=r,this.emit("setExploreLngLat",{lng:e,lat:r,altitude:n,emitOrigin:t}))}},{key:"exploreAltitude",set:function(t){var e=this._exploreState,r=e.lng,n=e.lat,e=e.altitude,i=t.altitude,o=t.emitOrigin,t=t.force;(void 0===t||!t)&&Math.abs(e-i)<.1||(this._exploreState.altitude=i,this.emit("setExploreAltitude",{lng:r,lat:n,altitude:i,emitOrigin:o,cursor:this._currentCursor}))}},{key:"exploreTilt",set:function(t){var e=t.tilt,t=t.emitOrigin,r=this._exploreState,n=r.tilt,r=r.pan;e!==n&&(this._exploreState.tilt=e,this.emit("setExploreTilt",{tilt:e,pan:r,emitOrigin:t}))}},{key:"explorePan",set:function(t){var e=t.pan,t=t.emitOrigin,r=this._exploreState,n=r.pan,r=r.tilt;n!==e&&(this._exploreState.pan=e,this.emit("setExplorePan",{pan:e,tilt:r,emitOrigin:t}))}},{key:"setExploreStateAfterLastKeyframe",value:function(){var t=this.getKeyframeIds(),t=Math.max.apply(Math,a(t)),t=this.getKeyframeStateById(t),e=t.lng,r=t.lat,n=t.altitude,i=t.tilt,t=t.pan;this.exploreLngLat={lng:e,lat:r,emitOrigin:0},this.exploreAltitude={altitude:n,emitOrigin:0,force:!0},this.exploreTilt={tilt:i,emitOrigin:0},this.explorePan={pan:t,emitOrigin:0}}},{key:"getKeyframeStateById",value:function(t){return this._keyframesState.get(t)}},{key:"addKeyframeHandler",value:function(t,e){this._keyframesState.set(t,o({},e)),this._exploreState={}}},{key:"addKeyframeStateFromOption",value:function(t){var s=this;t&&t.length&&t.forEach(function(t){var e,r,n,i,o,a=t.id,t=t.attributes.camera;t&&(i=t.position,e=t.positionBezireCtrls,t=t.rotation,r=(i=void 0===i?{}:i).lng,n=i.lat,i=i.altitude,o=(t=void 0===t?{}:t).tilt,t=t.pan,s._keyframesState.set(a,{lng:r,lat:n,altitude:i,tilt:o,pan:t,positionBezireCtrls:void 0===e?{}:e}))})}},{key:"deleteKeyframeState",value:function(t){this.getKeyframeStateById(t)&&this._keyframesState.delete(t)}},{key:"emitUpdatingAnchor",value:function(t){this.emit("updatingAnchorLatlng",o(o({},t),{},{keyframeId:this._currentKeyframeId}))}},{key:"emitUpdatingAltitude",value:function(t){this.emit("updatingAnchorAltitude",t)}},{key:"emitPathModeToggle",value:function(t){this.emit("togglePathMode",t)}},{key:"updateKeyframeState",value:function(t,e,r){var n=this.getKeyframeStateById(t);!n||1===r&&e.altitude===n.altitude||(n=o(o({},n),e),this._keyframesState.set(t,n),this.emit("updateKeyframeState",{keyframeId:t,keyframeState:n,emitOrigin:r}))}},{key:"destroy",value:function(){this._keyframesState.clear()}}]),Object.defineProperty(t,"prototype",{writable:!1}),i}();t.exports=r},function(t,e,r){function i(t){return(i="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function a(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=s(r);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=r(0),f=r(1),r=(r(31)(f),function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&o(t,e)}(c,l);var t,u=a(c);function c(t,e,r,n,i,o,a){var s;return function(t){if(!(t instanceof c))throw new TypeError("Cannot call a class as a function")}(this),(s=u.call(this)).map=t,s.viewer=e,s.cameraKeyframeManager=r,s.cameraPath=n,s._marker=null,s._altitude=5e3,s.visible=!0,s.tilt=89,s.pan=1,s.initialize(i,o,a),r.on("setExploreLngLat",function(t){var e=t.lng,r=t.lat;2!==t.emitOrigin&&(s._marker.setRotationAngle(90-s.tilt,s.pan),s._marker.setLatLng([r,e]))}),r.on("setExplorePan",function(t){t=t.pan;s.pan=t,s._marker.setRotationAngle(90-s.tilt,s.pan)}),r.on("setExploreTilt",function(t){t=t.tilt;s.tilt=t,s._marker.setRotationAngle(90-s.tilt,s.pan)}),n.on("movingAlong",function(t){var e=t.lng,r=t.lat,n=t.tilt,t=t.pan;s._marker.setLatLng([r,e]),s._marker.setRotationAngle(90-n,t)}),r.on("setCurrentKeyframeId",function(t){var t=t.state,e=t.lng,r=t.lat,n=t.tilt,t=t.pan;s._marker.setRotationAngle(90-n,t),s._marker.setLatLng([r,e]),s.tilt=n,s.pan=t}),r.on("updatingAnchorLatlng",function(t){s._marker.setRotationAngle(90-s.tilt,s.pan),s._marker.setLatLng([t.lat,t.lng])}),r.on("updateKeyframeState",function(t){var e=t.keyframeState,t=t.emitOrigin,r=e.lng,n=e.lat,i=e.tilt,e=e.pan;2!==t&&(s._marker.setRotationAngle(90-i,e),s._marker.setLatLng([n,r]),s.tilt=i,s.pan=e)}),s}return n((t=c).prototype,[{key:"initialize",value:function(t,e,r){var n=this,r=f.icon({iconUrl:r||"https://img.alicdn.com/imgextra/i4/O1CN01K0BLBC1XMpHC0olkZ_!!6000000002910-2-tps-152-152.png",iconSize:[60,60],iconAnchor:[30,30]}),t=f.marker([t,e],{icon:r,rotationOrigin:"center"});t.setZIndexOffset(-100),t.addTo(this.map),(this._marker=t).pm.enable({preventMarkerRemoval:!0,snappable:!1}),t.on("pm:drag",function(t){n.setCameraExploreLngLat(t.latlng),n._marker.setRotationAngle(90-n.tilt,n.pan)}),t.on("pm:dragend",function(t){t.target&&t.target._latlng&&(n.setCameraExploreLngLat(t.target._latlng),n._marker.setRotationAngle(90-n.tilt,n.pan))})}},{key:"setLatLng",value:function(t,e,r,n){2===r&&!n||this._marker.setLatLng([t,e]),this.cameraKeyframeManager.exploreLngLat={lng:e,lat:t,emitOrigin:r}}},{key:"getLatLng",value:function(){return this._marker.getLatLng()}},{key:"setCameraExploreLngLat",value:function(t){var e;t&&(e=t.lng,t=t.lat,this.setLatLng(t,e,2))}},{key:"show",value:function(){this.visible||(this.visible=!0,this._marker.setOpacity(1))}},{key:"hide",value:function(){this.visible&&(this.visible=!1,this._marker.setOpacity(0))}},{key:"destroy",value:function(){this._marker.removeFrom(this.map),this._marker=null}}]),Object.defineProperty(t,"prototype",{writable:!1}),c}());t.exports=r},function(t,e){t.exports=function(n){var t=n.Marker.prototype._initIcon,e=n.Marker.prototype._setPos;n.Marker.addInitHook(function(){var t=(t=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor)&&"".concat(t[0],"px ").concat(t[1],"px");this.options.rotationOrigin=this.options.rotationOrigin||t||"center",this.options.rotateXangle=this.options.rotateXangle||0,this.options.rotateZangle=this.options.rotateZangle||0,this.on("drag",function(t){t.target._applyRotation()})}),n.Marker.include({_initIcon:function(){t.call(this)},_setPos:function(t){e.call(this,t),this._applyRotation()},_applyRotation:function(){var t=this.options,e=t.rotationOrigin,r=t.rotateXangle,t=t.rotateZangle;this._icon.style["".concat(n.DomUtil.TRANSFORM,"Origin")]=e,r&&(this._icon.style[n.DomUtil.TRANSFORM]+=" rotateX(".concat(r,"deg)")),t&&(this._icon.style[n.DomUtil.TRANSFORM]+=" rotateZ(".concat(t,"deg)"))},setRotationAngle:function(t,e){return this.options.rotateXangle=t,this.options.rotateZangle=e,this.update(),this},setRotationOrigin:function(t){return this.options.rotationOrigin=t,this.update(),this}})}},function(t,e,r){function i(t){return(i="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function u(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}()||function(t){if(t){if("string"==typeof t)return n(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(e="Object"===e&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?n(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function c(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(r);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return l(t)}(this,n?(t=o(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var f=r(0),h=r(1),p=r(33),r=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}(o,f);var t,e,i=c(o);function o(t,e){!function(t){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}(this),(r=i.call(this)).map=t;var r,n=h.polyline([],{color:"#eee"});return n.addTo(t),n.pm.enable({hideMiddleMarkers:!0,snapSegment:!1,preventMarkerRemoval:!0,moveVertexValidation:o.moveVertexValidation}),r.visible=!0,r.pathLayer=n,r.cameraKeyframeManager=e,r.pathMode=e.pathMode||"Linear",r.cameraAnchorManager=new p(t,r.pathMode,e),r.initDragHelpLine(),n.pm.highlightAnchor=r.highlightAnchor.bind(l(r)),r.registerEvent(),r.addInitialAnchors(),r}return e=[{key:"moveVertexValidation",value:function(t){t=t.marker;return t._clicked&&t._draggable}}],a((t=o).prototype,[{key:"togglePathMode",value:function(t){if(this.pathMode!==t){if(this.pathMode=t,this.cameraAnchorManager.setPathMode(t),this.cameraKeyframeManager.emitPathModeToggle(t),"Bezire"===t&&this.cameraAnchorManager.getAnchors().length<3)return console.log("路径节点少于3个不可进行贝塞尔插值！");this.togglePathModeHandler()}}},{key:"initDragHelpLine",value:function(){var t=h.polyline([],{color:"#f27a24",dashArray:"1 4",weight:2});(this.dragHelpLine=t).addTo(this.map)}},{key:"setMarkerClicked",value:function(t){t=this.cameraKeyframeManager.whichKeyframe(t);this.pathLayer.pm.setMarkerClicked(t)}},{key:"registerEvent",value:function(){var n=this,t=this.pathLayer,e=this.cameraAnchorManager,r=this.cameraKeyframeManager;r.on("setCurrentKeyframeId",function(t){var e=t.keyframeId,t=t.emitOrigin;n.highlightAnchor(e),2!==t&&n.setMarkerClicked(e)}),r.on("moveToNonKeyframe",function(){n.pathLayer.pm.setMarkerDraggability(!1),e.unHighlightAnchor()}),t.on("pm:markerdragstart",function(t){var e=t.layer,t=t.indexPath,t=t&&t[0]||0,e=e._latlngs,e=n.highlightAnchor(null,e[t],t,!1);e&&e.updateBezireCtrlPtsNegative()}),t.on("pm:markerdrag",function(t){var e=t.layer,t=t.indexPath,t=t&&t[0]||0,e=e._latlngs,r=n.cameraAnchorManager.getAnchorByPathIdx(t);n.updatePathLineDragging(e,t),n.highlightAnchor(null,e[t],t,!1),r&&r.updateBezireCtrlPtsNegative()}),t.on("pm:markerdragend",function(t){var e=t.layer,t=t.indexPath,t=t&&t[0]||0,e=e._latlngs,e=(n.updatePathLineDragEnd(e[t],t),n.highlightAnchor(null,e[t],t));e&&(e.updateBezireCtrlPtsNegative(),n.setMarkerClicked(e.keyframeId))}),e.on("ctrlMarkerDrag",function(t){n.updateDragHelpLine(t)}),e.on("ctrlMarkerDragEnd",function(t){n.updateDragHelpLine(t),n.updatePathLineCtrlMarkerDragEnd(t)})}},{key:"getLatlngs",value:function(){return u(this.pathLayer.getLatLngs())}},{key:"addInitialAnchors",value:function(){var r=this;this.cameraKeyframeManager.keyframesState&&this.cameraKeyframeManager.keyframesState.forEach(function(t,e){r.addAnchor(e,t)})}},{key:"addAnchor",value:function(t,e){var r=this.cameraAnchorManager.keyframeId2anchor.size<2,n=2===this.cameraAnchorManager.keyframeId2anchor.size,i=2<this.cameraAnchorManager.keyframeId2anchor.size,o="Bezire"===this.pathMode,t=this.cameraAnchorManager.addCameraAnchor(t,e),e=-1,a=0,s=[];o?r?(s=(r=this.cameraAnchorManager.interpolate4add(t,!1)).interpolatedPts,a=r.deletePtsCount,e=r.deleteStartIdx):n?(s=(r=this.cameraAnchorManager.interpolate4add(t,!1)).interpolatedPts,a=r.deletePtsCount,e=r.deleteStartIdx,n=this.cameraAnchorManager.getAnchorIdxes(),this.pathLayer.pm.updateAnchorPtIdxes(n),(r=u(this.pathLayer.getLatLngs())).splice.apply(r,[e,a].concat(u(s))),this.pathLayer.setLatLngs(r),this.pathLayer.pm.updateMarkers(),n=t.prevAnchor,s=(r=this.cameraAnchorManager.updateCameraAnchor(n.pathIdx,n.getLatlng(),o)).interpolatedPts,a=r.deletePtsCount,e=r.deleteStartIdx):i&&(e=(n=this.cameraAnchorManager.interpolate4add(t,o)).deleteStartIdx,a=n.deletePtsCount,s=n.interpolatedPts):(s=(r=this.cameraAnchorManager.interpolate4add(t,!1)).interpolatedPts,a=r.deletePtsCount,e=r.deleteStartIdx),this.updatePathLineAfterInterpolate(e,a,s)}},{key:"removeAnchor",value:function(t){var e="Bezire"===this.pathMode,e=this.cameraAnchorManager.removeCameraAnchor(t,e),r=e.deleteStartIdx,n=e.deletePtsCount,e=e.interpolatedPts;this.updatePathLineAfterInterpolate(r,n,e),this.cameraKeyframeManager.deleteKeyframeState(t)}},{key:"highlightAnchor",value:function(t,e,r){var n=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],i=this.cameraAnchorManager.highlightAnchor(t,e,r);return t=null!=t?t:this.cameraAnchorManager.getAnchorByPathIdx(r).keyframeId,n&&(this.cameraKeyframeManager.currentKeyframeId={keyframeId:t,emitOrigin:2}),i}},{key:"updatePathLineDragging",value:function(t,e){var r=this.cameraAnchorManager.getAnchorByPathIdx(e);if(!r)return console.log("There is no anchor for the pathIdx: ".concat(e,"!"));t=t[e];r.setLatlng(t),this.cameraKeyframeManager.emitUpdatingAnchor({lat:t.lat,lng:t.lng,emitOrigin:2}),this.updateDragHelpLine(r)}},{key:"updateAnchorLinkSegment",value:function(t){var e=t.prevAnchor,r=t.nextAnchor,n=[],i="Bezire"===this.pathMode,i=2<this.cameraAnchorManager.keyframeId2anchor.size&&i;return e&&(n.push(e.getLatlng()),n.push.apply(n,u(this.cameraAnchorManager.interpolatePathLineSegment(e,t,i)))),r&&(n.push(t.getLatlng()),n.push.apply(n,u(this.cameraAnchorManager.interpolatePathLineSegment(t,r,i)))),n}},{key:"updateDragHelpLine",value:function(t){t=this.updateAnchorLinkSegment(t);this.dragHelpLine.setLatLngs(t)}},{key:"updatePathLineDragEnd",value:function(t,e){var r="Bezire"===this.pathMode,r=2<this.cameraAnchorManager.keyframeId2anchor.size&&r,e=(this.dragHelpLine.setLatLngs([]),this.cameraAnchorManager.updateCameraAnchor(e,t,r)),r=e.deleteStartIdx,n=e.deletePtsCount,e=e.interpolatedPts,r=(this.updatePathLineAfterInterpolate(r,n,e),this.cameraAnchorManager.curAnchor),n=r.keyframeId,e={lng:t.lng,lat:t.lat};"Bezire"===this.pathMode&&(e.positionBezireCtrls=r.getBezireCtrlLatlng()),this.cameraKeyframeManager.updateKeyframeState(n,e,2)}},{key:"updatePathLineNotDrag",value:function(t,e,r){var n="Bezire"===this.pathMode,n=2<this.cameraAnchorManager.keyframeId2anchor.size&&n,t={lat:t.lat,lng:t.lng},n=this.cameraAnchorManager.updateCameraAnchor(e,t,n),i=n.deleteStartIdx,o=n.deletePtsCount,a=n.interpolatedPts,n=n.anchorIdxDelta;0===e&&(i=0,o+=1,a.unshift(t),this.cameraAnchorManager.updateAnchorIdxFrom(0,n)),this.updatePathLineAfterInterpolate(i,o,a),this.setMarkerClicked(r)}},{key:"updatePathLineCtrlMarkerDragEnd",value:function(t){var e="Bezire"===this.pathMode,r=(this.dragHelpLine.setLatLngs([]),t.getLatlng()),r=this.cameraAnchorManager.updateCameraAnchor(t.pathIdx,r,e),e=r.deleteStartIdx,n=r.deletePtsCount,r=r.interpolatedPts,e=(this.updatePathLineAfterInterpolate(e,n,r),this.setMarkerClicked(t.keyframeId),t.getBezireCtrlLatlng());this.cameraKeyframeManager.updateKeyframeState(t.keyframeId,{positionBezireCtrls:e},2)}},{key:"updatePathLineAfterInterpolate",value:function(t,e,r){var n=this.cameraAnchorManager.getAnchorIdxes(),n=(this.pathLayer.pm.updateAnchorPtIdxes(n),u(this.pathLayer.getLatLngs()));n.splice.apply(n,[t,e].concat(u(r))),this.pathLayer.setLatLngs(n),this.pathLayer.pm.updateMarkers()}},{key:"getPtByRatio",value:function(t){var e=this.pathLayer.getLatLngs();if(e.length&&0<=t&&t<=1)return e[Math.round((e.length-1)*t)]}},{key:"emitMovingAlong",value:function(t,e){}},{key:"togglePathModeHandler",value:function(){var e=this,t=this.cameraAnchorManager.getAnchors(),r=this.cameraAnchorManager.lastHighlightAnchor,n="Bezire"===this.pathMode;n?(this.cameraAnchorManager.updateBezireCtrlPtsAfterToggle(),r&&r.showBezireCtrlPts()):r&&r.hideBezireCtrlPts();for(var i,o,a,s=null,u=1,c=t.length;u<c;u+=2)(s=t[u])&&(i=(a=this.cameraAnchorManager.updateCameraAnchor(s.pathIdx,s.getLatlng(),n)).interpolatedPts,o=a.deletePtsCount,a=a.deleteStartIdx,this.updatePathLineAfterInterpolate(a,o,i));t.forEach(function(t){return t.pathMode=e.pathMode}),r&&this.setMarkerClicked(r.keyframeId)}},{key:"viewAutoFit",value:function(){this.map.fitBounds(this.pathLayer.getBounds())}},{key:"show",value:function(){this.visible||(this.visible=!0,this.dragHelpLine.addTo(this.map),this.pathLayer.addTo(this.map),this.pathLayer.pm.enable({hideMiddleMarkers:!0,snapSegment:!1,preventMarkerRemoval:!0,moveVertexValidation:o.moveVertexValidation}))}},{key:"hide",value:function(){this.visible&&(this.visible=!1,this.pathLayer.removeFrom(this.map),this.dragHelpLine.removeFrom(this.map),this.cameraAnchorManager.unHighlightAnchor())}},{key:"destroy",value:function(){this.pathLayer.removeFrom(this.map),this.dragHelpLine.removeFrom(this.map),this.pathLayer=null,this.cameraAnchorManager.destroy(),this.cameraAnchorManager=null}}]),a(t,e),Object.defineProperty(t,"prototype",{writable:!1}),o}();t.exports=r},function(t,e,r){function i(t){return(i="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function p(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}()||function(t){if(t){if("string"==typeof t)return n(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(e="Object"===e&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?n(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function u(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(r);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n?(t=o(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var c=r(1),l=r(0),f=r(34),y=r(4),b=r(6),r=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}(o,l);var t,i=u(o);function o(t,e,r){var n;return function(t){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}(this),(n=i.call(this)).map=t,n.pathMode=e,n.cameraKeyframeManager=r,n.anchor2keyframeId=new Map,n.keyframeId2anchor=new Map,n.curAnchor=null,n.lastHighlightAnchor=null,n.initDragHelpMarker(),n}return a((t=o).prototype,[{key:"initDragHelpMarker",value:function(){var t=c.marker([0,0],{pmIgnore:!0}),e=c.divIcon({className:"marker-icon-selected"});t.setIcon(e),t.setZIndexOffset(1e3),t.setOpacity(0),t.addTo(this.map),this.dragHelpMarker=t}},{key:"getAnchorIdxes",value:function(){var e=[];return this.keyframeId2anchor.forEach(function(t){e.push(t.pathIdx)}),e}},{key:"getAnchors",value:function(){var e=this,r=[],t=Array.from(this.keyframeId2anchor.keys());return t.sort(function(t,e){return+t-+e}),t.forEach(function(t){r.push(e.keyframeId2anchor.get(t))}),r}},{key:"getAnchorByKeyframeId",value:function(t){return this.keyframeId2anchor.get(t)}},{key:"getAnchorByPathIdx",value:function(e){var r=null;return this.keyframeId2anchor.forEach(function(t){t.pathIdx===e&&(r=t)}),r}},{key:"getAdjacentAnchorsByKeyframeId",value:function(r){var n=null,i=null,o=-1,a=1e4;return this.anchor2keyframeId.forEach(function(t,e){t<r&&o<t&&(o=(n=e).keyframeId),r<t&&t<a&&(a=(i=e).keyframeId)}),{prevAnchor:n,nextAnchor:i}}},{key:"highlightAnchor",value:function(t,e,r){this.unHighlightAnchor();var n=null;if(e||void 0===t)e&&void 0!==r&&(n=this.getAnchorByPathIdx(r)).setLatlng(e);else{if(!(n=this.getAnchorByKeyframeId(t)))return;e=n.getLatlng()}return n&&e?(n.isHighlighted=!0,this.lastHighlightAnchor=n,this.dragHelpMarker.setOpacity(1),this.dragHelpMarker.setLatLng(e),n):console.log("Invalid parameters in highlightAnchor: ".concat(t,", ").concat(e,", ").concat(r,"!"))}},{key:"unHighlightAnchor",value:function(){var t=this.lastHighlightAnchor;t&&(t.isHighlighted=!1,this.lastHighlightAnchor=null,this.dragHelpMarker.setOpacity(0))}},{key:"updateDragHelpMarker",value:function(t){this.dragHelpMarker.setOpacity(1),this.dragHelpMarker.setLatLng(t)}},{key:"addCameraAnchor",value:function(t,e){var r=this;if(this.keyframeId2anchor.has(t))return this.keyframeId2anchor.get(t);var n=2===this.keyframeId2anchor.size,i=2<this.keyframeId2anchor.size,o=e.lng,a=e.lat,e=e.positionBezireCtrls,s=new f(this.map,t,this.pathMode,o,a),o=(s.on("ctrlMarkerDrag",function(){r.emit("ctrlMarkerDrag",s)}),s.on("ctrlMarkerDragEnd",function(){r.emit("ctrlMarkerDragEnd",s),r.lastHighlightAnchor=s}),this.curAnchor=s,this.keyframeId2anchor.set(t,s),this.anchor2keyframeId.set(s,t),this.getAdjacentAnchorsByKeyframeId(t)),a=o.prevAnchor,t=o.nextAnchor;return a&&((a.nextAnchor=s).prevAnchor=a),t&&((t.prevAnchor=s).nextAnchor=t),"Bezire"===this.pathMode&&(n?(o=a)&&(t=this.cameraKeyframeManager.getKeyframeStateById(o.keyframeId).positionBezireCtrls,o.initBezireCtrlPts(t),(n=o.prevAnchor)&&(a=this.cameraKeyframeManager.getKeyframeStateById(n.keyframeId).positionBezireCtrls,n.initBezireCtrlPts(a)),s.initBezireCtrlPts(e)):i&&s.initBezireCtrlPts(e)),s}},{key:"_getInitBezireCtrls",value:function(t){return{keyframeId:t.keyframeId,attributes:{positionBezireCtrls:t.getBezireCtrlLatlng()}}}},{key:"setPathMode",value:function(e){this.pathMode=e,this.getAnchors().forEach(function(t){return t.pathMode=e})}},{key:"updateBezireCtrlPtsAfterToggle",value:function(){var t,e,r,n=[],i=this.getAnchors(),o=i.length;if(2<o)for(var a=null,s=0;s<o;s++)(a=i[s]).hasInitBezireCtrlPts?a.updateBezireCtrlPtsNegative():(t=this.cameraKeyframeManager.getKeyframeStateById(a.keyframeId).positionBezireCtrls,0!==s&&(1===s?(a.initBezireCtrlPts(t),n.push(this._getInitBezireCtrls(a)),(e=a.prevAnchor)&&(r=this.cameraKeyframeManager.getKeyframeStateById(e.keyframeId).positionBezireCtrls,e.initBezireCtrlPts(r),n.push(this._getInitBezireCtrls(e)))):(a.initBezireCtrlPts(t),n.push(this._getInitBezireCtrls(a)))))}},{key:"interpolate4add",value:function(t,e){var r,n=t.keyframeId,i=t.prevAnchor,o=t.nextAnchor,a=[],s=0,u=-1,c=i?i.pathIdx:-1,l=o?o.pathIdx:-1,f=-1;return i&&o?(u=c+1,s=l-c-1,l=this.interpolatePathLineSegment(i,t,e),(r=this.interpolatePathLineSegment(t,o,e)).pop(),a=[].concat(p(l),p(r)),f=c+l.length,r=a.length-s,this.updateAnchorIdxFrom(n,r)):i||o?o||(f=c+(a=this.interpolatePathLineSegment(i,t,e)).length,u=c+1,s=0):(s=u=f=0,a=[t.getLatlng()]),t.pathIdx=f,{deleteStartIdx:u,deletePtsCount:s,interpolatedPts:a}}},{key:"removeCameraAnchor",value:function(t,e){var r=[],n=0,i=-1,o=this.keyframeId2anchor.get(t);if(!o||0===t)return console.log("Invalid keyframeId: ".concat(t," in removeAnchor.")),{deleteStartIdx:i,deletePtsCount:n,interpolatedPts:r};var a=o.prevAnchor,s=o.nextAnchor,u=o.pathIdx,c=a?a.pathIdx:-1,l=s?s.pathIdx:-1;if(a&&s)(a.nextAnchor=s).prevAnchor=a,i=c+1,n=l-c-1,(r=this.interpolatePathLineSegment(a,s,e)).pop();else if(s){if(!a)return}else a.nextAnchor=null,i=c+1,n=u-c;return l=r.length-n,this.updateAnchorIdxFrom(t,l),this.keyframeId2anchor.delete(t),this.anchor2keyframeId.delete(o),o===this.lastHighlightAnchor&&this.unHighlightAnchor(),o.destroy(),{deleteStartIdx:i,deletePtsCount:n,interpolatedPts:r}}},{key:"updateCameraAnchor",value:function(t,e){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=this.getAnchorByPathIdx(t);if(!n)return console.log("There is no anchor for the idx: ".concat(t,"!"));n.setLatlng(e);var i=(this.curAnchor=n).keyframeId,o=n.prevAnchor,a=n.nextAnchor,s=o?o.pathIdx:-1,u=a?a.pathIdx:-1,c=[],l=0,f=-1,h=0;return o&&(f=s+1,l=t-s,h=(c=this.interpolatePathLineSegment(o,n,r)).length-l),n.pathIdx=n.pathIdx+h,a&&(f=-1===f?t+1:f,l+=u-t,h=(c=[].concat(p(c),p(this.interpolatePathLineSegment(n,a,r)))).length-l),this.updateAnchorIdxFrom(i,h),{interpolatedPts:c,deletePtsCount:l,deleteStartIdx:f,anchorIdxDelta:h}}},{key:"updateAnchorIdxFrom",value:function(r,n){this.keyframeId2anchor.forEach(function(t,e){r<e&&(t.pathIdx=t.pathIdx+n)})}},{key:"interpolatePathLineSegment",value:function(t,e){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=[],i=(i=3<arguments.length?arguments[3]:void 0)||Math.abs(e.keyframeId-t.keyframeId);if(r){for(var o,r=t.getPixelCoord(),a=t.nextCtrlMarker.getPixelCoord(),s=e.prevCtrlMarker.getPixelCoord(),u=e.getPixelCoord(),r=new b(r,a,s,u),c=(i=i||Math.round(8*Math.random())+16)+1,l=r.getLUT(c),f=1;f<c-1;f++)o=y.pixelCoord2latlng(this.map,l[f]),n.push(o);n.push(e.getLatlng())}else for(var h=1;h<i;h++){var p=t.lat+(e.lat-t.lat)*h/(i-1),d=t.lng+(e.lng-t.lng)*h/(i-1);n.push({lat:p,lng:d})}return n}},{key:"destroy",value:function(){this.anchor2keyframeId.clear(),this.keyframeId2anchor.clear(),this.curAnchor=null,this.lastHighlightAnchor=null,this.dragHelpMarker.removeFrom(this.map),this.map=null}}]),Object.defineProperty(t,"prototype",{writable:!1}),o}();t.exports=r},function(t,e,r){function i(t){return(i="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function u(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(r);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return c(t)}(this,n?(t=o(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=r(1),a=r(2),f=r(4),h=r(35),p=a.THREE,d=new p.Vector2,y=new p.Vector2,b=new p.Vector2,m=new p.Vector2,v=new p.Vector2,g=0,_=new p.Vector2,k=new p.Vector2,r=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}(a,f);var t,o=u(a);function a(t,e,r,n,i){return function(t){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this),(t=o.call(this,t)).setLatlng(i,n),t._pathIdx=-1,t._keyframeId=e,t.pathMode=r,t.prevAnchor=null,t.nextAnchor=null,t.prevCtrlMarker=null,t.nextCtrlMarker=null,t.bezireCtrlLine=null,t.initBezireCtrlMarkers(),t.initBezireCtrlLine(),t.ctrlMarkerDragHandler=t.ctrlMarkerDragHandler.bind(c(t)),t.translateVec=new p.Vector2,t.translateLatlng={lat:0,lng:0},t._hasInitBezireCtrlPts=!1,t._isHighlighted=!1,t.savedLatlng=null,t}return n((t=a).prototype,[{key:"isHighlighted",get:function(){return this._isHighlighted},set:function(t){(this._isHighlighted=t)?"Bezire"===this.pathMode&&this.showBezireCtrlPts():this.hideBezireCtrlPts()}},{key:"hasInitBezireCtrlPts",get:function(){return this._hasInitBezireCtrlPts}},{key:"pathIdx",get:function(){return this._pathIdx},set:function(t){this._pathIdx=t}},{key:"keyframeId",get:function(){return this._keyframeId},set:function(t){this._keyframeId=t}},{key:"initBezireCtrlMarkers",value:function(){var t=this,e=l.divIcon({className:"marker-icon-bezireCtrl"}),e=(this.prevCtrlMarker=new h(this.map),this.prevCtrlMarker.setIcon(e),this.nextCtrlMarker=new h(this.map),l.divIcon({className:"marker-icon-bezireCtrl-next"})),e=(this.nextCtrlMarker.setIcon(e),this.prevCtrlMarker.on("drag",function(){t.ctrlMarkerDragHandler(t.prevCtrlMarker),t.emit("ctrlMarkerDrag")}),this.prevCtrlMarker.on("dragEnd",function(){t.ctrlMarkerDragHandler(t.prevCtrlMarker),t.emit("ctrlMarkerDragEnd")}),this.nextCtrlMarker.on("drag",function(){t.ctrlMarkerDragHandler(t.nextCtrlMarker),t.emit("ctrlMarkerDrag")}),this.nextCtrlMarker.on("dragEnd",function(){t.ctrlMarkerDragHandler(t.nextCtrlMarker),t.emit("ctrlMarkerDragEnd")}),this.getLatlng());this.prevCtrlMarker.setLatlng(e),this.nextCtrlMarker.setLatlng(e)}},{key:"initBezireCtrlLine",value:function(){var t=l.polyline([],{className:"bezire-ctrl-line",pmIgnore:!0});(this.bezireCtrlLine=t).addTo(this.map)}},{key:"ctrlMarkerDragHandler",value:function(t){this.updateBezireCtrlPtsByDrag(t),this.updateBezireCtrlLine()}},{key:"updateBezireCtrlLine",value:function(){var t=this.prevCtrlMarker.getLatlng(),e=this.nextCtrlMarker.getLatlng(),r=this.getLatlng();this.bezireCtrlLine.setLatLngs([t,r,e])}},{key:"showBezireCtrlPts",value:function(){this._hasInitBezireCtrlPts&&(this.prevCtrlMarker.show(),this.nextCtrlMarker.show(),this.updateBezireCtrlLine())}},{key:"hideBezireCtrlPts",value:function(){this._hasInitBezireCtrlPts&&(this.prevCtrlMarker.hide(),this.nextCtrlMarker.hide(),this.bezireCtrlLine.setLatLngs([]))}},{key:"initBezireCtrlPts",value:function(){var t,e,r,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=!1;return n.prev||n.next?(i=!0,e={lng:(t=this.getLatlng()).lng,lat:t.lat},r=n.prev,n=void 0===(n=n.next)?e:n,this.prevCtrlMarker.setLatlng([(e=void 0===r?e:r).lat,e.lng]),this.nextCtrlMarker.setLatlng([n.lat,n.lng]),this.translateLatlng={lat:t.lat-e.lat,lng:t.lng-e.lng}):(i=!1,this.prevAnchor&&this.nextAnchor?(r=this.prevAnchor.getPixelCoord(),d.set(r.x,r.y),n=this.nextAnchor.getPixelCoord(),y.set(n.x,n.y),t=this.getPixelCoord(),b.set(t.x,t.y),m=b.clone(),v=y.sub(d),g=v.length(),_=v.normalize(),k=_.multiplyScalar(.3*g),this.translateVec.set(k.x,k.y),e=b.add(k),r=m.add(k.negate()),this.prevCtrlMarker.setPixelCoord(r),this.nextCtrlMarker.setPixelCoord(e)):this.prevAnchor?(n=this.prevAnchor.nextCtrlMarker.getPixelCoord(),d.set(n.x,n.y),t=this.getPixelCoord(),b.set(t.x,t.y),m=b.clone(),v=m.sub(d),m=b.clone(),g=v.length(),_=v.normalize(),k=_.multiplyScalar(.3*g),this.translateVec.set(k.x,k.y),r=b.add(k),e=m.add(k.negate()),this.prevCtrlMarker.setPixelCoord(e),this.nextCtrlMarker.setPixelCoord(r)):this.nextAnchor&&(n=this.nextAnchor.prevCtrlMarker.getPixelCoord(),y.set(n.x,n.y),t=this.getPixelCoord(),b.set(t.x,t.y),m=b.clone(),v=y.sub(b),g=v.length(),_=v.normalize(),k=_.multiplyScalar(.3*g),this.translateVec.set(k.x,k.y),e=b.add(k),this.nextCtrlMarker.setPixelCoord(e),this.prevCtrlMarker.setPixelCoord(m)),r=this.getLatlng(),n=this.nextCtrlMarker.getLatlng(),this.translateLatlng={lat:n.lat-r.lat,lng:n.lng-r.lng}),this._hasInitBezireCtrlPts=!0,i}},{key:"updateBezireCtrlPtsByDrag",value:function(t){t===this.prevCtrlMarker?(e=this.getPixelCoord(),b.set(e.x,e.y),r=t.getPixelCoord(),k.set(e.x-r.x,e.y-r.y),this.translateVec.set(k.x,k.y),e=b.add(k),this.nextCtrlMarker.setPixelCoord(e)):t===this.nextCtrlMarker&&(r=this.getPixelCoord(),b.set(r.x,r.y),e=t.getPixelCoord(),k.set(e.x-r.x,e.y-r.y),this.translateVec.set(k.x,k.y),t=b.add(k.negate()),this.prevCtrlMarker.setPixelCoord(t));var e=this.getLatlng(),r=this.nextCtrlMarker.getLatlng();this.translateLatlng={lat:r.lat-e.lat,lng:r.lng-e.lng}}},{key:"updateNotByDrag",value:function(t){this.setLatlng(t),this.updateBezireCtrlPtsNegative(),"Bezire"===this.pathMode?this.showBezireCtrlPts():this.hideBezireCtrlPts()}},{key:"updateBezireCtrlPtsNegative",value:function(){var t,e;this._hasInitBezireCtrlPts&&(t=this.translateLatlng,e=this.getLatlng(),this.prevCtrlMarker.setLatlng({lat:e.lat-t.lat,lng:e.lng-t.lng}),this.nextCtrlMarker.setLatlng({lat:e.lat+t.lat,lng:e.lng+t.lng}))}},{key:"getBezireCtrlLatlng",value:function(){var t=this.prevCtrlMarker,e=this.nextCtrlMarker,t=t.getLatlng(),e=e.getLatlng();return{prev:{lng:t.lng,lat:t.lat},next:{lng:e.lng,lat:e.lat}}}},{key:"destroy",value:function(){this.prevAnchor=null,this.nextAnchor=null,this.prevCtrlMarker.off("drag"),this.prevCtrlMarker.off("dragEnd"),this.nextCtrlMarker.off("drag"),this.nextCtrlMarker.off("dragEnd"),this.prevCtrlMarker.destroy(),this.nextCtrlMarker.destroy(),this.bezireCtrlLine.removeFrom(this.map)}}]),Object.defineProperty(t,"prototype",{writable:!1}),a}();t.exports=r},function(t,e,r){function i(t){return(i="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function s(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=l(r);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return u(t)}(this,n?(t=l(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(n)return(n=Object.getOwnPropertyDescriptor(n,e)).get?n.get.call(arguments.length<3?t:r):n.value}).apply(this,arguments)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var f=r(1),o=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}(o,r(4));var t,i=s(o);function o(t){var e,r,n;return function(t){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}(this),(n=i.call(this,t))._marker=f.marker(n.latlng).addTo(t),n._marker.setZIndexOffset(-100),n.hide(),n._marker.on("pm:drag",function(t){c((e=u(n),l(o.prototype)),"setLatlng",e).call(e,t.latlng),n.emit("drag")}),n._marker.on("pm:dragend",function(t){t.target&&t.target._latlng&&(c((r=u(n),l(o.prototype)),"setLatlng",r).call(r,t.target._latlng),n.emit("dragEnd"))}),n}return n((t=o).prototype,[{key:"setLatlng",value:function(t){c(l(o.prototype),"setLatlng",this).call(this,t),this._marker.setLatLng(t)}},{key:"setPixelCoord",value:function(t){c(l(o.prototype),"setPixelCoord",this).call(this,t),this._marker.setLatLng(this.latlng)}},{key:"show",value:function(){this._marker.setOpacity(1),this._marker.setZIndexOffset(100),this._marker.pm.enable({snappable:!1})}},{key:"hide",value:function(){this._marker.setOpacity(0),this._marker.setZIndexOffset(-100),this._marker.pm.disable()}},{key:"setIcon",value:function(t){this._marker.setIcon(t)}},{key:"destroy",value:function(){this._marker.removeFrom(this.map),this._marker=null,this.map=null,this.latlng=null,this.pixelCoord=null}}]),Object.defineProperty(t,"prototype",{writable:!1}),o}();t.exports=o},function(t,e,r){function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=r(7),r=function(){function n(t){!function(t){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this),this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)}var t=n;return o(t.prototype,[{key:"valueOf",value:function(){return this.toString()}},{key:"toString",value:function(){return"[".concat(this.curves.map(function(t){return a.pointsToString(t.points)}).join(", "),"]")}},{key:"addCurve",value:function(t){this.curves.push(t),this._3d=this._3d||t._3d}},{key:"length",value:function(){return this.curves.map(function(t){return t.length()}).reduce(function(t,e){return t+e})}},{key:"curve",value:function(t){return this.curves[t]}},{key:"bbox",value:function(){for(var t=this.curves,e=t[0].bbox(),r=1;r<t.length;r++)a.expandbox(e,t[r].bbox());return e}},{key:"offset",value:function(e){var r=[];return this.curves.forEach(function(t){r.push.apply(r,function(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}()||function(t){if(t){if("string"==typeof t)return i(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(e="Object"===e&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?i(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t.offset(e)))}),new n(r)}}]),Object.defineProperty(t,"prototype",{writable:!1}),n}();t.exports=r},function(t,e,r){function i(t){return(i="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function m(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}()||function(t){if(t){if("string"==typeof t)return n(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(e="Object"===e&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?n(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function s(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=u(r);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n?(t=u(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var c=r(0),v=r(38),r=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}(n,c);var t,r=s(n);function n(t){var e;return function(t){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this),(e=r.call(this)).data=[],e.data2=[],e.lastCursor4explore=-1,e.anchorStrokeColor="#ffffff",e.anchorFillColor="#ffffff",e.activeAnchorFillColor="#2681ff",e.cameraKeyframeManager=t,e.cameraMarkerLastLocation={cursor:0,altitude:0},e.init(),e}return o((t=n).prototype,[{key:"registerEvents",value:function(){var n=this,t=this.cameraKeyframeManager;t.on("setExploreAltitude",function(t){var e,r;n._isCurAltitudeEditor()&&(e=t.altitude,r=t.emitOrigin,t=t.cursor,1!==r&&n.updateExploreFromOtherPanel({cursor:t,altitude:e,emitOrigin:r}))}),t.on("setCurrentKeyframeId",function(t){var e;n._isCurAltitudeEditor()&&(e=t.keyframeId,1!==t.emitOrigin&&(n.altitudePanelUtils.curKeyframeId=e,n.resetHelpLine(),t=n.altitudePanelUtils.focus,n.updateCameraMarkerPosition2(t,e)))}),t.on("moveToNonKeyframe",function(){n.unHighlightAnchor()})}},{key:"init",value:function(){var r=this;this.registerEvents(),this.cameraKeyframeManager.keyframesState&&(this.cameraKeyframeManager.keyframesState.forEach(function(t,e){t=t.altitude;r.data.push([e,t])}),this.data.sort(function(t,e){return t[0]-e[0]}),this.data2=this.data.map(function(t){return[t[0],t[1]]}))}},{key:"_isCurAltitudeEditor",value:function(){return this===this.altitudePanelUtils.curAltitudeEditor}},{key:"_getAltitudeMinMax",value:function(t,e){e=(e?[].concat(m(t),m(e)):t).map(function(t){return t[1]});return e.sort(function(t,e){return t-e}),[e[0],e[e.length-1]]}},{key:"_updateAltitudeByKeyframeId",value:function(t,e,r){for(var n=0,i=t.length;n<i;n++)t[n][0]===e&&(t[n][1]=r)}},{key:"setPanelUtils",value:function(t){var n=this;(t.curAltitudeEditor=this).altitudePanelUtils||((this.altitudePanelUtils=t).on("dragging",function(t){n.circleDraggingHandler(t)}),t.on("dragEnd",function(t){n.circleDragEndHandler(t)}),t.on("clicked",function(t){var e,r;n._isCurAltitudeEditor()&&(e=t.keyframeId,r=t.anchor,t=t.altitude,n._saveCameraMarkerPos(e,t),n.resetHelpLine(),n.highlightAnchor(r),n.cameraKeyframeManager.currentKeyframeId={keyframeId:e,emitOrigin:1})}))}},{key:"_clipAltitude",value:function(t){var e=this.altitudePanelUtils,r=e.altitudeMin,e=e.altitudeMax;return r<=t&&t<=e?t:t<r?r:e}},{key:"_hideHelperLine",value:function(){this.altitudePanelUtils.focus.select(".helpLine").attr("opacity",0)}},{key:"circleDraggingHandler",value:function(t){var e,r,n,i,o,a,s,u,c,l,f,h,p,d,y,b;this._isCurAltitudeEditor()&&(e=t.altitudeLimit,r=t.keyframeId,n=t.eventY,i=t.altitude,t=t.needUpdateYaxis,o=this.altitudePanelUtils,b=this.data,a=this.data2,s=o.altitudeLimitMax,u=o.altitudeLimitMin,c=o.focus,l=o.line,f=o.helpLine,h=o.yScale,p=o.yAxis,d=m(h.domain()),(y=(b=this._getAltitudeMinMax(b,a))[0])===(b=b[1])&&(i+=1,t=!0),d=v.extent([].concat(m(d),[y,b,e,i])),t||(d[1]<.5*s&&(s=1.2*d[1],d[1]=s,o.altitudeLimitMax=s,t=!0),d[0]>2*u&&(u=.8*d[0],d[0]=u,o.altitudeLimitMin=u,t=!0)),t&&(h.domain(d),i=h.invert(n),i=this._clipAltitude(i),p.scale(h),this.updateYaxis()),this._updateAltitudeByKeyframeId(a,r,i),c.selectAll("circle").attr("cy",function(t){return t[0]===r?h(i):h(t[1])}),c.select(".trueLine").attr("d",l),c.select(".helpLine").datum(a).attr("opacity",1).attr("d",f),this.cameraKeyframeManager.emitUpdatingAltitude({keyframeId:r,altitude:i,emitOrigin:1}))}},{key:"circleDragEndHandler",value:function(t){var e,r,n,i,o,a,s,u,c,l,f,h,p;this._isCurAltitudeEditor()&&(e=t.keyframeId,t=t.altitude,r=this.data,n=this.data2,i=this.altitudePanelUtils,o=i.yScale,a=i.yAxis,s=i.focus,u=i.line,c=i.helpLine,l=i.altitudeMin,f=i.altitudeMax,this._updateAltitudeByKeyframeId(n,e,t),this._updateAltitudeByKeyframeId(r,e,t),p=(h=this._getAltitudeMinMax(r))[1]-h[0],h[0]-=.2*p,h[1]+=.2*p,h[0]=Math.max(h[0],l),h[1]=Math.min(h[1],f),i.altitudeLimitMin=h[0],i.altitudeLimitMax=h[1],o.domain(h),a.scale(o),this.updateYaxis(),s.select(".trueLine").datum(r).attr("d",u),s.select(".helpLine").datum(n).attr("opacity",1).attr("d",c),s.selectAll("circle").attr("cy",function(t){return o(t[1])}),this._saveCameraMarkerPos(e,t),this.cameraKeyframeManager.updateKeyframeState(e,{altitude:t},1))}},{key:"updateCameraMarkerPosition",value:function(t,e,r,n){r=r||this.altitudePanelUtils.xScale,n=n||this.altitudePanelUtils.yScale,this.altitudePanelUtils.cameraMarkerHolder.attr("transform","translate(".concat(r(t),", ").concat(n(e),") scale(1.0)")),this._reHighlightAnchor(),this._saveCameraMarkerPos(t,e)}},{key:"updateCameraMarkerPosition2",value:function(t,e){var r,n,t=t.selectAll("circle").select(function(t){return t[0]===e?this:null});t&&(n=t.attr("cx"),r=t.attr("cy"),this.altitudePanelUtils.cameraMarkerHolder.attr("transform","translate(".concat(n,", ").concat(r,") scale(1.0)")),this.highlightAnchor(t),n=this.cameraKeyframeManager.getKeyframeStateById(e).altitude,this._saveCameraMarkerPos(e,n))}},{key:"_saveCameraMarkerPos",value:function(t,e){var r=this.cameraMarkerLastLocation;r.cursor=t,r.altitude=e}},{key:"updateCameraMarkerPositionAfterPanelResize",value:function(){var t=this.cameraMarkerLastLocation,e=t.cursor,t=t.altitude;this.updateCameraMarkerPosition(e,t)}},{key:"updateExploreFromOtherPanel",value:function(t){var e=this;if(this._isCurAltitudeEditor()){for(var r=t.cursor,n=t.altitude,i=!1,o=0,a=this.data2.length;o<a;o++)if(this.data2[o][0]===r){this.data2[o][1]=n,i=!0;break}var s,t=!0;i?this.lastCursor4explore=-1:(s=Math.max.apply(Math,m(this.data.map(function(t){return t[0]}))),this.afterTailKeyframe=s<r,this.afterTailKeyframe&&this.lastCursor4explore<=s&&(this.data2=this.data.map(function(t){return m(t)})),this.data2=this.data2.filter(function(t){return t[0]!==e.lastCursor4explore}),this.data2.includes(r)?t=!1:(this.data2.push([r,n]),this.data2.sort(function(t,e){return t[0]-e[0]})),this.lastCursor4explore=r),this.updateForExplore(t),this.updateCameraMarkerPosition(r,n)}}},{key:"updateNotDrag",value:function(t){if(this._isCurAltitudeEditor()){for(var e=t.keyframeId,r=t.altitude,n=0,i=this.data.length;n<i;n++)if(this.data[n][0]===e){this.data[n][1]=r;break}this.draw();t=this.altitudePanelUtils.focus;this.updateCameraMarkerPosition2(t,e)}}},{key:"_reHighlightAnchor",value:function(){this.lastActiveAnchor&&this.lastActiveAnchor.style("fill",this.activeAnchorFillColor)}},{key:"highlightAnchor",value:function(t){this.lastActiveAnchor&&this.lastActiveAnchor.style("fill",this.anchorFillColor),t&&t.style("fill",this.activeAnchorFillColor),this.lastActiveAnchor=t}},{key:"unHighlightAnchor",value:function(){this.lastActiveAnchor&&this.lastActiveAnchor.style("fill",this.anchorFillColor),this.lastActiveAnchor=null}},{key:"addAnchor",value:function(t,e){this.data.push([t,e]),this.data.sort(function(t,e){return t[0]-e[0]}),this.checkDataDiff(),this.resetHelpLine(),this.draw(),this.afterTailKeyframe=!1,this.lastCursor4explore=-1}},{key:"removeAnchor",value:function(t){for(var e=[],r=0,n=0,i=this.data.length;n<i;n++)this.data[n][0]!==t?e.push(this.data[n]):r=this.data[n][1];this.data=e,this.data.sort(function(t,e){return t[0]-e[0]}),this.checkDataDiff(),this.resetHelpLine(),this.draw(),Math.max.apply(Math,m(this.data.map(function(t){return t[0]})))<t?this.updateExploreFromOtherPanel({cursor:t,altitude:r,emitOrigin:1}):this.setCameraMarkerToCurrentFrameNum(t)}},{key:"checkDataDiff",value:function(){var e=this.data.map(function(t){return t[1]}).sort(function(t,e){return t-e});e[e.length-1]-e[0]<.1&&(this.data=this.data.map(function(t){return[t[0],e[0]]}))}},{key:"draw",value:function(){var t=this.data,e=this.data2,r=this.altitudePanelUtils,n=r.xScale,i=r.yScale,o=r.xAxis,a=r.yAxis,s=r.line,u=r.focus,c=r.circlesHolder,l=r.drag,f=r.click,h=r.helpLine,e=(n.domain(v.extent(t,function(t){return t[0]})),v.extent([].concat(m(t),m(e)),function(t){return t[1]})),p=e[1]-e[0],p=(e[0]-=.2*p,e[1]+=.2*p,r.altitudeLimitMin=e[0],r.altitudeLimitMax=e[1],i.domain(e),o.scale(n),a.scale(i),o.tickValues(t.map(function(t){return t[0]})),u.select(".axis.axis--x").call(o),this.updateYaxis(),u.select(".trueLine").datum(t).attr("d",s),c.selectAll("circle").data(t).attr("r",5).attr("cx",function(t){return n(t[0])}).attr("cy",function(t){return i(t[1])}).style("cursor","pointer").style("stroke",this.anchorStrokeColor).style("fill",this.anchorFillColor));p.enter().append("circle").attr("r",5).attr("cx",function(t){return n(t[0])}).attr("cy",function(t){return i(t[1])}).style("cursor","pointer").style("stroke",this.anchorStrokeColor).style("fill",this.anchorFillColor).call(l).on("click",f),p.exit().remove(),+u.select(".helpLine").attr("opacity")&&(h.x(function(t){return n(t[0])}).y(function(t){return i(t[1])}),u.select(".helpLine").attr("opacity",1).attr("d",h)),this._reHighlightAnchor()}},{key:"updateForExplore",value:function(t){var e=this.data,r=this.data2,n=this.altitudePanelUtils,i=n.xScale,o=n.yScale,a=n.xAxis,s=n.yAxis,u=n.circlesHolder,c=n.line,l=n.helpLine,n=n.focus,f=[].concat(m(e),m(r));t&&(i.domain(v.extent(f,function(t){return t[0]})),a.scale(i),this.updateXaxis(r)),o.domain(v.extent(f,function(t){return t[1]})),s.scale(o),this.updateYaxis(),n.select(".trueLine").datum(e).attr("d",c),u.selectAll("circle").data(e).attr("r",5).attr("cx",function(t){return i(t[0])}).attr("cy",function(t){return o(t[1])}).style("cursor","pointer").style("stroke",this.anchorStrokeColor).style("fill",this.anchorFillColor),n.select(".helpLine").datum(r).attr("opacity",1).attr("d",l)}},{key:"updateXaxis",value:function(t){var e=this.altitudePanelUtils,r=e.xAxis,e=e.focus;r.tickValues(t.map(function(t){return t[0]})),e.select(".axis.axis--x").call(r)}},{key:"updateYaxis",value:function(){var t=this.altitudePanelUtils,e=t.focus,t=t.yAxis;e.select(".axis.axis--y").call(t).call(function(t){return t.selectAll(".tick text").attr("x",-8).attr("text-anchor","end")})}},{key:"resetHelpLine",value:function(){this.altitudePanelUtils.focus.select(".helpLine").datum([[0,0]]).attr("opacity",0),this.data2=this.data.map(function(t){return[t[0],t[1]]}),this.updateXaxis(this.data)}},{key:"setCameraMarkerToCurrentFrameNum",value:function(t){for(var e,r,n,i=null,o=0,a=this.data.length;o<a;o++){if((n=this.data[o])[0]===t){i=n[1];break}if(!(n[0]<t)){r=n[0];break}e=n[0]}null===i&&(i=this.getPtByRatio((t-e)/(r-e),t,e,r));var s=this.altitudePanelUtils,u=s.xScale,s=s.yScale;this.updateCameraMarkerPosition(t,i,u,s)}},{key:"getAltitudeByRatio",value:function(t,e,r,n){var i;if(r===n){for(var o=0,a=this.data.length;o<a;o++)if(this.data[o][0]===r){i=this.data[o][1];break}}else for(var s,u,c=0,l=this.data.length;c<l;c++)if(s=this.data[c],u=this.data[c+1],s[0]===r&&u&&u[0]===n){i=s[1]*(1-t)+u[1]*t;break}if(!i){console.log("Error in cameraAltitudeEditor.getPtByRatio:",e);for(var f=[-1e3,0],h=0,p=this.data.length;h<p;h++)Math.abs(this.data[h][0]-e)<Math.abs(f[0]-e)&&(f=this.data[h]);i=f[1]}return i}},{key:"getPtByRatio",value:function(t,e,r,n){return this.getAltitudeByRatio(t,e,r,n)}},{key:"emitMovingAlong",value:function(t,e,r){}}]),Object.defineProperty(t,"prototype",{writable:!1}),n}();t.exports=r},function(t,e){t.exports=a},function(t,e,r){function n(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)),n}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){!function(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=r(40),r=function(){function n(t,e){!function(t){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this);var r=t.viewer;this.cityproCore=t,this.viewer=r,this.options=e,this.keyframeAttrs={enableBokeh:!1,bokehRadius:1,aperture:10,focalDistance:10,focalSize:10},this.tempOpts=e,this.onSceneChanged=this.onSceneChanged.bind(this),this.viewer.engine.on("onscenechangeend",this.onSceneChanged),this.init()}var t=n;return o(t.prototype,[{key:"init",value:function(){this.postprocessing=new a(null,this.options),this.postprocessing.addTo(this.cityproCore);var t=this.options;t.postprocessing.bokeh||(t.postprocessing.bokeh={})}},{key:"onSceneChanged",value:function(){this.updateOptions(this.tempOpts)}},{key:"setEnvMap",value:function(t){this.postprocessing.setEnvMap(t)}},{key:"updateOptions",value:function(t){t.postprocessing.bokeh=i({enabled:this.keyframeAttrs.enableBokeh},this.keyframeAttrs),this.options=t,this.postprocessing&&this.postprocessing.updateOptions(this.options)}},{key:"updateBokehRadius",value:function(t){var e=this.options,r=this.keyframeAttrs;r.bokehRadius!==t&&(r.bokehRadius=t,this.updateOptions(e))}},{key:"updateBokehAperture",value:function(t){var e=this.options,r=this.keyframeAttrs;r.aperture!==t&&(r.aperture=t,this.updateOptions(e))}},{key:"updateBokehFocalDistance",value:function(t){var e=this.options,r=this.keyframeAttrs;r.focalDistance!==t&&(r.focalDistance=t,this.updateOptions(e))}},{key:"updateBokehFocalSize",value:function(t){var e=this.options,r=this.keyframeAttrs;r.focalSize!==t&&(r.focalSize=t,this.updateOptions(e))}},{key:"updateBokeh",value:function(t){var e=this.options;this.keyframeAttrs=i(i({},this.keyframeAttrs),t),this.updateOptions(e)}},{key:"switchBokeh",value:function(t){var e=this.options,r=this.keyframeAttrs;r.enableBokeh!==t&&(r.enableBokeh=t,this.updateOptions(e))}},{key:"destroy",value:function(){this.postprocessing&&this.postprocessing.destroy()}}]),Object.defineProperty(t,"prototype",{writable:!1}),n}();t.exports=r},function(t,e,r){function i(t){return(i="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function s(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=u(r);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n?(t=u(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var c=r(0),l=r(41),r=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}(i,c);var t,n=s(i);function i(t,e){var r;return function(t){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this),(r=n.call(this)).options=e,r.comId="",r.type="PostProcessing",r.visible=!0,r}return o((t=i).prototype,[{key:"setEnvMap",value:function(t){this.layer&&(this.layer.envMapIntensity=t.properties,this.layer.envMap=t.value)}},{key:"addTo",value:function(t,e){return this.cityproCore=t,this.comId=e||"postprocessingCom",this.initLayer()}},{key:"initLayer",value:function(){var t=l(this.cityproCore),t=(this.layer=new t(this.options),this.cityproCore.viewer.addLayer(this.comId,this.layer));return this.visible?this.layer.show():this.layer.hide(),t}},{key:"setData",value:function(){}},{key:"show",value:function(){this.visible=!0,this.layer&&this.layer.show()}},{key:"hide",value:function(){this.visible=!1,this.layer&&this.layer.hide()}},{key:"updateOptions",value:function(t){this.layer&&this.layer.updateOptions(t)}},{key:"destroy",value:function(){this.layer&&(this.layer.destroy&&this.layer.destroy(),this.layer=null)}}]),Object.defineProperty(t,"prototype",{writable:!1}),i}();t.exports=r},function(t,e){function i(t){return(i="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(n)return(n=Object.getOwnPropertyDescriptor(n,e)).get?n.get.call(arguments.length<3?t:r):n.value}).apply(this,arguments)}function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function u(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=c(r);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n?(t=c(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t.exports=function(t){var e=t.VG,i=t.Utils;return t.THREE,function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}(n,e.Layer);var t,r=u(n);function n(t){var e;return function(t){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this),(e=r.call(this)).options=i.mergeOptions({},t||{}),e.classNameAlias="PostprocessingLayer",e}return o((t=n).prototype,[{key:"composer",get:function(){if(this.renderPipeline)return this.renderPipeline._pipelineCore}},{key:"envMap",set:function(t){this.renderPipeline&&(this.renderPipeline._pipelineCore.pipeline.envMap=t)}},{key:"envMapIntensity",set:function(t){this.renderPipeline&&(this.renderPipeline._pipelineCore.pipeline.envMapIntensity=t)}},{key:"addTo",value:function(t){return a(c(n.prototype),"addTo",this).call(this,t),this.initLayer()}},{key:"initLayer",value:function(){this.viewer&&(this.renderPipeline=new e.RenderPipeline(this.options.postprocessing),this.viewer.addRenderPipeline(this.renderPipeline),this.viewer.csm&&this.viewer.csm.setupMaterial(this.renderPipeline._pipelineCore.pipeline.lightingPass.deferredLighting))}},{key:"show",value:function(){this.renderPipeline&&(this.renderPipeline.enabled=!0)}},{key:"hide",value:function(){this.renderPipeline&&(this.renderPipeline.enabled=!1)}},{key:"setData",value:function(){}},{key:"updateOptions",value:function(t){this.options=i.mergeOptions(this.options,t||{}),this.renderPipeline&&this.renderPipeline.updateOptions(this.options.postprocessing)}},{key:"destroy",value:function(){this.hide()}}]),Object.defineProperty(t,"prototype",{writable:!1}),n}()}},function(t,e,r){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=r(43),a=null,s={properties:1,value:null,url:null},r=function(){function n(t,e){!function(t){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this);var r=t.subcoms,e=(this.options=e,this.subcoms=r,this._sceneId="scene1",a=t.Utils,this.options.assets);this.assets=new o(t,e),this._postprocessingNode=null,this.subcomsNotSetEnvMap=[]}var t=n;return i(t.prototype,[{key:"sceneId",set:function(t){this._sceneId=t}},{key:"postprocessingNode",set:function(t){this._postprocessingNode=t}},{key:"getSubComsInCurrentScene",value:function(){var r=this,n=[];return this.subcoms.forEach(function(t){var e=t.layer.options.sceneId;e&&Array.isArray(e)&&e.includes(r._sceneId)&&n.push(t)}),n}},{key:"loadAssets",value:function(){var t=this;this.assets.load().then(function(){t.setGlobalEnvMap(!0)})}},{key:"getCurrentSceneEnvMap",value:function(){var t=this.options,e=t.globalEnvMap,t=t.assets;return t&&Array.isArray(t)&&-1!==t.findIndex(function(t){return t.key===e})&&this.assets.getMap(e)?this.assets.getMap(e):s}},{key:"setGlobalEnvMap",value:function(t){var e=this.getCurrentSceneEnvMap(),r=this.subcoms;void 0!==(r=t?r:this.getSubComsInCurrentScene())&&r.forEach(function(t){t&&t.setEnvMap&&t.setEnvMap.call(t,e)}),this._postprocessingNode&&this._postprocessingNode.setEnvMap(e)}},{key:"applySubCom",value:function(t){var e=t.options.sceneId;e&&Array.isArray(e)&&e.includes(this._sceneId)?(e=this.getCurrentSceneEnvMap(),t&&t.setEnvMap&&t.setEnvMap.call(t,e)):t&&t.setEnvMap&&this.subcomsNotSetEnvMap.push(t)}},{key:"updateOptions",value:function(t){var r=this,e=a.deepClone(this.options);this.options=a.mergeOptions(this.options,t||{}),a.easyDiff(e.globalEnvMap,t.globalEnvMap)||this.setGlobalEnvMap(),a.deepDiff(e.assets,t.assets)||this.assets.updateOptions(t.assets).then(function(){r.setGlobalEnvMap()}),this.subcomsNotSetEnvMap.forEach(function(t){var e=r.getCurrentSceneEnvMap();t&&t.setEnvMap&&t.setEnvMap.call(t,e)}),this.subcomsNotSetEnvMap.length=0}},{key:"destroy",value:function(){this.assets&&this.assets.destroy()}}]),Object.defineProperty(t,"prototype",{writable:!1}),n}();t.exports=r},function(t,e,r){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e){if(t){if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(r="Object"===r&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var c=null,a=null,s=r(2),u=s.Cache,l=s.THREE,f=l.PMREMGenerator,r=function(){function r(t,e){!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);t=t.viewer,this.viewer=t,this.options=e,c=new s.RGBELoader,a=new l.TextureLoader,this.assetsMap=new Map,this.cache=new u,this.key2texture=new Map,this.key2url=new Map,e=new f(t.engine.renderer);e.compileEquirectangularShader(),this.pmremGenerator=e}var t=r;return n(t.prototype,[{key:"getMap",value:function(t){return this.assetsMap.get(t)}},{key:"load",value:function(){var e=this,r=[];return this.assetsMap.clear(),Array.isArray(this.options)&&this.options.forEach(function(t){t=e.fetch(t);r&&r.push(t)}),this.feedBack(r)}},{key:"fetch",value:function(t){var e=t.url,r=t.key,n=t.properties,t=t.rotate,i=void 0===t?0:t;switch(function(t){var e;if(void 0!==t)return e=null,t=(e=Array.isArray(t)?function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,o=[],a=!0,s=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(o.push(n.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}}(t,e)||o(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,1)[0]:t).lastIndexOf("."),e.substr(t+1).toLowerCase()}(e)){case"hdr":return this.fetchEnvMap(r,n,e,i);case"png":case"jpg":case"jpeg":return this.fetchTexture(r,n,e)}}},{key:"feedBack",value:function(t){var o=this;return Promise.all(t).then(function(t){return t.forEach(function(t){var e=t.key,r=t.properties,n=t.url,t=t.rotate,t=void 0===t?0:t,i=o.cache.get(n);o.assetsMap.has(e)&&o.assetsMap.delete(e),o.assetsMap.set(e,{properties:r,value:i,url:n,rotate:t})}),Promise.resolve()})}},{key:"fetchEnvMap",value:function(n,t,i,o){var a,s=this,u=this.pmremGenerator;if(Array.isArray(i)&&1===i.length||"string"==typeof i)return a=Array.isArray(i)?i[0]:i,this.key2url.set(n,i),new Promise(function(e){var r={key:n,properties:t,url:i,value:null,rotate:o};s.cache.get(i)||null===s.cache.get(i)?(r.value=s.cache.get(i),e(r)):(s.cache.set(i,null),c.load(a,function(t){s.key2texture.set(n,t),u.updateAngle(o*Math.PI/180);t=u.fromEquirectangular(t).texture;r.value=t,s.cache.set(i,t),e(r)}))})}},{key:"fetchTexture",value:function(t,n,i){var o=this;return new Promise(function(e){var r={key:t,properties:n,url:i,value:null};o.cache.get(i)||null===o.cache.get(i)?(r.value=o.cache.get(i),e(r)):(o.cache.set(i,null),a.load(i,function(t){r.value=t,o.cache.set(i,t),e(r)}),a.manager.onError=function(){r.value=null,e(r)})})}},{key:"updateOptions",value:function(t){var s=this,u=[],c=[];return Array.isArray(t)&&t.forEach(function(t){c.push(t.key);var e=s.assetsMap.get(t.key);if(e&&e.url===t.url){if(e.properties!==t.properties)e.properties=t.properties;else if(void 0!==t.rotate&&e.rotate!==t.rotate){var r,n,i=s.key2texture,o=s.pmremGenerator,a=i.get(t.key);if(a||(r=s.key2url.get(t.key),n=[],s.key2url.forEach(function(t,e){t===r&&n.push(e)}),n.length&&(a=i.get(n[0]),i.set(t.key,a))),!a)return console.log("No texture for ".concat(t.key,"-").concat(t.url));o.updateAngle(t.rotate*Math.PI/180);i=o.fromEquirectangular(a).texture;e.value=i,e.rotate=t.rotate}}else{o=s.fetch(t);u&&u.push(o)}}),function(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}()||o(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.key2texture.keys()).forEach(function(t){var e;c.includes(t)||((e=s.key2texture.get(t))&&e.dispose&&e.dispose(),s.key2texture.delete(t))}),this.feedBack(u)}},{key:"destroy",value:function(){this.assetsMap&&this.assetsMap.forEach(function(t){t.value&&t.value.dispose&&t.value.dispose()}),this.assetsMap.clear(),this.cache.clear(),this.key2texture.forEach(function(t){return t&&t.dispose&&t.dispose()}),this.key2texture.clear(),this.key2url.clear(),this.pmremGenerator.dispose()}}]),Object.defineProperty(t,"prototype",{writable:!1}),r}();t.exports=r},function(t,e){function g(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,o=[],a=!0,s=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(o.push(n.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(r="Object"===r&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}t.exports={getPolygonCenter:function(t){var t=t.geometry,e=t.type,r=t.coordinates,n=180,i=-180,o=90,a=-90,s=1e6,u=-1e6;function c(t,e,r){n=t<n?t:n,i=i<t?t:i,o=e<o?e:o,a=a<e?e:a,s=r<s?r:s,u=u<r?r:u}if("Polygon"===e)for(var l=0;l<r.length;l++)for(var f=0;f<r[l].length;f++){var h=g(r[l][f],3),p=h[0],d=h[1],h=h[2];c(p,d,void 0===h?0:h)}else if("MultiPolygon"===e)for(var y=0;y<r.length;y++)for(var b=0;b<r[y].length;b++)for(var m=0;m<r[y][b].length;m++){var v=g(r[y][b][m],3),v=(p=v[0],d=v[1],v[2]);c(p,d,void 0===v?0:v)}return[(n+i)/2,(o+a)/2,(s+u)/2]}}},function(t,n,e){!function(t){var e;function S(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}()||function(t){if(t){if("string"==typeof t)return r(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(e="Object"===e&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?r(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function o(t){return(o="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}e=function(){return function(r){var n={};function i(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}return i.m=r,i.c=n,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==o(e)&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e){var u={};u.Offset,u.Table,u.SIZEOF_SHORT=2,u.SIZEOF_INT=4,u.FILE_IDENTIFIER_LENGTH=4,u.SIZE_PREFIX_LENGTH=4,u.Encoding={UTF8_BYTES:1,UTF16_STRING:2},u.int32=new Int32Array(2),u.float32=new Float32Array(u.int32.buffer),u.float64=new Float64Array(u.int32.buffer),u.isLittleEndian=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0],u.Long=function(t,e){this.low=0|t,this.high=0|e},u.Long.create=function(t,e){return 0==t&&0==e?u.Long.ZERO:new u.Long(t,e)},u.Long.prototype.toFloat64=function(){return(this.low>>>0)+4294967296*this.high},u.Long.prototype.equals=function(t){return this.low==t.low&&this.high==t.high},u.Long.ZERO=new u.Long(0,0),u.Builder=function(t){t=t||1024;this.bb=u.ByteBuffer.allocate(t),this.space=t,this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},u.Builder.prototype.clear=function(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},u.Builder.prototype.forceDefaults=function(t){this.force_defaults=t},u.Builder.prototype.dataBuffer=function(){return this.bb},u.Builder.prototype.asUint8Array=function(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())},u.Builder.prototype.prep=function(t,e){t>this.minalign&&(this.minalign=t);for(var r=1+~(this.bb.capacity()-this.space+e)&t-1;this.space<r+t+e;){var n=this.bb.capacity();this.bb=u.Builder.growByteBuffer(this.bb),this.space+=this.bb.capacity()-n}this.pad(r)},u.Builder.prototype.pad=function(t){for(var e=0;e<t;e++)this.bb.writeInt8(--this.space,0)},u.Builder.prototype.writeInt8=function(t){this.bb.writeInt8(--this.space,t)},u.Builder.prototype.writeInt16=function(t){this.bb.writeInt16(this.space-=2,t)},u.Builder.prototype.writeInt32=function(t){this.bb.writeInt32(this.space-=4,t)},u.Builder.prototype.writeInt64=function(t){this.bb.writeInt64(this.space-=8,t)},u.Builder.prototype.writeFloat32=function(t){this.bb.writeFloat32(this.space-=4,t)},u.Builder.prototype.writeFloat64=function(t){this.bb.writeFloat64(this.space-=8,t)},u.Builder.prototype.addInt8=function(t){this.prep(1,0),this.writeInt8(t)},u.Builder.prototype.addInt16=function(t){this.prep(2,0),this.writeInt16(t)},u.Builder.prototype.addInt32=function(t){this.prep(4,0),this.writeInt32(t)},u.Builder.prototype.addInt64=function(t){this.prep(8,0),this.writeInt64(t)},u.Builder.prototype.addFloat32=function(t){this.prep(4,0),this.writeFloat32(t)},u.Builder.prototype.addFloat64=function(t){this.prep(8,0),this.writeFloat64(t)},u.Builder.prototype.addFieldInt8=function(t,e,r){!this.force_defaults&&e==r||(this.addInt8(e),this.slot(t))},u.Builder.prototype.addFieldInt16=function(t,e,r){!this.force_defaults&&e==r||(this.addInt16(e),this.slot(t))},u.Builder.prototype.addFieldInt32=function(t,e,r){!this.force_defaults&&e==r||(this.addInt32(e),this.slot(t))},u.Builder.prototype.addFieldInt64=function(t,e,r){!this.force_defaults&&e.equals(r)||(this.addInt64(e),this.slot(t))},u.Builder.prototype.addFieldFloat32=function(t,e,r){!this.force_defaults&&e==r||(this.addFloat32(e),this.slot(t))},u.Builder.prototype.addFieldFloat64=function(t,e,r){!this.force_defaults&&e==r||(this.addFloat64(e),this.slot(t))},u.Builder.prototype.addFieldOffset=function(t,e,r){!this.force_defaults&&e==r||(this.addOffset(e),this.slot(t))},u.Builder.prototype.addFieldStruct=function(t,e,r){e!=r&&(this.nested(e),this.slot(t))},u.Builder.prototype.nested=function(t){if(t!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")},u.Builder.prototype.notNested=function(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")},u.Builder.prototype.slot=function(t){this.vtable[t]=this.offset()},u.Builder.prototype.offset=function(){return this.bb.capacity()-this.space},u.Builder.growByteBuffer=function(t){var e=t.capacity();if(3221225472&e)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");var r=e<<1,n=u.ByteBuffer.allocate(r);return n.setPosition(r-e),n.bytes().set(t.bytes(),r-e),n},u.Builder.prototype.addOffset=function(t){this.prep(u.SIZEOF_INT,0),this.writeInt32(this.offset()-t+u.SIZEOF_INT)},u.Builder.prototype.startObject=function(t){this.notNested(),null==this.vtable&&(this.vtable=[]),this.vtable_in_use=t;for(var e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()},u.Builder.prototype.endObject=function(){if(null==this.vtable||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);for(var t=this.offset(),e=this.vtable_in_use-1;0<=e&&0==this.vtable[e];e--);for(var r=e+1;0<=e;e--)this.addInt16(0!=this.vtable[e]?t-this.vtable[e]:0);this.addInt16(t-this.object_start);var n=(r+2)*u.SIZEOF_SHORT,i=(this.addInt16(n),0),o=this.space;t:for(e=0;e<this.vtables.length;e++){var a=this.bb.capacity()-this.vtables[e];if(n==this.bb.readInt16(a)){for(var s=u.SIZEOF_SHORT;s<n;s+=u.SIZEOF_SHORT)if(this.bb.readInt16(o+s)!=this.bb.readInt16(a+s))continue t;i=this.vtables[e];break}}return i?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,i-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t},u.Builder.prototype.finish=function(t,e,r){r=r?u.SIZE_PREFIX_LENGTH:0;if(e){var n=e;if(this.prep(this.minalign,u.SIZEOF_INT+u.FILE_IDENTIFIER_LENGTH+r),n.length!=u.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+u.FILE_IDENTIFIER_LENGTH);for(var i=u.FILE_IDENTIFIER_LENGTH-1;0<=i;i--)this.writeInt8(n.charCodeAt(i))}this.prep(this.minalign,u.SIZEOF_INT+r),this.addOffset(t),r&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)},u.Builder.prototype.finishSizePrefixed=function(t,e){this.finish(t,e,!0)},u.Builder.prototype.requiredField=function(t,e){t=this.bb.capacity()-t,t-=this.bb.readInt32(t);if(0==this.bb.readInt16(t+e))throw new Error("FlatBuffers: field "+e+" must be set")},u.Builder.prototype.startVector=function(t,e,r){this.notNested(),this.vector_num_elems=e,this.prep(u.SIZEOF_INT,t*e),this.prep(r,t*e)},u.Builder.prototype.endVector=function(){return this.writeInt32(this.vector_num_elems),this.offset()},u.Builder.prototype.createString=function(t){if(t instanceof Uint8Array)var e=t;else for(var e=[],r=0;r<t.length;){var n=t.charCodeAt(r++);(n=n<55296||56320<=n?n:(n<<10)+t.charCodeAt(r++)+-56613888)<128?e.push(n):(n<2048?e.push(n>>6&31|192):(n<65536?e.push(n>>12&15|224):e.push(n>>18&7|240,n>>12&63|128),e.push(n>>6&63|128)),e.push(63&n|128))}this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length);for(var r=0,i=this.space,o=this.bb.bytes();r<e.length;r++)o[i++]=e[r];return this.endVector()},u.Builder.prototype.createLong=function(t,e){return u.Long.create(t,e)},u.ByteBuffer=function(t){this.bytes_=t,this.position_=0},u.ByteBuffer.allocate=function(t){return new u.ByteBuffer(new Uint8Array(t))},u.ByteBuffer.prototype.clear=function(){this.position_=0},u.ByteBuffer.prototype.bytes=function(){return this.bytes_},u.ByteBuffer.prototype.position=function(){return this.position_},u.ByteBuffer.prototype.setPosition=function(t){this.position_=t},u.ByteBuffer.prototype.capacity=function(){return this.bytes_.length},u.ByteBuffer.prototype.readInt8=function(t){return this.readUint8(t)<<24>>24},u.ByteBuffer.prototype.readUint8=function(t){return this.bytes_[t]},u.ByteBuffer.prototype.readInt16=function(t){return this.readUint16(t)<<16>>16},u.ByteBuffer.prototype.readUint16=function(t){return this.bytes_[t]|this.bytes_[t+1]<<8},u.ByteBuffer.prototype.readInt32=function(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24},u.ByteBuffer.prototype.readUint32=function(t){return this.readInt32(t)>>>0},u.ByteBuffer.prototype.readInt64=function(t){return new u.Long(this.readInt32(t),this.readInt32(t+4))},u.ByteBuffer.prototype.readUint64=function(t){return new u.Long(this.readUint32(t),this.readUint32(t+4))},u.ByteBuffer.prototype.readFloat32=function(t){return u.int32[0]=this.readInt32(t),u.float32[0]},u.ByteBuffer.prototype.readFloat64=function(t){return u.int32[u.isLittleEndian?0:1]=this.readInt32(t),u.int32[u.isLittleEndian?1:0]=this.readInt32(t+4),u.float64[0]},u.ByteBuffer.prototype.writeInt8=function(t,e){this.bytes_[t]=e},u.ByteBuffer.prototype.writeUint8=function(t,e){this.bytes_[t]=e},u.ByteBuffer.prototype.writeInt16=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8},u.ByteBuffer.prototype.writeUint16=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8},u.ByteBuffer.prototype.writeInt32=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24},u.ByteBuffer.prototype.writeUint32=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24},u.ByteBuffer.prototype.writeInt64=function(t,e){this.writeInt32(t,e.low),this.writeInt32(t+4,e.high)},u.ByteBuffer.prototype.writeUint64=function(t,e){this.writeUint32(t,e.low),this.writeUint32(t+4,e.high)},u.ByteBuffer.prototype.writeFloat32=function(t,e){u.float32[0]=e,this.writeInt32(t,u.int32[0])},u.ByteBuffer.prototype.writeFloat64=function(t,e){u.float64[0]=e,this.writeInt32(t,u.int32[u.isLittleEndian?0:1]),this.writeInt32(t+4,u.int32[u.isLittleEndian?1:0])},u.ByteBuffer.prototype.getBufferIdentifier=function(){if(this.bytes_.length<this.position_+u.SIZEOF_INT+u.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");for(var t="",e=0;e<u.FILE_IDENTIFIER_LENGTH;e++)t+=String.fromCharCode(this.readInt8(this.position_+u.SIZEOF_INT+e));return t},u.ByteBuffer.prototype.__offset=function(t,e){t-=this.readInt32(t);return e<this.readInt16(t)?this.readInt16(t+e):0},u.ByteBuffer.prototype.__union=function(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t},u.ByteBuffer.prototype.__string=function(t,e){t+=this.readInt32(t);var r=this.readInt32(t),n="",i=0;if(t+=u.SIZEOF_INT,e===u.Encoding.UTF8_BYTES)return this.bytes_.subarray(t,t+r);for(;i<r;){var o,a,s=this.readUint8(t+i++);(s=s<192?s:(o=this.readUint8(t+i++),s<224?(31&s)<<6|63&o:(a=this.readUint8(t+i++),s<240?(15&s)<<12|(63&o)<<6|63&a:(7&s)<<18|(63&o)<<12|(63&a)<<6|63&this.readUint8(t+i++))))<65536?n+=String.fromCharCode(s):(s-=65536,n+=String.fromCharCode(55296+(s>>10),56320+(1023&s)))}return n},u.ByteBuffer.prototype.__indirect=function(t){return t+this.readInt32(t)},u.ByteBuffer.prototype.__vector=function(t){return t+this.readInt32(t)+u.SIZEOF_INT},u.ByteBuffer.prototype.__vector_len=function(t){return this.readInt32(t+this.readInt32(t))},u.ByteBuffer.prototype.__has_identifier=function(t){if(t.length!=u.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+u.FILE_IDENTIFIER_LENGTH);for(var e=0;e<u.FILE_IDENTIFIER_LENGTH;e++)if(t.charCodeAt(e)!=this.readInt8(this.position_+u.SIZEOF_INT+e))return!1;return!0},u.ByteBuffer.prototype.createLong=function(t,e){return u.Long.create(t,e)},this.flatbuffers=u},function(t,e,r){var C=r(2).Mesh,P=r(0).flatbuffers;t.exports=function(t){var t=new P.ByteBuffer(new Uint8Array(t)),e=C.getRootAsMesh(t),t=e.positionsArray()||new Float32Array,r=e.indicesArray()||new Uint32Array,n=e.normalsArray()||new Float32Array,i=e.tangentsArray()||new Float32Array,o=e.uvsArray()||new Float32Array,a=e.groupsArray()||new Int32Array,s=e.featureIndexArray()||new Int32Array,u=e.fAttr0Array()||new Float32Array,c=e.fAttr1Array()||new Float32Array,l=e.fAttr2Array()||new Float32Array,f=e.fAttr3Array()||new Float32Array,h=e.fAttr4Array()||new Float32Array,p=e.iAttr0Array()||new Int32Array,d=e.iAttr1Array()||new Int32Array,y=e.iAttr2Array()||new Int32Array,b=e.iAttr3Array()||new Int32Array,m=e.iAttr4Array()||new Int32Array,v=e.positionsQuantizedArray()||new Uint16Array,g=e.normalsQuantizedArray()||new Uint16Array,_=e.tangentsQuantizedArray()||new Uint16Array,k=e.uvsQuantizedArray()||new Uint16Array,A=e.ui16Attr0Array()||new Uint16Array,w=e.ui16Attr1Array()||new Uint16Array,I=e.ui16Attr2Array()||new Uint16Array,x=e.i16Attr0Array()||new Int16Array,O=e.i16Attr1Array()||new Int16Array,E=e.i16Attr2Array()||new Int16Array;return{positions:t,indices:r,normals:n,tangents:i,uvs:o,groups:a,featureIndex:s,fAttr0:u,fAttr1:c,fAttr2:l,fAttr3:f,fAttr4:h,iAttr0:p,iAttr1:d,iAttr2:y,iAttr3:b,iAttr4:m,sAttr0:S(Array(e.sAttr0Length()).keys()).map(function(t){return e.sAttr0(t,"utf-8")}),sAttr1:S(Array(e.sAttr1Length()).keys()).map(function(t){return e.sAttr1(t,"utf-8")}),sAttr2:S(Array(e.sAttr2Length()).keys()).map(function(t){return e.sAttr2(t,"utf-8")}),sAttr3:S(Array(e.sAttr3Length()).keys()).map(function(t){return e.sAttr3(t,"utf-8")}),sAttr4:S(Array(e.sAttr4Length()).keys()).map(function(t){return e.sAttr4(t,"utf-8")}),positions_quantized:v,normals_quantized:g,tangents_quantized:_,uvs_quantized:k,ui16Attr0:A,ui16Attr1:w,ui16Attr2:I,i16Attr0:x,i16Attr1:O,i16Attr2:E}}},function(t,e,r){"use strict";e.__esModule=!0,e.Mesh=void 0;var n=r(0),r=function(){function M(){this.bb=null,this.bb_pos=0}return M.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},M.getRootAsMesh=function(t,e){return(e||new M).__init(t.readInt32(t.position())+t.position(),t)},M.getSizePrefixedRootAsMesh=function(t,e){return t.setPosition(t.position()+n.SIZE_PREFIX_LENGTH),(e||new M).__init(t.readInt32(t.position())+t.position(),t)},M.prototype.positions=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readFloat32(this.bb.__vector(this.bb_pos+e)+4*t):0},M.prototype.positionsLength=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.positionsArray=function(){var t=this.bb.__offset(this.bb_pos,4);return t?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.indices=function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0},M.prototype.indicesLength=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.indicesArray=function(){var t=this.bb.__offset(this.bb_pos,6);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.normals=function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readFloat32(this.bb.__vector(this.bb_pos+e)+4*t):0},M.prototype.normalsLength=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.normalsArray=function(){var t=this.bb.__offset(this.bb_pos,8);return t?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.tangents=function(t){var e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readFloat32(this.bb.__vector(this.bb_pos+e)+4*t):0},M.prototype.tangentsLength=function(){var t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.tangentsArray=function(){var t=this.bb.__offset(this.bb_pos,10);return t?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.uvs=function(t){var e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readFloat32(this.bb.__vector(this.bb_pos+e)+4*t):0},M.prototype.uvsLength=function(){var t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.uvsArray=function(){var t=this.bb.__offset(this.bb_pos,12);return t?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.groups=function(t){var e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+4*t):0},M.prototype.groupsLength=function(){var t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.groupsArray=function(){var t=this.bb.__offset(this.bb_pos,14);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.fAttr0=function(t){var e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readFloat32(this.bb.__vector(this.bb_pos+e)+4*t):0},M.prototype.fAttr0Length=function(){var t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.fAttr0Array=function(){var t=this.bb.__offset(this.bb_pos,16);return t?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.fAttr1=function(t){var e=this.bb.__offset(this.bb_pos,18);return e?this.bb.readFloat32(this.bb.__vector(this.bb_pos+e)+4*t):0},M.prototype.fAttr1Length=function(){var t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.fAttr1Array=function(){var t=this.bb.__offset(this.bb_pos,18);return t?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.fAttr2=function(t){var e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readFloat32(this.bb.__vector(this.bb_pos+e)+4*t):0},M.prototype.fAttr2Length=function(){var t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.fAttr2Array=function(){var t=this.bb.__offset(this.bb_pos,20);return t?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.fAttr3=function(t){var e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readFloat32(this.bb.__vector(this.bb_pos+e)+4*t):0},M.prototype.fAttr3Length=function(){var t=this.bb.__offset(this.bb_pos,22);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.fAttr3Array=function(){var t=this.bb.__offset(this.bb_pos,22);return t?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.fAttr4=function(t){var e=this.bb.__offset(this.bb_pos,24);return e?this.bb.readFloat32(this.bb.__vector(this.bb_pos+e)+4*t):0},M.prototype.fAttr4Length=function(){var t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.fAttr4Array=function(){var t=this.bb.__offset(this.bb_pos,24);return t?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.iAttr0=function(t){var e=this.bb.__offset(this.bb_pos,26);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+4*t):0},M.prototype.iAttr0Length=function(){var t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.iAttr0Array=function(){var t=this.bb.__offset(this.bb_pos,26);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.iAttr1=function(t){var e=this.bb.__offset(this.bb_pos,28);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+4*t):0},M.prototype.iAttr1Length=function(){var t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.iAttr1Array=function(){var t=this.bb.__offset(this.bb_pos,28);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.iAttr2=function(t){var e=this.bb.__offset(this.bb_pos,30);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+4*t):0},M.prototype.iAttr2Length=function(){var t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.iAttr2Array=function(){var t=this.bb.__offset(this.bb_pos,30);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.iAttr3=function(t){var e=this.bb.__offset(this.bb_pos,32);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+4*t):0},M.prototype.iAttr3Length=function(){var t=this.bb.__offset(this.bb_pos,32);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.iAttr3Array=function(){var t=this.bb.__offset(this.bb_pos,32);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.iAttr4=function(t){var e=this.bb.__offset(this.bb_pos,34);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+4*t):0},M.prototype.iAttr4Length=function(){var t=this.bb.__offset(this.bb_pos,34);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.iAttr4Array=function(){var t=this.bb.__offset(this.bb_pos,34);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.sAttr0=function(t,e){var r=this.bb.__offset(this.bb_pos,36);return r?this.bb.__string(this.bb.__vector(this.bb_pos+r)+4*t,e):null},M.prototype.sAttr0Length=function(){var t=this.bb.__offset(this.bb_pos,36);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.sAttr1=function(t,e){var r=this.bb.__offset(this.bb_pos,38);return r?this.bb.__string(this.bb.__vector(this.bb_pos+r)+4*t,e):null},M.prototype.sAttr1Length=function(){var t=this.bb.__offset(this.bb_pos,38);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.sAttr2=function(t,e){var r=this.bb.__offset(this.bb_pos,40);return r?this.bb.__string(this.bb.__vector(this.bb_pos+r)+4*t,e):null},M.prototype.sAttr2Length=function(){var t=this.bb.__offset(this.bb_pos,40);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.sAttr3=function(t,e){var r=this.bb.__offset(this.bb_pos,42);return r?this.bb.__string(this.bb.__vector(this.bb_pos+r)+4*t,e):null},M.prototype.sAttr3Length=function(){var t=this.bb.__offset(this.bb_pos,42);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.sAttr4=function(t,e){var r=this.bb.__offset(this.bb_pos,44);return r?this.bb.__string(this.bb.__vector(this.bb_pos+r)+4*t,e):null},M.prototype.sAttr4Length=function(){var t=this.bb.__offset(this.bb_pos,44);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.featureIndex=function(t){var e=this.bb.__offset(this.bb_pos,46);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+4*t):0},M.prototype.featureIndexLength=function(){var t=this.bb.__offset(this.bb_pos,46);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.featureIndexArray=function(){var t=this.bb.__offset(this.bb_pos,46);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.positionsQuantized=function(t){var e=this.bb.__offset(this.bb_pos,48);return e?this.bb.readUint16(this.bb.__vector(this.bb_pos+e)+2*t):0},M.prototype.positionsQuantizedLength=function(){var t=this.bb.__offset(this.bb_pos,48);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.positionsQuantizedArray=function(){var t=this.bb.__offset(this.bb_pos,48);return t?new Uint16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.normalsQuantized=function(t){var e=this.bb.__offset(this.bb_pos,50);return e?this.bb.readUint16(this.bb.__vector(this.bb_pos+e)+2*t):0},M.prototype.normalsQuantizedLength=function(){var t=this.bb.__offset(this.bb_pos,50);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.normalsQuantizedArray=function(){var t=this.bb.__offset(this.bb_pos,50);return t?new Uint16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.tangentsQuantized=function(t){var e=this.bb.__offset(this.bb_pos,52);return e?this.bb.readUint16(this.bb.__vector(this.bb_pos+e)+2*t):0},M.prototype.tangentsQuantizedLength=function(){var t=this.bb.__offset(this.bb_pos,52);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.tangentsQuantizedArray=function(){var t=this.bb.__offset(this.bb_pos,52);return t?new Uint16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.uvsQuantized=function(t){var e=this.bb.__offset(this.bb_pos,54);return e?this.bb.readUint16(this.bb.__vector(this.bb_pos+e)+2*t):0},M.prototype.uvsQuantizedLength=function(){var t=this.bb.__offset(this.bb_pos,54);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.uvsQuantizedArray=function(){var t=this.bb.__offset(this.bb_pos,54);return t?new Uint16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.ui16Attr0=function(t){var e=this.bb.__offset(this.bb_pos,56);return e?this.bb.readUint16(this.bb.__vector(this.bb_pos+e)+2*t):0},M.prototype.ui16Attr0Length=function(){var t=this.bb.__offset(this.bb_pos,56);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.ui16Attr0Array=function(){var t=this.bb.__offset(this.bb_pos,56);return t?new Uint16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.ui16Attr1=function(t){var e=this.bb.__offset(this.bb_pos,58);return e?this.bb.readUint16(this.bb.__vector(this.bb_pos+e)+2*t):0},M.prototype.ui16Attr1Length=function(){var t=this.bb.__offset(this.bb_pos,58);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.ui16Attr1Array=function(){var t=this.bb.__offset(this.bb_pos,58);return t?new Uint16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.ui16Attr2=function(t){var e=this.bb.__offset(this.bb_pos,60);return e?this.bb.readUint16(this.bb.__vector(this.bb_pos+e)+2*t):0},M.prototype.ui16Attr2Length=function(){var t=this.bb.__offset(this.bb_pos,60);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.ui16Attr2Array=function(){var t=this.bb.__offset(this.bb_pos,60);return t?new Uint16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.i16Attr0=function(t){var e=this.bb.__offset(this.bb_pos,62);return e?this.bb.readInt16(this.bb.__vector(this.bb_pos+e)+2*t):0},M.prototype.i16Attr0Length=function(){var t=this.bb.__offset(this.bb_pos,62);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.i16Attr0Array=function(){var t=this.bb.__offset(this.bb_pos,62);return t?new Int16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.i16Attr1=function(t){var e=this.bb.__offset(this.bb_pos,64);return e?this.bb.readInt16(this.bb.__vector(this.bb_pos+e)+2*t):0},M.prototype.i16Attr1Length=function(){var t=this.bb.__offset(this.bb_pos,64);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.i16Attr1Array=function(){var t=this.bb.__offset(this.bb_pos,64);return t?new Int16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.prototype.i16Attr2=function(t){var e=this.bb.__offset(this.bb_pos,66);return e?this.bb.readInt16(this.bb.__vector(this.bb_pos+e)+2*t):0},M.prototype.i16Attr2Length=function(){var t=this.bb.__offset(this.bb_pos,66);return t?this.bb.__vector_len(this.bb_pos+t):0},M.prototype.i16Attr2Array=function(){var t=this.bb.__offset(this.bb_pos,66);return t?new Int16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},M.startMesh=function(t){t.startObject(32)},M.addPositions=function(t,e){t.addFieldOffset(0,e,0)},M.createPositionsVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addFloat32(e[r]);return t.endVector()},M.startPositionsVector=function(t,e){t.startVector(4,e,4)},M.addIndices=function(t,e){t.addFieldOffset(1,e,0)},M.createIndicesVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addInt32(e[r]);return t.endVector()},M.startIndicesVector=function(t,e){t.startVector(4,e,4)},M.addNormals=function(t,e){t.addFieldOffset(2,e,0)},M.createNormalsVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addFloat32(e[r]);return t.endVector()},M.startNormalsVector=function(t,e){t.startVector(4,e,4)},M.addTangents=function(t,e){t.addFieldOffset(3,e,0)},M.createTangentsVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addFloat32(e[r]);return t.endVector()},M.startTangentsVector=function(t,e){t.startVector(4,e,4)},M.addUvs=function(t,e){t.addFieldOffset(4,e,0)},M.createUvsVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addFloat32(e[r]);return t.endVector()},M.startUvsVector=function(t,e){t.startVector(4,e,4)},M.addGroups=function(t,e){t.addFieldOffset(5,e,0)},M.createGroupsVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addInt32(e[r]);return t.endVector()},M.startGroupsVector=function(t,e){t.startVector(4,e,4)},M.addFAttr0=function(t,e){t.addFieldOffset(6,e,0)},M.createFAttr0Vector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addFloat32(e[r]);return t.endVector()},M.startFAttr0Vector=function(t,e){t.startVector(4,e,4)},M.addFAttr1=function(t,e){t.addFieldOffset(7,e,0)},M.createFAttr1Vector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addFloat32(e[r]);return t.endVector()},M.startFAttr1Vector=function(t,e){t.startVector(4,e,4)},M.addFAttr2=function(t,e){t.addFieldOffset(8,e,0)},M.createFAttr2Vector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addFloat32(e[r]);return t.endVector()},M.startFAttr2Vector=function(t,e){t.startVector(4,e,4)},M.addFAttr3=function(t,e){t.addFieldOffset(9,e,0)},M.createFAttr3Vector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addFloat32(e[r]);return t.endVector()},M.startFAttr3Vector=function(t,e){t.startVector(4,e,4)},M.addFAttr4=function(t,e){t.addFieldOffset(10,e,0)},M.createFAttr4Vector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addFloat32(e[r]);return t.endVector()},M.startFAttr4Vector=function(t,e){t.startVector(4,e,4)},M.addIAttr0=function(t,e){t.addFieldOffset(11,e,0)},M.createIAttr0Vector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addInt32(e[r]);return t.endVector()},M.startIAttr0Vector=function(t,e){t.startVector(4,e,4)},M.addIAttr1=function(t,e){t.addFieldOffset(12,e,0)},M.createIAttr1Vector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addInt32(e[r]);return t.endVector()},M.startIAttr1Vector=function(t,e){t.startVector(4,e,4)},M.addIAttr2=function(t,e){t.addFieldOffset(13,e,0)},M.createIAttr2Vector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addInt32(e[r]);return t.endVector()},M.startIAttr2Vector=function(t,e){t.startVector(4,e,4)},M.addIAttr3=function(t,e){t.addFieldOffset(14,e,0)},M.createIAttr3Vector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addInt32(e[r]);return t.endVector()},M.startIAttr3Vector=function(t,e){t.startVector(4,e,4)},M.addIAttr4=function(t,e){t.addFieldOffset(15,e,0)},M.createIAttr4Vector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addInt32(e[r]);return t.endVector()},M.startIAttr4Vector=function(t,e){t.startVector(4,e,4)},M.addSAttr0=function(t,e){t.addFieldOffset(16,e,0)},M.createSAttr0Vector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addOffset(e[r]);return t.endVector()},M.startSAttr0Vector=function(t,e){t.startVector(4,e,4)},M.addSAttr1=function(t,e){t.addFieldOffset(17,e,0)},M.createSAttr1Vector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addOffset(e[r]);return t.endVector()},M.startSAttr1Vector=function(t,e){t.startVector(4,e,4)},M.addSAttr2=function(t,e){t.addFieldOffset(18,e,0)},M.createSAttr2Vector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addOffset(e[r]);return t.endVector()},M.startSAttr2Vector=function(t,e){t.startVector(4,e,4)},M.addSAttr3=function(t,e){t.addFieldOffset(19,e,0)},M.createSAttr3Vector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addOffset(e[r]);return t.endVector()},M.startSAttr3Vector=function(t,e){t.startVector(4,e,4)},M.addSAttr4=function(t,e){t.addFieldOffset(20,e,0)},M.createSAttr4Vector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addOffset(e[r]);return t.endVector()},M.startSAttr4Vector=function(t,e){t.startVector(4,e,4)},M.addFeatureIndex=function(t,e){t.addFieldOffset(21,e,0)},M.createFeatureIndexVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addInt32(e[r]);return t.endVector()},M.startFeatureIndexVector=function(t,e){t.startVector(4,e,4)},M.addPositionsQuantized=function(t,e){t.addFieldOffset(22,e,0)},M.createPositionsQuantizedVector=function(t,e){t.startVector(2,e.length,2);for(var r=e.length-1;0<=r;r--)t.addInt16(e[r]);return t.endVector()},M.startPositionsQuantizedVector=function(t,e){t.startVector(2,e,2)},M.addNormalsQuantized=function(t,e){t.addFieldOffset(23,e,0)},M.createNormalsQuantizedVector=function(t,e){t.startVector(2,e.length,2);for(var r=e.length-1;0<=r;r--)t.addInt16(e[r]);return t.endVector()},M.startNormalsQuantizedVector=function(t,e){t.startVector(2,e,2)},M.addTangentsQuantized=function(t,e){t.addFieldOffset(24,e,0)},M.createTangentsQuantizedVector=function(t,e){t.startVector(2,e.length,2);for(var r=e.length-1;0<=r;r--)t.addInt16(e[r]);return t.endVector()},M.startTangentsQuantizedVector=function(t,e){t.startVector(2,e,2)},M.addUvsQuantized=function(t,e){t.addFieldOffset(25,e,0)},M.createUvsQuantizedVector=function(t,e){t.startVector(2,e.length,2);for(var r=e.length-1;0<=r;r--)t.addInt16(e[r]);return t.endVector()},M.startUvsQuantizedVector=function(t,e){t.startVector(2,e,2)},M.addUi16Attr0=function(t,e){t.addFieldOffset(26,e,0)},M.createUi16Attr0Vector=function(t,e){t.startVector(2,e.length,2);for(var r=e.length-1;0<=r;r--)t.addInt16(e[r]);return t.endVector()},M.startUi16Attr0Vector=function(t,e){t.startVector(2,e,2)},M.addUi16Attr1=function(t,e){t.addFieldOffset(27,e,0)},M.createUi16Attr1Vector=function(t,e){t.startVector(2,e.length,2);for(var r=e.length-1;0<=r;r--)t.addInt16(e[r]);return t.endVector()},M.startUi16Attr1Vector=function(t,e){t.startVector(2,e,2)},M.addUi16Attr2=function(t,e){t.addFieldOffset(28,e,0)},M.createUi16Attr2Vector=function(t,e){t.startVector(2,e.length,2);for(var r=e.length-1;0<=r;r--)t.addInt16(e[r]);return t.endVector()},M.startUi16Attr2Vector=function(t,e){t.startVector(2,e,2)},M.addI16Attr0=function(t,e){t.addFieldOffset(29,e,0)},M.createI16Attr0Vector=function(t,e){t.startVector(2,e.length,2);for(var r=e.length-1;0<=r;r--)t.addInt16(e[r]);return t.endVector()},M.startI16Attr0Vector=function(t,e){t.startVector(2,e,2)},M.addI16Attr1=function(t,e){t.addFieldOffset(30,e,0)},M.createI16Attr1Vector=function(t,e){t.startVector(2,e.length,2);for(var r=e.length-1;0<=r;r--)t.addInt16(e[r]);return t.endVector()},M.startI16Attr1Vector=function(t,e){t.startVector(2,e,2)},M.addI16Attr2=function(t,e){t.addFieldOffset(31,e,0)},M.createI16Attr2Vector=function(t,e){t.startVector(2,e.length,2);for(var r=e.length-1;0<=r;r--)t.addInt16(e[r]);return t.endVector()},M.startI16Attr2Vector=function(t,e){t.startVector(2,e,2)},M.endMesh=function(t){return t.endObject()},M.finishMeshBuffer=function(t,e){t.finish(e)},M.finishSizePrefixedMeshBuffer=function(t,e){t.finish(e,void 0,!0)},M.createMesh=function(t,e,r,n,i,o,a,s,u,c,l,f,h,p,d,y,b,m,v,g,_,k,A,w,I,x,O,E,C,P,S,B,T){return M.startMesh(t),M.addPositions(t,e),M.addIndices(t,r),M.addNormals(t,n),M.addTangents(t,i),M.addUvs(t,o),M.addGroups(t,a),M.addFAttr0(t,s),M.addFAttr1(t,u),M.addFAttr2(t,c),M.addFAttr3(t,l),M.addFAttr4(t,f),M.addIAttr0(t,h),M.addIAttr1(t,p),M.addIAttr2(t,d),M.addIAttr3(t,y),M.addIAttr4(t,b),M.addSAttr0(t,m),M.addSAttr1(t,v),M.addSAttr2(t,g),M.addSAttr3(t,_),M.addSAttr4(t,k),M.addFeatureIndex(t,A),M.addPositionsQuantized(t,w),M.addNormalsQuantized(t,I),M.addTangentsQuantized(t,x),M.addUvsQuantized(t,O),M.addUi16Attr0(t,E),M.addUi16Attr1(t,C),M.addUi16Attr2(t,P),M.addI16Attr0(t,S),M.addI16Attr1(t,B),M.addI16Attr2(t,T),M.endMesh(t)},M}();e.Mesh=r}])},"object"==o(n)&&"object"==o(t)?t.exports=e():void 0!==(e="function"==typeof(e=e)?e.apply(n,[]):e)&&(t.exports=e)}.call(this,e(8)(t))},function(t,r,e){!function(t){var e;function o(t){return(o="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}e=function(){return function(r){var n={};function i(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}return i.m=r,i.c=n,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==o(e)&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,r){var n=r(1).DataVVTBufferV1,i=r(2).flatbuffers;t.exports=function(t){t=new i.ByteBuffer(new Uint8Array(t)),t=n.VTBuffer.getRootAsVTBuffer(t);return{albedoTex2DArrayData:t.albedoTex2DArrayArray()||new Uint8Array,normalTex2DArrayData:t.normalTex2DArrayArray()||new Uint8Array,emissiveTex2DArrayData:t.emissiveTex2DArrayArray()||new Uint8Array,ormTex2DArrayData:t.ormTex2DArrayArray()||new Uint8Array,uvScaleData:t.uvScaleArray()||new Float32Array}}},function(t,e){var a={VTBuffer:function(){this.bb=null,this.bb_pos=0}};a.VTBuffer.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},a.VTBuffer.getRootAsVTBuffer=function(t,e){return(e||new a.VTBuffer).__init(t.readInt32(t.position())+t.position(),t)},a.VTBuffer.getSizePrefixedRootAsVTBuffer=function(t,e){return(e||new a.VTBuffer).__init(t.readInt32(t.position())+t.position(),t)},a.VTBuffer.prototype.albedoTex2DArray=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0},a.VTBuffer.prototype.albedoTex2DArrayLength=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0},a.VTBuffer.prototype.albedoTex2DArrayArray=function(){var t=this.bb.__offset(this.bb_pos,4);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},a.VTBuffer.prototype.normalTex2DArray=function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0},a.VTBuffer.prototype.normalTex2DArrayLength=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0},a.VTBuffer.prototype.normalTex2DArrayArray=function(){var t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},a.VTBuffer.prototype.emissiveTex2DArray=function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0},a.VTBuffer.prototype.emissiveTex2DArrayLength=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0},a.VTBuffer.prototype.emissiveTex2DArrayArray=function(){var t=this.bb.__offset(this.bb_pos,8);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},a.VTBuffer.prototype.ormTex2DArray=function(t){var e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0},a.VTBuffer.prototype.ormTex2DArrayLength=function(){var t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0},a.VTBuffer.prototype.ormTex2DArrayArray=function(){var t=this.bb.__offset(this.bb_pos,10);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},a.VTBuffer.prototype.uvScale=function(t){var e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readFloat32(this.bb.__vector(this.bb_pos+e)+4*t):0},a.VTBuffer.prototype.uvScaleLength=function(){var t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0},a.VTBuffer.prototype.uvScaleArray=function(){var t=this.bb.__offset(this.bb_pos,12);return t?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},a.VTBuffer.startVTBuffer=function(t){t.startObject(5)},a.VTBuffer.addAlbedoTex2DArray=function(t,e){t.addFieldOffset(0,e,0)},a.VTBuffer.createAlbedoTex2DArrayVector=function(t,e){t.startVector(1,e.length,1);for(var r=e.length-1;0<=r;r--)t.addInt8(e[r]);return t.endVector()},a.VTBuffer.startAlbedoTex2DArrayVector=function(t,e){t.startVector(1,e,1)},a.VTBuffer.addNormalTex2DArray=function(t,e){t.addFieldOffset(1,e,0)},a.VTBuffer.createNormalTex2DArrayVector=function(t,e){t.startVector(1,e.length,1);for(var r=e.length-1;0<=r;r--)t.addInt8(e[r]);return t.endVector()},a.VTBuffer.startNormalTex2DArrayVector=function(t,e){t.startVector(1,e,1)},a.VTBuffer.addEmissiveTex2DArray=function(t,e){t.addFieldOffset(2,e,0)},a.VTBuffer.createEmissiveTex2DArrayVector=function(t,e){t.startVector(1,e.length,1);for(var r=e.length-1;0<=r;r--)t.addInt8(e[r]);return t.endVector()},a.VTBuffer.startEmissiveTex2DArrayVector=function(t,e){t.startVector(1,e,1)},a.VTBuffer.addOrmTex2DArray=function(t,e){t.addFieldOffset(3,e,0)},a.VTBuffer.createOrmTex2DArrayVector=function(t,e){t.startVector(1,e.length,1);for(var r=e.length-1;0<=r;r--)t.addInt8(e[r]);return t.endVector()},a.VTBuffer.startOrmTex2DArrayVector=function(t,e){t.startVector(1,e,1)},a.VTBuffer.addUvScale=function(t,e){t.addFieldOffset(4,e,0)},a.VTBuffer.createUvScaleVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;0<=r;r--)t.addFloat32(e[r]);return t.endVector()},a.VTBuffer.startUvScaleVector=function(t,e){t.startVector(4,e,4)},a.VTBuffer.endVTBuffer=function(t){return t.endObject()},a.VTBuffer.finishVTBufferBuffer=function(t,e){t.finish(e)},a.VTBuffer.finishSizePrefixedVTBufferBuffer=function(t,e){t.finish(e,void 0,!0)},a.VTBuffer.createVTBuffer=function(t,e,r,n,i,o){return a.VTBuffer.startVTBuffer(t),a.VTBuffer.addAlbedoTex2DArray(t,e),a.VTBuffer.addNormalTex2DArray(t,r),a.VTBuffer.addEmissiveTex2DArray(t,n),a.VTBuffer.addOrmTex2DArray(t,i),a.VTBuffer.addUvScale(t,o),a.VTBuffer.endVTBuffer(t)},this.DataVVTBufferV1=a},function(t,e){var u={};u.Offset,u.Table,u.SIZEOF_SHORT=2,u.SIZEOF_INT=4,u.FILE_IDENTIFIER_LENGTH=4,u.SIZE_PREFIX_LENGTH=4,u.Encoding={UTF8_BYTES:1,UTF16_STRING:2},u.int32=new Int32Array(2),u.float32=new Float32Array(u.int32.buffer),u.float64=new Float64Array(u.int32.buffer),u.isLittleEndian=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0],u.Long=function(t,e){this.low=0|t,this.high=0|e},u.Long.create=function(t,e){return 0==t&&0==e?u.Long.ZERO:new u.Long(t,e)},u.Long.prototype.toFloat64=function(){return(this.low>>>0)+4294967296*this.high},u.Long.prototype.equals=function(t){return this.low==t.low&&this.high==t.high},u.Long.ZERO=new u.Long(0,0),u.Builder=function(t){t=t||1024;this.bb=u.ByteBuffer.allocate(t),this.space=t,this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},u.Builder.prototype.clear=function(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},u.Builder.prototype.forceDefaults=function(t){this.force_defaults=t},u.Builder.prototype.dataBuffer=function(){return this.bb},u.Builder.prototype.asUint8Array=function(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())},u.Builder.prototype.prep=function(t,e){t>this.minalign&&(this.minalign=t);for(var r=1+~(this.bb.capacity()-this.space+e)&t-1;this.space<r+t+e;){var n=this.bb.capacity();this.bb=u.Builder.growByteBuffer(this.bb),this.space+=this.bb.capacity()-n}this.pad(r)},u.Builder.prototype.pad=function(t){for(var e=0;e<t;e++)this.bb.writeInt8(--this.space,0)},u.Builder.prototype.writeInt8=function(t){this.bb.writeInt8(--this.space,t)},u.Builder.prototype.writeInt16=function(t){this.bb.writeInt16(this.space-=2,t)},u.Builder.prototype.writeInt32=function(t){this.bb.writeInt32(this.space-=4,t)},u.Builder.prototype.writeInt64=function(t){this.bb.writeInt64(this.space-=8,t)},u.Builder.prototype.writeFloat32=function(t){this.bb.writeFloat32(this.space-=4,t)},u.Builder.prototype.writeFloat64=function(t){this.bb.writeFloat64(this.space-=8,t)},u.Builder.prototype.addInt8=function(t){this.prep(1,0),this.writeInt8(t)},u.Builder.prototype.addInt16=function(t){this.prep(2,0),this.writeInt16(t)},u.Builder.prototype.addInt32=function(t){this.prep(4,0),this.writeInt32(t)},u.Builder.prototype.addInt64=function(t){this.prep(8,0),this.writeInt64(t)},u.Builder.prototype.addFloat32=function(t){this.prep(4,0),this.writeFloat32(t)},u.Builder.prototype.addFloat64=function(t){this.prep(8,0),this.writeFloat64(t)},u.Builder.prototype.addFieldInt8=function(t,e,r){!this.force_defaults&&e==r||(this.addInt8(e),this.slot(t))},u.Builder.prototype.addFieldInt16=function(t,e,r){!this.force_defaults&&e==r||(this.addInt16(e),this.slot(t))},u.Builder.prototype.addFieldInt32=function(t,e,r){!this.force_defaults&&e==r||(this.addInt32(e),this.slot(t))},u.Builder.prototype.addFieldInt64=function(t,e,r){!this.force_defaults&&e.equals(r)||(this.addInt64(e),this.slot(t))},u.Builder.prototype.addFieldFloat32=function(t,e,r){!this.force_defaults&&e==r||(this.addFloat32(e),this.slot(t))},u.Builder.prototype.addFieldFloat64=function(t,e,r){!this.force_defaults&&e==r||(this.addFloat64(e),this.slot(t))},u.Builder.prototype.addFieldOffset=function(t,e,r){!this.force_defaults&&e==r||(this.addOffset(e),this.slot(t))},u.Builder.prototype.addFieldStruct=function(t,e,r){e!=r&&(this.nested(e),this.slot(t))},u.Builder.prototype.nested=function(t){if(t!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")},u.Builder.prototype.notNested=function(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")},u.Builder.prototype.slot=function(t){this.vtable[t]=this.offset()},u.Builder.prototype.offset=function(){return this.bb.capacity()-this.space},u.Builder.growByteBuffer=function(t){var e=t.capacity();if(3221225472&e)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");var r=e<<1,n=u.ByteBuffer.allocate(r);return n.setPosition(r-e),n.bytes().set(t.bytes(),r-e),n},u.Builder.prototype.addOffset=function(t){this.prep(u.SIZEOF_INT,0),this.writeInt32(this.offset()-t+u.SIZEOF_INT)},u.Builder.prototype.startObject=function(t){this.notNested(),null==this.vtable&&(this.vtable=[]),this.vtable_in_use=t;for(var e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()},u.Builder.prototype.endObject=function(){if(null==this.vtable||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);for(var t=this.offset(),e=this.vtable_in_use-1;0<=e&&0==this.vtable[e];e--);for(var r=e+1;0<=e;e--)this.addInt16(0!=this.vtable[e]?t-this.vtable[e]:0);this.addInt16(t-this.object_start);var n=(r+2)*u.SIZEOF_SHORT,i=(this.addInt16(n),0),o=this.space;t:for(e=0;e<this.vtables.length;e++){var a=this.bb.capacity()-this.vtables[e];if(n==this.bb.readInt16(a)){for(var s=u.SIZEOF_SHORT;s<n;s+=u.SIZEOF_SHORT)if(this.bb.readInt16(o+s)!=this.bb.readInt16(a+s))continue t;i=this.vtables[e];break}}return i?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,i-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t},u.Builder.prototype.finish=function(t,e,r){r=r?u.SIZE_PREFIX_LENGTH:0;if(e){var n=e;if(this.prep(this.minalign,u.SIZEOF_INT+u.FILE_IDENTIFIER_LENGTH+r),n.length!=u.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+u.FILE_IDENTIFIER_LENGTH);for(var i=u.FILE_IDENTIFIER_LENGTH-1;0<=i;i--)this.writeInt8(n.charCodeAt(i))}this.prep(this.minalign,u.SIZEOF_INT+r),this.addOffset(t),r&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)},u.Builder.prototype.finishSizePrefixed=function(t,e){this.finish(t,e,!0)},u.Builder.prototype.requiredField=function(t,e){t=this.bb.capacity()-t,t-=this.bb.readInt32(t);if(0==this.bb.readInt16(t+e))throw new Error("FlatBuffers: field "+e+" must be set")},u.Builder.prototype.startVector=function(t,e,r){this.notNested(),this.vector_num_elems=e,this.prep(u.SIZEOF_INT,t*e),this.prep(r,t*e)},u.Builder.prototype.endVector=function(){return this.writeInt32(this.vector_num_elems),this.offset()},u.Builder.prototype.createString=function(t){if(t instanceof Uint8Array)var e=t;else for(var e=[],r=0;r<t.length;){var n=t.charCodeAt(r++);(n=n<55296||56320<=n?n:(n<<10)+t.charCodeAt(r++)+-56613888)<128?e.push(n):(n<2048?e.push(n>>6&31|192):(n<65536?e.push(n>>12&15|224):e.push(n>>18&7|240,n>>12&63|128),e.push(n>>6&63|128)),e.push(63&n|128))}this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length);for(var r=0,i=this.space,o=this.bb.bytes();r<e.length;r++)o[i++]=e[r];return this.endVector()},u.Builder.prototype.createLong=function(t,e){return u.Long.create(t,e)},u.ByteBuffer=function(t){this.bytes_=t,this.position_=0},u.ByteBuffer.allocate=function(t){return new u.ByteBuffer(new Uint8Array(t))},u.ByteBuffer.prototype.clear=function(){this.position_=0},u.ByteBuffer.prototype.bytes=function(){return this.bytes_},u.ByteBuffer.prototype.position=function(){return this.position_},u.ByteBuffer.prototype.setPosition=function(t){this.position_=t},u.ByteBuffer.prototype.capacity=function(){return this.bytes_.length},u.ByteBuffer.prototype.readInt8=function(t){return this.readUint8(t)<<24>>24},u.ByteBuffer.prototype.readUint8=function(t){return this.bytes_[t]},u.ByteBuffer.prototype.readInt16=function(t){return this.readUint16(t)<<16>>16},u.ByteBuffer.prototype.readUint16=function(t){return this.bytes_[t]|this.bytes_[t+1]<<8},u.ByteBuffer.prototype.readInt32=function(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24},u.ByteBuffer.prototype.readUint32=function(t){return this.readInt32(t)>>>0},u.ByteBuffer.prototype.readInt64=function(t){return new u.Long(this.readInt32(t),this.readInt32(t+4))},u.ByteBuffer.prototype.readUint64=function(t){return new u.Long(this.readUint32(t),this.readUint32(t+4))},u.ByteBuffer.prototype.readFloat32=function(t){return u.int32[0]=this.readInt32(t),u.float32[0]},u.ByteBuffer.prototype.readFloat64=function(t){return u.int32[u.isLittleEndian?0:1]=this.readInt32(t),u.int32[u.isLittleEndian?1:0]=this.readInt32(t+4),u.float64[0]},u.ByteBuffer.prototype.writeInt8=function(t,e){this.bytes_[t]=e},u.ByteBuffer.prototype.writeUint8=function(t,e){this.bytes_[t]=e},u.ByteBuffer.prototype.writeInt16=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8},u.ByteBuffer.prototype.writeUint16=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8},u.ByteBuffer.prototype.writeInt32=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24},u.ByteBuffer.prototype.writeUint32=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24},u.ByteBuffer.prototype.writeInt64=function(t,e){this.writeInt32(t,e.low),this.writeInt32(t+4,e.high)},u.ByteBuffer.prototype.writeUint64=function(t,e){this.writeUint32(t,e.low),this.writeUint32(t+4,e.high)},u.ByteBuffer.prototype.writeFloat32=function(t,e){u.float32[0]=e,this.writeInt32(t,u.int32[0])},u.ByteBuffer.prototype.writeFloat64=function(t,e){u.float64[0]=e,this.writeInt32(t,u.int32[u.isLittleEndian?0:1]),this.writeInt32(t+4,u.int32[u.isLittleEndian?1:0])},u.ByteBuffer.prototype.getBufferIdentifier=function(){if(this.bytes_.length<this.position_+u.SIZEOF_INT+u.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");for(var t="",e=0;e<u.FILE_IDENTIFIER_LENGTH;e++)t+=String.fromCharCode(this.readInt8(this.position_+u.SIZEOF_INT+e));return t},u.ByteBuffer.prototype.__offset=function(t,e){t-=this.readInt32(t);return e<this.readInt16(t)?this.readInt16(t+e):0},u.ByteBuffer.prototype.__union=function(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t},u.ByteBuffer.prototype.__string=function(t,e){t+=this.readInt32(t);var r=this.readInt32(t),n="",i=0;if(t+=u.SIZEOF_INT,e===u.Encoding.UTF8_BYTES)return this.bytes_.subarray(t,t+r);for(;i<r;){var o,a,s=this.readUint8(t+i++);(s=s<192?s:(o=this.readUint8(t+i++),s<224?(31&s)<<6|63&o:(a=this.readUint8(t+i++),s<240?(15&s)<<12|(63&o)<<6|63&a:(7&s)<<18|(63&o)<<12|(63&a)<<6|63&this.readUint8(t+i++))))<65536?n+=String.fromCharCode(s):(s-=65536,n+=String.fromCharCode(55296+(s>>10),56320+(1023&s)))}return n},u.ByteBuffer.prototype.__indirect=function(t){return t+this.readInt32(t)},u.ByteBuffer.prototype.__vector=function(t){return t+this.readInt32(t)+u.SIZEOF_INT},u.ByteBuffer.prototype.__vector_len=function(t){return this.readInt32(t+this.readInt32(t))},u.ByteBuffer.prototype.__has_identifier=function(t){if(t.length!=u.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+u.FILE_IDENTIFIER_LENGTH);for(var e=0;e<u.FILE_IDENTIFIER_LENGTH;e++)if(t.charCodeAt(e)!=this.readInt8(this.position_+u.SIZEOF_INT+e))return!1;return!0},u.ByteBuffer.prototype.createLong=function(t,e){return u.Long.create(t,e)},this.flatbuffers=u}])},"object"==o(r)&&"object"==o(t)?t.exports=e():void 0!==(e="function"==typeof(e=e)?e.apply(r,[]):e)&&(t.exports=e)}.call(this,e(8)(t))},function(t,e,r){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var h=r(48),r=function(){function e(){!function(t){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this._canvasToolA=document.createElement("canvas"),this._canvasToolB=document.createElement("canvas"),this._ctxToolA=this._canvasToolA.getContext("2d"),this._ctxToolB=this._canvasToolB.getContext("2d"),this._albedoVT=document.createElement("canvas"),this._normalVT=document.createElement("canvas"),this._emissiveVT=document.createElement("canvas"),this._ormVT=document.createElement("canvas"),this._albedoCtx=this._albedoVT.getContext("2d"),this._normalCtx=this._normalVT.getContext("2d"),this._emissiveCtx=this._emissiveVT.getContext("2d"),this._ormCtx=this._ormVT.getContext("2d"),this._cache=new Map}var t=e;return n(t.prototype,[{key:"toRGB",value:function(t,e){for(var r,e=e.canvas,n=e.width,i=e.height,o=new Uint8Array(n*i*3),a=0;a<i;a++)for(var s=0;s<n;s++)o[3*(r=a*n+s)]=t[4*r],o[3*r+1]=t[4*r+1],o[3*r+2]=t[4*r+2];return o}},{key:"getAlbedoVT",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"rgba",e=this._albedoCtx.getImageData(0,0,this._albedoVT.width,this._albedoVT.height);return"rgb"===t?this.toRGB(e.data,this._albedoCtx):new Uint8Array(e.data.buffer)}},{key:"getNormalVT",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"rgba",e=this._normalCtx.getImageData(0,0,this._normalVT.width,this._normalVT.height);return"rgb"===t?this.toRGB(e.data,this._normalCtx):new Uint8Array(e.data.buffer)}},{key:"getEmissiveVT",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"rgba",e=this._emissiveCtx.getImageData(0,0,this._emissiveVT.width,this._emissiveVT.height);return"rgb"===t?this.toRGB(e.data,this._emissiveCtx):new Uint8Array(e.data.buffer)}},{key:"getOrmVT",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"rgba",e=this._ormCtx.getImageData(0,0,this._ormVT.width,this._ormVT.height);return"rgb"===t?this.toRGB(e.data,this._ormCtx):new Uint8Array(e.data.buffer)}},{key:"fetchImage",value:function(r){var t=this._cache.get(r);return t||(t=new Promise(function(t){var e=new Image;e.crossOrigin="anonymous",e.onload=function(){t(e)},e.onerror=function(){t()},e.src=r}),this._cache.set(r,t)),t}},{key:"fetchImages",value:function(t){var e=this;return t.map(function(t){return e.fetchImage(t)})}},{key:"setSize",value:function(t,e,r){h.SetSize(this._canvasToolA,t,e),h.SetSize(this._canvasToolB,t,e),h.SetSize(this._albedoVT,t,e*r),h.SetSize(this._normalVT,t,e*r),h.SetSize(this._emissiveVT,t,e*r),h.SetSize(this._ormVT,t,e*r)}},{key:"buildVT",value:function(s,t,u,c){var l=this,f=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"#fff";return Promise.all(t).then(function(t){for(var e=l._canvasToolA,r=e.width,n=e.height,i=0,o=t.length;i<o;i++){s.save();var a=t[i];c&&(s.globalCompositeOperation="lighter"),a=(a=a?(c&&(a=h.MultiplyBlendImage(l._ctxToolB,a,r,n,c)),h.FilpImage(l._ctxToolA,a,r,n)):c?(a=h.ClearCanvas(l._ctxToolB,f),h.MultiplyBlendImage(l._ctxToolA,a,r,n,c)):h.ClearCanvas(l._ctxToolA,f),h.MultiplyBlendCanvas(l._ctxToolA,u[i],r,n)),s.drawImage(a,0,n*i,r,n),s.restore()}return s.canvas})}},{key:"buildAlbedoVT",value:function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"#000",n=this.fetchImages(t),i=this._albedoCtx;return h.ClearCanvas(i,r),this.buildVT(i,n,e)}},{key:"buildEmissiveVT",value:function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"#000",n=this.fetchImages(t),i=this._emissiveCtx;return h.ClearCanvas(i,r),this.buildVT(i,n,e)}},{key:"buildNormalVT",value:function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"#00f",n=this.fetchImages(t),i=this._normalCtx;return h.ClearCanvas(i,r),this.buildVT(i,n,e,null,"rgb(127, 127, 255)")}},{key:"buildOrmVT",value:function(t,e,r,n,i,o){var a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"#000",s=this.fetchImages(t),u=this.fetchImages(e),c=this.fetchImages(r),l=this._ormCtx;return h.ClearCanvas(l,a),Promise.all([this.buildVT(l,s,n,"#f00"),this.buildVT(l,u,i,"#0f0"),this.buildVT(l,c,o,"#00f")])}},{key:"dispose",value:function(){this._cache.forEach(function(t){return t.then(function(t){t&&t.src&&(t.src="")})}),this._cache.clear()}}]),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.exports=r},function(t,e){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=function(){function e(){!function(t){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this)}var t=e,r=[{key:"SetSize",value:function(t,e,r){t.width=e,t.height=r}},{key:"ClearCanvas",value:function(t,e){return t.save(),t.fillStyle=e,t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore(),t.canvas}},{key:"MultiplyBlendCanvas",value:function(t,e,r,n){return t.save(),t.globalCompositeOperation="multiply",t.fillStyle=e,t.fillRect(0,0,r,n),t.restore(),t.canvas}},{key:"CopyImage",value:function(t,e,r,n){return t.save(),t.drawImage(e,0,0,r,n),t.restore(),t.canvas}},{key:"FilpImage",value:function(t,e,r,n){return t.save(),t.scale(1,-1),t.drawImage(e,0,-1*n,r,n),t.restore(),t.canvas}},{key:"MultiplyBlendImage",value:function(t,e,r,n,i){return t.save(),t.fillStyle=i,t.fillRect(0,0,r,n),t.globalCompositeOperation="multiply",t.drawImage(e,0,0,r,n),t.restore(),t.canvas}}];return null&&n(t.prototype,null),n(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.exports=r},function(t,e){function n(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)),n}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){!function(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var i=function(){function e(){!function(t){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this)}var t=e;return r(t.prototype,[{key:"geojson2datav",value:function(t){for(var e,r,n,i,o=[],a=0,s=t.features.length;a<s;a++)if((e=t.features[a]).type&&e.geometry)switch(r=e.geometry.coordinates,(i=e.properties||{}).id=void 0===i.id?a:i.id,e.geometry.type){case"Point":n=f({lng:r[0],lat:r[1],altitude:r[2]||0},i),o.push(n);break;case"MultiPoint":for(var u=r.length,c=0;c<u;c++)n=f({lng:r[c][0],lat:r[c][1],altitude:r[c][2]||0},i),o.push(n);break;case"LineString":n=f({geometry:{type:"LineString",coordinates:r.map(function(t){return[t[0],t[1],t[2]||0]})}},i),o.push(n);break;case"MultiLineString":n=f({geometry:{type:"MultiLineString",coordinates:r=r.map(function(t){return t.map(function(t){return[t[0],t[1],t[2]||0]})})}},i),o.push(n);break;case"Polygon":for(var l=0;l<r.length;l++)r[l]=r[l].map(function(t){return[t[0],t[1],t[2]||0]});n=f({geometry:{type:"Polygon",coordinates:r}},i),o.push(n);break;case"MultiPolygon":n=f({geometry:{type:"MultiPolygon",coordinates:r=r.map(function(t){return t.map(function(t){return t.map(function(t){return[t[0],t[1],t[2]||0]})})})}},i),o.push(n)}return o}},{key:"datav2geojson",value:function(t){for(var e,r,n=["lng","lat","altitude","geometry"],i=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],o={type:"FeatureCollection",features:[]},a=0,s=t.length;a<s;a++){if(e=t[a],r={},Object.keys(e).forEach(function(t){-1===n.indexOf(t)&&(r[t]=e[t])}),e.geometry){if(f=e.geometry.type,-1===i.indexOf(f)){console.error("Invalid type for geojson: ",f);continue}f={type:"Feature",geometry:e.geometry,properties:r}}else var u=e.lng,c=e.lat,l=e.altitude,f={type:"Feature",geometry:{type:"Point",coordinates:l?[u||0,c||0,l]:[u||0,c||0]},properties:r};o.features.push(f)}return o}}]),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.exports=i},function(t,e){function i(t){return(i="function"==typeof Symbol&&"symbol"==A(Symbol.iterator)?function(t){return A(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":A(t)})(t)}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function l(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(r);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n?(t=o(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t.exports=function(a){var s=document.createElement("canvas"),u=s.getContext("2d");return function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&n(t,e)}(o,a.Sprite);var t,i=l(o);function o(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:10,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"rgba(255, 255, 255, 1)";return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this,new a.SpriteMaterial({map:new a.Texture,depthTest:!1}))).material.toneMapped=!1,t.material.sizeAttenuation=!0,t.material.needsUpdate=!0,t._text="".concat(e),t._height=r,t._width=r,t._color=n,t._layout="center",t._fontFamily="Microsoft YaHei,微软雅黑",t._fontSize=120,t._fontWeight="bold",t._canvas=document.createElement("canvas"),t._canvas.width=1,t._canvas.height=1,t._texture=t.material.map,t._texture.minFilter=a.NearestMipmapNearestFilter,t._texture.encoding=a.sRGBEncoding,t._texture.anisotropy=64,t}return r((t=o).prototype,[{key:"sizeAttenuation",set:function(t){t!==this.material.sizeAttenuation&&(this.material.sizeAttenuation=t,this.material.needsUpdate=!0)}},{key:"anisotropy",set:function(t){this._texture.anisotropy=t}},{key:"text",get:function(){return this._text},set:function(t){this._text=t}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._width=this._height*this._canvas.width/this._canvas.height,this.scale.set(this._width,this._height,1),this.visible=0!==t&&0!==this.opacity}},{key:"width",get:function(){return this._width}},{key:"opacity",get:function(){return this.material.opacity},set:function(t){this.material.opacity=t,this.visible=0!==t&&0!==this.height}},{key:"color",get:function(){return this._color},set:function(t){this._color=t}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily=t}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize=t}},{key:"fontWeight",get:function(){return this._fontWeight},set:function(t){this._fontWeight=t}},{key:"layout",get:function(){return this._layout},set:function(t){this._layout=t}},{key:"needsUpdate",set:function(t){t&&this._genCanvas()}},{key:"_genCanvas",value:function(){var e=this,r=u,t="".concat(this.fontWeight," ").concat(this.fontSize,"px ").concat(this.fontFamily),n=this.text.split("\n"),i=(r.font=t,Math.max.apply(Math,function(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}()||function(t){if(t){if("string"==typeof t)return c(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(e="Object"===e&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?c(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(n.map(function(t){return r.measureText(t).width})))+4),o=1.5*this.fontSize*n.length+4,a=(s.width=i,s.height=o,r.font=t,r.textAlign="center",r.textBaseline="middle",r.fillStyle=this.color,2),t=(n.forEach(function(t){r.fillText(t,.5*i,a+.75*e.fontSize),a+=1.5*e.fontSize}),this._canvas),r=t.getContext("2d"),n=(t.width=i*("center"===this._layout?1:2),t.height=o,"right"===this._layout?i:0);r.drawImage(s,n,0,i,o),this._texture.image=t,this._texture.needsUpdate=!0,this._width=this._height*t.width/t.height,this.scale.set(this._width,this._height,1)}},{key:"dispose",value:function(){this.material.dispose(),this._texture.image=null,this._texture.dispose(),this.geometry.dispose()}}]),Object.defineProperty(t,"prototype",{writable:!1}),o}()}}])}),r.exports});