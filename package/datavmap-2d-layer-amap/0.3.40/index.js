// env=undefined => env=publish 
Cube("datav:/com/datavmap-2d-layer-amap/0.3.40/css.css", [], function(m){m.exports=".amap-indoormap-floorbar-control{position:absolute;margin:auto 0;bottom:165px;right:12px;width:35px;text-align:center;line-height:1.3em;overflow:hidden;padding:0 2px;z-index:10000}";return m.exports});;
Cube("datav:/com/datavmap-2d-layer-amap/0.3.40/amapLayer.js",["datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/safely-merge/1.0.1");return c("datav:/com/datavmap-2d-layer-amap/0.3.40/css.css",""),a.exports=function(a){var b=a.BaseLayer,c={amapVersion:"1.4.15",isTraffic:!1,standardStyleTemplate:"blue",isCustom:!1,customMapStyle:""};return function(b){function i(a){d(this,i);var b=e(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return b.options=h(c,a),b.options.visibility=!0,b.options.key=a.mapKey||"f6ce2bfb8de7c1ec5cbe49d47a7ac207",b.onMapMove=b.onMapMove.bind(b),b.setZoomAndCenter=b.setZoomAndCenter.bind(b),b.initAMap=b.initAMap.bind(b),b.updateFilter=b.updateFilter.bind(b),b}return f(i,b),g(i,[{key:"init",value:function(){var a=this,b=this.map;b.setMinZoom(3),b.setMaxZoom(19),b._animatingZoom=!1,b._zoomAnimated=!1,b.options.zoomAnimation=!1,this.initContainer(),this.loadAmapScript(this.options).then(function(){a.initAMap(),a.registerMapEvent()})}},{key:"loadAmapScript",value:function(a){var b="AMapOnLoad"+Math.floor(65536*(1+Math.random())).toString(16).substring(1),c=document.createElement("script");return c.type="text/javascript",c.async=!0,c.defer=!0,c.src="https://webapi.amap.com/maps?v="+this.options.amapVersion+"&key="+(a.mapKey||this.options.key)+"&plugin=AMap.ToolBar&callback="+b,document.head.appendChild(c),new Promise(function(a,d){window[b]=function(){a(window.AMap)},c.onerror=function(a){return d(a)}})}},{key:"initContainer",value:function(){this.pane=this.map.getPane("tilePane");var b=this.map.getSize();this.amapContainer=document.createElement("div"),this.amapContainer.style.position="absolute",this.amapContainer.style.top=0,this.amapContainer.style.left=0,this.amapContainer.style.width=b.x+"px",this.amapContainer.style.height=b.y+"px",this.amapContainer.style.pointerEvents="none",this.amapContainer.style.zIndex=0,this.amapContainer.style.backgroundColor="rgba(0,0,0,0)";var c=a.DomUtil.getPosition(this.map.getPane("mapPane"));c&&a.DomUtil.setTransform(this.amapContainer,{x:-c.x,y:-c.y}),this.pane.appendChild(this.amapContainer)}},{key:"initAMap",value:function(a){var b=this,c=a||this.options,d=this,e=d.map,f=e.getZoom(),g=e.getCenter(),h="amap://styles/"+(c.isCustom?c.customMapStyle:c.standardStyleTemplate),i=[];Object.keys(c.amapFeatures).forEach(function(a){c.amapFeatures[a]&&i.push(a)});var j=c.isTraffic;d.amap=new AMap.Map(d.amapContainer,{resizeEnable:!0,showIndoorMap:!0,layers:[],features:i,center:[g.lng,g.lat],showBuildingBlock:!1,expandZoomRange:!0,animateEnable:!1,jogEnable:!1,viewMode:"3D",zoom:f,mapStyle:h}),d.updateFilter(),d.traffic=new AMap.TileLayer.Traffic({autoRefresh:!0}),j&&d.amap.add(d.traffic),d.amap.on("complete",function(){d.currentControls=d.amapContainer.querySelector(".amap-controls"),b.map.getContainer().appendChild(d.currentControls),d.currentControls.onclick=function(a){d.parentIndex.emit("global_var",{indoormapFloor:a.target.innerText})},d.options.visibility?d.show():d.hide()})}},{key:"setZoomAndCenter",value:function(){if(this.amap){var a=this.map.getZoom(),b=this.map.getCenter();this.amap.setZoomAndCenter(a,[b.lng,b.lat])}}},{key:"onMapMove",value:function(){var b=this.map;if(this.amapContainer){var c=b.getSize();this.amapContainer.style.width=c.x+"px",this.amapContainer.style.height=c.y+"px";var d=a.DomUtil.getPosition(this.map.getPane("mapPane"));d&&a.DomUtil.setTransform(this.amapContainer,{x:-d.x,y:-d.y}),this.setZoomAndCenter()}}},{key:"registerMapEvent",value:function(){this.map.on("move",this.onMapMove)}},{key:"removeMapEvent",value:function(){this.map.off("move",this.onMapMove)}},{key:"onUpdateOptions",value:function(a){var b=this;if(a.isFilter&&this.amapContainer&&(a.filter.brightness!=this.options.brightness||a.filter.contrast!=this.options.contrast||a.filter.grayscale!=this.options.grayscale||a.filter.hueRotate!=this.options.hueRotate||a.filter.invert!=this.options.invert||a.filter.saturate!=this.options.saturate||a.filter.sepia!=this.options.sepia))return this.updateFilter(),this.options.brightness=a.filter.brightness,this.options.contrast=a.filter.contrast,this.options.grayscale=a.filter.grayscale,this.options.hueRotate=a.filter.hueRotate,this.options.invert=a.filter.invert,this.options.saturate=a.filter.saturate,this.options.sepia=a.filter.sepia,void(this.options=h(this.options,a));a.isFilter||(this.amapContainer.style.filter=""),this.options=h(this.options,a),this.amap&&this.amap.clearMap&&this.amap.destroy&&(this.amap.clearMap(),this.amap.destroy(),this.currentControls&&this.map.getContainer&&this.map.getContainer().querySelector(".amap-controls")&&this.map.getContainer().removeChild(this.currentControls)),this.options.mapKey&&this.options.key!==this.options.mapKey?(this.options.key=this.options.mapKey,this.loadAmapScript(this.options).then(function(){b.initAMap(),b.registerMapEvent()})):(this.initAMap(),this.registerMapEvent());var c=this.options.isTraffic;c?this.amap.add(this.traffic):this.amap.remove(this.traffic)}},{key:"updateFilter",value:function(){var a=this.options;if(a.isFilter&&this.amapContainer){var b="brightness("+this.toPercent(a.filter.brightness)+") contrast("+this.toPercent(a.filter.contrast)+") grayscale("+this.toPercent(a.filter.grayscale)+") hue-rotate("+a.filter.hueRotate+"deg) invert("+this.toPercent(a.filter.invert)+") saturate("+this.toPercent(a.filter.saturate)+") sepia("+this.toPercent(a.filter.sepia)+") blur("+0+"px)";this.amapContainer.style.filter=b}}},{key:"toPercent",value:function(a){return(Math.round(1e4*a)/100).toFixed(2)+"%"}},{key:"show",value:function(){this.options.visibility=!0,this.amapContainer&&this.amapContainer.style&&(this.amapContainer.style.opacity=1)}},{key:"hide",value:function(){this.options.visibility=!1,this.amapContainer&&this.amapContainer.style&&(this.amapContainer.style.opacity=0)}},{key:"onRemove",value:function(){this.removeMapEvent(),this.amap&&this.amap.clearMap&&this.amap.destroy&&(this.amap.clearMap(),this.amap.destroy(),this.currentControls&&this.map.getContainer().removeChild(this.currentControls),this.amapContainer.remove()),this.amapContainer&&this.pane.removeChild(this.amapContainer),this.map.setMinZoom(0),this.map.setMaxZoom(20),this.map._animatingZoom=!0,this.map._zoomAnimated=!0,this.map.options.zoomAnimation=!0}}]),i}(b)},a.exports});;
Cube("datav:/com/datavmap-2d-layer-amap/0.3.40",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/com/datavmap-2d-layer-amap/0.3.40/amapLayer.js"),k={isTraffic:!1},l=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=i(k,c),f.options.visibility=!0,f.container="string"===typeof a?document.querySelector(a):a,f.map=null,f}return f(b,a),g(b,[{key:"addTo",value:function(a){this.map=a,this.init()}},{key:"init",value:function(){var a=j(this.map.L);this.layer=new a(this.options),this.layer.parentIndex=this,this.layer.addTo(this.map)}},{key:"show",value:function(){this.options.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.options.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"remove",value:function(){this.layer&&this.layer.remove&&this.layer.remove(),this.layer=null,this._data=null}},{key:"updateOptions",value:function(a){this.options=i(this.options,a),this.layer&&this.layer.updateOptions(this.options)}}]),b}(h);return a.exports=l,a.exports});