// env=undefined => env=publish 
Cube("datav:/com/datav-2dmap-area/3.0.40/config",[],function(a,o,e,r,i,t){return a.exports={DEFAULT_OPTIONS:{renderer:"canvas",visibility:!0,general:{zoomRange:[0,18],minZoom:0,maxZoom:22,opacity:1},graph:{autoComplete:!0},interaction:{graph:{isDrill:!1}}}},a.exports});;
Cube("datav:/com/datav-2dmap-area/3.0.40/src/areaLayer",[],function(e,t,o,r,i,n){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(t,e){var o,r=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,o)),r}function f(r){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?p(Object(i),!0).forEach(function(e){var t,o;t=r,o=i[e=e],e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})}return r}function g(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,o){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=P(e)););return e}(e,t);if(r)return(r=Object.getOwnPropertyDescriptor(r,t)).get?r.get.call(arguments.length<3?e:o):r.value}).apply(this,arguments)}function v(e,t){return(v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function b(o){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=P(o),t=(e=r?(e=P(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}return e.exports=function(e){var s=e.L,l=e.map,t=e.Layer,o=e.GeoJson,r=e.Utils,d=e.GuiUtils,i=r.getDashArray,C=r.mergeOptions,n=r.geojsonBBox,u=r.polylabel,y=r._;function h(e){for(var t=0,o=0;o<e.length;o++)for(var r=e[o],i=0,n=r.length,a=n-1;i<n;a=i++)t+=(r[i][0]-r[a][0])*(r[i][1]+r[a][1])*(o?-1:1);return Math.abs(t)/2}e=c,r=t;if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&v(e,r);var a,p=b(c);function c(e){var t;if(this instanceof c)return(t=p.call(this)).addTo(l),t.options=C({},e),t.options.general.minZoom=e.general.zoomRange[0],t.options.general.maxZoom=e.general.zoomRange[1],t.options.visibility=!0,t.init(),t;throw new TypeError("Cannot call a class as a function")}return e=c,(r=[{key:"init",value:function(){this.popups={},this.data=[],this.mappingData=[],this.drill_data={defaultArea:null,adcodeKeys:null,all_topojson:null,all_geojson:null,root_adcode:null},this.onRender=this.onRender.bind(this),this.dataProcess=this.dataProcess.bind(this),this.getGeojsonStyle=this.getGeojsonStyle.bind(this),this.getMappingStyle=this.getMappingStyle.bind(this);var e=this.getGeojsonStyle();this.geojsonLayer=new o(e),(this.geojsonLayer.layer=this).addLayer(this.geojsonLayer)}},{key:"render",value:function(e){var t=[];e&&e.length&&(t=e),this.data=t,this.dataProcess()}},{key:"setGeojson",value:function(e){if(this._geojson=null,e&&e.features){for(var t={type:"FeatureCollection",features:[]},o=0;o<e.features.length;o++){var r=e.features[o];r.type&&"Feature"==r.type&&r.geometry&&("Polygon"==r.geometry.type||"MultiPolygon"==r.geometry.type)&&t.features.push(r)}this._geojson=t;var i,n,a=!1;if(this.mappingData)for(i=0;i<this.mappingData.length;i++)if((n=this.mappingData[i]).geometry&&("Polygon"==n.geometry.type||"MultiPolygon"==n.geometry.type)){a=!0;break}this._geojson=a?null:t,this.dataProcess()}}},{key:"setTopojson",value:function(e){var t,o,r;for(t in this.drill_data.adcodeKeys={},e){for(var i=e[t].objects.collection.geometries,n=[],a=0;a<i.length;a++){i[a].properties.adchar&&"JD"===i[a].properties.adchar&&(i[a].properties.adcode="100000_JD");var p=i[a].properties.adcode;n.push(p),this.drill_data.adcodeKeys[p]={parent:t,properties:i[a].properties}}this.drill_data.adcodeKeys[t]||(this.drill_data.adcodeKeys[t]={}),this.drill_data.adcodeKeys[t].children=n,t==this.drill_data.adcodeKeys[t].parent&&(this.drill_data.root_adcode=t)}for(r in this.drill_data.all_geojson={},e)o=e[r],(o=s.topojson.feature(o,o.objects.collection)).features=o.features.filter(function(e){var t=!0;return"district"===e.properties.level&&(t=!"".concat(e.properties.adcode).endsWith("00")),e.geometry&&("Polygon"===e.geometry.type||"MultiPolygon"===e.geometry.type)&&t}),this.drill_data.all_geojson[r]=o;this.dataProcess()}},{key:"dataProcess",value:function(){var e=!1,t=this.data;for(v=0;v<t.length;v++)if((p=t[v]).geometry&&("Polygon"==p.geometry.type||"MultiPolygon"==p.geometry.type)){e=!0;break}var o={type:"FeatureCollection",features:[]};if(e)for(v=0;v<t.length;v++){var r=t[v];!r.geometry||"Polygon"!=r.geometry.type&&"MultiPolygon"!=r.geometry.type||(r={type:"Feature",properties:{},geometry:r.geometry},o.features.push(r))}else if(this._geojson)this.mappingData=t,o=C({},this._geojson);else{var i=this.drill_data.adcodeKeys;if(!i)return;var n,a={};for(v=0;v<t.length;v++)(p=t[v]).adcode&&i[p.adcode]&&(a[p.adcode]=p);for(n in a){var p,s=i[(p=a[n]).adcode].parent;(!i[p.adcode]||i[p.adcode]&&s!=this.drill_data.root_adcode&&a[s]||!a[s]&&i[s].parent&&i[s].parent!=this.drill_data.root_adcode&&a[i[s].parent])&&delete a[p.adcode]}this.mappingData=[];var l=0;for(n in a)l++,this.mappingData.push(a[n]);if(0!==l){this.options.graph;var u,h=[],c=[];for(v=0;v<this.mappingData.length;v++){var f=this.mappingData[v].adcode,d=this.drill_data.adcodeKeys[f].parent;-1<c.indexOf(d)||c.push(d)}for(v=0;v<c.length;v++)i[c[v]].parent&&i[c[v]].parent!=this.drill_data.root_adcode&&-1==c.indexOf(i[c[v]].parent)&&c.push(i[c[v]].parent);for(var y={type:"FeatureCollection",features:[]},g=0;g<c.length;g++)for(var m=this.drill_data.all_geojson[c[g]],v=0;v<m.features.length;v++)if(u=m.features[v],!(-1<h.indexOf(u.properties.adcode))){var b=i[u.properties.adcode].children,P=!1;if(b)for(var w=0;w<b.length;w++)if(a[b[w]]){P=!0;break}P||(h.push(u.properties.adcode),y.features.push(u))}var O=[],S={type:"FeatureCollection",features:[]};for(v=0;v<y.features.length;v++){f=(u=y.features[v]).properties.adcode;for(var j=0;j<h.length;j++)i[f].children&&-1<i[f].children.indexOf(h[j])||-1<O.indexOf(f)||(O.push(f),S.features.push(u))}var x,_={};for(v=0;v<O.length;v++)_[x=i[O[v]].parent]||(_[x]=0),_[x]++;for(v=0;v<S.features.length;v++)1<_[f=(u=S.features[v]).properties.adcode]||o.features.push(u)}}var k=this.getGeojsonStyle(this.mappingData);this.geojsonLayer.setOptions(k),this.geojsonLayer.setData(o),this.onRender(!0)}},{key:"updateOptions",value:function(e){var t=C({},this.options);this.options=C(this.options,e),this.options.general.minZoom=e.general.zoomRange[0],this.options.general.maxZoom=e.general.zoomRange[1],this.infoPopup&&(this.infoPopup&&!this.options.popupStyle.isShow&&this.infoPopup.remove(),s.customPopup.updatePopupStyle(this.infoPopup,this.convertToRootPopupStyle(this.options.popupStyle))),t.graph.autoComplete!=this.options.graph.autoComplete?this.dataProcess():(e=this.getGeojsonStyle(),this.geojsonLayer.setOptions(e),this.onRender())}},{key:"getGeojsonStyle",value:function(){this.options.mappingStyle=this.getMappingStyle();var e=this.options,t=e.graph,o=e.label,e=e.interaction,t=t.lineStyle,r=y.get(this.options,"graph.colorMapping");return{interaction:e,style:{fill:!0,fillRule:"evenodd",fillColor:r.mapping?r.scale.abnormal:r.fixed,fillOpacity:1,stroke:!0,strokeColor:t.strokeColor,weight:t.weight,lineJoin:"round",lineCap:"round",dashArray:i(t.dashArray)},mappingStyle:this.options.mappingStyle,label:o}}},{key:"getMappingStyle",value:function(){for(var e,t,o,r=this.options.graph,i=d.validateCustomStyle,n=y.get(this.options,"condition.condition"),a=y.get(d,"scale.color"),p=a({config:y.get(this.options,"graph.colorMapping"),data:this.mappingData,field:"colorField"}),s=a({config:y.get(this.options,"graph.texture.colorMapping"),data:this.mappingData,field:"textureColorField"}),l=y.get(d,"scale.marker")({config:y.get(this.options,"graph.texture.markerMapping"),data:this.mappingData,field:"textureShapeField"}),u={},h=0;h<this.mappingData.length;h++){var c,f={};if((c=C({},this.mappingData[h])).adcode){if(t=(o=i({config:n,data:c,ruleKey:"rules"}))&&o[0]?o[0]:null,c.fillColor)f.fillColor=c.fillColor;else for(e=o.length-1;0<=e&&(t=o[e]).graph.show;e--)if(t.graph.fillColor.show){f.fillColor=t.graph.fillColor.value;break}for(e=o.length-1;0<=e&&(t=o[e]).graph.show;e--)if(t.graph.texture.show&&t.graph.texture.fillColor.show){f.textureColor=t.graph.texture.fillColor.value;break}for(e=o.length-1;0<=e&&(t=o[e]).graph.show;e--)if(t.graph.texture.show&&t.graph.texture.iconUrl.show){f.textureShape=t.graph.texture.iconUrl.value;break}for(e=o.length-1;0<=e&&(t=o[e]).graph.show;e--)if(t.graph.texture.show&&t.graph.texture.size.show){f.textureSize={width:t.graph.texture.size.width,height:t.graph.texture.size.height};break}f.hasOwnProperty("fillColor")||(f.fillColor=p(c.colorField)),r.texture.show&&(f.hasOwnProperty("textureColor")||(f.textureColor=s(c.textureColorField)),f.hasOwnProperty("textureShape")||(f.textureShape=l(c.textureShapeField)),f.hasOwnProperty("textureSize")||(f.textureSize={width:r.texture.size.width,height:r.texture.size.height})),u[c.adcode]=C(c,f)}}return u}},{key:"onClick",value:function(e){var t=this.options,o=t.popupStyle,t=t.interaction,r=e.feature,i=r.properties;t.graph.show&&t.graph.clickZoom.show&&(t=i.adcode,this.fitBounds(t,r)),o.isShow&&"click"===o.eventType&&this._openPopup(e)}},{key:"fitBounds",value:function(e,t){var o=this.options,r=o.mappingStyle,o=o.interaction;r=r[e]&&r[e].bounds?r[e].bounds:(e=[[(r=n(t))[1],r[0]],[r[3],r[2]]],this.featureBounds=e,l.isMapMoving=o.graph.clickZoom.show,t=o.graph.clickZoom.zoomPad-1,[[e[0][0]-(e[1][0]-e[0][0])*t/2,e[0][1]-(e[1][1]-e[0][1])*t/2],[e[1][0]+(e[1][0]-e[0][0])*t/2,e[1][1]+(e[1][1]-e[0][1])*t/2]]),l.fitBounds(r,{animate:!1})}},{key:"onMouseOver",value:function(e){var t=this.options.popupStyle;t.isShow&&"mouseover"===t.eventType&&this._openPopup(e)}},{key:"onMouseOut",value:function(e){}},{key:"bindGroup",value:function(e,t,o){var r=+t.clientWidth,i=+t.clientHeight,n=(t.style.transform="",t.style.position="",t.style.display="none",s.popup());n.isCustom=!0,this.popups[e]={popup:n,container:t,clientWidth:r,clientHeight:i,popupStyle:o}}},{key:"convertToRootPopupStyle",value:function(e){var t=e.domStyle,o=t.padding,r=t.border,i=t.boxShadow,n=t.backgroundColor,a=t.closeBtn,t=t.tipBtn,p=e.textStyle,e=e.offset;return{background:f({color:n},i),padding:o,border:r,closeBtn:a,tipBtn:t,textStyle:p,offset:e}}},{key:"_openPopup",value:function(e){var t=this.options,o=t.general,t=t.popupStyle,r=e.feature,i=r.properties,n=i.customLabelPosition||(a=1,(n=r).geometry&&"Polygon"===n.geometry.type?u(n.geometry.coordinates,a):n.geometry&&"MultiPolygon"===n.geometry.type?(n=n.geometry.coordinates.reduce(function(e,t){return h(e)>=h(t)?e:t},{}),u(n,a)):void 0),a="click"===t.eventType?e.latlng:{lat:+n[1],lng:+n[0]},e=i.popupType,p=this.popups[e],t=t.offset;if(e&&p){e={L:s,map:l,latlng:a,feature:r,offset:t,bindPopup:p,minZoom:o.minZoom,maxZoom:o.maxZoom};s.customPopup.openPopup(e)}else{r=this.convertToRootPopupStyle(this.options.popupStyle);if(!y.isEmpty(i.info))return t=s.popup({}).setLatLng(a).setContent(i.info).openOn(l),this.infoPopup=t,void s.customPopup.updatePopupStyle(t,r);if(this.options.popupStyle.isEmptyShow)return p=s.popup({}).setLatLng(a).setContent("无数据").openOn(l),this.infoPopup=p,void s.customPopup.updatePopupStyle(p,r);this.infoPopup&&this.infoPopup.remove()}this.infoPopup=null}},{key:"draw",value:function(e){var t=this.options.general;e.globalAlpha=.01*t.opacity,this.container&&e.drawImage(this.container,0,0,this.container.width,this.container.height)}},{key:"show",value:function(){this.onRender(!0),this.options.visibility=!0}},{key:"hide",value:function(){m(P(c.prototype),"hide",this).call(this),this.options.visibility=!1}},{key:"destroy",value:function(){m(P(c.prototype),"destroy",this).call(this)}}])&&g(e.prototype,r),a&&g(e,a),Object.defineProperty(e,"prototype",{writable:!1}),c},e.exports});;
Cube("datav:/com/datav-2dmap-area/3.0.40",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(e,t,r,o,i,n){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(r){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=p(r),t=(e=o?(e=p(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var y=r("datav:/npm/eventemitter3/3.0.0"),c=r("datav:/npm/safely-merge/1.0.1"),h=r("datav:/com/datav-2dmap-area/3.0.40/src/areaLayer"),f=r("datav:/com/datav-2dmap-area/3.0.40/config").DEFAULT_OPTIONS,r=function(){var e=i,t=y;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t);var r,o=u(i);function i(e,t){var r;if(this instanceof i)return r=o.call(this),t=t.options,r.options=c(f,t),r.options.general.minZoom=t.general.zoomRange[0],r.options.general.maxZoom=t.general.zoomRange[1],r.options.visibility=!0,r;throw new TypeError("Cannot call a class as a function")}return e=i,(t=[{key:"addTo",value:function(e,t){this.options.id=t;t=h(e);return this.layer=new t(this.options),this}},{key:"onRender",value:function(e){this.layer&&this.layer.onRender(e)}},{key:"resize",value:function(e,t){this.layer&&this.layer.resize(e,t)}},{key:"setGeojson",value:function(e){var t=this;e&&"{}"!=JSON.stringify(e)&&""!=JSON.stringify(e)?e&&e.type&&e.api?fetch(e.api).then(function(e){return e.json()}).then(function(e){t.layer&&t.layer.setGeojson(e)}):e.features&&this.layer&&this.layer.setGeojson(e):this.layer&&this.layer.setGeojson(null)}},{key:"render",value:function(e){this.layer&&this.layer.render&&this.layer.render(e)}},{key:"setTopojson",value:function(e){var t=this;e&&e.type&&e.api?fetch(e.api).then(function(e){return e.json()}).then(function(e){t.layer&&t.layer.setTopojson&&t.layer.setTopojson(e)}):this.layer&&this.layer.setTopojson&&this.layer.setTopojson(e)}},{key:"draw",value:function(e){this.layer&&this.layer.draw&&this.layer.draw(e)}},{key:"updateOptions",value:function(e){e=e.options;this.options=c(this.options,e),this.options.general.minZoom=e.general.zoomRange[0],this.options.general.maxZoom=e.general.zoomRange[1],this.layer&&this.layer.updateOptions&&this.layer.updateOptions(this.options)}},{key:"onClick",value:function(e){var t=e.feature;t&&t.properties&&(t.properties=this.getProperties(this.layer,t.properties),this.emit("click",t.properties),e.feature=t),this.layer&&this.layer.onClick&&this.layer.onClick(e)}},{key:"onDblclick",value:function(e){var t=e.feature;t&&t.properties?(t.properties=this.getProperties(this.layer,t.properties),this.emit("dblclick",t.properties),e.feature=t):this.emit("dblclick",null),this.layer&&this.layer.onDblclick&&this.layer.onDblclick(e)}},{key:"onMouseOver",value:function(e){var t=e.feature;t&&t.properties&&(t.properties=this.getProperties(this.layer,t.properties),this.emit("mouseover",t.properties),e.feature=t),this.layer&&this.layer.onMouseOver&&this.layer.onMouseOver(e)}},{key:"onMouseOut",value:function(e){var t=e.feature;t&&t.properties&&(t.properties=this.getProperties(this.layer,t.properties),this.emit("mouseout",t.properties),e.feature=t,this.layer&&this.layer.onMouseOut&&this.layer.onMouseOut(e))}},{key:"getProperties",value:function(e,t){var r=c({},t);return e&&e.getMappingStyle&&((e=e.getMappingStyle())[r.adcode]&&(r=c(r,e[t.adcode]))),r}},{key:"bindGroup",value:function(e){var t=e.popupType||"",r=e.container||"<div></div>",e=e.popupStyle||{};this.layer&&this.layer.bindGroup&&this.layer.bindGroup(t,r,e)}},{key:"show",value:function(){this.options.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.options.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"contains",value:function(e){return this.layer.contains(e)}},{key:"destroy",value:function(){this.layer&&this.layer.destroy&&this.layer.destroy(),this.layer=null,delete this.layer}}])&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}();return e.exports=r,e.exports});