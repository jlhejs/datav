// env=undefined => env=publish 
Cube("datav:/com/datavmap-3d-scene-director/0.0.21/director.js",["datav:/npm/eventemitter3/2.0.3","datav:/npm/safely-merge/1.0.1","datav:/npm/async/2.5.0","datav:/npm/cheap-ruler/2.5.0"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/2.0.3"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/npm/async/2.5.0"),k=c("datav:/npm/cheap-ruler/2.5.0"),l={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?0.5*a*a:-0.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?0.5*a*a*a:0.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?0.5*a*a*a*a:-0.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return 1>(a*=2)?0.5*a*a*a*a*a:0.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return 0.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?0.5*Math.pow(1024,a-1):0.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-0.5*(Math.sqrt(1-a*a)-1):0.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){return 0===a?0:1===a?1:-Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)},Out:function(a){return 0===a?0:1===a?1:Math.pow(2,-10*a)*Math.sin(5*(a-0.1)*Math.PI)+1},InOut:function(a){return 0===a?0:1===a?1:(a*=2,1>a?-0.5*Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI):0.5*Math.pow(2,-10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)+1)}},Back:{In:function(a){var b=1.70158;return a*a*((b+1)*a-b)},Out:function(a){var b=1.70158;return--a*a*((b+1)*a+b)+1},InOut:function(a){var b=1.70158*1.525;return 1>(a*=2)?0.5*(a*a*((b+1)*a-b)):0.5*((a-=2)*a*((b+1)*a+b)+2)}},Bounce:{In:function(a){return 1-TWEEN.Easing.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+0.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+0.9375:7.5625*(a-=2.625/2.75)*a+0.984375},InOut:function(a){return 0.5>a?0.5*TWEEN.Easing.Bounce.In(2*a):0.5*TWEEN.Easing.Bounce.Out(2*a-1)+0.5}}};return a.exports=function(a){var b=a.datavgl,c=b.THREE,m=a.glLayer||a,n={isCycle:!0};return function(b){function c(a){d(this,c);var b=e(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));return a=i(n,a),b.options=i(b.options,a),b.onKeyDown=b.onKeyDown.bind(b),b.runSceneState=b.runSceneState.bind(b),b.play=b.play.bind(b),b.pause=b.pause.bind(b),b.stopflag=!0,b.init(),b}return f(c,b),g(c,[{key:"init",value:function(){this.name="director",this.data=[],this.points=[],this.options.keyControl&&document.addEventListener("keydown",this.onKeyDown)}},{key:"onKeyDown",value:function(a){if(32===a.keyCode){var b=!this.stopflag;this.runSceneState(b)}}},{key:"runSceneState",value:function(b){var c=this;b?(a._canvasContainer.style.pointerEvents="auto",a.stop(),this.stopScene(),this.emit("stop",{type:"stop"})):(this.stopflag=b,setTimeout(function(){c.start()},0))}},{key:"play",value:function(){this.runSceneState(!1)}},{key:"pause",value:function(){this.runSceneState(!0)}},{key:"stopScene",value:function(){this.stopflag=!0,this.timer&&clearTimeout(this.timer)}},{key:"setData",value:function(b){this.data=b||[],this.genKeyframe();var c=this.stopflag;a.stop(),this.stopScene(),this.stopflag=c,this.start()}},{key:"start",value:function(){var b=this;this.emit("start",{type:"start"}),j.eachSeries(this.points,this.switchScene.bind(this),function(){a._canvasContainer.style.pointerEvents="auto",!b.stopflag&&b.options.isCycle&&(b.resetID=setTimeout(function(){b.start()},100))})}},{key:"updateOptions",value:function(b){a.stop(),this.stopScene(),this.options=i(this.options,b),this.options.keyControl?document.addEventListener("keydown",this.onKeyDown):document.removeEventListener("keydown",this.onKeyDown),this.start()}},{key:"genKeyframe",value:function(){var b=this.points=[];this.data.forEach(function(c){if(c.path&&c.path.length)for(var d=k(c.path[0][1],"meters"),e=c.path,f=d.lineDistance(e),g=c.hasOwnProperty("startDuration")?c.startDuration:3e3,h=0;h<e.length;h++){var i=a.getBearing(),j=0,m=0;i=e[h]&&e[h+1]?d.bearing(e[h],e[h+1]):d.bearing(e[h-1],e[h]),j=d.distance(e[0<=h-1?h-1:0],e[h])||0,m=j*c.duration/f;var n=e[h];b.push({center:[n[0],n[1]],zoom:c.zoom,bearing:i,pitch:c.pitch,duration:0===h?g:m})}else c.easing&&l[c.easing.split(".")[0]][c.easing.split(".")[1]]&&(c.easing=l[c.easing.split(".")[0]][c.easing.split(".")[1]]),b.push(c)})}},{key:"switchScene",value:function(b,c){var d=this;if(a._canvasContainer.style.pointerEvents="none",this.stopflag)a.stop(),c("stop"),this.emit("stop",{type:"stop"});else{b.center=b.center?b.center:b.lng&&b.lat?[b.lng,b.lat]:a.getCenter();var e=i({easing:l.Linear.None,duration:2e3},b);a.easeTo(e),this.timer=setTimeout(function(){d.emit("keyframe-finish",e),a.stop(),d.stopflag||c(),d.stopflag&&c("stop")},e.duration)}}},{key:"remove",value:function(){this.options.keyControl&&document.removeEventListener("keydown",this.onKeyDown),a.stop(),this.stopScene(),this.resetID&&clearTimeout(this.resetID)}}]),c}(h)},a.exports});;
Cube("datav:/com/datavmap-3d-scene-director/0.0.21",["datav:/npm/eventemitter3/2.0.3","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/2.0.3"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/com/datavmap-3d-scene-director/0.0.21/director.js"),k={},l=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.container="string"===typeof a?document.querySelector(a):a,f.apis=c.apis,f.map=null,f._data=null,f.config=c,f}return f(b,a),g(b,[{key:"initSceneDirector",value:function(){var a=this.getOptions(),b=j(this.map);this.layer=new b(a)}},{key:"init",value:function(){var a=this;this.resetID&&clearTimeout(this.resetID),this.resetID=setTimeout(function(){a.map.glLayer.loaded?(a.resetID&&clearTimeout(a.resetID),a.initSceneDirector(),a.setData(a.data),a.layer.on("start",function(b){a.emit("scene-director-start",b)}),a.layer.on("stop",function(b){a.emit("scene-director-stop",b)}),a.layer.on("keyframe-finish",function(b){a.emit("scene-keyframe-finish",b)})):a.init()},100)}},{key:"play",value:function(){this.layer&&this.layer.play&&this.layer.play()}},{key:"pause",value:function(){this.layer&&this.layer.pause&&this.layer.pause()}},{key:"addTo",value:function(a){var b=this;this.map=a,this.init(),this.endID=setTimeout(function(){b.resetID&&clearTimeout(b.resetID)},300000)}},{key:"getOptions",value:function(){return this.config=i(k,this.config),this.config}},{key:"remove",value:function(){this.endID&&clearTimeout(this.endID),this.resetID&&clearTimeout(this.resetID),this.layer&&this.layer.remove&&this.layer.remove(),this.layer=null,this._data=null,this.data=null}},{key:"setData",value:function(a){this.data=a,this.layer&&this.layer.setData(a)}},{key:"updateOptions",value:function(a){this.config=i(this.config,a),a=this.getOptions(),this.layer&&this.layer.updateOptions(a)}}]),b}(h);return a.exports=l,a.exports});