// env=undefined => env=publish 
Cube("datav:/com/datavmap-3d-layer-bubbleLine/0.0.14/tubeVert.js",[],function(a){return a.exports="\nuniform vec2 offset;\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  // vec4 mvPosition = modelViewMatrix * vec4(position-vec3(offset, 0.0), 1.0);\n  // gl_Position = projectionMatrix * mvPosition;\n}\n",a.exports});;
Cube("datav:/com/datavmap-3d-layer-bubbleLine/0.0.14/tubeFrag.js",[],function(a){return a.exports="\n#ifdef GL_ES\n  precision highp float;\n#endif\n\nuniform float uTimeCounter;\nuniform float uTrailLength;\nuniform vec3 uColor;\nvarying vec2 vUv;\n\nfloat calculateTimeContrlOpacity(float timeCounter, vec2 vUv){\n  float uvGap = uTrailLength;\n  float uvTail = timeCounter - uvGap;\n\n  if((vUv.x < timeCounter) && (vUv.x > uvTail)) {\n    float opacity = (1.0 - (timeCounter - vUv.x) / uvGap);\n    opacity *= opacity;\n    opacity /= 1.3;\n\n    return opacity;\n  } else {\n    return 0.0;\n  }\n}\n\nvoid main() {\n  float currentOpacity = calculateTimeContrlOpacity(uTimeCounter, vUv);\n  // vec3 color = vec3(0.9, 0.3, 0.1);\n  // gl_FragColor = vec4(color, 1.0);\n  gl_FragColor = vec4(uColor, currentOpacity);\n}\n",a.exports});;
Cube("datav:/com/datavmap-3d-layer-bubbleLine/0.0.14/TubeTrail.js",[],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/com/datavmap-3d-layer-bubbleLine/0.0.14/tubeVert.js"),i=c("datav:/com/datavmap-3d-layer-bubbleLine/0.0.14/tubeFrag.js");return a.exports=function(a,b){return function(c){function j(b){d(this,j);var c=e(this,(j.__proto__||Object.getPrototypeOf(j)).call(this));return c.colorUniform=b.colorUniform||new a.Vector3(0.9,0.9,1),c.uTrailLength=b.uTrailLength||0.2,c.sizeScale=b.sizeScale||{yScale:1,xScale:1,zScale:1},c.animationTimeStep=b.animationTimeStep||5e-3,c.animationTimeStart=b.animationTimeStart||Math.random(),c.tubeConfig=b.tubeConfig||{path:new a.CatmullRomCurve3([new a.Vector3(0,0,0),new a.Vector3(0,0,100)]),tubularSegments:2,radius:1e-5,radiusSegments:32,closed:!1},c.build(),c}return f(j,c),g(j,[{key:"build",value:function(){this.geometry=new a.TubeBufferGeometry(this.tubeConfig.path,this.tubeConfig.tubularSegments,this.tubeConfig.radius,this.tubeConfig.radiusSegments,this.tubeConfig.closed),this.material=new a.ShaderMaterial({uniforms:{offset:{value:b.centerOffset},uColor:{value:this.colorUniform},uTrailLength:{value:this.uTrailLength},uTimeCounter:{value:this.animationTimeStart}},vertexShader:h,fragmentShader:i,side:a.DoubleSide,blending:a.AdditiveBlending,depthTest:!0,depthWrite:!1,transparent:!0}),this.mesh=new a.Mesh(this.geometry,this.material),this.mesh.scale.x=this.sizeScale.xScale,this.mesh.scale.y=this.sizeScale.yScale,this.mesh.scale.z=this.sizeScale.zScale}},{key:"animate",value:function(){this.material.uniforms.uTimeCounter.value+=this.animationTimeStep,1<this.material.uniforms.uTimeCounter.value&&(this.material.uniforms.uTimeCounter.value=0)}}]),j}(a.Object3D)},a.exports});;
Cube("datav:/com/datavmap-3d-layer-bubbleLine/0.0.14/TubeMesh.js",[],function(a){function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function c(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function d(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var e=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();return a.exports=function(a){return function(f){function g(d){b(this,g);var e=c(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));return e.materialColor=d.materialColor||"#4FADFF",e.materialOpacity=d.materialOpacity||0.1,e.sizeScale=d.sizeScale||{yScale:1,xScale:1,zScale:1},e.tubeConfig=d.tubeConfig||{path:new a.CatmullRomCurve3([new a.Vector3(0,0,0),new a.Vector3(0,0,100)]),tubularSegments:2,radius:1e-5,radiusSegments:32,closed:!1},e.build(),e}return d(g,f),e(g,[{key:"build",value:function(){this.geometry=new a.TubeBufferGeometry(this.tubeConfig.path,this.tubeConfig.tubularSegments,this.tubeConfig.radius,this.tubeConfig.radiusSegments,this.tubeConfig.closed),this.geometry.dynamic=!0,this.material=new a.MeshBasicMaterial({color:this.materialColor,transparent:!0,opacity:this.materialOpacity,depthTest:!0,depthWrite:!1,side:a.DoubleSide}),this.material.needsUpdate=!0,this.mesh=new a.Mesh(this.geometry,this.material),this.mesh.scale.x=this.sizeScale.xScale,this.mesh.scale.y=this.sizeScale.yScale,this.mesh.scale.z=this.sizeScale.zScale}}]),g}(a.Object3D)},a.exports});;
Cube("datav:/com/datavmap-3d-layer-bubbleLine/0.0.14/BubbleLineLayer.js",["datav:/npm/eventemitter3/2.0.3","datav:/npm/safely-merge/1.0.1","datav:/npm/chroma-js/1.3.4"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/2.0.3"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/npm/chroma-js/1.3.4"),k=c("datav:/com/datavmap-3d-layer-bubbleLine/0.0.14/TubeMesh.js"),l=c("datav:/com/datavmap-3d-layer-bubbleLine/0.0.14/TubeTrail.js");return a.exports=function(a){var b=a.datavgl,c=b.THREE,m=a.glLayer||a,n=b.DataVModelTools.point2buffer,o=a.worldsize,p=k(c),q=l(c,m),r={};return function(a){function b(a){d(this,b);var c=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return a=i(r,a),c.options=i(c.options,a),c.animate=c.animate.bind(c),c.init(),c}return f(b,a),g(b,[{key:"init",value:function(){this.meshGroup=new c.Group,this.tubeTrailList=[],this.tubeStillList=[],m.on("runAnimation",this.animate)}},{key:"setData",value:function(a){if(a&&0==a.length&&this.disposeMesh(),a&&a.length){this.disposeMesh(),this.meshGroup=new c.Group;for(var b,d=n(a,{worldsize:o}),e=d.positions,f=j(this.options.bubbleLineBrightColor).gl(),g=new c.Vector3(f[0],f[1],f[2]),h={colorUniform:g,uTrailLength:this.options.bubblePercent,animationTimeStep:this.options.bubbleLineBrightSpeed},k={materialColor:this.options.bubbleLineStillColor,materialOpacity:this.options.bubbleLineStillOpacity},l=0;l<e.length;l+=3){b=new q(h),b.mesh.position.x=e[l+0],b.mesh.position.y=e[l+1],b.mesh.position.z=this.options.heightPosition,b.mesh.scale.z=this.options.bubbleLineLength*this.options.bubbleLineLengthFactor,b.mesh.scale.x=this.options.bubbleLineRadius*this.options.bubbleLineRadiusFactor,b.mesh.scale.y=this.options.bubbleLineRadius*this.options.bubbleLineRadiusFactor,this.meshGroup.add(b.mesh),this.tubeTrailList.push(b);var i=new p(k);i.mesh.position.x=e[l+0],i.mesh.position.y=e[l+1],i.mesh.position.z=this.options.heightPosition,i.mesh.scale.z=this.options.bubbleLineLength*this.options.bubbleLineLengthFactor,i.mesh.scale.x=this.options.bubbleLineRadius*this.options.bubbleLineRadiusFactor,i.mesh.scale.y=this.options.bubbleLineRadius*this.options.bubbleLineRadiusFactor,this.meshGroup.add(i.mesh),this.tubeStillList.push(i)}this.meshGroup.visible=this.options.visibility,m.rootNode.add(this.meshGroup)}}},{key:"updateOptions",value:function(a){var b=this;this.options=i(this.options,a),this.tubeTrailList.forEach(function(a){a.mesh.scale.z=b.options.bubbleLineLength*b.options.bubbleLineLengthFactor,a.mesh.scale.x=b.options.bubbleLineRadius*b.options.bubbleLineRadiusFactor,a.mesh.scale.y=b.options.bubbleLineRadius*b.options.bubbleLineRadiusFactor,a.mesh.position.z=b.options.heightPosition;var d=j(b.options.bubbleLineBrightColor).gl();a.mesh.material.uniforms.uColor.value=new c.Vector3(d[0],d[1],d[2]),a.mesh.material.uniforms.uTrailLength.value=b.options.bubblePercent,a.animationTimeStep=b.options.bubbleLineBrightSpeed,a.mesh.material.needsUpdate=!0}),this.tubeStillList.forEach(function(a){a.mesh.scale.z=b.options.bubbleLineLength*b.options.bubbleLineLengthFactor,a.mesh.scale.x=b.options.bubbleLineRadius*b.options.bubbleLineRadiusFactor,a.mesh.scale.y=b.options.bubbleLineRadius*b.options.bubbleLineRadiusFactor,a.mesh.position.z=b.options.heightPosition;var c=j(b.options.bubbleLineStillColor).gl();a.mesh.material.color={r:c[0],g:c[1],b:c[2]},a.mesh.material.opacity=b.options.bubbleLineStillOpacity,a.mesh.material.needsUpdate=!0}),this.meshGroup.visible=this.options.visibility}},{key:"show",value:function(){this.options.visibility=!0,this.meshGroup&&(this.meshGroup.visible=!0)}},{key:"hide",value:function(){this.options.visibility=!1,this.meshGroup&&(this.meshGroup.visible=!1)}},{key:"disposeMesh",value:function(){this.meshGroup&&m.rootNode.remove(this.meshGroup),this.meshGroup&&m.disposeNode(this.meshGroup),this.meshGroup=null,this.tubeTrailList=[],this.tubeStillList=[]}},{key:"animate",value:function(){this.tubeTrailList.forEach(function(a){a.animate()})}},{key:"remove",value:function(){m.off("runAnimation",this.animate),this.disposeMesh()}}]),b}(h)},a.exports});;
Cube("datav:/com/datavmap-3d-layer-bubbleLine/0.0.14",["datav:/npm/eventemitter3/2.0.3","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/2.0.3"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/com/datavmap-3d-layer-bubbleLine/0.0.14/BubbleLineLayer.js"),k={},l=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.container="string"===typeof a?document.querySelector(a):a,f.apis=c.apis,f.map=null,f._data=null,f.config=c,f}return f(b,a),g(b,[{key:"initLayer",value:function(){var a=this.getOptions(),b=j(this.map);this.layer=new b(a),this.render(this.data)}},{key:"init",value:function(){var a=this;this.resetID&&clearTimeout(this.resetID),this.resetID=setTimeout(function(){a.map.glLayer.loaded?(a.resetID&&clearTimeout(a.resetID),a.initLayer()):a.init()},100)}},{key:"addTo",value:function(a){var b=this;this.map=a,this.init(),this.endID=setTimeout(function(){b.resetID&&clearTimeout(b.resetID)},300000)}},{key:"getOptions",value:function(){return this.config=i(k,this.config),this.config}},{key:"show",value:function(){this.config.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.config.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"remove",value:function(){this.endID&&clearTimeout(this.endID),this.resetID&&clearTimeout(this.resetID),this.layer&&this.layer.remove&&this.layer.remove(),this.layer=null,this._data=null,this.data=null}},{key:"render",value:function(a){this.data=a,this.layer&&this.layer.setData(a)}},{key:"updateOptions",value:function(a){this.config=i(this.config,a),a=this.getOptions(),this.layer&&this.layer.updateOptions(a)}}]),b}(h);return a.exports=l,a.exports});