// env=undefined => env=publish 
Cube("datav:/com/@datav-3d-v3/datav-3dplane-line/3.1.2/src/shader/meshline_frag.glsl",[],function(n,e,a,l,t,o){return n.exports="#define GLSLIFY 1\n#include <common>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#include <fog_pars_fragment>\n\nuniform vec3 color;\nuniform float opacity;\n\n#ifdef USE_MAP\n  uniform sampler2D map;\n  uniform sampler2D map1;\n#endif\n\n#ifdef USE_ALPHA_MAP\n  uniform sampler2D alphaMap;\n#endif\n\nuniform float visibility;\nuniform uint useDash;\nuniform float dashOffset0;\nuniform float dashOffset1;\n\nvarying float v_brightSegCount;\n\nuniform float alphaTest;\nuniform vec2 uvScale0;\n\nin vec2 vUv;\n\nflat in float lineAspect;\n// flat in float v_symbolCount;\n\nvarying vec2 v_normal;\nvarying vec4 v_lineColor;\nvarying float v_blurWidthRatio;\nvarying float v_lineType;\n\nvarying vec4 v_lineHeadColor;\nvarying float v_lineHeadSpaceRatio;\n\nvarying vec4 v_symbolColor;\nvarying vec3 v_symbolParams;\n\nvoid main() {\n  #include <clipping_planes_fragment>\n  #include <logdepthbuf_fragment>\n    vec4 c = v_lineColor;\n\n    bool useMap = false;\n\n    // for line  \n    vec2 uv0 = vUv * uvScale0;\n    uv0.x *= v_brightSegCount;\n    uv0.x -= dashOffset0;\n    uv0.y = (v_lineType - 1.0 + vUv.y) * 0.2;\n   \n    // antialiase\n    // reference from https://blog.mapbox.com/drawing-antialiased-lines-with-opengl-8766f34192dc\n    float blur = 1.0;\n    float featherLen = length(v_normal) - (1.0 - v_blurWidthRatio);\n    if (featherLen > 0.0) {\n      blur =  1.0 - featherLen / v_blurWidthRatio;\n    }\n    blur *= blur;\n\n    vec4 texture1 = vec4(0.0);\n\n    float symbolLen = 1.0;\n    \n    #ifdef USE_MAP\n      // 飞线头颜色处理\n      vec4 texture0 = texture2D(map, uv0); //线条纹理\n      texture0 *= blur; //仅对线条纹理做边缘模糊\n      texture0 = mix(vec4(.0), texture0, texture0.a);\n      c *= texture0;\n\n      //使得不同长度的飞线上符号运动速度一致\n      float segU = mod(uv0.x + dashOffset0 - dashOffset1, 1.0);\n\n      symbolLen = v_symbolParams.z * 100.0 / lineAspect * v_brightSegCount; //保持符号贴图的纵横比\n      if (segU < symbolLen) {\n        segU = segU / symbolLen;\n\n        // 对每个分段的首尾两端做模糊处理\n        float endBlurLen = 0.08; //首尾两端模糊长度\n        float endBlurFactor = 1.0;\n        if (segU < endBlurLen) {\n          endBlurFactor = pow((segU / endBlurLen), 3.0);\n        } else if (segU > 1.0 - endBlurLen) {\n          endBlurFactor = pow((1.0 - segU) / endBlurLen, 3.0);\n        }\n\n        vec2 uv1 = vec2( segU, vUv.y);\n        uv1.y = (v_symbolParams.x * 100.0 - 1.0 + vUv.y) / (v_symbolParams.y * 100.0);\n       \n        // // 对每个分段的首尾两端做模糊处理\n        // float endBlurLen = 0.08; //首尾两端模糊长度\n        // // float endBlurFactor = 1.0;\n        // if(segU < endBlurLen){\n        //   endBlurFactor = pow((segU / endBlurLen), 3.0);\n        // }else if(segU > 1.0 - endBlurLen){\n        //   endBlurFactor = pow((1.0 - segU) / endBlurLen, 3.0);\n        // }\n        // texture1 = v_symbolColor * texture2D(map1, uv1) * endBlurFactor;\n\n        // vec2 uv1 = vec2( segU, vUv.y);\n        // uv1.y = (v_symbolParams.x * 100.0 - 1.0 + vUv.y) / (v_symbolParams.y * 100.0);\n\n        texture1 = v_symbolColor * texture2D(map1, uv1) * endBlurFactor;\n\n        if (v_symbolColor.w > 0.0) {\n          c += texture1;\n        }\n      }\n    #endif\n\n    #ifdef USE_ALPHA_MAP\n      // c.a *= texture2D(alphaMap, vUv * repeat).a;\n      c.a *= texture2D(alphaMap, uv0).a;\n\n      texture1.a *= texture2D(alphaMap, uv0).a;\n    #endif\n\n    #include <alphatest_fragment>\n\n    if (c.a < alphaTest) discard;\n\n    // 高亮线处理\n    float dist = 1.0;\n    float blurRange = 0.1;\n\n    float _spaceRatio = v_lineHeadSpaceRatio + blurRange;\n    float localSegLen = mod(uv0.x + v_lineHeadSpaceRatio, 1.0);\n    float localSegRatio = localSegLen;\n\n    if (v_lineHeadSpaceRatio == 0.0) {\n      dist = 0.0;\n      gl_FragColor = c;\n    } else {\n      if (localSegRatio > _spaceRatio) {\n        dist = pow((localSegRatio - _spaceRatio) / (1.0 - _spaceRatio), 4.0 );\n      } else if (localSegRatio > v_lineHeadSpaceRatio) {\n        // 对高亮线段的头部做模糊处理\n        dist = pow((localSegRatio - v_lineHeadSpaceRatio) * blurRange, 4.0 );\n      }\n    }\n    dist = saturate(dist);\n    \n    if (v_lineHeadColor.w > 0.0) {\n      gl_FragColor = mix(c, v_lineHeadColor, dist);\n    } else {\n      gl_FragColor = c;\n    }\n\n    gl_FragColor.a *= blur;\n    \n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <premultiplied_alpha_fragment>\n\n}",n.exports});;
Cube("datav:/com/@datav-3d-v3/datav-3dplane-line/3.1.2/src/shader/meshline_vert.glsl",[],function(e,n,t,i,r,o){return e.exports="#define GLSLIFY 1\n#include <common>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#include <fog_pars_vertex>\n\nattribute vec3 previous;\nattribute vec3 next;\nattribute float side;\nattribute float len;\nattribute float lineLength;\nattribute float lineWidth;\nattribute vec4 lineColor;\nattribute vec4 lineHeadColor;\nattribute vec4 symbolColor;\nattribute vec4 lineParams;\nattribute vec3 symbolParams;\n\nuniform vec2 resolution;\nuniform float near;\nuniform float far;\nuniform uint sizeAttenuation;\nuniform float dashOffset0;\nuniform float drawScale;\n\nout vec2 vUv;\n\nvarying vec4 v_lineColor;\nvarying vec2 v_normal;\nvarying float v_lineType;\nflat out float lineAspect;\n// flat out float v_symbolCount;\nvarying float v_blurWidthRatio;\n\nvarying vec4 v_lineHeadColor;\nvarying float v_lineHeadSpaceRatio;\nvarying float v_brightSegCount;\n// varying float v_lineTextureNum;\n\nvarying vec4 v_symbolColor;\nvarying vec3 v_symbolParams;\n\n// out float v_len;\n// out float v_pixelWidth;\n\nvec2 fix(vec4 i, float aspect) {\n  vec2 res = i.xy / i.w;\n  res.x *= aspect;\n  return res;\n}\n\nvoid main() {\n  v_lineColor = lineColor;\n  v_lineHeadColor = lineHeadColor;\n  v_symbolColor = symbolColor;\n\n  v_lineType = lineParams.x * 100.0;\n  v_blurWidthRatio = lineParams.y;\n  v_lineHeadSpaceRatio = lineParams.z;\n\n  // v_lineTextureNum = lineParams.w * 100.0;\n\n  v_symbolParams = symbolParams;\n\n  float len_step = (110.0 - lineLength) / 100.0 * 0.5;\n\n  v_brightSegCount = len * len_step / drawScale * 0.000001;\n\n  vUv = uv;\n\n  // vPick = pick;\n  // vUnPick = pick;\n  float aspect = resolution.x / resolution.y;\n  float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);\n  vec2 aspectVec = vec2(aspect, 1.0);\n\n  lineAspect = len / lineWidth / aspect;\n\n  mat4 mvp = projectionMatrix * modelViewMatrix;\n  // into clip space\n  vec4 currentProjected = mvp * vec4(position, 1.);\n  vec4 previousProjected = mvp * vec4(previous, 1.);\n  vec4 nextProjected = mvp * vec4(next, 1.);\n\n  // into NDC space [-1,1] and correct for aspect ratio(screenWidth/screenHeight)\n  vec2 currentScreen = currentProjected.xy / currentProjected.w * aspectVec;\n  vec2 previousScreen = previousProjected.xy / previousProjected.w * aspectVec;\n  vec2 nextScreen = nextProjected.xy / nextProjected.w * aspectVec;\n   \n  float pixelWidth = sizeAttenuation == 1u ? 1.0 : currentProjected.w * pixelWidthRatio;\n\n  float width = lineWidth;\n\n  #ifdef USE_MAP\n\n  #else\n    float dist = 1.0;\n    float localSegLen = mod(uv.x - dashOffset0, 1.0 / v_brightSegCount);\n    float localSegRatio = localSegLen * v_brightSegCount;\n    \n    float blurRange = 0.1; \n    float spaceRatio = v_lineHeadSpaceRatio + blurRange;\n    if (localSegRatio > spaceRatio) {\n      dist = (localSegRatio - spaceRatio) / (1.0 - spaceRatio);\n    } else if (localSegRatio > spaceRatio - blurRange) {\n      //对高亮线段的头部做模糊处理\n      dist = pow((spaceRatio - localSegRatio) / blurRange, 3.0 );\n    }\n    width = mix(lineWidth, lineWidth, saturate(dist));\n  #endif\n\n  width *= 1.8 * pixelWidth;\n\n  // into NDC space [-1,1] and correct for aspect ratio(screenWidth/screenHeight)\n  // vec2 currentP = fix(currentProjected, aspect);\n  // vec2 prevP = fix(previousProjected, aspect);\n  // vec2 nextP = fix(nextProjected, aspect);\n\n  vec2 dir = vec2(0.0);\n  if (nextScreen == currentScreen) //next == position\n    dir = normalize(currentScreen - previousScreen);\n  else if (previousScreen == currentScreen) //previous == position\n    dir = normalize(nextScreen - currentScreen);\n  else {\n    vec2 dir1 = normalize(currentScreen - previousScreen);\n    vec2 dir2 = normalize(nextScreen - currentScreen);\n    dir = normalize(dir1 + dir2);\n\n    // vec2 perp = vec2(-dir1.y, dir1.x);\n    // vec2 miter = vec2(-dir.y, dir.x);\n    // width = clamp( width / dot( miter, perp ), width, 1.5 * width);\n  }\n\n  v_normal = normalize( vec2(-dir.y / aspect, dir.x) * side); //for antialiase line\n\n  vec4 normalVec4 = vec4( -dir.y, dir.x, 0., 1. );\n  normalVec4.xy *= .5 * width;\n  normalVec4 *= projectionMatrix;\n  vec2 normal = normalVec4.xy;\n\n  vec4 offset = vec4(normal * side, 0., 0.);\n\n  gl_Position = currentProjected + offset;\n\n  vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n  // v_symbolCount = len;\n\n  #include <logdepthbuf_vertex>\n  #include <clipping_planes_vertex>\n  #include <fog_vertex>\n\n}\n",e.exports});;
Cube("datav:/com/@datav-3d-v3/datav-3dplane-line/3.1.2/src/meshLine",[],function(t,e,i,r,s,n){function a(e,t){var i,r=Object.keys(e);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(e),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)),r}function o(r){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?a(Object(s),!0).forEach(function(t){var e,i;e=r,i=s[t=t],t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(s,t))})}return r}function m(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){var i;if(t)return"string"==typeof t?u(t,e):"Map"===(i="Object"===(i=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?u(t,e):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function l(t,e,i){t*=6,e*=6;return i[t]===i[e]&&i[1+t]===i[1+e]&&i[2+t]===i[2+e]}function h(t,e){t*=6;return[e[t],e[1+t],e[2+t]]}return t.exports=function(O){function t(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices=[],this.uvs=[],this.counters=[],this.lens=[],this.lineLengths=[],this.lineWidths=[],this.lineColor=[],this.lineHeadColor=[],this.symbolColor=[],this.lineParams=[],this.symbolParams=[],this.geometry=new O.BufferGeometry,this.widthCallback=null,this.matrixWorld=new O.Matrix4}var M,C,W;function n(t,e,i,r,s){var n;if(t=t.subarray||t.slice?t:t.buffer,i=i.subarray||i.slice?i:i.buffer,t=e?t.subarray?t.subarray(e,s&&e+s):t.slice(e,s&&e+s):t,i.set)i.set(t,r);else for(n=0;n<t.length;n++)i[n+r]=t[n]}return((t.prototype=Object.create(O.Mesh.prototype)).constructor=t).prototype.setMatrixWorld=function(t){this.matrixWorld=t},t.prototype.setGeometry=function(t,e,i){this.widthCallback=i,this.process(t,e)},t.prototype.raycast=(M=new O.Matrix4,C=new O.Ray,W=new O.Sphere,function(t,e){var i=t.linePrecision,r=i*i,i=this.geometry;if(null===i.boundingSphere&&i.computeBoundingSphere(),W.copy(i.boundingSphere),W.applyMatrix4(this.matrixWorld),!1!==t.ray.intersectSphere(W)){M.getInverse(this.matrixWorld),C.copy(t.ray).applyMatrix4(M);var s=new O.Vector3,n=new O.Vector3,a=new O.Vector3,o=new O.Vector3,u=this instanceof O.LineSegments?2:1;if(i instanceof O.BufferGeometry){var l=i.index,h=i.attributes;if(null!==l)for(var p=l.array,f=h.position.array,c=0,m=p.length-1;c<m;c+=u){var y=p[c],v=p[c+1];s.fromArray(f,3*y),n.fromArray(f,3*v),r<C.distanceSqToSegment(s,n,o,a)||(o.applyMatrix4(this.matrixWorld),(y=t.ray.origin.distanceTo(o))<t.near||y>t.far||e.push({distance:y,point:a.clone().applyMatrix4(this.matrixWorld),index:c,face:null,faceIndex:null,object:this}))}else for(var b,d=h.position.array,g=0,w=d.length/3-1;g<w;g+=u)s.fromArray(d,3*g),n.fromArray(d,3*g+3),r<C.distanceSqToSegment(s,n,o,a)||(o.applyMatrix4(this.matrixWorld),(b=t.ray.origin.distanceTo(o))<t.near||b>t.far||e.push({distance:b,point:a.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(i instanceof O.Geometry)for(var A,x=i.vertices,P=x.length,S=0;S<P-1;S+=u)r<C.distanceSqToSegment(x[S],x[S+1],o,a)||(o.applyMatrix4(this.matrixWorld),(A=t.ray.origin.distanceTo(o))<t.near||A>t.far||e.push({distance:A,point:a.clone().applyMatrix4(this.matrixWorld),index:S,face:null,faceIndex:null,object:this}))}}),t.prototype.createGeometry=function(){var t=new O.BufferAttribute(new Float32Array(this.positions),3),e=new O.BufferAttribute(new Float32Array(this.previous),3),i=new O.BufferAttribute(new Float32Array(this.next),3),r=new O.BufferAttribute(new Float32Array(this.side),1),s=new O.BufferAttribute(new Float32Array(this.uvs),2),n=new O.BufferAttribute(new Uint32Array(this.indices),1),a=new O.BufferAttribute(new Float32Array(this.counters),1),o=new O.BufferAttribute(new Float32Array(this.lens),1),u=new O.BufferAttribute(new Float32Array(this.lineLengths),1),l=new O.BufferAttribute(new Float32Array(this.lineWidths),1),h=new O.BufferAttribute(new Float32Array(this.lineColor),4),p=new O.BufferAttribute(new Float32Array(this.lineHeadColor),4),f=new O.BufferAttribute(new Float32Array(this.symbolColor),4),c=new O.BufferAttribute(new Float32Array(this.lineParams),4),m=new O.BufferAttribute(new Float32Array(this.symbolParams),3);this.geometry.setAttribute("position",t),this.geometry.setAttribute("previous",e),this.geometry.setAttribute("next",i),this.geometry.setAttribute("side",r),this.geometry.setAttribute("uv",s),this.geometry.setAttribute("counters",a),this.geometry.setAttribute("len",o),this.geometry.setAttribute("lineLength",u),this.geometry.setAttribute("lineWidth",l),this.geometry.setAttribute("lineColor",h),this.geometry.setAttribute("lineHeadColor",p),this.geometry.setAttribute("symbolColor",f),this.geometry.setAttribute("lineParams",c),this.geometry.setAttribute("symbolParams",m),this.geometry.setIndex(n)},t.prototype.clear=function(){this.positions.length=0,this.previous.length=0,this.next.length=0,this.side.length=0,this.width.length=0,this.indices.length=0,this.uvs.length=0,this.counters.length=0,this.lens.length=0,this.lineLengths.length=0,this.lineWidths.length=0,this.lineColor.length=0,this.lineHeadColor.length=0,this.symbolColor.length=0,this.lineParams.length=0,this.symbolParams.length=0},t.prototype._processPosition=function(t){for(var e,i,r=0,s=t.length/6;r<s;r++)this.counters.push(i=r/(s-1)),this.counters.push(i);(e=this.positions).push.apply(e,m(t));var n=t.length/6,a=l(0,n-1,t)?h(n-2,t):h(0,t);this.previous.push(a[0],a[1],a[2]),this.previous.push(a[0],a[1],a[2]);for(var o=0;o<n-1;o++)a=h(o,t),this.previous.push(a[0],a[1],a[2]),this.previous.push(a[0],a[1],a[2]);for(var u=1;u<n;u++)a=h(u,t),this.next.push(a[0],a[1],a[2]),this.next.push(a[0],a[1],a[2]);a=l(n-1,0,t)?h(1,t):h(n-1,t),this.next.push(a[0],a[1],a[2]),this.next.push(a[0],a[1],a[2])},t.prototype._processIndex=function(t){for(var e=this.positions.length/3,i=t.length/6,r=0;r<i-1;r++){var s=2*r+e;this.indices.push(s,1+s,2+s),this.indices.push(2+s,1+s,3+s)}},t.prototype._processUV=function(t,e){if(2<arguments.length&&void 0!==arguments[2]&&arguments[2]){this.uvs.push(0,0),this.uvs.push(0,1);for(var i,r,s=0,n=6,a=t.length;n<a;n+=6)i=[t[n-6],t[n-6+1],t[n-6+2]],r=[t[n],t[n+1],t[n+2]],s+=Math.sqrt(Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2)+Math.pow(r[2]-i[2],2)),this.uvs.push(r=s/e,0),this.uvs.push(r,1)}else for(var o=t.length/6,u=0;u<o;u++)this.uvs.push(u/(o-1),0),this.uvs.push(u/(o-1),1)},t.prototype._processSide=function(t){for(var e=t.length/6,i=0;i<e;i++)this.side.push(1),this.side.push(-1)},t.prototype.process=function(t,e){for(var i,r=e.curveLen,s=e.isGeoUv,n=e.lineColor,a=e.lineHeadColor,o=e.symbolColor,u=e.lineLength,l=e.lineWidth,h=e.lineParams,p=e.symbolParams,f=(this._processIndex(t),this._processSide(t),this._processUV(t,r,s),this._processPosition(t),t.length/6),c=0;c<f;c++)this.lens.push(r),this.lens.push(r),this.lineLengths.push(u),this.lineLengths.push(u),this.lineWidths.push(l),this.lineWidths.push(l),(i=this.lineColor).push.apply(i,m(n)),(i=this.lineColor).push.apply(i,m(n)),(i=this.lineHeadColor).push.apply(i,m(a)),(i=this.lineHeadColor).push.apply(i,m(a)),(i=this.symbolColor).push.apply(i,m(o)),(i=this.symbolColor).push.apply(i,m(o)),this.lineParams.push(h.lineType),this.lineParams.push(h.blurWidthRatio),this.lineParams.push(h.lineHeadSpaceRatio),this.lineParams.push(h.lineTextureNum),this.lineParams.push(h.lineType),this.lineParams.push(h.blurWidthRatio),this.lineParams.push(h.lineHeadSpaceRatio),this.lineParams.push(h.lineTextureNum),this.symbolParams.push(p.symbolType),this.symbolParams.push(p.symbolNum),this.symbolParams.push(p.symbolAspect),this.symbolParams.push(p.symbolType),this.symbolParams.push(p.symbolNum),this.symbolParams.push(p.symbolAspect)},t.prototype.advance=function(t){var e=this.attributes.position.array,i=this.attributes.previous.array,r=this.attributes.next.array,s=e.length;n(e,0,i,0,s),n(e,6,e,0,s-6),e[s-6]=t.x,e[s-5]=t.y,e[s-4]=t.z,e[s-3]=t.x,e[s-2]=t.y,e[s-1]=t.z,n(e,6,r,0,s-6),r[s-6]=t.x,r[s-5]=t.y,r[s-4]=t.z,r[s-3]=t.x,r[s-2]=t.y,r[s-1]=t.z,this.attributes.position.needsUpdate=!0,this.attributes.previous.needsUpdate=!0,this.attributes.next.needsUpdate=!0},{MeshLine:t,MeshLineMaterial:function(t){var e=new O.ShaderMaterial({depthWrite:!0,depthTest:!0,transparent:!0});return e.type="MeshLineMaterial",e.uniforms=o({drawScale:{value:1},opacity:{value:1},map:{value:null},map1:{value:null},alphaMap:{value:null},resolution:{value:new O.Vector2(1,1)},sizeAttenuation:{value:1},near:{value:1},far:{value:1},visibility:{value:1},dashOffset0:{value:0},dashOffset1:{value:0},useDash:{value:0},alphaTest:{value:0},repeat:{value:new O.Vector2(1,1)},uvScale0:{value:new O.Vector2(1,1)}},O.UniformsLib.fog),e.vertexShader=i("datav:/com/@datav-3d-v3/datav-3dplane-line/3.1.2/src/shader/meshline_vert.glsl"),e.fragmentShader=i("datav:/com/@datav-3d-v3/datav-3dplane-line/3.1.2/src/shader/meshline_frag.glsl"),Object.defineProperties(e,{drawScale:{enumerable:!0,get:function(){return this.uniforms.drawScale.value},set:function(t){this.uniforms.drawScale.value=t}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(t){this.uniforms.map.value=t}},map1:{enumerable:!0,get:function(){return this.uniforms.map1.value},set:function(t){this.uniforms.map1.value=t}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(t){this.uniforms.alphaMap.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value=t}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(t){this.uniforms.sizeAttenuation.value=t}},near:{enumerable:!0,get:function(){return this.uniforms.near.value},set:function(t){this.uniforms.near.value=t}},far:{enumerable:!0,get:function(){return this.uniforms.far.value},set:function(t){this.uniforms.far.value=t}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(t){this.uniforms.visibility.value=t}},dashOffset0:{enumerable:!0,get:function(){return this.uniforms.dashOffset0.value},set:function(t){this.uniforms.dashOffset0.value=t}},dashOffset1:{enumerable:!0,get:function(){return this.uniforms.dashOffset1.value},set:function(t){this.uniforms.dashOffset1.value=t}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(t){this.uniforms.useDash.value=t}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(t){this.uniforms.alphaTest.value=t}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(t){this.uniforms.repeat.value=t}},uvScale0:{enumerable:!0,get:function(){return this.uniforms.uvScale0.value},set:function(t){this.uniforms.uvScale0.value=t}}}),e.setValues(t),e}}},t.exports});;
Cube("datav:/com/@datav-3d-v3/datav-3dplane-line/3.1.2/config/lineStyle",[],function(e,t,c,p,a,n){return e.exports={"线型1":[{percent:0,opacity:1},{percent:1,opacity:1}],"线型2":[{percent:0,opacity:0},{percent:1,opacity:1}],"线型3":[{percent:0,opacity:.1},{percent:.25,opacity:1},{percent:.5,opacity:1},{percent:1,opacity:0}],"线型4":[{percent:0,opacity:.25},{percent:.1,opacity:1},{percent:.2,opacity:.25},{percent:.3,opacity:1},{percent:.4,opacity:.25},{percent:.5,opacity:1},{percent:.6,opacity:.25},{percent:.7,opacity:1},{percent:.8,opacity:.25},{percent:.9,opacity:1},{percent:1,opacity:.25}],"线型5":[{percent:0,opacity:1},{percent:.05,opacity:1},{percent:.05,opacity:0},{percent:.1,opacity:0},{percent:.1,opacity:1},{percent:.15,opacity:1},{percent:.15,opacity:0},{percent:.2,opacity:0},{percent:.2,opacity:1},{percent:.25,opacity:1},{percent:.25,opacity:0},{percent:.3,opacity:0},{percent:.3,opacity:1},{percent:.35,opacity:1},{percent:.35,opacity:0},{percent:.4,opacity:0},{percent:.4,opacity:1},{percent:.45,opacity:1},{percent:.45,opacity:0},{percent:.5,opacity:0},{percent:.5,opacity:1},{percent:.55,opacity:1},{percent:.55,opacity:0},{percent:.6,opacity:0},{percent:.6,opacity:1},{percent:.65,opacity:1},{percent:.65,opacity:0},{percent:.7,opacity:0},{percent:.7,opacity:1},{percent:.75,opacity:1},{percent:.75,opacity:0},{percent:.8,opacity:0},{percent:.8,opacity:1},{percent:.85,opacity:1},{percent:.85,opacity:0},{percent:.9,opacity:0},{percent:.9,opacity:1},{percent:.95,opacity:1},{percent:.95,opacity:0},{percent:1,opacity:0}]},e.exports});;
Cube("datav:/com/@datav-3d-v3/datav-3dplane-line/3.1.2/src/lineLayer",[],function(e,t,h,i,o,r){function p(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function d(){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=g(e)););return e}(e,t);if(o)return(o=Object.getOwnPropertyDescriptor(o,t)).get?o.get.call(arguments.length<3?e:i):o.value}).apply(this,arguments)}function y(e,t){return(y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function f(i){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=g(i),t=(e=o?(e=g(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===b(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return m(t)}}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}return e.exports=function(F){var G=F.THREE,e=F.Utils,V=F.GuiUtils,i=F.VOGO,N=e._,o=e.mergeOptions,t=e.FormatTransformer,B=e.BASE_HEIGHT_SCALE,D=e.Chroma,a=e.coordtransformCli,u=((new i.Coordinates).crs=i.EPSG3857,h("datav:/com/@datav-3d-v3/datav-3dplane-line/3.1.2/config/lineStyle")),e=h("datav:/com/@datav-3d-v3/datav-3dplane-line/3.1.2/src/meshLine")(G),r=e.MeshLine,c=e.MeshLineMaterial;new t;e=F.Layer,t=s;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&y(t,e);var n,l=f(s);function s(e){var t;if(this instanceof s)return(t=l.call(this)).options=o(t.options,{visible:!0}),t.options=o(t.options,e||{}),t.classNameAlias="OdFlylineLayer",t.layerName=t.classNameAlias,t.renderQueue=i.Transparent,t.needsAutoUpdate=!0,t.symbolIndex=1,t.symbolImages={},t.setSymbolTexture=t.setSymbolTexture.bind(m(t)),t.process=t.process.bind(m(t)),t.getLineType=t.getLineType.bind(m(t)),t.meshLine=new r,t.material=null,t;throw new TypeError("Cannot call a class as a function")}return t=s,(e=[{key:"render",value:function(e){if(this.data=[],this.clear(),!e)return console.error("No data for Line.");if(!e.length)return console.error("Line: the length of data is 0.",e);for(var t=[],i=0;i<e.length;i++){var o=Object.assign({},e[i]),r=o.geometry;r&&r.coordinates&&0!=r.coordinates.length&&(r=a.wgs84ToMecator(r={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:r}]},F.proj.proj),o.geometry=r.features[0].geometry,t.push(o))}this.data=[];for(var n=0;n<t.length;n++)t[n].data_index=n+1;t&&0<t.length&&(this.data=t),this.setMaterial()}},{key:"process",value:function(){this.meshLine.clear();for(var e=this.data,t=this.options.graph,i=t.sizeAttenuation,o=t.lineStyle,r=o.lineShape,n=o.lineLength,a=o.blurWidthRatio,o=t.lineHeadStyle,l=o.lineHeadColor,s=o.lineHeadSpaceRatio,o=t.symbolStyle,h=o.symbolColor,u=o.symbolUrl,o=F.baseHeightScale,c=F.drawScale,A=(F.bboxSize,this.group.position.z=(o+.05)*c*B,V.validateCustomStyle),E=N.get(this.options,"condition.condition"),z=N.get(V,"scale.color")({config:N.get(this.options,"graph.lineStyle.colorMapping"),data:e,field:"colorField"}),_=N.get(V,"scale.size")({config:N.get(this.options,"graph.lineStyle.sizeMapping"),data:e,field:"sizeField"}),p=0;p<e.length;p++){for(var d,y,f,m=(y=A({config:E,data:d=e[p],ruleKey:"rules"}))&&y[0]?y[0]:null,g={},b=y.length-1;0<=b&&(m=y[b]).graph.show;b--){var v=m.graph.lineStyle;if(v.show){g.lineType=this.getLineType(v.lineShape),g.lineColor=v.lineColor,g.lineLength=v.lineLength,g.lineWidth=i?2e4*v.lineWidth*c:v.lineWidth,g.blurWidthRatio=v.blurWidthRatio;break}break}for(b=y.length-1;0<=b&&(m=y[b]).graph.show;b--){var w=m.graph.lineHeadStyle;if(w.show){g.lineHeadColor=w.lineHeadColor,g.lineHeadSpaceRatio=.01*w.lineHeadSpaceRatio;break}}for(b=y.length-1;0<=b&&(m=y[b]).graph.show;b--){var S=m.graph.symbolStyle;if(S.show){g.symbolColor=S.symbolColor,g.symbolUrl=S.symbolUrl;break}}g.hasOwnProperty("lineType")||(g.lineType=this.getLineType(r)),g.hasOwnProperty("lineColor")||(g.lineColor=z(d.colorField)),g.hasOwnProperty("lineLength")||(g.lineLength=n),g.hasOwnProperty("lineWidth")||(f=_(d.sizeField),g.lineWidth=i?2e4*f*c:f),g.hasOwnProperty("blurWidthRatio")||(g.blurWidthRatio=a),g.hasOwnProperty("lineHeadSpaceRatio")||(g.lineHeadSpaceRatio=.01*s),g.hasOwnProperty("lineHeadColor")||(t.lineHeadStyle.show?g.lineHeadColor=l:g.lineHeadColor="rgba(255,0,0,0)"),g.hasOwnProperty("symbolUrl")||(g.symbolUrl=u),g.hasOwnProperty("symbolColor")||(t.symbolStyle.show?g.symbolColor=h:g.symbolColor="rgba(255,0,0,0)");for(var O,C=d.geometry.coordinates,k=void 0,T=[],k=0;k<C.length;k++)O=C[k],T.push(O[0],O[1],0,O[0],O[1],0);for(var L,R,x=void 0,P=0,x=0;x<T.length-6;x+=6)L=[T[x],T[x+1]],R=[T[x+6],T[x+6+1]],P+=Math.sqrt(Math.pow(R[0]-L[0],2)+Math.pow(R[1]-L[1],2));if(0!=P){var H,M=1,U=1;for(H in this.symbolImages){var W=this.symbolImages[H];if(g.symbolUrl==H){M=W.symbolType,U=W.symbolAspect;break}}this.meshLine.setGeometry(T,{curveLen:P,isGeoUv:!1,lineColor:D(g.lineColor).gl(),lineHeadColor:D(g.lineHeadColor).gl(),symbolColor:D(g.symbolColor).gl(),lineLength:Math.floor(g.lineLength),lineWidth:Math.floor(g.lineWidth),lineParams:{lineType:.01*g.lineType,blurWidthRatio:g.blurWidthRatio,lineHeadSpaceRatio:g.lineHeadSpaceRatio,lineTextureNum:.05},symbolParams:{symbolType:.01*M,symbolNum:.01*(this.symbolIndex-1),symbolAspect:.01*U}})}}this.meshLine.createGeometry();var I,j,o=this.meshLine.geometry;this.linksMesh?this.linksMesh.geometry=o:(I=F.engine.renderer,j=new G.Vector2,I.getDrawingBufferSize(j),this.material.uniforms.resolution.value=j,this.material.uniforms.near.value=0,this.material.uniforms.far.value=1e8,this.material.needsUpdate=!0,this.linksMesh=new G.Mesh(o,this.material),this.add(this.linksMesh),this.linksMesh.renderOrder=18)}},{key:"getLineType",value:function(e){var t=1;switch(e){case"线型1":t=1;break;case"线型2":t=2;break;case"线型3":t=3;break;case"线型4":t=4;break;case"线型5":t=5}return t}},{key:"setMaterial",value:function(){var e=this.options,t=e.general,e=e.graph,t=t.blending,i=e.sizeAttenuation,e=e.symbolStyle,o=this.getLineTexture(),r=(this.material?(this.material.uniforms.drawScale.value=F.drawScale,this.material.uniforms.sizeAttenuation.value=i?1:0,this.material.uniforms.map.value=o,this.material.uniforms.uvScale0.value=new G.Vector2(1,1),this.material.depthTest=!0,this.material.blending=G[t],this.material.needsUpdate=!0):this.material=c({resolution:new G.Vector2,sizeAttenuation:i?1:0,side:G.DoubleSide,blending:G[t],visibility:1,dashOffset0:0,dashOffset1:0,drawScale:F.drawScale,map:o,map1:null,uvScale0:new G.Vector2(1,1),transparent:!0,depthWrite:!1,depthTest:!0}),N.get(this.options,"condition.condition")),n=[];for(e.symbolUrl&&n.push(e.symbolUrl),h=r.length-1;0<=h;h--)if((a=r[h]).graph.show){var a=a.graph.symbolStyle;a.show&&a.symbolUrl&&n.push(a.symbolUrl);break}for(var l,n=function(e){for(var t,i,o={},r=[],n=e.length,a=0;a<n;a++)i=b(t=e[a]),o[t]?o[t].indexOf(i)<0&&(o[t].push(i),r.push(t)):(o[t]=[i],r.push(t));return r}(n),s=!1,h=0;h<n.length;h++)if(!this.symbolImages[n[h]]){s=!0;break}s?(l=this).setSymbolTexture(n).then(function(){l.process(),l.emit("rendered")}):(this.process(),this.emit("rendered"))}},{key:"autoUpdate",value:function(){var e,t;this.options&&this.material&&(e=(t=this.options.animation).dashSpeed0,t=t.dashSpeed1,this.material.uniforms.dashOffset0.value+=.001*e,this.material.uniforms.dashOffset0.value%=1,e==t?this.material.uniforms.dashOffset1.value=this.material.uniforms.dashOffset0.value:(this.material.uniforms.dashOffset1.value+=.001*t,this.material.uniforms.dashOffset1.value%=1))}},{key:"checkVisible",value:function(){this.options.visible?this.show():this.hide()}},{key:"hide",value:function(){this.options.visible=!1,d(g(s.prototype),"hide",this).call(this)}},{key:"show",value:function(){this.options.visible=!0,d(g(s.prototype),"show",this).call(this)}},{key:"updateOptions",value:function(e){this.options=o(this.options,e||{}),this.setMaterial(),this.checkVisible()}},{key:"updateBaseHeight",value:function(){var e=F.baseHeightScale,t=F.drawScale;this.group.position.z=~~(t*e*B)}},{key:"clear",value:function(){d(g(s.prototype),"clear",this).call(this),this.meshLine&&this.meshLine.clear(),this.linksMesh=null}},{key:"destroy",value:function(){d(g(s.prototype),"clear",this).call(this),this.needsAutoUpdate=!1,this.data&&(this.data.length=0)}},{key:"getLineTexture",value:function(){var e,t,i=document.createElement("canvas"),o=(i.width=100,i.height=100,i.style.width="100px",i.style.height="100px",i.getContext("2d")),r=20;for(e in u){for(var n,a=u[e],l={r:255,g:255,b:255,a:1},s=o.createLinearGradient(0,0,100,0),h=0;h<a.length;h++)n=a[h],s.addColorStop(n.percent,(t=n.percent,n=n.opacity,"rgba("+~~((l.r-l.r)*t+l.r)+","+~~((l.g-l.g)*t+l.g)+","+~~((l.b-l.b)*t+l.b)+","+n*l.a+")"));o.fillStyle=s,o.fillRect(0,100-r,100,20),r+=20}i=new G.CanvasTexture(i);return i.wrapS=G.RepeatWrapping,i.wrapT=G.RepeatWrapping,i}},{key:"setSymbolTexture",value:function(t){for(var i,l=this,o=[],e=t.length,r=0;r<e;r++)!function(e){var r=t[e];i=new Promise(function(i,e){var o;l.symbolImages[r]?i(!0):((o=new Image).crossOrigin="anonymous",o.onload=function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=o.width,e.height=o.height,t.imageSmoothingQuality="high",t.drawImage(o,0,0,o.width,o.height),l.symbolImages[r]={symbolType:l.symbolIndex,image:o,symbolAspect:o.width/o.height},l.symbolIndex++,i(!0)},o.onerror=function(){console.log("Could not load image at "+r),e(!1)},o.src=r)}),o.push(i)}(r);return Promise.all(o).then(function(e){if(l.material){var t,i=50*(l.symbolIndex-1),o=document.createElement("canvas"),r=(o.width=50,o.height=i,o.style.width="50px",o.style.height=i+"px",o.getContext("2d")),n=50;for(t in l.symbolImages){var a=l.symbolImages[t];r.drawImage(a.image,0,i-n,50,50),n+=50}o=new G.CanvasTexture(o);return o.wrapS=G.RepeatWrapping,o.wrapT=G.RepeatWrapping,l.material.map1=o,l.material.needsUpdate=!0}}).catch(function(e){return!1})}}])&&p(t.prototype,e),n&&p(t,n),Object.defineProperty(t,"prototype",{writable:!1}),s},e.exports});;
Cube("datav:/com/@datav-3d-v3/datav-3dplane-line/3.1.2",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(e,t,r,n,o,i){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function l(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=y(r),t=(e=n?(e=y(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c=r("datav:/npm/eventemitter3/3.0.0"),f=r("datav:/npm/safely-merge/1.0.1"),p=r("datav:/com/@datav-3d-v3/datav-3dplane-line/3.1.2/src/lineLayer"),r=function(){var e=o,t=c;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t);var r,n=l(o);function o(e,t){var r;if(this instanceof o)return(r=n.call(this)).options=f({},t.options||{}),r.layerId="",r.visible=!0,r;throw new TypeError("Cannot call a class as a function")}return e=o,(t=[{key:"addTo",value:function(e,t){this.viewer=e,this.layerId=t;t=p(e);this.layer=new t(this.options),e.addLayer(this.layerId+"_layer",this.layer),this.visible?this.layer.show():this.layer.hide()}},{key:"render",value:function(e){this.data=e,this.layer&&this.layer.render&&this.layer.render(e)}},{key:"updateArea",value:function(){this.render(this.data)}},{key:"updateOptions",value:function(e){this.options=f(this.options,e.options),this.layer&&this.layer.updateOptions&&this.layer.updateOptions(this.options)}},{key:"updateBaseHeight",value:function(){this.layer&&this.layer.updateBaseHeight&&this.layer.updateBaseHeight()}},{key:"show",value:function(){this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.layer&&this.layer.hide&&this.layer.hide()}},{key:"destroy",value:function(){this.layer&&this.layer.destroy&&this.layer.destroy()}}])&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),o}();return e.exports=r,e.exports});