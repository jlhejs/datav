// env=undefined => env=publish 
Cube("datav:/com/@echarts/ml-echarts-heatmap-cartesian/2.0.13",["datav:/com/maliang-echarts-utils/0.0.18","datav:/npm/bcore/0.0.18/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.6.1","datav:/npm/echarts/3.5.4"],function(a,b,c){var d=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},e=c("datav:/npm/bcore/0.0.18/event"),f=c("datav:/npm/jquery/2.1.4"),g=c("datav:/npm/lodash/4.6.1"),h=c("datav:/npm/echarts/3.5.4"),i=c("datav:/com/maliang-echarts-utils/0.0.18");return a.exports=e.extend(function(a,b){this.config={_series:{type:"heatmap"},visualMap:{type:"continuous"}},this.container=f(a),this.apis=b.apis,this._data=null,this.chart=null,this.init(b)},{init:function(a){var b=this;a=this.mergeConfig(g.defaultsDeep(a,{yAxis:{data:[]},xAxis:{data:[]}})),this.chart=h.init(this.container[0]),this.updateStyle(),this.chart.off(),this.chart.on("click",function(a){var c=b._data.filter(function(c){return c.value===a.data[2]&&c.x===a.name&&c.y===b.config.yAxis.data[a.data[1]]});b.emit("click",c.length&&c[0])}),this.chart.on("datarangeselected",function(a){console.log({selected:a.selected}),b.emit("data-range-selected",{selected:a.selected,name:a.name})})},highlight:function(a){a=g.merge(a||{},{type:"highlight"}),this.chart.dispatchAction(a)},downplay:function(a){a=g.merge(a||{},{type:"downplay"}),this.chart.dispatchAction(a)},showTip:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};a=g.merge(a,{type:"showTip"}),this.chart.dispatchAction(a)},hideTip:function(){this.chart.dispatchAction({type:"hideTip"})},selectDataRange:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};a=g.merge(a,{type:"selectDataRange"}),this.chart.dispatchAction(a)},render:function(a){a=this.data(a);this.mergeConfig(i.data2echartsHeatmap(a,this.config));this.updateStyle(),this.updateOptions()},resize:function(a,b){this.chart.resize({width:a,height:b})},data:function(a){return a&&(this._data=a),this._data},mergeConfig:function(a){return a?(a.series&&(this.config._series.data=a.series[0].data,this.config._series=g.defaultsDeep(a.series[0]||{},this.config._series)),this.config.visualMap&&a.visualMap&&a.visualMap._inRange&&(this.config.visualMap._inRange=a.visualMap._inRange),this.config=g.defaultsDeep(a||{},this.config),this.config.series=[this.config._series],this.config.visualMap.inRange={color:this.config.visualMap._inRange},this.config.tooltip.showContent=this.config.tooltip.show,this.config):this.config},updateStyle:function(){this.config},updateOptions:function(a){a=this.mergeConfig(a);var b=i.config2echartsOptions(a),c=[],e=b,f=e.xAxis,h=f.min,j=f.max,k=e.yAxis,l=k.min,m=k.max,n=e.visualMap,o=n.min,p=n.max;g.map(this._data,function(a){g.isNaN(g.toNumber(a.value))||c.push(a.value)}),b=d({},b,{xAxis:d({},b.xAxis,{min:this.setMinMax(h),max:this.setMinMax(j)}),yAxis:d({},b.yAxis,{min:this.setMinMax(l),max:this.setMinMax(m)}),visualMap:d({},b.visualMap,{min:"dataMin"==o?g.min(c):g.toNumber(o),max:"dataMax"==p?g.max(c):g.toNumber(p)})}),this.chart.setOption(b)},setMinMax:function(a){var b=g.toNumber(a);return null==a?null:g.isNaN(b)?a:b},clear:function(){this.chart&&this.chart.clear&&this.chart.clear()},destroy:function(){this.chart&&this.chart.dispose&&this.chart.dispose()}}),a.exports});