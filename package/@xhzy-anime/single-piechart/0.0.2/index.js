// env=undefined => env=publish 
Cube("datav:/com/@xhzy-anime/single-piechart/0.0.2",["datav:/npm/bcore/0.0.18/event","datav:/npm/jquery/3.5.1","datav:/npm/lodash/4.17.15","datav:/npm/vizz/0.2.54"],function(a,b,c){var d=c("datav:/npm/bcore/0.0.18/event"),e=c("datav:/npm/jquery/3.5.1"),f=c("datav:/npm/lodash/4.17.15"),g=c("datav:/npm/vizz/0.2.54");return a.exports=d.extend(function(a,b){var c=this;this.config={theme:{}},this.container=e(a),this.apis=b.apis,this._data=null,this.chart=null,this.option=null,this.animation=null,this.interval=null,this.pieData=null,this.duration=null,this.init(b),this.finish=function(a){var b=a.data,d=a.duration,e=new Date().getTime();c.myReq=requestAnimationFrame(function a(){var f=new Date().getTime();f-e<d?c.myReq=requestAnimationFrame(a):(c.emit("finish",{data:b}),cancelAnimationFrame(c.myReq))})}},{init:function(a){this.mergeConfig(a),this.updateLayout(),this.updateStyle()},render:function(a,b){a=this.data(a);var c=this.mergeConfig(b);this.chart=g.init(this.container[0]);var d=this.chart.getHeight(),e=this.chart.getWidth(),f=[];a.forEach(function(a,b){var d=b%c.options.series.series.values.length,e=c.options.series.series.values[d].value;f.push(e)}),this.labelFunc=function(a){var b=a.group,c=a.label,e=a.number,f=a.percent;return function(a){return{fontFamily:"PingFang-SC-Medium",fontSize:c.fontSize,textVerticalAlign:"middle",rich:{name:{fontSize:c.fontSize,textFill:b[a.index%b.length],fontWeight:c.fontWeight},value:{fontFamily:"DINCond-Medium",fontSize:e.fontSize,textFill:e.color,fontWeight:e.fontWeight},percent:{fontFamily:"DINCond-Medium",fontSize:f.fontSize,textFill:f.color,fontWeight:f.fontWeight}}}}},this.option={series:[{type:"animePie",data:a.map(function(a){return{name:a.name,value:Math.abs(a.value)}}),center:[e/2,d/2],color:f,innerRadius:c.options.series.series.innerRadius+"%",radius:c.options.series.series.radius+"%",labelLine:{length:[c.options.series.series.link.length/2,c.options.series.series.link.length/2],style:{lineWidth:c.options.series.series.link.lineWidth}},label:{style:this.labelFunc({group:f,label:c.options.chart.label.text,number:c.options.chart.number.text,percent:c.options.chart.percent.text})},animationDuration:1e3*c.options.others.animation.animationDuration/5,eachDuration:4*(1e3*c.options.others.animation.animationDuration)/5/a.length,eachDelay:0}]},this.chart.setOption(this.option);var h=1e3*c.options.others.animation.animationDelay+1e3*c.options.others.animation.animationDuration;this.finish({data:a,duration:h}),this.updateStyle()},resize:function(a,b){this.updateLayout(a,b),this.option.series[0].center=[a/2,b/2],this.chart.resize(),this.chart.setOption(this.option)},setColors:function(){},data:function(a){return a&&(this._data=a),this._data},mergeConfig:function(a){return a?(this.config.theme=f.defaultsDeep(a.theme||{},this.config.theme),this.setColors(),this.config=f.defaultsDeep(a||{},this.config),this.config):this.config},updateLayout:function(){},updateStyle:function(){},updateOptions:function(a){var b=[];a.options.series.series.values.forEach(function(a){b.push(a.value)}),this.option.series[0].color=b,this.option.series[0].label.style=this.labelFunc({group:b,label:a.options.chart.label.text,number:a.options.chart.number.text,percent:a.options.chart.percent.text}),this.option.series[0].innerRadius=a.options.series.series.innerRadius+"%",this.option.series[0].radius=a.options.series.series.radius+"%",this.option.series[0].labelLine={length:[a.options.series.series.link.length/2,a.options.series.series.link.length/2],style:{lineWidth:a.options.series.series.link.lineWidth}};var c=this.data();this.option.series[0].animationDuration=1e3*a.options.others.animation.animationDuration/5,this.option.series[0].eachDuration=4*(1e3*a.options.others.animation.animationDuration)/5/c.length;var d=1e3*a.options.others.animation.animationDelay+1e3*a.options.others.animation.animationDuration;this.finish({data:c,duration:d}),this.chart.setOption(this.option)},destroy:function(){this.chart.clear()},getThemableConfig:function(a){if(!a)return null;var b=this.config.options.series.series.values.map(function(b,c){return{name:b.name,value:a.palette[c]||a.palette[c%a.palette.length]}}),c={options:{chart:{number:{text:{color:a.textColor}},percent:{text:{color:a.textColor}}},series:{series:{values:b}}}};return c}}),a.exports});