// env=undefined => env=publish 
Cube("datav:/com/map3d-korea-model/0.0.2/src/layers/libs/ColladaLoader2",["datav:/npm/three/0.88.0"],function(a,b,c){const e=c("datav:/npm/three/0.88.0");return e.ColladaLoader=function(a){this.manager=void 0===a?e.DefaultLoadingManager:a},e.ColladaLoader.prototype={constructor:e.ColladaLoader,load:function(a,b,c,d){var f=this,g=new e.FileLoader(f.manager);g.load(a,function(a){b(f.parse(a))},c,d)},options:{set convertUpAxis(a){console.log("ColladaLoder.options.convertUpAxis: TODO")}},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a){function b(a,b){for(var c,d=[],e=a.childNodes,f=0,g=e.length;f<g;f++)c=e[f],c.nodeName===b&&d.push(c);return d}function c(a){if(0===a.length)return[];for(var b=a.trim().split(/\s+/),c=Array(b.length),d=0,e=b.length;d<e;d++)c[d]=parseFloat(b[d]);return c}function d(a){if(0===a.length)return[];for(var b=a.trim().split(/\s+/),c=Array(b.length),d=0,e=b.length;d<e;d++)c[d]=parseInt(b[d]);return c}function f(a){return a.substring(1)}function g(a){return void 0===a?1:parseFloat(a.getAttribute("meter"))}function h(a){return void 0===a?"Y_UP":a.textContent}function i(a,c,d,e){var f=b(a,c)[0];if(void 0!==f)for(var g=b(f,d),h=0;h<g.length;h++)e(g[h])}function j(a,b){for(var c in a){var d=a[c];d.build=b(a[c])}}function k(a,b){return void 0===a.build?(a.build=b(a),a.build):a.build}function l(a){return void 0===a.build?new Image:a.build}function m(a){return k(da.images[a],l)}function n(a){for(var b,c={surfaces:{},samplers:{}},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"newparam":o(b,c);break;case"technique":c.technique=r(b);}return c}function o(a,b){for(var c,d=a.getAttribute("sid"),e=0,f=a.childNodes.length;e<f;e++)if(c=a.childNodes[e],1===c.nodeType)switch(c.nodeName){case"surface":b.surfaces[d]=p(c);break;case"sampler2D":b.samplers[d]=q(c);}}function p(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"init_from":c.init_from=b.textContent;}return c}function q(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"source":c.source=b.textContent;}return c}function r(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"constant":case"lambert":case"blinn":case"phong":c.type=b.nodeName,c.parameters=s(b);}return c}function s(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"emission":case"diffuse":case"specular":case"shininess":case"transparent":case"transparency":c[b.nodeName]=t(b);}return c}function t(a){for(var b,d={},e=0,f=a.childNodes.length;e<f;e++)if(b=a.childNodes[e],1===b.nodeType)switch(b.nodeName){case"color":d[b.nodeName]=c(b.textContent);break;case"float":d[b.nodeName]=parseFloat(b.textContent);break;case"texture":d[b.nodeName]={id:b.getAttribute("texture"),extra:u(b)};}return d}function u(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"extra":c=v(b);}return c}function v(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"technique":c[b.nodeName]=w(b);}return c}function w(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":c[b.nodeName]=parseFloat(b.textContent);break;case"wrapU":case"wrapV":c[b.nodeName]=parseInt(b.textContent);}return c}function x(a){return a}function y(a){return k(da.effects[a],x)}function z(a){function b(a){var b=d.profile.samplers[a.id];if(void 0!==b){var c=d.profile.surfaces[b.source],f=new e.Texture(m(c.init_from)),g=a.extra;if(void 0!==g&&void 0!==g.technique){var h=g.technique;f.wrapS=h.wrapU?e.RepeatWrapping:e.ClampToEdgeWrapping,f.wrapT=h.wrapV?e.RepeatWrapping:e.ClampToEdgeWrapping,f.offset.set(h.offsetU,h.offsetV),f.repeat.set(h.repeatU,h.repeatV)}else f.wrapS=e.RepeatWrapping,f.wrapT=e.RepeatWrapping;return f.needsUpdate=!0,f}return console.error("ColladaLoder: Undefined sampler",a.id),null}var c,d=y(a.url),f=d.profile.technique;switch(f.type){case"phong":case"blinn":c=new e.MeshPhongMaterial;break;case"lambert":c=new e.MeshLambertMaterial;break;default:c=new e.MeshBasicMaterial;}c.name=a.name;var g=f.parameters;for(var h in g){var i=g[h];"diffuse"===h?(i.color&&c.color.fromArray(i.color),i.texture&&(c.map=b(i.texture))):"specular"===h?i.color&&c.specular&&c.specular.fromArray(i.color):"shininess"===h?i.float&&c.shininess&&(c.shininess=i.float):"emission"===h?i.color&&c.emissive&&c.emissive.fromArray(i.color):"transparent"===h?c.transparent=!0:"transparency"===h?(void 0!==i.float&&(c.opacity=i.float),c.transparent=!0):void 0}return c}function A(a){return k(da.materials[a],z)}function B(a){for(var b,c=0;c<a.childNodes.length;c++)switch(b=a.childNodes[c],b.nodeName){case"technique_common":return C(b);}return{}}function C(a){for(var b,c={},d=0;d<a.childNodes.length;d++)switch(b=a.childNodes[d],b.nodeName){case"perspective":case"orthographic":c.technique=b.nodeName,c.parameters=D(b);}return c}function D(a){for(var b,c={},d=0;d<a.childNodes.length;d++)switch(b=a.childNodes[d],b.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":c[b.nodeName]=parseFloat(b.textContent);}return c}function E(a){var b;switch(a.optics.technique){case"perspective":b=new e.PerspectiveCamera(a.optics.parameters.yfov,a.optics.parameters.aspect_ratio,a.optics.parameters.znear,a.optics.parameters.zfar);break;case"orthographic":b=new e.OrthographicCamera;break;default:b=new e.PerspectiveCamera;}return b.name=a.name,b}function F(a){return k(da.cameras[a],E)}function G(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"directional":case"point":case"spot":case"ambient":c.technique=b.nodeName,c.parameters=H(b);}return c}function H(a){for(var b,d={},g=0,h=a.childNodes.length;g<h;g++)if(b=a.childNodes[g],1===b.nodeType)switch(b.nodeName){case"color":var i=c(b.textContent);d.color=new e.Color().fromArray(i);break;case"falloff_angle":d.falloffAngle=parseFloat(b.textContent);break;case"quadratic_attenuation":var j=parseFloat(b.textContent);d.distance=j?Math.sqrt(1/j):0;}return d}function I(a){var b;switch(a.technique){case"directional":b=new e.DirectionalLight;break;case"point":b=new e.PointLight;break;case"spot":b=new e.SpotLight;break;case"ambient":b=new e.AmbientLight;}return a.parameters.color&&b.color.copy(a.parameters.color),a.parameters.distance&&(b.distance=a.parameters.distance),b}function J(a){return k(da.lights[a],I)}function K(a){for(var d,e={array:[],stride:3},f=0;f<a.childNodes.length;f++)if(d=a.childNodes[f],1===d.nodeType)switch(d.nodeName){case"float_array":e.array=c(d.textContent);break;case"technique_common":var g=b(d,"accessor")[0];void 0!==g&&(e.stride=parseInt(g.getAttribute("stride")));break;default:console.log(d);}return e}function L(a){for(var b,c={},d=0;d<a.childNodes.length;d++)b=a.childNodes[d],1===b.nodeType&&(c[b.getAttribute("semantic")]=f(b.getAttribute("source")));return c}function M(a){for(var b,c={type:a.nodeName,material:a.getAttribute("material"),inputs:{},stride:0},e=0,g=a.childNodes.length;e<g;e++)if(b=a.childNodes[e],1===b.nodeType)switch(b.nodeName){case"input":var h=f(b.getAttribute("source")),i=b.getAttribute("semantic"),j=parseInt(b.getAttribute("offset"));c.inputs[i]={id:h,offset:j},c.stride=W(c.stride,j+1);break;case"vcount":c.vcount=d(b.textContent);break;case"p":c.p=d(b.textContent);}return c}function N(a){var b={},c=a.sources,d=a.vertices,f=a.primitives;if(0===f.length)return b;for(var g=0;g<f.length;g++){var h=f[g],i=h.inputs,j=new e.BufferGeometry;for(var k in a.name&&(j.name=a.name),i){var l=i[k];switch(k){case"VERTEX":for(var m in d)j.addAttribute(m.toLowerCase(),O(h,c[d[m]],l.offset));break;case"NORMAL":j.addAttribute("normal",O(h,c[l.id],l.offset));break;case"COLOR":j.addAttribute("color",O(h,c[l.id],l.offset));break;case"TEXCOORD":j.addAttribute("uv",O(h,c[l.id],l.offset));}}var n;switch(h.type){case"lines":n=new e.LineSegments(j,X);break;case"linestrips":n=new e.Line(j,X);break;case"triangles":case"polylist":n=new e.Mesh(j,Y);}b[h.material]=n}return b}function O(f,g,h){function j(a){for(var b=k[a+h]*q,c=b+q;b<c;b++)r.push(p[b])}var k=f.p,m=f.stride,n=f.vcount,o=0,p=g.array,q=g.stride,r=[];if(void 0!==f.vcount){for(var s,t=0,u=0,i=n.length;u<i;u++){if(s=n[u],4===s){var l=t+0*m,a=t+1*m,b=t+2*m,c=t+3*m;j(l),j(a),j(c),j(a),j(b),j(c)}else if(3===s){var l=t+0*m,a=t+1*m,b=t+2*m;j(l),j(a),j(b)}else o=W(o,s);t+=m*s}0<o&&console.log("ColladaLoader: Geometry has faces with more than 4 vertices.")}else for(var u=0,i=k.length;u<i;u+=m)j(u);return new e.Float32BufferAttribute(r,q)}function P(a){return k(da.geometries[a],N)}function Q(a){for(var b,d={name:a.getAttribute("name"),matrix:new e.Matrix4,nodes:[],instanceCameras:[],instanceLights:[],instanceGeometries:[],instanceNodes:[]},g=0;g<a.childNodes.length;g++)if(b=a.childNodes[g],1===b.nodeType)switch(b.nodeName){case"node":b.hasAttribute("id")&&(d.nodes.push(b.getAttribute("id")),Q(b));break;case"instance_camera":d.instanceCameras.push(f(b.getAttribute("url")));break;case"instance_light":d.instanceLights.push(f(b.getAttribute("url")));break;case"instance_geometry":d.instanceGeometries.push(R(b));break;case"instance_node":d.instanceNodes.push(f(b.getAttribute("url")));break;case"matrix":var h=c(b.textContent);d.matrix.multiply(Z.fromArray(h).transpose());break;case"translate":var h=c(b.textContent);$.fromArray(h),d.matrix.multiply(Z.makeTranslation($.x,$.y,$.z));break;case"rotate":var h=c(b.textContent),i=e.Math.degToRad(h[3]);d.matrix.multiply(Z.makeRotationAxis($.fromArray(h),i));break;case"scale":var h=c(b.textContent);d.matrix.scale($.fromArray(h));break;case"extra":break;default:console.log(b);}return a.hasAttribute("id")&&(da.nodes[a.getAttribute("id")]=d),d}function R(a){for(var b,c={id:f(a.getAttribute("url")),materials:{}},d=0;d<a.childNodes.length;d++)if(b=a.childNodes[d],"bind_material"===b.nodeName){for(var e=b.getElementsByTagName("instance_material"),g=0;g<e.length;g++){var h=e[g],i=h.getAttribute("symbol"),j=h.getAttribute("target");c.materials[i]=f(j)}break}return c}function S(a){for(var b=[],c=a.matrix,d=a.nodes,f=a.instanceCameras,g=a.instanceLights,h=a.instanceGeometries,j=a.instanceNodes,k=0,i=d.length;k<i;k++)b.push(T(d[k]).clone());for(var k=0,i=f.length;k<i;k++)b.push(F(f[k]).clone());for(var k=0,i=g.length;k<i;k++)b.push(J(g[k]).clone());for(var k=0,i=h.length;k<i;k++){var l=h[k],m=P(l.id);for(var n in m){var o=m[n].clone();void 0!==l.materials[n]&&(o.material=A(l.materials[n])),b.push(o)}}for(var k=0,i=j.length;k<i;k++)b.push(T(j[k]).clone());var o;if(0===d.length&&1===b.length)o=b[0];else{o=new e.Group;for(var k=0;k<b.length;k++)o.add(b[k])}return o.name=a.name,c.decompose(o.position,o.quaternion,o.scale),o}function T(a){return k(da.nodes[a],S)}function U(a){var b=new e.Group;b.name=a.name;for(var c=a.children,d=0;d<c.length;d++)b.add(S(c[d]));return b}function V(a){return k(da.visualScenes[a],U)}var W=Math.max,X=new e.LineBasicMaterial,Y=new e.MeshPhongMaterial,Z=new e.Matrix4,$=new e.Vector3;if(console.time("ColladaLoader"),0===a.length)return{scene:new e.Scene};console.time("ColladaLoader: DOMParser");var _=new DOMParser().parseFromString(a,"application/xml");console.timeEnd("ColladaLoader: DOMParser");var aa=b(_,"COLLADA")[0],ba=aa.getAttribute("version");console.log("ColladaLoader: File version",ba);var ca=function(a){return{unit:g(b(a,"unit")[0]),upAxis:h(b(a,"up_axis")[0])}}(b(aa,"asset")[0]),da={images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{}};console.time("ColladaLoader: Parse"),i(aa,"library_images","image",function(a){var c={init_from:b(a,"init_from")[0].textContent};da.images[a.getAttribute("id")]=c}),i(aa,"library_effects","effect",function(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"profile_COMMON":c.profile=n(b);}da.effects[a.getAttribute("id")]=c}),i(aa,"library_materials","material",function(a){for(var b,c={name:a.getAttribute("name")},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"instance_effect":c.url=f(b.getAttribute("url"));}da.materials[a.getAttribute("id")]=c}),i(aa,"library_cameras","camera",function(a){for(var b,c={name:a.getAttribute("name")},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"optics":c.optics=B(b);}da.cameras[a.getAttribute("id")]=c}),i(aa,"library_lights","light",function(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"technique_common":c=G(b);}da.lights[a.getAttribute("id")]=c}),i(aa,"library_geometries","geometry",function(a){for(var c,d={name:a.getAttribute("name"),sources:{},vertices:{},primitives:[]},e=b(a,"mesh")[0],f=0;f<e.childNodes.length;f++)if(c=e.childNodes[f],1===c.nodeType){var g=c.getAttribute("id");switch(c.nodeName){case"source":d.sources[g]=K(c);break;case"vertices":d.vertices=L(c);break;case"polygons":console.warn("ColladaLoader: Unsupported primitive type: ",c.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":d.primitives.push(M(c));break;default:console.log(c);}}da.geometries[a.getAttribute("id")]=d}),i(aa,"library_nodes","node",Q),i(aa,"library_visual_scenes","visual_scene",function(a){for(var c={name:a.getAttribute("name"),children:[]},d=b(a,"node"),e=0;e<d.length;e++)c.children.push(Q(d[e]));da.visualScenes[a.getAttribute("id")]=c}),console.timeEnd("ColladaLoader: Parse"),console.time("ColladaLoader: Build"),j(da.images,l),j(da.effects,x),j(da.materials,z),j(da.cameras,E),j(da.lights,I),j(da.geometries,N),j(da.visualScenes,U),console.timeEnd("ColladaLoader: Build");var ea=function(a){var c=b(a,"instance_visual_scene")[0];return V(f(c.getAttribute("url")))}(b(aa,"scene")[0]);return"Z_UP"===ca.upAxis&&(ea.rotation.x=-Math.PI/2),ea.scale.multiplyScalar(ca.unit),console.timeEnd("ColladaLoader"),{animations:[],kinematics:{joints:[]},library:da,scene:ea}}},a.exports});;
Cube("datav:/com/map3d-korea-model/0.0.2/src/layers/building",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(a,b,c){var d=Math.PI;let e=null;const f=c("datav:/npm/eventemitter3/3.0.0"),g=c("datav:/npm/safely-merge/1.0.1");c("datav:/com/map3d-korea-model/0.0.2/src/layers/libs/ColladaLoader2");const h={opacity:1,offsetX:0,offsetY:0,offsetZ:0,rotationX:0,rotationY:0,rotationZ:0,modelUrl:"http://sh-conf.oss-cn-shanghai.aliyuncs.com/korea-model.dae"};return a.exports=class extends f{constructor(a){super(),this.options=g(h,a||{})}addTo(a,b){a||console.error("buildings need scene"),e=b,this.scene=a}render(a){this.remove();let b=this,c=this.scene,d=this.options,f=a[0].url||d.modelUrl,g=new e.ColladaLoader;g.options.convertUpAxis=!0,g.load(f,function(a){b.model=a,a.scene.scale.set(0.01,0.01,0.01),c.add(a.scene);let d=new e.Box3,f=d.setFromObject(a.scene),g=b.center=f.getCenter();console.log("\u5EFA\u7B51\u5927\u5C0F\uFF1A",f.getSize()),b.setRotation(),b.setPosition(),b.updateMaterial()})}updateMaterial(){let a=this.options.opacity;this.model&&this.model.scene.traverse((b)=>{"Mesh"===b.type&&(b.material=b.material.clone(),b.material.transparent=!0,b.material.alphaTest=0.1,b.material.opacity=a,b.material.depthWrite=!1,b.material.needsUpdate=!0)})}setPosition(){let a=this.options,b=this.center;this.model&&this.model.scene.position.set(a.offsetX-b.x,a.offsetY-b.y,a.offsetZ-b.z)}planarization(){this.model&&this.model.scene.rotation.set(this.options.rotationX*d,0,0)}setRotation(){let a=this.options,b=a.rotationX,c=a.rotationY,e=a.rotationZ;this.model&&this.model.scene.rotation.set(b*d,c*d,e*d)}updateModel(){this.render()}updateOptions(a){let b=this.options.modelUrl;this.options=g(this.options,a||{}),b!==a.modelUrl&&this.updateModel(),this.setPosition(),this.setRotation(),this.updateMaterial()}remove(){this.model&&this.scene.remove(this.model.scene),this.model&&this.disposeNode(this.model.scene),this.model=null}disposeNode(a){a.traverse(function(a){a instanceof e.Mesh&&(a.geometry&&a.geometry.dispose(),a.material&&(a.material instanceof e.MeshFaceMaterial||a.material instanceof e.MultiMaterial?a.material.materials.forEach(function(a){a.map&&a.map.dispose(),a.lightMap&&a.lightMap.dispose(),a.bumpMap&&a.bumpMap.dispose(),a.normalMap&&a.normalMap.dispose(),a.specularMap&&a.specularMap.dispose(),a.envMap&&a.envMap.dispose(),a.dispose()}):(a.material.map&&a.material.map.dispose(),a.material.lightMap&&a.material.lightMap.dispose(),a.material.bumpMap&&a.material.bumpMap.dispose(),a.material.normalMap&&a.material.normalMap.dispose(),a.material.specularMap&&a.material.specularMap.dispose(),a.material.envMap&&a.material.envMap.dispose(),a.material.dispose())))})}},a.exports});;
Cube("datav:/com/map3d-korea-model/0.0.2/src/layers/heatmap",["datav:/npm/chroma-js/1.3.4","datav:/npm/eventemitter3/3.0.0","datav:/npm/simpleheat/0.4.0","datav:/npm/safely-merge/1.0.1"],function(a,b,c){let d=null;const e=c("datav:/npm/chroma-js/1.3.4"),f=c("datav:/npm/eventemitter3/3.0.0"),g=c("datav:/npm/simpleheat/0.4.0"),h=c("datav:/npm/safely-merge/1.0.1"),i={width:145,height:75,minOpacity:0.6,maxZoom:18,zScale:1,radius:5,blur:15,max:1,offsetX:0,offsetY:0,offsetZ:0,rotationX:0,rotationY:0,rotationZ:0};return a.exports=class extends f{constructor(a){super(),this.options=h(i,a||{})}addTo(a,b){a||console.error("heatmap need scene"),d=b,this.scene=a,this.init()}init(){let a=this.options,b=this.options.width,c=this.options.height,e=this.canvas=document.createElement("canvas");e.width=b,e.height=c,this.heatmap=new g(e),this.updateHeatmapOptions();let f=this.texture=new d.Texture(e);f.anisotropy=8;let h=this.material=this.initMaterial(),i=this.geometry=new d.PlaneBufferGeometry(b,c,b,c),j=this.mesh=new d.Mesh(i,h);j.renderOrder=1e3,this.setRotation(a.rotationX,a.rotationY,a.rotationZ),this.setPosition(a.offsetX,a.offsetY,a.offsetZ),this.scene.add(j)}initMaterial(){let a=this.options,b=a.gradient,c=e(b["0.0"]).gl(),f=e(b["1.0"]).gl();return new d.ShaderMaterial({uniforms:{uScale:{value:a.zScale},uTexture:{value:this.texture},uSourceColor:{value:new d.Vector3(c[0],c[1],c[2])},uTargetColor:{value:new d.Vector3(f[0],f[1],f[2])}},vertexShader:`
      #ifdef GL_ES
        precision highp float;
      #endif

      varying vec2 vUv;
      uniform float uScale;
      uniform vec3 uSourceColor;
      uniform vec3 uTargetColor;
      uniform sampler2D uTexture;

      float getIndex(float a, float b, float x){
        if(a == b) return 0.0;
        return (x - a) / (b - a);
      }

      float getZ(vec4 color){
        float r_delta = getIndex(uSourceColor.r, uTargetColor.r, color.r);
        float g_delta = getIndex(uSourceColor.g, uTargetColor.g, color.g);
        float b_delta = getIndex(uSourceColor.b, uTargetColor.b, color.b);

        return ((r_delta + g_delta + b_delta) / 3.0) * uScale;
      }

      float decodeRGBA2Float( vec4 color ) {
        return dot( color, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0));
      }

      void main() {
        vUv = uv;
        vec4 color = texture2D(uTexture, uv);
        // float z = position.z + color.r * uScale;
        float z = position.z + getZ(color);
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy, z, 1.0);
      }
      `,fragmentShader:`
      varying vec2 vUv;     
      uniform sampler2D uTexture;
      void main() {
        gl_FragColor = texture2D(uTexture, vUv);
      }
      `,side:d.DoubleSide,blending:d.NormalBlending,depthTest:!0,depthWrite:!0,transparent:!0,polygonOffset:!0,polygonOffsetUnits:1,polygonOffsetFactor:0.75})}setData(a){a||console.error("heatmap need data"),this.ds=a,this.render()}render(){this.heatmap.resize();let a=this.options,b=a.width,c=a.height,f=a.gradient,g=e(f["0.0"]).gl(),h=e(f["1.0"]).gl(),i=this.ds.map((a)=>{return[a.x*b,a.y*c,a.value||1]});this.heatmap.data(i).draw(a.minOpacity),this.material.uniforms.uTexture.value=this.texture,this.material.uniforms.uScale.value=a.zScale,this.material.uniforms.uSourceColor.value=new d.Vector3(g[0],g[1],g[2]),this.material.uniforms.uTargetColor.value=new d.Vector3(h[0],h[1],h[2]),this.material.needsUpdate=!0,this.texture.needsUpdate=!0}setRotation(a,b,c){var d=Math.PI;this.mesh&&this.mesh.rotation.set(a*d,b*d,c*d)}setPosition(a,b,c){this.mesh&&this.mesh.position.set(a,b,c)}redraw(){let a=this.options;this.updateCanvas(),this.updateHeatmapOptions(),this.render(),this.setRotation(a.rotationX,a.rotationY,a.rotationZ),this.setPosition(a.offsetX,a.offsetY,a.offsetZ)}updateCanvas(){let a=this.options;this.canvas.width=a.width,this.canvas.height=a.height}updateHeatmapOptions(){let a=this.options;this.heatmap.radius(a.radius,a.blur),a.gradient&&this.heatmap.gradient(a.gradient),a.max&&this.heatmap.max(a.max)}updateOptions(a){this.options=h(this.options,a||{}),this.redraw()}remove(){this.scene.remove(this.mesh),this.mesh&&this.mesh.dispose&&this.mesh.dispose(),this.mesh.geometry&&this.mesh.geometry.dispose(),this.mesh.material&&this.mesh.material.dispose(),this.mesh=null,this.heatmap.clear(),this.heatmap=null,this.canvas=null}},a.exports});;
Cube("datav:/com/map3d-korea-model/0.0.2/src/index.js",["datav:/npm/three/0.88.0","datav:/npm/stats.js/0.17.0","datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1","datav:/npm/three-orbit-controls/82.1.0"],function(a,b,c){const d=c("datav:/npm/three/0.88.0"),e=c("datav:/npm/stats.js/0.17.0"),f=c("datav:/npm/eventemitter3/3.0.0"),g=c("datav:/npm/safely-merge/1.0.1"),h=c("datav:/npm/three-orbit-controls/82.1.0")(d),i=c("datav:/com/map3d-korea-model/0.0.2/src/layers/heatmap"),j=c("datav:/com/map3d-korea-model/0.0.2/src/layers/building"),k={showStats:!0,camera:{x:0,y:0,z:200,lookAtX:0,lookAtY:0,lookAtZ:0}};return a.exports=class extends f{constructor(a,b){super(),this.container="string"===typeof a?document.querySelector(a):a,this.options=g(k,b),this.init(),this.initStats(),this.loop()}init(){let a=this.container,b=a.offsetWidth,c=a.offsetHeight,e=this.scene=new d.Scene,f=this.camera=new d.PerspectiveCamera(75,b/c,0.01,1e8),g=this.renderer=new d.WebGLRenderer({alpha:!0,antialias:!0});g.setSize(b,c),a.appendChild(g.domElement);let i=this.controls=new h(f,g.domElement);i.enabled=!0,i.minDistance=0,i.maxDistance=4e4;var j=new d.AmbientLight(16777215,0.8);e.add(j),this.setCamera(),this.initControlEvent()}initControlEvent(){let a=this.controls,b=this.controls.object;document.onclick=function(){console.info("\u5F53\u524D\u76F8\u673A\u4F4D\u7F6E"),console.log(JSON.stringify({x:b.position.x,y:b.position.y,z:b.position.z,lookAtX:a.target.x,lookAtY:a.target.y,lookAtZ:a.target.z}))}}initStats(){let a=this.stats=new e;a.showPanel(0),this.container.appendChild(a.dom),this.updateStats()}setCamera(){let a=this.options,b=a.camera,c=new d.Vector3(b.lookAtX,b.lookAtY,b.lookAtZ);this.controls.target.copy(c),this.camera.position.set(b.x,b.y,b.z),this.camera.lookAt(c)}resize(a,b){this.renderer.setSize(a,b),this.camera.aspect=a/b,this.camera.updateProjectionMatrix()}initBuilding(a){this.building=new j(a),this.building.addTo(this.scene,d)}initHeatMap(a){this.heatmap=new i(a),this.heatmap.addTo(this.scene,d)}renderHeatmapLayer(a){this.heatmap&&this.heatmap.setData(a)}renderBuildingLayer(a){this.building&&this.building.render(a)}updateHeatmapOptions(a){this.heatmap&&this.heatmap.updateOptions(a)}updateBuildingOptions(a){this.building&&this.building.updateOptions(a)}updateStats(){this.stats.dom.style.visibility=this.options.showStats?"visible":"hidden"}updateThreeMap(a){this.options=g(this.options,a||{}),this.setCamera(),this.updateStats()}loop(){this.controls&&this.controls.update(),this.options.showStats&&this.stats.update(),this.renderer.render(this.scene,this.camera),window.requestAnimationFrame(this.loop.bind(this))}},a.exports});;
Cube("datav:/com/map3d-korea-model/0.0.2",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(a,b,c){const d=c("datav:/com/map3d-korea-model/0.0.2/src/index.js"),e=c("datav:/npm/eventemitter3/3.0.0"),f=c("datav:/npm/safely-merge/1.0.1"),g={};return a.exports=class extends e{constructor(a,b){super(),this.container="string"===typeof a?document.querySelector(a):a,this.apis=b.apis,this.options=f(g,b),this.initMap(),this.initLayers()}initMap(){this.map=new d(this.container,this.options.base)}initLayers(){let a=this.options;this.map.initBuilding(a.building),this.map.initHeatMap(a.heatmap)}renderHeatmapLayer(a){return a&&a.length?void(this.map&&this.map.renderHeatmapLayer(a)):console.log("heatmap layer has no data")}renderBuildingLayer(a){return a&&a.length?void(this.map&&this.map.renderBuildingLayer(a)):console.log("building layer has no data")}updateBaseOptions(a){this.map&&this.map.updateThreeMap(a)}updateHeatmapOptions(a){this.map&&this.map.updateHeatmapOptions(a)}updateBuildingOptions(a){this.map&&this.map.updateBuildingOptions(a)}resize(a,b){this.map&&this.map.resize(a,b)}},a.exports});