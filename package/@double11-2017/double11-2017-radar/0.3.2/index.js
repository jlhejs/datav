// env=undefined => env=publish 
Cube("datav:/com/@double11-2017/double11-2017-radar/0.3.2",["datav:/npm/bcore/0.0.18/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.6.1","datav:/npm/d3/3.5.12","datav:/npm/chroma-js/1.3.4"],function(a,b,c){function e(a,b){var c=0;for(a<b[c].pos&&(c=1),1!=b[b.length-1].pos&&(b[b.length-1].pos=1);a>=b[c].pos;)c++;return c}function d(a,b,c){var d="",e=b,f=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];a&&(e=Math.round(Math.random()*(c-b))+b);for(var g,h=0;h<e;h++)g=Math.round(Math.random()*(f.length-1)),d+=f[g];return d}var f=c("datav:/npm/bcore/0.0.18/event"),g=c("datav:/npm/jquery/2.1.4"),h=c("datav:/npm/lodash/4.6.1"),j=c("datav:/npm/d3/3.5.12"),k=c("datav:/npm/chroma-js/1.3.4"),l=Math.PI;return a.exports=f.extend(function(a,b){this.config={theme:{},global:{top:20,percent:0.81},bgCircle:{strokeColor:"rgba(52,71,255,1)",strokeWidth:2},radarPath:{maxValue:100,strokeColor:"rgba(0,106,255,1)",strokeWidth:4},label:{dy:10,strokeColor:"rgba(255,255,255,0.2)",strokeWidth:2,fontFamily:"Microsoft Yahei",fontSize:20,color:"red",fontWeight:"normal"},light:{background:"https://datav.oss-cn-hangzhou.aliyuncs.com/uploads/images/117b8e67801036bf8aa5a27da7c4a309.png",animationTime:1}},this.container=g(a),this.apis=b.apis,this._data=null,this.chart=null,this.initMode=!0,this.init(b)},{initSvg:function(){var a=this.config,b=this.container;b.empty(),b.css({background:"transparent",position:"relative"}),this.svg=j.select(b[0]).append("svg").attr("width",a.global.width).attr("height",a.global.height).append("g").attr("transform","translate("+a.global.width/2+","+(a.global.height+a.global.top)/2+")"),a.light.show&&this.initLight(a.global.width/2,(a.global.height+a.global.top)/2)},initBgCircle:function(){var a=this.config,b=a.global.radius;this.svg.append("circle").attr({cx:0,cy:0,class:"circle",r:b}).style({fill:"transparent",stroke:a.bgCircle.strokeColor,"stroke-width":a.bgCircle.strokeWidth+"px"})},initLight:function(a,b){var c=this.config.global.radius;this.lightNode=g("<div class=\"radar-light\"></div>").css({background:"url("+this.config.light.background+")","background-size":2*c+"px "+2*c+"px",position:"absolute",left:a-c,top:b-c,width:2*c,height:2*c,opacity:0,transform:"rotate(0deg)"}),this.lightNode.attr("transition","transform "+this.config.light.animationTime+"s"),this.container.append(this.lightNode);var d=this.lightNode=this.container.find(".radar-light");d.on("transitionend",function(a){"transform"===a.originalEvent.propertyName&&"radar-light"===g(a.target).attr("class")&&g(a.target).css({transition:"none",opacity:0,transform:"rotate(0deg)"})})},init:function(a){this.mergeConfig(a),this.initSvg()},setRadar:function(a){var b=this,c=this.config,f=c.global.radius,g=c.global.percent,m=[],n=a.length;this.svg.selectAll(".radar-bg-path")&&(this.svg.selectAll(".radar-bg-path").remove(),this.svg.selectAll("text").remove(),this.svg.selectAll("defs").remove(),this.svg.selectAll(".radarArea-gradient-g").remove(),this.svg.selectAll(".circle").remove());var o=d(!1,5,1)+"radarArea-gradient",p=this.svg.append("defs").append("clipPath").attr("id",o);if("cardinal-closed"===c.radarPath.strokeStyle)for(var q=0;q<n;q++)m.push(a[q]),m.push({value:parseInt(0.7*a[q].value)});else for(var q=0;q<n;q++)m.push(a[q]);for(var s=2*l/n,q=0;q<n;q++){var i,t;0===n%2?0===n/2%2?(i=f*Math.cos(s*q-s/2),t=f*Math.sin(s*q-s/2)):(i=f*Math.cos(s*q),t=f*Math.sin(s*q)):(i=-f*Math.sin(s*q),t=-f*Math.cos(s*q));this.svg.append("path").attr("class","radar-bg-path").attr("d",function(){var a="M0,0L"+i+","+t;return a=0>i?a+"H"+-c.global.width/2:a+"H"+c.global.width/2,a}).style({stroke:c.label.strokeColor,"stroke-width":c.label.strokeWidth,fill:"none"})}this.label=this.svg.selectAll(".label").data(a).enter().append("text"),this.label.text(function(a){return a.type}).attr({dx:function(a,b){return 0===n%2?b>=n/2?-c.global.width/2:c.global.width/2:b>=(n+1)/2?-c.global.width/2:c.global.width/2},dy:function(a,b){var d;return d=0===n%2?f*Math.cos(s*b+l/n):f*Math.cos(s*b),-d-c.label.dy}}).style({"font-family":"\""+c.label.fontFamily+"\"","font-weight":c.label.fontWeight,fill:c.label.color,"font-size":c.label.fontSize,"text-anchor":function(a,b){return 0===n%2?b>=n/2?"start":"end":b>=(n+1)/2?"start":"end"}});var u=h.maxBy(m,function(a){return a.value}),v=Math.max(c.radarPath.maxValue,u.value),w=j.scale.linear().range([0,f-c.radarPath.strokeWidth]).domain([0,v]),r=m.length,x=2*l/r,y=j.svg.line.radial().radius(function(a){return w(a.value)}).angle(function(a,b){var c;return c=0===n%2?n===m.length?x*b+x/2:x*b+x:x*b,c}).tension(c.radarPath.strokeRange).interpolate(c.radarPath.strokeStyle);this.radarAreaClip=p.selectAll("path").data([m]).enter().append("path").attr({d:function(a){return y(a)}}).style({"stroke-width":c.radarPath.strokeWidth}),this.center=this.svg.insert("g",".radar-bg-path").attr("class","radarArea-gradient-g").style("clip-path","url(#"+o+")");var z=c.radarPath.colors;this.scales=h.map(z,function(a,b,c){return 0==b?null:k.scale([c[b-1].color,a.color]).mode("lch").domain([c[b-1].pos,a.pos])});var A=j.range(360).map(function(a,c){var d=(c-90+360)%360/360;return{startAngle:c*(l/180),endAngle:(c+1)*(l/180),fill:b.scales[e(d,z)](d)}});this.pie=j.svg.arc().innerRadius(0).outerRadius(c.global.radius),this.bgPie=this.center.selectAll(".bg-pie").append("g").data(A).enter().append("path").attr({class:"bg-pie",d:this.pie}).style({fill:function(a){return a.fill},stroke:function(a){return a.fill},"stroke-width":0.5})},render:function(a,b){var c=this;if(a=this.data(a),a&&a.length){var d=this.mergeConfig(b);this.setRadar(a),this.initBgCircle(a),setTimeout(function(){c.lightNode&&c.lightNode.css({transition:"transform "+d.light.animationTime+"s",opacity:1,transform:"rotate(360deg)"})},0)}},resize:function(a,b){this.render([],{global:{width:a,height:b}})},data:function(a){if(a&&0<a.length){for(var b=0;b<a.length;b++)a[b].value=a[b].value?h.toNumber(a[b].value):0;this._data=a}return this._data},mergeConfig:function(a){if(!a)return this.config;var b=this.config;b.global.width=b.global.width||this.container.width(),b.global.height=b.global.height||this.container.height(),a.radarPath&&a.radarPath.colors&&(this.config.radarPath.colors=a.radarPath.colors);var c=h.cloneDeep(a),d=h.defaultsDeep(c||{},b);return h.isEqual(b,d)||(this.config=d,this._calculatePieConfig(d.global.width,d.global.height),this.initMode?this.initMode=!1:this.init()),this.config},_calculatePieConfig:function(a,b){a||(a=this.container.width()),b||(b=this.container.height());var c=b-this.config.global.top,d=Math.min(a,c)/2-this.config.bgCircle.strokeWidth;this.config.global.radius=d||Math.min(a,c)/2,this.config.global.width=a,this.config.global.height=b},updateLayout:function(){},updateStyle:function(){var a=this.config;this.container.css({"font-size":a.size+"px",color:a.color||"#fff"})},destroy:function(){this._data=null,this.bgPie=null,this.center=null,this.label=null,this.scales=null,this.svg=null,this.radarAreaClip=null,this.pie=null,this.container.empty()},clean:function(){this.render([{type:"",value:0},{type:"",value:0},{type:"",value:0},{type:"",value:0},{type:"",value:0},{type:"",value:0}])}}),a.exports});