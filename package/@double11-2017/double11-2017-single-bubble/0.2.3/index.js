// env=undefined => env=publish 
Cube("datav:/com/@double11-2017/double11-2017-single-bubble/0.2.3",["datav:/npm/bcore/0.0.9/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.6.1","datav:/npm/d3-selection/1.1.0","datav:/npm/d3-hierarchy/1.1.5","datav:/npm/d3-scale/1.0.6","datav:/npm/d3-transition/1.1.0","datav:/npm/d3-ease/1.0.3"],function(a,b,c){var d=c("datav:/npm/bcore/0.0.9/event"),e=c("datav:/npm/jquery/2.1.4"),f=c("datav:/npm/lodash/4.6.1"),g=Object.assign({},c("datav:/npm/d3-selection/1.1.0"),c("datav:/npm/d3-hierarchy/1.1.5"),c("datav:/npm/d3-scale/1.0.6"),c("datav:/npm/d3-transition/1.1.0"),c("datav:/npm/d3-ease/1.0.3"));return a.exports=d.extend(function(a,b){this.config={theme:{},content:{numericalLabel:{show:!0,labelType:"value"},verticalPos:-12},nodes:{series:[{color:{type:"linearGradient",value:{angle:0,stops:[{offset:0,color:"#7e35ee"},{offset:16,color:"#7e35ee"},{offset:16,color:"#4a2979"},{offset:60,color:"#4a2979"},{offset:16,color:"#382652"},{offset:96,color:"#382652"},{offset:96,color:"#7e35ee"},{offset:100,color:"#7e35ee"}]}}},{color:{type:"linearGradient",value:{angle:0,stops:[{offset:0,color:"#ff3388"},{offset:16,color:"#ff3388"},{offset:16,color:"#883557"},{offset:60,color:"#883557"},{offset:16,color:"#612a41"},{offset:96,color:"#612a41"},{offset:96,color:"#ff3388"},{offset:100,color:"#ff3388"}]}}},{color:{type:"linearGradient",value:{angle:0,stops:[{offset:0,color:"#2a64f9"},{offset:16,color:"#2a64f9"},{offset:16,color:"#2d4584"},{offset:60,color:"#2d4584"},{offset:16,color:"#1f2d52"},{offset:96,color:"#1f2d52"},{offset:96,color:"#2a64f9"},{offset:100,color:"#2a64f9"}]}}},{color:{type:"linearGradient",value:{angle:0,stops:[{offset:0,color:"#33fab7"},{offset:16,color:"#33fab7"},{offset:16,color:"#2d6b56"},{offset:60,color:"#2d6b56"},{offset:16,color:"#1f4c3d"},{offset:96,color:"#1f4c3d"},{offset:96,color:"#33fab7"},{offset:100,color:"#33fab7"}]}}}]}},this.container=e(a),this.apis=null,this._data=null,this.chart=null,this.init(b)},{init:function(a){var b=this.mergeConfig(a);b.width=this.container.width(),b.height=this.container.height();var c=g.select(this.container[0]);c.append("svg").attr("width",b.width).attr("height",b.height),this.svg=c.select("svg").style("position","relative"),this.container.attr("date",+new Date)},render:function(a,b){if(a=this.data(a),a&&a.length){var c=this.mergeConfig(b);c.width=this.container.width(),c.height=this.container.height(),this.svg.attr("width",c.width).attr("height",c.height).style("left",c.global.posX||"0").style("top",c.global.posY||"0");var d=g.pack().size([c.width*(c.global.ratio||1),c.height]).padding(c.global.padding),e=g.hierarchy({children:a}).sum(function(a){return a&&a.value||0}),h=d(e).leaves();this.svg.selectAll(".node").data([]).exit().remove();var i=this.svg.selectAll(".node").data(h).enter().append("g").attr("class","node").attr("transform",function(a){return"translate("+(a&&a.x||0)+","+(a&&a.y||0)+")"}),j=this.nodes=this.svg.selectAll(".node"),k=g.transition().duration(1e3*c.global.duration).ease(g[c.global.ease]||g.easeLinear);i.append("circle").attr("class","node-circle").attr("r",0).transition(k).attr("r",function(a){return Math.max(a&&a.r||0,0)});var l=f.get(c,"nodes"),m=l.series,n=this.container.attr("date"),o=this;i.append("defs").append("radialGradient").attr("class",function(b){return"radialGradient radialGradient"+f.findIndex(a,b.data)}).attr("id",function(b){return"grad_"+n+f.findIndex(a,b.data)}).attr("cx","50%").attr("cy","50%").attr("r","50%").attr("fx","50%").attr("fy","50%");var p=i.selectAll(".radialGradient");p.each(function(b){var c=f.findIndex(a,b.data),d=f.get(m,"["+c+"].color"),e=f.get(d,"type"),g=f.get(d,"value");if(e&&"linearGradient"===e){var h=f.get(g,"stops"),i=o.svg.select(".radialGradient"+c);i.selectAll(".color-stop").data(h).enter().append("stop").attr("offset",function(a){return a.offset+"%"}).style("stop-color",function(a){return a.color})}});var q=f.maxBy(h,"r"),r=f.minBy(h,"r"),s=q&&q.r||0,t=r&&r.r||0,u=c.content.maxSize,v=c.content.minSize,w=g.scaleLinear().domain([t,s]).range([v,u]),x=f.get(c,"content"),y=x.numericalLabel,z=y.labelType,A=y.show,B=x.verticalPos;i.append("text").attr("class","node-text").attr("x",0).attr("y",function(b){var c=f.get(b,"value"),d=100*(c/f.sumBy(a,function(a){return a.value*w(b&&b.r||0)}))*B;return w(b&&b.r||0)/2-1+d}).text(function(a){return A?"content"===z?a.data.content:a.data.value:""}).style("text-anchor","middle").style("font-family","\""+c.content.fontFamily+"\"").style("font-weight",c.content.fontWeight).style("font-size","0px").transition(k).style("font-size",function(a){return w(a&&a.r||0)+"px"}),j.selectAll(".node-circle").style("fill",function(b){var c=f.findIndex(a,b.data),d=f.get(m,"["+c+"].color"),e=f.get(d,"type"),g=f.get(d,"value");return"flat"===e?g:"url(#grad_"+n+c+")"}),j.selectAll(".node-text").style("fill",c.content.color)}},hide:function(){this.nodes&&(this.nodes.selectAll(".node-circle").attr("r",0),this.nodes.selectAll(".node-text").style("font-size","0px"))},resize:function(){this.render()},data:function(a){return a&&(this._data=f.clone(a)),this._data},mergeConfig:function(a){return a?(this.config=f.defaultsDeep(a||{},this.config),this.config):this.config},destroy:function(){this._data=null,this.nodes=null,this.svg=null,this.container.empty()}}),a.exports});