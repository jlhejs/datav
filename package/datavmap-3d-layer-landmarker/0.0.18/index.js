// env=undefined => env=publish 
Cube("datav:/com/datavmap-3d-layer-landmarker/0.0.18/Marker.js",["datav:/npm/three/0.84.0"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/three/0.84.0");return a.exports=function(a){return function(b){function c(a){d(this,c);var b=e(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));return b.spriteTexture=a.spriteTexture||"https://img.alicdn.com/tfs/TB1hGrFSFXXXXXfapXXXXXXXXXX-128-128.png",b.spriteSizeScale=a.spriteSizeScale||5e-4,b.spriteHeightPosition=a.spriteHeightPosition||80,b.spriteOpacity=a.spriteOpacity||1,b.lineHeightPosition=b.spriteHeightPosition,b.lineColor=a.lineColor||"#ff1100",b.lineOpacity=a.lineOpacity||0.6,b.build(),b}return f(c,b),g(c,[{key:"build",value:function(){this;this.mesh=new a.Object3D,this.textureLoader=new a.TextureLoader().setCrossOrigin("*"),this.spriteMaterial=new a.SpriteMaterial({map:this.textureLoader.load(this.spriteTexture),transparent:!0,opacity:this.spriteOpacity}),this.sprite=new a.Sprite(this.spriteMaterial),this.sprite.scale.x=this.sprite.scale.y=this.spriteSizeScale,this.sprite.position.z=this.spriteHeightPosition,this.mesh.add(this.sprite),this.lineVertices=new a.LineCurve3(new a.Vector3(0,0,0),new a.Vector3(0,0,this.lineHeightPosition)),this.lineGeometry=new a.Geometry,this.lineGeometry.vertices=this.lineVertices.getPoints(10),this.lineGeometry.verticesNeedUpdate=!0,this.lineGeometry.elementsNeedUpdate=!0,this.lineMaterial=new a.LineBasicMaterial({color:this.lineColor,transparent:!0,opacity:this.lineOpacity}),this.line=new a.Line(this.lineGeometry,this.lineMaterial),this.mesh.add(this.line)}}]),c}(a.Object3D)},a.exports});;
Cube("datav:/com/datavmap-3d-layer-landmarker/0.0.18/LandmarkerLayer.js",["datav:/npm/eventemitter3/2.0.3","datav:/npm/safely-merge/1.0.1","datav:/npm/chroma-js/1.3.4"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/2.0.3"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/npm/chroma-js/1.3.4"),k=c("datav:/com/datavmap-3d-layer-landmarker/0.0.18/Marker.js");return a.exports=function(a){var b=a.datavgl,c=b.THREE,l=a.glLayer||a,m=b.DataVModelTools.point2buffer,n=a.worldsize,o=k(c),p={};return function(b){function h(a){d(this,h);var b=e(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));return a=i(p,a),b.options=i(b.options,a),b.raycaster=new c.Raycaster,b.raycaster.params.Sprite={threshold:1},b.mouse=new c.Vector2,b.onMouseEventCallback=b.onMouseEventCallback.bind(b),b.init(),b.initPickHelper(),b}return f(h,b),g(h,[{key:"init",value:function(){this.meshGroup=new c.Group,this.markerList=[],this.setData(this.data)}},{key:"initPickHelper",value:function(){a.on("mouseup",this.onMouseEventCallback)}},{key:"onMouseEventCallback",value:function(b){if(!a.isEasing()&&this.options.visibility){this.mouse.x=2*(b.point.x/a.transform.width)-1,this.mouse.y=2*-(b.point.y/a.transform.height)+1,this.raycaster.setFromCamera(this.mouse,l.camera);var c=this.raycaster.intersectObjects(this.meshGroup.children,!0);0<c.length&&"Sprite"===c[0].object.type&&this.emit("landmarker-click",c[0].object.userData)}}},{key:"setData",value:function(a){if(this.data=a||[],a&&0==a.length&&this.meshGroup&&this.disposeMesh(),this.data&&this.data.length){this.disposeMesh(),this.meshGroup||(this.meshGroup=new c.Group);for(var b,d=m(this.data,{worldsize:n}),e=d.positions,f={spriteTexture:this.options.markerSprite.spriteTexture,spriteSizeScale:this.options.markerSprite.spriteSizeScale/1e4,spriteHeightPosition:this.options.markerSprite.spriteHeightPosition,spriteOpacity:this.options.markerSprite.spriteOpacity,lineColor:this.options.markerLine.lineColor,lineOpacity:this.options.markerLine.lineOpacity},g=0;g<e.length;g+=3)b=new o(f),b.mesh.position.set(e[g+0],e[g+1],e[g+2]),b.mesh.position.z=this.options.heightPosition,b.sprite.userData=this.data[g/3],this.meshGroup.add(b.mesh),this.markerList.push(b);this.meshGroup.visible=this.options.visibility,l.rootNode.add(this.meshGroup)}}},{key:"disposeMesh",value:function(){for(var a,b=this.meshGroup.children.length-1;0<=b;b--)a=this.meshGroup.children[b],this.meshGroup.remove(a),a.children.forEach(function(a){a.geometry&&a.geometry.dispose(),a.material.map&&a.material.map.dispose(),a.material.dispose(),a=null}),a=null;this.markerList=[]}},{key:"updateOptions",value:function(a){var b=this;this.options=i(this.options,a),this.markerList.forEach(function(a){a.textureLoader.load(b.options.markerSprite.spriteTexture),a.spriteMaterial.map=a.textureLoader.load(b.options.markerSprite.spriteTexture),a.spriteMaterial.opacity=b.options.markerSprite.spriteOpacity,a.spriteMaterial.needsUpdate=!0,a.sprite.scale.x=a.sprite.scale.y=b.options.markerSprite.spriteSizeScale/1e4,a.sprite.position.z=b.options.markerSprite.spriteHeightPosition;var d=new c.LineCurve3(new c.Vector3(0,0,0),new c.Vector3(0,0,b.options.markerSprite.spriteHeightPosition));a.lineGeometry.vertices=d.getPoints(10),a.lineGeometry.verticesNeedUpdate=!0,a.lineGeometry.elementsNeedUpdate=!0;var e=j(b.options.markerLine.lineColor).gl();a.lineMaterial.color.r=e[0],a.lineMaterial.color.g=e[1],a.lineMaterial.color.b=e[2],a.lineMaterial.opacity=b.options.markerLine.lineOpacity,a.lineMaterial.needsUpdate=!0,a.mesh.position.z=b.options.heightPosition}),this.meshGroup.visible=this.options.visibility}},{key:"show",value:function(){this.options.visibility=!0,this.meshGroup&&(this.meshGroup.visible=!0)}},{key:"hide",value:function(){this.options.visibility=!1,this.meshGroup&&(this.meshGroup.visible=!1)}},{key:"remove",value:function(){var b=this;a.off("mouseup",this.onMouseEventCallback),l.rootNode.remove(this.meshGroup),this.meshGroup.children.forEach(function(a){b.meshGroup.remove(a),a.children.forEach(function(a){a.geometry&&a.geometry.dispose(),a.material.map&&a.material.map.dispose(),a.material.dispose(),a=null}),a=null}),this.meshGroup=null,this.markerList=[]}}]),h}(h)},a.exports});;
Cube("datav:/com/datavmap-3d-layer-landmarker/0.0.18",["datav:/npm/eventemitter3/2.0.3","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/2.0.3"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/com/datavmap-3d-layer-landmarker/0.0.18/LandmarkerLayer.js"),k={},l=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.container="string"===typeof a?document.querySelector(a):a,f.apis=c.apis,f.map=null,f._data=null,f.config=c,f}return f(b,a),g(b,[{key:"initLayer",value:function(){var a=this,b=this.getOptions(),c=j(this.map);this.layer=new c(b),this.layer.on("landmarker-click",function(b){a.emit("landmarker-click",b)}),this.render(this.data)}},{key:"init",value:function(){var a=this;this.resetID&&clearTimeout(this.resetID),this.resetID=setTimeout(function(){a.map.glLayer.loaded?(a.resetID&&clearTimeout(a.resetID),a.initLayer()):a.init()},100)}},{key:"addTo",value:function(a){var b=this;this.map=a,this.init(),this.endID=setTimeout(function(){b.resetID&&clearTimeout(b.resetID)},300000)}},{key:"getOptions",value:function(){return this.config=i(k,this.config),this.config}},{key:"show",value:function(){this.config.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.config.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"remove",value:function(){this.endID&&clearTimeout(this.endID),this.resetID&&clearTimeout(this.resetID),this.layer&&this.layer.remove&&this.layer.remove(),this.layer=null,this._data=null,this.data=null}},{key:"render",value:function(a){this.data=a,this.layer&&this.layer.setData(a)}},{key:"updateOptions",value:function(a){this.config=i(this.config,a),a=this.getOptions(),this.layer&&this.layer.updateOptions(a)}}]),b}(h);return a.exports=l,a.exports});