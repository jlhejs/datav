// env=undefined => env=publish 
Cube("datav:/com/map2d-layer-icon-scatter/0.1.1",["datav:/npm/bcore/0.0.21/event","datav:/npm/bcore/0.0.21/utils","datav:/npm/ldmap/0.1.45/layer/scatter_markers"],function(a,b,c){function d(a,b){this.options=f.deepMerge(this.options,b)}var e=c("datav:/npm/bcore/0.0.21/event"),f=c("datav:/npm/bcore/0.0.21/utils"),g=c("datav:/npm/ldmap/0.1.45/layer/scatter_markers");return d=e.extend(d,{options:{},addTo:function(a){a._map&&(a=a._map),this.map=a,this.initCom()},genOptions:function(a){this.options=f.deepMerge(this.options,a);var b=this,a={lat:function(a){return a.lat},lng:function(a){return a.lng},id:function(a){return a.lat+"_"+a.lng},text:function(){return""},zoom:{max:20,min:1},popup:function(a){var c=b.options,d="<div style=\"font-size:"+c.tip["font-size"]+"px;color:"+c.tip.color+";\">";if(a.name&&(d+=a.name+"<br/>"),"object"==typeof a.info)for(var e in a.info)d+=e+": "+a.info[e]+"<br/>";else d+=a.info||"";return d},child:{css:function(a,c){c=$(c);var d,e=b.options,f=e.radius,g=a.iconUrl||e.iconUrl;d=/^url\(/.test(g.toLowerCase())?g:"url("+g+")",c.css({background:d,left:-f,top:"center"===e.offset?-f:-2*f,width:2*f,height:2*f,"border-radius":0,"background-size":"cover"})}}};return a},initCom:function(){var a=this,b=this.genOptions(this.options),c=this.iconlayer=new g(b);c.addTo(this.map),c.on("child-mousedown",function(b){var c=a.options,e=b.data;a.emit("click-scatter-icon",e),a.emit("global_var",c["click-key"],e[c["click-key"]])})},updateOptions:function(a){this.options=f.deepMerge(this.options,a);var a=this.genOptions(this.options);this.iconlayer.updateOptions(a),this.iconlayer.render(this.data)},destory:function(){this.iconlayer.destroy(),this.data=[]},render:function(a){this.data=a,this.iconlayer.render(this.data)}}),a.exports=d,a.exports});