// env=undefined => env=publish 
Cube("datav:/com/guston-3d-layer-loader-obj/0.0.3/loader/ColladaLoader",[],function(a){return a.exports=function(a){a.ColladaLoader=function(b){this.manager=void 0===b?a.DefaultLoadingManager:b},a.ColladaLoader.prototype={constructor:a.ColladaLoader,crossOrigin:"Anonymous",load:function(b,c,d,e){var f=this,g=void 0===f.path?a.LoaderUtils.extractUrlBase(b):f.path,h=new a.FileLoader(f.manager);h.load(b,function(a){c(f.parse(a,g))},d,e)},setPath:function(a){this.path=a},options:{set convertUpAxis(a){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(b,c){function d(a,b){for(var c,d=[],e=a.childNodes,f=0,g=e.length;f<g;f++)c=e[f],c.nodeName===b&&d.push(c);return d}function e(a){if(0===a.length)return[];for(var b=a.trim().split(/\s+/),c=Array(b.length),d=0,e=b.length;d<e;d++)c[d]=b[d];return c}function g(a){if(0===a.length)return[];for(var b=a.trim().split(/\s+/),c=Array(b.length),d=0,e=b.length;d<e;d++)c[d]=parseFloat(b[d]);return c}function f(a){if(0===a.length)return[];for(var b=a.trim().split(/\s+/),c=Array(b.length),d=0,e=b.length;d<e;d++)c[d]=parseInt(b[d]);return c}function h(a){return a.substring(1)}function j(){return"three_default_"+Xa++}function k(a){return 0===Object.keys(a).length}function i(a){return void 0===a?1:parseFloat(a.getAttribute("meter"))}function l(a){return void 0===a?"Y_UP":a.textContent}function m(a,b,c,e){var f=d(a,b)[0];if(void 0!==f)for(var g=d(f,c),h=0;h<g.length;h++)e(g[h])}function n(a,b){for(var c in a){var d=a[c];d.build=b(a[c])}}function o(a,b){return void 0===a.build?(a.build=b(a),a.build):a.build}function p(a){for(var b,c={inputs:{}},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"input":var f=h(b.getAttribute("source")),g=b.getAttribute("semantic");c.inputs[g]=f;}return c}function q(a){var b={},c=a.getAttribute("target"),d=c.split("/"),e=d.shift(),f=d.shift(),g=-1!==f.indexOf("("),j=-1!==f.indexOf(".");if(j)d=f.split("."),f=d.shift(),b.member=d.shift();else if(g){var k=f.split("(");f=k.shift();for(var l=0;l<k.length;l++)k[l]=parseInt(k[l].replace(/\)/,""));b.indices=k}return b.id=e,b.sid=f,b.arraySyntax=g,b.memberSyntax=j,b.sampler=h(a.getAttribute("source")),b}function r(a){var b=[],c=a.channels,d=a.samplers,e=a.sources;for(var f in c)if(c.hasOwnProperty(f)){var g=c[f],h=d[g.sampler],i=h.inputs.INPUT,j=h.inputs.OUTPUT,k=e[i],l=e[j],m=t(g,k,l);v(m,b)}return b}function s(a){return o(Ya.animations[a],r)}function t(a,b,c){var d,e,f,g,h,i,j=Ya.nodes[a.id],k=Ia(j.id),l=j.transforms[a.sid],m=j.matrix.clone().transpose(),n={};switch(l){case"matrix":for(f=0,g=b.array.length;f<g;f++)if(d=b.array[f],e=f*c.stride,void 0===n[d]&&(n[d]={}),!0===a.arraySyntax){var o=c.array[e],p=a.indices[0]+4*a.indices[1];n[d][p]=o}else for(h=0,i=c.stride;h<i;h++)n[d][h]=c.array[e+h];break;case"translate":console.warn("THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.",l);break;case"rotate":console.warn("THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.",l);break;case"scale":console.warn("THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.",l);}var q=u(n,m),r={name:k.uuid,keyframes:q};return r}function u(a,b){var c=[];for(var d in a)c.push({time:parseFloat(d),value:a[d]});c.sort(function(c,a){return c.time-a.time});for(var e=0;16>e;e++)w(c,e,b.elements[e]);return c}function v(b,c){for(var d=b.keyframes,e=b.name,f=[],g=[],h=[],j=[],k=0,i=d.length;k<i;k++){var l=d[k],m=l.time,n=l.value;Oa.fromArray(n).transpose(),Oa.decompose(La,Na,Ma),f.push(m),g.push(La.x,La.y,La.z),h.push(Na.x,Na.y,Na.z,Na.w),j.push(Ma.x,Ma.y,Ma.z)}return 0<g.length&&c.push(new a.VectorKeyframeTrack(e+".position",f,g)),0<h.length&&c.push(new a.QuaternionKeyframeTrack(e+".quaternion",f,h)),0<j.length&&c.push(new a.VectorKeyframeTrack(e+".scale",f,j)),c}function w(a,b,c){var d,e,f,g=!0;for(e=0,f=a.length;e<f;e++)d=a[e],void 0===d.value[b]?d.value[b]=null:g=!1;if(!0===g)for(e=0,f=a.length;e<f;e++)d=a[e],d.value[b]=c;else x(a,b)}function x(a,b){for(var c,d,e,f=0,g=a.length;f<g;f++)if(e=a[f],null===e.value[b]){if(c=y(a,f,b),d=z(a,f,b),null===c){e.value[b]=d.value[b];continue}if(null===d){e.value[b]=c.value[b];continue}A(e,c,d,b)}}function y(a,b,c){for(;0<=b;){var d=a[b];if(null!==d.value[c])return d;b--}return null}function z(a,b,c){for(;b<a.length;){var d=a[b];if(null!==d.value[c])return d;b++}return null}function A(a,b,c,d){return 0===c.time-b.time?void(a.value[d]=b.value[d]):void(a.value[d]=(a.time-b.time)*(c.value[d]-b.value[d])/(c.time-b.time)+b.value[d])}function B(b){for(var c,d=[],e=b.name,f=b.end-b.start||-1,g=b.animations,h=0,i=g.length;h<i;h++){c=s(g[h]);for(var k=0,j=c.length;k<j;k++)d.push(c[k])}return new a.AnimationClip(e,f,d)}function C(a){return o(Ya.clips[a],B)}function D(a){for(var b,c={sources:{}},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"bind_shape_matrix":c.bindShapeMatrix=g(b.textContent);break;case"source":var f=b.getAttribute("id");c.sources[f]=ga(b);break;case"joints":c.joints=E(b);break;case"vertex_weights":c.vertexWeights=F(b);}return c}function E(a){for(var b,c={inputs:{}},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"input":var f=b.getAttribute("semantic"),g=h(b.getAttribute("source"));c.inputs[f]=g;}return c}function F(a){for(var b,c={inputs:{}},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"input":var g=b.getAttribute("semantic"),i=h(b.getAttribute("source")),j=parseInt(b.getAttribute("offset"));c.inputs[g]={id:i,offset:j};break;case"vcount":c.vcount=f(b.textContent);break;case"v":c.v=f(b.textContent);}return c}function G(a){var b={id:a.id},c=Ya.geometries[b.id];return void 0!==a.skin&&(b.skin=H(a.skin),c.sources.skinIndices=b.skin.indices,c.sources.skinWeights=b.skin.weights),b}function H(b){function c(c,a){return a.weight-c.weight}var e,f,g,h=4,i={joints:[],indices:{array:[],stride:h},weights:{array:[],stride:h}},j=b.sources,k=b.vertexWeights,l=k.vcount,m=k.v,n=k.inputs.JOINT.offset,o=k.inputs.WEIGHT.offset,p=b.sources[b.joints.inputs.JOINT],q=b.sources[b.joints.inputs.INV_BIND_MATRIX],r=j[k.inputs.WEIGHT.id].array,s=0;for(e=0,g=l.length;e<g;e++){var t=l[e],u=[];for(f=0;f<t;f++){var v=m[s+n],w=m[s+o],x=r[w];u.push({index:v,weight:x}),s+=2}for(u.sort(c),f=0;f<h;f++){var y=u[f];void 0===y?(i.indices.array.push(0),i.weights.array.push(0)):(i.indices.array.push(y.index),i.weights.array.push(y.weight))}}for(i.bindMatrix=new a.Matrix4().fromArray(b.bindShapeMatrix).transpose(),e=0,g=p.array.length;e<g;e++){var d=p.array[e],z=new a.Matrix4().fromArray(q.array,e*q.stride).transpose();i.joints.push({name:d,boneInverse:z})}return i}function I(a){return o(Ya.controllers[a],G)}function J(a){return void 0===a.build?a.init_from:a.build}function K(a){return o(Ya.images[a],J)}function L(a){for(var b,c={surfaces:{},samplers:{}},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"newparam":M(b,c);break;case"technique":c.technique=P(b);}return c}function M(a,b){for(var c,d=a.getAttribute("sid"),e=0,f=a.childNodes.length;e<f;e++)if(c=a.childNodes[e],1===c.nodeType)switch(c.nodeName){case"surface":b.surfaces[d]=N(c);break;case"sampler2D":b.samplers[d]=O(c);}}function N(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"init_from":c.init_from=b.textContent;}return c}function O(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"source":c.source=b.textContent;}return c}function P(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"constant":case"lambert":case"blinn":case"phong":c.type=b.nodeName,c.parameters=Q(b);}return c}function Q(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"emission":case"diffuse":case"specular":case"shininess":case"transparent":case"transparency":c[b.nodeName]=R(b);}return c}function R(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"color":c[b.nodeName]=g(b.textContent);break;case"float":c[b.nodeName]=parseFloat(b.textContent);break;case"texture":c[b.nodeName]={id:b.getAttribute("texture"),extra:S(b)};}return c}function S(a){for(var b,c={technique:{}},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"extra":T(b,c);}return c}function T(a,b){for(var c,d=0,e=a.childNodes.length;d<e;d++)if(c=a.childNodes[d],1===c.nodeType)switch(c.nodeName){case"technique":U(c,b);}}function U(a,b){for(var c,d=0,e=a.childNodes.length;d<e;d++)if(c=a.childNodes[d],1===c.nodeType)switch(c.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":b.technique[c.nodeName]=parseFloat(c.textContent);break;case"wrapU":case"wrapV":b.technique[c.nodeName]="TRUE"===c.textContent.toUpperCase()?1:"FALSE"===c.textContent.toUpperCase()?0:parseInt(c.textContent);}}function V(a){return a}function W(a){return o(Ya.effects[a],V)}function X(b){function c(b){var c=e.profile.samplers[b.id];if(void 0!==c){var d=e.profile.surfaces[c.source],f=Ua.load(K(d.init_from)),g=b.extra;if(void 0!==g&&void 0!==g.technique&&!1===k(g.technique)){var h=g.technique;f.wrapS=h.wrapU?a.RepeatWrapping:a.ClampToEdgeWrapping,f.wrapT=h.wrapV?a.RepeatWrapping:a.ClampToEdgeWrapping,f.offset.set(h.offsetU||0,h.offsetV||0),f.repeat.set(h.repeatU||1,h.repeatV||1)}else f.wrapS=a.RepeatWrapping,f.wrapT=a.RepeatWrapping;return f}return console.error("THREE.ColladaLoader: Undefined sampler",b.id),null}var d,e=W(b.url),f=e.profile.technique;switch(f.type){case"phong":case"blinn":d=new a.MeshPhongMaterial;break;case"lambert":d=new a.MeshLambertMaterial;break;default:d=new a.MeshBasicMaterial;}d.name=b.name;var g=f.parameters;for(var h in g){var i=g[h];"diffuse"===h?(i.color&&d.color.fromArray(i.color),i.texture&&(d.map=c(i.texture))):"specular"===h?(i.color&&d.specular&&d.specular.fromArray(i.color),i.texture&&(d.specularMap=c(i.texture))):"shininess"===h?i.float&&d.shininess&&(d.shininess=i.float):"emission"===h?i.color&&d.emissive&&d.emissive.fromArray(i.color):"transparent"===h?d.transparent=!0:"transparency"===h?(void 0!==i.float&&(d.opacity=i.float),d.transparent=!0):void 0}return d}function Y(a){return o(Ya.materials[a],X)}function Z(a){for(var b,c=0;c<a.childNodes.length;c++)switch(b=a.childNodes[c],b.nodeName){case"technique_common":return $(b);}return{}}function $(a){for(var b,c={},d=0;d<a.childNodes.length;d++)switch(b=a.childNodes[d],b.nodeName){case"perspective":case"orthographic":c.technique=b.nodeName,c.parameters=_(b);}return c}function _(a){for(var b,c={},d=0;d<a.childNodes.length;d++)switch(b=a.childNodes[d],b.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":c[b.nodeName]=parseFloat(b.textContent);}return c}function aa(b){var c;switch(b.optics.technique){case"perspective":c=new a.PerspectiveCamera(b.optics.parameters.yfov,b.optics.parameters.aspect_ratio,b.optics.parameters.znear,b.optics.parameters.zfar);break;case"orthographic":var d=b.optics.parameters.ymag,e=b.optics.parameters.xmag,f=b.optics.parameters.aspect_ratio;e=void 0===e?d*f:e,d=void 0===d?e/f:d,e*=0.5,d*=0.5,c=new a.OrthographicCamera(-e,e,d,-d,b.optics.parameters.znear,b.optics.parameters.zfar);break;default:c=new a.PerspectiveCamera;}return c.name=b.name,c}function ba(a){var b=Ya.cameras[a];return void 0===b?(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",a),null):o(b,aa)}function ca(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"directional":case"point":case"spot":case"ambient":c.technique=b.nodeName,c.parameters=da(b);}return c}function da(b){for(var c,d={},e=0,h=b.childNodes.length;e<h;e++)if(c=b.childNodes[e],1===c.nodeType)switch(c.nodeName){case"color":var i=g(c.textContent);d.color=new a.Color().fromArray(i);break;case"falloff_angle":d.falloffAngle=parseFloat(c.textContent);break;case"quadratic_attenuation":var j=parseFloat(c.textContent);d.distance=j?Math.sqrt(1/j):0;}return d}function ea(b){var c;switch(b.technique){case"directional":c=new a.DirectionalLight;break;case"point":c=new a.PointLight;break;case"spot":c=new a.SpotLight;break;case"ambient":c=new a.AmbientLight;}return b.parameters.color&&c.color.copy(b.parameters.color),b.parameters.distance&&(c.distance=b.parameters.distance),c}function fa(a){var b=Ya.lights[a];return void 0===b?(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",a),null):o(b,ea)}function ga(a){for(var b,c={array:[],stride:3},f=0;f<a.childNodes.length;f++)if(b=a.childNodes[f],1===b.nodeType)switch(b.nodeName){case"float_array":c.array=g(b.textContent);break;case"Name_array":c.array=e(b.textContent);break;case"technique_common":var h=d(b,"accessor")[0];void 0!==h&&(c.stride=parseInt(h.getAttribute("stride")));}return c}function ha(a){for(var b,c={},d=0;d<a.childNodes.length;d++)b=a.childNodes[d],1===b.nodeType&&(c[b.getAttribute("semantic")]=h(b.getAttribute("source")));return c}function ia(a){for(var b,c={type:a.nodeName,material:a.getAttribute("material"),count:parseInt(a.getAttribute("count")),inputs:{},stride:0},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"input":var g=h(b.getAttribute("source")),i=b.getAttribute("semantic"),j=parseInt(b.getAttribute("offset"));c.inputs[i]={id:g,offset:j},c.stride=Math.max(c.stride,j+1);break;case"vcount":c.vcount=f(b.textContent);break;case"p":c.p=f(b.textContent);}return c}function ja(a){for(var b,c={},d=0;d<a.length;d++)b=a[d],void 0===c[b.type]&&(c[b.type]=[]),c[b.type].push(b);return c}function ka(a){var b={},c=a.sources,d=a.vertices,e=a.primitives;if(0===e.length)return{};var f=ja(e);for(var g in f)b[g]=la(f[g],c,d);return b}function la(b,c,d){for(var e={},f={array:[],stride:0},g={array:[],stride:0},h={array:[],stride:0},i={array:[],stride:0},j={array:[],stride:4},k={array:[],stride:4},l=new a.BufferGeometry,m=[],n=0,o=0,q=0;q<b.length;q++){var p=b[q],r=p.inputs,s=1;for(var t in p.vcount&&4===p.vcount[0]&&(s=2),o="lines"===p.type||"linestrips"===p.type?2*p.count:3*p.count*s,l.addGroup(n,o,q),n+=o,p.material&&m.push(p.material),r){var u=r[t];switch(t){case"VERTEX":for(var v in d){var w=d[v];"POSITION"===v?(ma(p,c[w],u.offset,f.array),f.stride=c[w].stride,c.skinWeights&&c.skinIndices&&(ma(p,c.skinIndices,u.offset,j.array),ma(p,c.skinWeights,u.offset,k.array))):"NORMAL"===v?(ma(p,c[w],u.offset,g.array),g.stride=c[w].stride):"COLOR"===v?(ma(p,c[w],u.offset,i.array),i.stride=c[w].stride):"TEXCOORD"===v?(ma(p,c[w],u.offset,h.array),h.stride=c[w].stride):console.warn("THREE.ColladaLoader: Semantic \"%s\" not handled in geometry build process.",v)}break;case"NORMAL":ma(p,c[u.id],u.offset,g.array),g.stride=c[u.id].stride;break;case"COLOR":ma(p,c[u.id],u.offset,i.array),i.stride=c[u.id].stride;break;case"TEXCOORD":ma(p,c[u.id],u.offset,h.array),h.stride=c[u.id].stride;}}}return 0<f.array.length&&l.addAttribute("position",new a.Float32BufferAttribute(f.array,f.stride)),0<g.array.length&&l.addAttribute("normal",new a.Float32BufferAttribute(g.array,g.stride)),0<i.array.length&&l.addAttribute("color",new a.Float32BufferAttribute(i.array,i.stride)),0<h.array.length&&l.addAttribute("uv",new a.Float32BufferAttribute(h.array,h.stride)),0<j.array.length&&l.addAttribute("skinIndex",new a.Float32BufferAttribute(j.array,j.stride)),0<k.array.length&&l.addAttribute("skinWeight",new a.Float32BufferAttribute(k.array,k.stride)),e.data=l,e.type=b[0].type,e.materialKeys=m,e}function ma(e,f,g,h){function j(a){for(var b=k[a+g]*q,c=b+q;b<c;b++)h.push(p[b])}var k=e.p,m=e.stride,n=e.vcount,o=0,p=f.array,q=f.stride;if(void 0!==e.vcount){for(var r,s=0,t=0,i=n.length;t<i;t++){if(r=n[t],4===r){var l=s+0*m,a=s+1*m,b=s+2*m,c=s+3*m;j(l),j(a),j(c),j(a),j(b),j(c)}else if(3===r){var l=s+0*m,a=s+1*m,b=s+2*m;j(l),j(a),j(b)}else o=Math.max(o,r);s+=m*r}0<o&&console.log("THREE.ColladaLoader: Geometry has faces with more than 4 vertices.")}else for(var t=0,i=k.length;t<i;t+=m)j(t)}function na(a){return o(Ya.geometries[a],ka)}function oa(a){return void 0===a.build?a:a.build}function pa(a){return o(Ya.kinematicsModels[a],oa)}function qa(a,b){for(var c,d=0;d<a.childNodes.length;d++)if(c=a.childNodes[d],1===c.nodeType)switch(c.nodeName){case"joint":b.joints[c.getAttribute("sid")]=ra(c);break;case"link":b.links.push(ta(c));}}function ra(a){for(var b,c,d=0;d<a.childNodes.length;d++)if(c=a.childNodes[d],1===c.nodeType)switch(c.nodeName){case"prismatic":case"revolute":b=sa(c);}return b}function sa(b,c){for(var d,c={sid:b.getAttribute("sid"),name:b.getAttribute("name")||"",axis:new a.Vector3,limits:{min:0,max:0},type:b.nodeName,static:!1,zeroPosition:0,middlePosition:0},e=0;e<b.childNodes.length;e++)if(d=b.childNodes[e],1===d.nodeType)switch(d.nodeName){case"axis":var f=g(d.textContent);c.axis.fromArray(f);break;case"limits":var h=d.getElementsByTagName("max")[0],i=d.getElementsByTagName("min")[0];c.limits.max=parseFloat(h.textContent),c.limits.min=parseFloat(i.textContent);}return c.limits.min>=c.limits.max&&(c.static=!0),c.middlePosition=(c.limits.min+c.limits.max)/2,c}function ta(a){for(var b,c={sid:a.getAttribute("sid"),name:a.getAttribute("name")||"",attachments:[],transforms:[]},d=0;d<a.childNodes.length;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"attachment_full":c.attachments.push(ua(b));break;case"matrix":case"translate":case"rotate":c.transforms.push(va(b));}return c}function ua(a){for(var b,c={joint:a.getAttribute("joint").split("/").pop(),transforms:[],links:[]},d=0;d<a.childNodes.length;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"link":c.links.push(ta(b));break;case"matrix":case"translate":case"rotate":c.transforms.push(va(b));}return c}function va(b){var c={type:b.nodeName},d=g(b.textContent);switch(c.type){case"matrix":c.obj=new a.Matrix4,c.obj.fromArray(d).transpose();break;case"translate":c.obj=new a.Vector3,c.obj.fromArray(d);break;case"rotate":c.obj=new a.Vector3,c.obj.fromArray(d),c.angle=a.Math.degToRad(d[3]);}return c}function wa(a){for(var b,c={target:a.getAttribute("target").split("/").pop()},d=0;d<a.childNodes.length;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"axis":var e=b.getElementsByTagName("param")[0];c.axis=e.textContent;var f=c.axis.split("inst_").pop().split("axis")[0];c.jointIndex=f.substr(0,f.length-1);}return c}function xa(a){return void 0===a.build?a:a.build}function ya(a){return o(Ya.kinematicsScenes[a],xa)}function za(b){for(var c,d=[],e=Ra.querySelector("[id=\""+b.id+"\"]"),f=0;f<e.childNodes.length;f++)if(c=e.childNodes[f],1===c.nodeType)switch(c.nodeName){case"matrix":var h=g(c.textContent),i=new a.Matrix4().fromArray(h).transpose();d.push({sid:c.getAttribute("sid"),type:c.nodeName,obj:i});break;case"translate":case"scale":var h=g(c.textContent),j=new a.Vector3().fromArray(h);d.push({sid:c.getAttribute("sid"),type:c.nodeName,obj:j});break;case"rotate":var h=g(c.textContent),j=new a.Vector3().fromArray(h),k=a.Math.degToRad(h[3]);d.push({sid:c.getAttribute("sid"),type:c.nodeName,obj:j,angle:k});}return d}function Aa(a){for(var b,c=a.getElementsByTagName("node"),d=0;d<c.length;d++)b=c[d],!1===b.hasAttribute("id")&&b.setAttribute("id",j())}function Ba(b){for(var c,d={name:b.getAttribute("name")||"",type:b.getAttribute("type"),id:b.getAttribute("id"),sid:b.getAttribute("sid"),matrix:new a.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},e=0;e<b.childNodes.length;e++)if(c=b.childNodes[e],1===c.nodeType)switch(c.nodeName){case"node":d.nodes.push(c.getAttribute("id")),Ba(c);break;case"instance_camera":d.instanceCameras.push(h(c.getAttribute("url")));break;case"instance_controller":d.instanceControllers.push(Ca(c));break;case"instance_light":d.instanceLights.push(h(c.getAttribute("url")));break;case"instance_geometry":d.instanceGeometries.push(Ca(c));break;case"instance_node":d.instanceNodes.push(h(c.getAttribute("url")));break;case"matrix":var f=g(c.textContent);d.matrix.multiply(Oa.fromArray(f).transpose()),d.transforms[c.getAttribute("sid")]=c.nodeName;break;case"translate":var f=g(c.textContent);Pa.fromArray(f),d.matrix.multiply(Oa.makeTranslation(Pa.x,Pa.y,Pa.z)),d.transforms[c.getAttribute("sid")]=c.nodeName;break;case"rotate":var f=g(c.textContent),i=a.Math.degToRad(f[3]);d.matrix.multiply(Oa.makeRotationAxis(Pa.fromArray(f),i)),d.transforms[c.getAttribute("sid")]=c.nodeName;break;case"scale":var f=g(c.textContent);d.matrix.scale(Pa.fromArray(f)),d.transforms[c.getAttribute("sid")]=c.nodeName;break;case"extra":break;default:console.log(c);}return Ya.nodes[d.id]=d,d}function Ca(a){for(var b,c={id:h(a.getAttribute("url")),materials:{},skeletons:[]},d=0;d<a.childNodes.length;d++)switch(b=a.childNodes[d],b.nodeName){case"bind_material":for(var e=b.getElementsByTagName("instance_material"),f=0;f<e.length;f++){var g=e[f],i=g.getAttribute("symbol"),j=g.getAttribute("target");c.materials[i]=h(j)}break;case"skeleton":c.skeletons.push(h(b.textContent));break;default:}return c}function Da(b,c){var d,e,f,g=[],h=[];for(d=0;d<b.length;d++){var i=b[d],j=Ia(i);Ea(j,c,g)}for(d=0;d<c.length;d++)for(e=0;e<g.length;e++)if(f=g[e],f.bone.name===c[d].name){h[d]=f,f.processed=!0;break}for(d=0;d<g.length;d++)f=g[d],!1===f.processed&&(h.push(f),f.processed=!0);var k=[],l=[];for(d=0;d<h.length;d++)f=h[d],k.push(f.bone),l.push(f.boneInverse);return new a.Skeleton(k,l)}function Ea(b,c,d){b.traverse(function(b){if(!0===b.isBone){for(var e,f,g=0;g<c.length;g++)if(f=c[g],f.name===b.name){e=f.boneInverse;break}void 0===e&&(e=new a.Matrix4),d.push({bone:b,boneInverse:e,processed:!1})}})}function Fa(b){for(var c=[],d=b.matrix,e=b.nodes,f=b.type,g=b.instanceCameras,h=b.instanceControllers,k=b.instanceLights,m=b.instanceGeometries,n=b.instanceNodes,o=0,i=e.length;o<i;o++)c.push(Ia(e[o]));for(var l,o=0,i=g.length;o<i;o++)l=ba(g[o]),null!==l&&c.push(l.clone());for(var o=0,i=h.length;o<i;o++)for(var p,q=h[o],r=I(q.id),s=na(r.id),t=Ha(s,q.materials),u=q.skeletons,v=r.skin.joints,w=Da(u,v),x=0,j=t.length;x<j;x++)p=t[x],p.isSkinnedMesh&&(p.bind(w,r.skin.bindMatrix),p.normalizeSkinWeights()),c.push(p);for(var y,o=0,i=k.length;o<i;o++)y=fa(k[o]),null!==y&&c.push(y.clone());for(var o=0,i=m.length;o<i;o++)for(var q=m[o],s=na(q.id),t=Ha(s,q.materials),x=0,j=t.length;x<j;x++)c.push(t[x]);for(var o=0,i=n.length;o<i;o++)c.push(Ia(n[o]).clone());var p;if(0===e.length&&1===c.length)p=c[0];else{p="JOINT"===f?new a.Bone:new a.Group;for(var o=0;o<c.length;o++)p.add(c[o])}return p.name="JOINT"===f?b.sid:b.name,p.matrix.copy(d),p.matrix.decompose(p.position,p.quaternion,p.scale),p}function Ga(a,b){for(var c,d=[],e=0,f=a.length;e<f;e++)c=b[a[e]],d.push(Y(c));return d}function Ha(b,c){var d=[];for(var e in b){var f=b[e],g=Ga(f.materialKeys,c);0===g.length&&("lines"===e||"linestrips"===e?g.push(new a.LineBasicMaterial):g.push(new a.MeshPhongMaterial));var h=void 0!==f.data.attributes.skinIndex;if(h)for(var j=0,i=g.length;j<i;j++)g[j].skinning=!0;var k,l=1===g.length?g[0]:g;"lines"===e?k=new a.LineSegments(f.data,l):"linestrips"===e?k=new a.Line(f.data,l):"triangles"===e||"polylist"===e?k=h?new a.SkinnedMesh(f.data,l):new a.Mesh(f.data,l):void 0,d.push(k)}return d}function Ia(a){return o(Ya.nodes[a],Fa)}function Ja(b){var c=new a.Group;c.name=b.name;for(var d,e=b.children,f=0;f<e.length;f++)d=e[f],null===d.id?c.add(Fa(d)):c.add(Ia(d.id));return c}function Ka(a){return o(Ya.visualScenes[a],Ja)}var La=new a.Vector3,Ma=new a.Vector3,Na=new a.Quaternion,Oa=new a.Matrix4,Pa=new a.Vector3;if(console.time("THREE.ColladaLoader"),0===b.length)return{scene:new a.Scene};console.time("THREE.ColladaLoader: DOMParser");var Qa=new DOMParser().parseFromString(b,"application/xml");console.timeEnd("THREE.ColladaLoader: DOMParser");var Ra=d(Qa,"COLLADA")[0],Sa=Ra.getAttribute("version");console.log("THREE.ColladaLoader: File version",Sa);var Ta=function(a){return{unit:i(d(a,"unit")[0]),upAxis:l(d(a,"up_axis")[0])}}(d(Ra,"asset")[0]),Ua=new a.TextureLoader(this.manager);Ua.setPath(c).setCrossOrigin(this.crossOrigin);var Va=[],Wa={},Xa=0,Ya={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},kinematicsScenes:{}};console.time("THREE.ColladaLoader: Parse"),m(Ra,"library_animations","animation",function(a){for(var b,c={sources:{},samplers:{},channels:{}},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType){var f;switch(b.nodeName){case"source":f=b.getAttribute("id"),c.sources[f]=ga(b);break;case"sampler":f=b.getAttribute("id"),c.samplers[f]=p(b);break;case"channel":f=b.getAttribute("target"),c.channels[f]=q(b);break;default:console.log(b);}}Ya.animations[a.getAttribute("id")]=c}),m(Ra,"library_animation_clips","animation_clip",function(a){for(var b,c={name:a.getAttribute("id")||"default",start:parseFloat(a.getAttribute("start")||0),end:parseFloat(a.getAttribute("end")||0),animations:[]},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"instance_animation":c.animations.push(h(b.getAttribute("url")));}Ya.clips[a.getAttribute("id")]=c}),m(Ra,"library_controllers","controller",function(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"skin":c.id=h(b.getAttribute("source")),c.skin=D(b);break;case"morph":c.id=h(b.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");}Ya.controllers[a.getAttribute("id")]=c}),m(Ra,"library_images","image",function(a){var b={init_from:d(a,"init_from")[0].textContent};Ya.images[a.getAttribute("id")]=b}),m(Ra,"library_effects","effect",function(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"profile_COMMON":c.profile=L(b);}Ya.effects[a.getAttribute("id")]=c}),m(Ra,"library_materials","material",function(a){for(var b,c={name:a.getAttribute("name")},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"instance_effect":c.url=h(b.getAttribute("url"));}Ya.materials[a.getAttribute("id")]=c}),m(Ra,"library_cameras","camera",function(a){for(var b,c={name:a.getAttribute("name")},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"optics":c.optics=Z(b);}Ya.cameras[a.getAttribute("id")]=c}),m(Ra,"library_lights","light",function(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"technique_common":c=ca(b);}Ya.lights[a.getAttribute("id")]=c}),m(Ra,"library_geometries","geometry",function(a){var b={name:a.getAttribute("name"),sources:{},vertices:{},primitives:[]},c=d(a,"mesh")[0];if(void 0!==c){for(var e,f=0;f<c.childNodes.length;f++)if(e=c.childNodes[f],1===e.nodeType){var g=e.getAttribute("id");switch(e.nodeName){case"source":b.sources[g]=ga(e);break;case"vertices":b.vertices=ha(e);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",e.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":b.primitives.push(ia(e));break;default:console.log(e);}}Ya.geometries[a.getAttribute("id")]=b}}),m(Ra,"library_nodes","node",Ba),m(Ra,"library_visual_scenes","visual_scene",function(a){var b={name:a.getAttribute("name"),children:[]};Aa(a);for(var c=d(a,"node"),e=0;e<c.length;e++)b.children.push(Ba(c[e]));Ya.visualScenes[a.getAttribute("id")]=b}),m(Ra,"library_kinematics_models","kinematics_model",function(a){for(var b,c={name:a.getAttribute("name")||"",joints:{},links:[]},d=0;d<a.childNodes.length;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"technique_common":qa(b,c);}Ya.kinematicsModels[a.getAttribute("id")]=c}),m(Ra,"scene","instance_kinematics_scene",function(a){for(var b,c={bindJointAxis:[]},d=0;d<a.childNodes.length;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"bind_joint_axis":c.bindJointAxis.push(wa(b));}Ya.kinematicsScenes[h(a.getAttribute("url"))]=c}),console.timeEnd("THREE.ColladaLoader: Parse"),console.time("THREE.ColladaLoader: Build"),n(Ya.animations,r),n(Ya.clips,B),n(Ya.controllers,G),n(Ya.images,J),n(Ya.effects,V),n(Ya.materials,X),n(Ya.cameras,aa),n(Ya.lights,ea),n(Ya.geometries,ka),n(Ya.visualScenes,Ja),console.timeEnd("THREE.ColladaLoader: Build"),function(){var b=Ya.clips;if(!0!==k(b))for(var c in b)Va.push(C(c));else if(!1===k(Ya.animations)){var d=[];for(var c in Ya.animations)for(var e=s(c),f=0,g=e.length;f<g;f++)d.push(e[f]);Va.push(new a.AnimationClip("default",-1,d))}}(),function(){function b(a,b){var c=b.getAttribute("name"),d=f.joints[a];h.traverse(function(e){e.name===c&&(k[a]={object:e,transforms:za(b),joint:d,position:d.zeroPosition})})}var c=Object.keys(Ya.kinematicsModels)[0],d=Object.keys(Ya.kinematicsScenes)[0],e=Object.keys(Ya.visualScenes)[0];if(void 0!==c&&void 0!==d){for(var f=pa(c),g=ya(d),h=Ka(e),j=g.bindJointAxis,k={},m=0,i=j.length;m<i;m++){var l=j[m],n=Ra.querySelector("[sid=\""+l.target+"\"]");if(n){var o=n.parentElement;b(l.jointIndex,o)}}var p=new a.Matrix4;Wa={joints:f&&f.joints,getJointValue:function(a){var b=k[a];return b?b.position:void console.warn("THREE.ColladaLoader: Joint "+a+" doesn't exist.")},setJointValue:function(b,c){var d=k[b];if(d){var e=d.joint;if(c>e.limits.max||c<e.limits.min)console.warn("THREE.ColladaLoader: Joint "+b+" value "+c+" outside of limits (min: "+e.limits.min+", max: "+e.limits.max+").");else if(e.static)console.warn("THREE.ColladaLoader: Joint "+b+" is static.");else{var f=d.object,g=e.axis,h=d.transforms;Oa.identity();for(var j,l=0;l<h.length;l++)if(j=h[l],j.sid&&-1!==j.sid.indexOf(b))switch(e.type){case"revolute":Oa.multiply(p.makeRotationAxis(g,a.Math.degToRad(c)));break;case"prismatic":Oa.multiply(p.makeTranslation(g.x*c,g.y*c,g.z*c));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+e.type);}else switch(j.type){case"matrix":Oa.multiply(j.obj);break;case"translate":Oa.multiply(p.makeTranslation(j.obj.x,j.obj.y,j.obj.z));break;case"scale":Oa.scale(j.obj);break;case"rotate":Oa.multiply(p.makeRotationAxis(j.obj,j.angle));}f.matrix.copy(Oa),f.matrix.decompose(f.position,f.quaternion,f.scale),k[b].position=c}}else console.log("THREE.ColladaLoader: "+b+" does not exist.")}}}}();var Za=function(a){var b=d(a,"instance_visual_scene")[0];return Ka(h(b.getAttribute("url")))}(d(Ra,"scene")[0]);return"Z_UP"===Ta.upAxis&&(Za.rotation.x=-Math.PI/2),Za.scale.multiplyScalar(Ta.unit),console.timeEnd("THREE.ColladaLoader"),{animations:Va,kinematics:Wa,library:Ya,scene:Za}}}},a.exports});;
Cube("datav:/com/guston-3d-layer-loader-obj/0.0.3/shader/fragPass.js",[],function(a){const b=`
#ifdef GL_ES
  precision highp float;
#endif

uniform vec3 uColor;

void main() {
  // gl_FragColor = vec4( 0.3, 17.8, 15.2, 1.4 );
  gl_FragColor = vec4(uColor, 1.0);
}
`;return a.exports=b,a.exports});;
Cube("datav:/com/guston-3d-layer-loader-obj/0.0.3/loader/MTLLoader.js",[],function(a){return a.exports=function(a){a.MTLLoader=function(b){this.manager=void 0===b?a.DefaultLoadingManager:b},a.MTLLoader.prototype={constructor:a.MTLLoader,load:function(b,c,d,e){var f=this,g=new a.FileLoader(this.manager);g.setPath(this.path),g.load(b,function(a){c(f.parse(a))},d,e)},setPath:function(a){this.path=a},setTexturePath:function(a){this.texturePath=a},setBaseUrl:function(a){console.warn("THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead."),this.setTexturePath(a)},setCrossOrigin:function(a){this.crossOrigin=a},setMaterialOptions:function(a){this.materialOptions=a},parse:function(b){for(var c,d=b.split("\n"),e={},f=/\s+/,g={},h=0;h<d.length;h++)if(c=d[h],c=c.trim(),0!==c.length&&"#"!==c.charAt(0)){var i=c.indexOf(" "),j=0<=i?c.substring(0,i):c;j=j.toLowerCase();var k=0<=i?c.substring(i+1):"";if(k=k.trim(),"newmtl"===j)e={name:k},g[k]=e;else if(e)if("ka"===j||"kd"===j||"ks"===j){var l=k.split(f,3);e[j]=[parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2])]}else e[j]=k}var m=new a.MTLLoader.MaterialCreator(this.texturePath||this.path,this.materialOptions);return m.setCrossOrigin(this.crossOrigin),m.setManager(this.manager),m.setMaterials(g),m}},a.MTLLoader.MaterialCreator=function(b,c){this.baseUrl=b||"",this.options=c,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:a.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:a.RepeatWrapping},a.MTLLoader.MaterialCreator.prototype={constructor:a.MTLLoader.MaterialCreator,crossOrigin:"Anonymous",setCrossOrigin:function(a){this.crossOrigin=a},setManager:function(a){this.manager=a},setMaterials:function(a){this.materialsInfo=this.convert(a),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(a){if(!this.options)return a;var b={};for(var c in a){var d=a[c],e={};for(var f in b[c]=e,d){var g=!0,h=d[f],i=f.toLowerCase();switch(i){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(h=[h[0]/255,h[1]/255,h[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===h[0]&&0===h[1]&&0===h[2]&&(g=!1);break;default:}g&&(e[i]=h)}}return b},preload:function(){for(var a in this.materialsInfo)this.create(a)},getIndex:function(a){return this.nameLookup[a]},getAsArray:function(){var a=0;for(var b in this.materialsInfo)this.materialsArray[a]=this.create(b),this.nameLookup[b]=a,a++;return this.materialsArray},create:function(a){return void 0===this.materials[a]&&this.createMaterial_(a),this.materials[a]},createMaterial_:function(b){function c(a,b){return"string"!==typeof b||""===b?"":/^https?:\/\//i.test(b)?b:a+b}function d(a,b){if(!g[a]){var d=e.getTextureParams(b,g),f=e.loadTexture(c(e.baseUrl,d.url));f.repeat.copy(d.scale),f.offset.copy(d.offset),f.wrapS=e.wrap,f.wrapT=e.wrap,g[a]=f}}var e=this,f=this.materialsInfo[b],g={name:b,side:this.side};for(var h in f){var i,j=f[h];if(""!==j)switch(h.toLowerCase()){case"kd":g.color=new a.Color().fromArray(j);break;case"ks":g.specular=new a.Color().fromArray(j);break;case"map_kd":d("map",j);break;case"map_ks":d("specularMap",j);break;case"norm":d("normalMap",j);break;case"map_bump":case"bump":d("bumpMap",j);break;case"ns":g.shininess=parseFloat(j);break;case"d":i=parseFloat(j),1>i&&(g.opacity=i,g.transparent=!0);break;case"tr":i=parseFloat(j),0<i&&(g.opacity=1-i,g.transparent=!0);break;default:}}return this.materials[b]=new a.MeshPhongMaterial(g),this.materials[b]},getTextureParams:function(b,c){var d,e={scale:new a.Vector2(1,1),offset:new a.Vector2(0,0)},f=b.split(/\s+/);return d=f.indexOf("-bm"),0<=d&&(c.bumpScale=parseFloat(f[d+1]),f.splice(d,2)),d=f.indexOf("-s"),0<=d&&(e.scale.set(parseFloat(f[d+1]),parseFloat(f[d+2])),f.splice(d,4)),d=f.indexOf("-o"),0<=d&&(e.offset.set(parseFloat(f[d+1]),parseFloat(f[d+2])),f.splice(d,4)),e.url=f.join(" ").trim(),e},loadTexture:function(b,c,d,e,f){var g,h=a.Loader.Handlers.get(b),i=void 0===this.manager?a.DefaultLoadingManager:this.manager;return null===h&&(h=new a.TextureLoader(i)),h.setCrossOrigin&&h.setCrossOrigin(this.crossOrigin),g=h.load(b,d,e,f),void 0!==c&&(g.mapping=c),g}}},a.exports});;
Cube("datav:/com/guston-3d-layer-loader-obj/0.0.3/shader/frag.js",[],function(a){const b=`
#ifdef GL_ES
  precision highp float;
#endif

varying vec2 vUv;
uniform sampler2D tDiffuse;
void main() {
  gl_FragColor = texture2D( tDiffuse, vUv );
}
`;return a.exports=b,a.exports});;
Cube("datav:/com/guston-3d-layer-loader-obj/0.0.3/loader/LoaderUtils",[],function(a){return a.exports=function(a){a.LoaderUtils={decodeText:function(a){if("undefined"!==typeof TextDecoder)return new TextDecoder().decode(a);for(var b="",c=0,d=a.length;c<d;c++)b+=String.fromCharCode(a[c]);return decodeURIComponent(escape(b))},extractUrlBase:function(a){var b=a.split("/");return 1===b.length?"./":(b.pop(),b.join("/")+"/")}}},a.exports});;
Cube("datav:/com/guston-3d-layer-loader-obj/0.0.3/loader/OBJLoader",[],function(a){return a.exports=function(a){a.OBJLoader=function(){function b(){var a={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(a,b){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=a,void(this.object.fromDeclaration=!1!==b);var c=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0),this.object={name:a||"",fromDeclaration:!1!==b,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(a,b){var c=this._finalize(!1);c&&(c.inherited||0>=c.groupCount)&&this.materials.splice(c.index,1);var d={index:this.materials.length,name:a||"",mtllib:Array.isArray(b)&&0<b.length?b[b.length-1]:"",smooth:void 0===c?this.smooth:c.smooth,groupStart:void 0===c?0:c.groupEnd,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(a){var b={index:"number"===typeof a?a:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return b.clone=this.clone.bind(b),b}};return this.materials.push(d),d},currentMaterial:function(){return 0<this.materials.length?this.materials[this.materials.length-1]:void 0},_finalize:function(a){var b=this.currentMaterial();if(b&&-1===b.groupEnd&&(b.groupEnd=this.geometry.vertices.length/3,b.groupCount=b.groupEnd-b.groupStart,b.inherited=!1),a&&1<this.materials.length)for(var c=this.materials.length-1;0<=c;c--)0>=this.materials[c].groupCount&&this.materials.splice(c,1);return a&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),b}},c&&c.name&&"function"===typeof c.clone){var d=c.clone(0);d.inherited=!0,this.object.materials.push(d)}this.objects.push(this.object)},finalize:function(){this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(a,b){var c=parseInt(a,10);return 3*(0<=c?c-1:c+b/3)},parseNormalIndex:function(a,b){var c=parseInt(a,10);return 3*(0<=c?c-1:c+b/3)},parseUVIndex:function(a,b){var c=parseInt(a,10);return 2*(0<=c?c-1:c+b/2)},addVertex:function(d,a,b){var c=this.vertices,e=this.object.geometry.vertices;e.push(c[d+0],c[d+1],c[d+2]),e.push(c[a+0],c[a+1],c[a+2]),e.push(c[b+0],c[b+1],c[b+2])},addVertexLine:function(b){var a=this.vertices,c=this.object.geometry.vertices;c.push(a[b+0],a[b+1],a[b+2])},addNormal:function(d,a,b){var c=this.normals,e=this.object.geometry.normals;e.push(c[d+0],c[d+1],c[d+2]),e.push(c[a+0],c[a+1],c[a+2]),e.push(c[b+0],c[b+1],c[b+2])},addUV:function(d,a,b){var c=this.uvs,e=this.object.geometry.uvs;e.push(c[d+0],c[d+1]),e.push(c[a+0],c[a+1]),e.push(c[b+0],c[b+1])},addUVLine:function(b){var a=this.uvs,c=this.object.geometry.uvs;c.push(a[b+0],a[b+1])},addFace:function(d,a,b,c,e,f,g,h,i){var j=this.vertices.length,k=this.parseVertexIndex(d,j),l=this.parseVertexIndex(a,j),m=this.parseVertexIndex(b,j);if(this.addVertex(k,l,m),void 0!==c){var n=this.uvs.length;k=this.parseUVIndex(c,n),l=this.parseUVIndex(e,n),m=this.parseUVIndex(f,n),this.addUV(k,l,m)}if(void 0!==g){var o=this.normals.length;k=this.parseNormalIndex(g,o),l=g===h?k:this.parseNormalIndex(h,o),m=g===i?k:this.parseNormalIndex(i,o),this.addNormal(k,l,m)}},addLineGeometry:function(a,b){this.object.geometry.type="Line";for(var c=this.vertices.length,d=this.uvs.length,e=0,f=a.length;e<f;e++)this.addVertexLine(this.parseVertexIndex(a[e],c));for(var g=0,f=b.length;g<f;g++)this.addUVLine(this.parseUVIndex(b[g],d))}};return a.startObject("",!1),a}function c(b){this.manager=void 0===b?a.DefaultLoadingManager:b,this.materials=null}var d=/^[og]\s*(.+)?/,e=/^mtllib /,f=/^usemtl /;return c.prototype={constructor:c,load:function(b,c,d,e){var f=this,g=new a.FileLoader(f.manager);g.setPath(this.path),g.load(b,function(a){c(f.parse(a))},d,e)},setPath:function(a){this.path=a},setMaterials:function(a){return this.materials=a,this},parse:function(c){console.time("OBJLoader");var g=new b;-1!==c.indexOf("\r\n")&&(c=c.replace(/\r\n/g,"\n")),-1!==c.indexOf("\\\n")&&(c=c.replace(/\\\n/g,""));for(var h=c.split("\n"),k="",m="",n=0,o=[],p="function"===typeof"".trimLeft,q=0,i=h.length;q<i;q++)if(k=h[q],k=k.trimLeft(),n=k.length,0!==n&&(m=k.charAt(0),"#"!==m))if("v"===m){var l=k.split(/\s+/);switch(l[0]){case"v":g.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));break;case"vn":g.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));break;case"vt":g.uvs.push(parseFloat(l[1]),parseFloat(l[2]));}}else if("f"===m){for(var r,s=k.substr(1).trim(),t=s.split(/\s+/),u=[],v=0,j=t.length;v<j;v++)if(r=t[v],0<r.length){var w=r.split("/");u.push(w)}for(var x=u[0],v=1,j=u.length-1;v<j;v++){var y=u[v],z=u[v+1];g.addFace(x[0],y[0],z[0],x[1],y[1],z[1],x[2],y[2],z[2])}}else if("l"===m){var A=k.substring(1).trim().split(" "),B=[],C=[];if(-1===k.indexOf("/"))B=A;else for(var D,E=0,F=A.length;E<F;E++)D=A[E].split("/"),""!==D[0]&&B.push(D[0]),""!==D[1]&&C.push(D[1]);g.addLineGeometry(B,C)}else if(null!==(o=d.exec(k))){var G=(" "+o[0].substr(1).trim()).substr(1);g.startObject(G)}else if(f.test(k))g.object.startMaterial(k.substring(7).trim(),g.materialLibraries);else if(e.test(k))g.materialLibraries.push(k.substring(7).trim());else if("s"===m){if(o=k.split(" "),1<o.length){var H=o[1].trim().toLowerCase();g.object.smooth="0"!==H&&"off"!==H}else g.object.smooth=!0;var I=g.object.currentMaterial();I&&(I.smooth=g.object.smooth)}else{if("\0"===k)continue;throw new Error("Unexpected line: '"+k+"'")}g.finalize();var J=new a.Group;J.materialLibraries=[].concat(g.materialLibraries);for(var q=0,i=g.objects.length;q<i;q++){var K=g.objects[q],L=K.geometry,M=K.materials,N="Line"===L.type;if(0!==L.vertices.length){var O=new a.BufferGeometry;O.addAttribute("position",new a.BufferAttribute(new Float32Array(L.vertices),3)),0<L.normals.length?O.addAttribute("normal",new a.BufferAttribute(new Float32Array(L.normals),3)):O.computeVertexNormals(),0<L.uvs.length&&O.addAttribute("uv",new a.BufferAttribute(new Float32Array(L.uvs),2));for(var P=[],Q=0,R=M.length;Q<R;Q++){var S=M[Q],I=void 0;if(null!==this.materials&&(I=this.materials.create(S.name),N&&I&&!(I instanceof a.LineBasicMaterial))){var T=new a.LineBasicMaterial;T.copy(I),I=T}I||(I=N?new a.LineBasicMaterial:new a.MeshPhongMaterial,I.name=S.name),I.flatShading=!S.smooth,P.push(I)}var U;if(1<P.length){for(var S,Q=0,R=M.length;Q<R;Q++)S=M[Q],O.addGroup(S.groupStart,S.groupCount,Q);U=N?new a.LineSegments(O,P):new a.Mesh(O,P)}else U=N?new a.LineSegments(O,P[0]):new a.Mesh(O,P[0]);U.name=K.name,J.add(U)}}return console.timeEnd("OBJLoader"),J}},c}()},a.exports});;
Cube("datav:/com/guston-3d-layer-loader-obj/0.0.3/shader/vert.js",[],function(a){const b=`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}
`;return a.exports=b,a.exports});;
Cube("datav:/com/guston-3d-layer-loader-obj/0.0.3/LoaderObjLayer.js",["datav:/npm/bcore/0.0.21/event","datav:/npm/safely-merge/1.0.0","datav:/npm/chroma-js/1.3.4"],function(a,b,c){const d=c("datav:/npm/bcore/0.0.21/event"),e=c("datav:/npm/safely-merge/1.0.0"),f=c("datav:/npm/chroma-js/1.3.4"),g=Math.PI/180,h=c("datav:/com/guston-3d-layer-loader-obj/0.0.3/shader/vert.js"),i=c("datav:/com/guston-3d-layer-loader-obj/0.0.3/shader/frag.js"),j=c("datav:/com/guston-3d-layer-loader-obj/0.0.3/shader/fragPass.js");return a.exports=function(a){const b={},i=a.THREE;return c("datav:/com/guston-3d-layer-loader-obj/0.0.3/loader/MTLLoader.js")(i),c("datav:/com/guston-3d-layer-loader-obj/0.0.3/loader/OBJLoader")(i),c("datav:/com/guston-3d-layer-loader-obj/0.0.3/loader/ColladaLoader")(i),c("datav:/com/guston-3d-layer-loader-obj/0.0.3/loader/LoaderUtils")(i),class extends d{constructor(c){super(),c=e(b,c),this.options=e(this.options,c),this.animate=this.animate.bind(this),this.init(a)}init(a){console.log(i.ColladaLoader),this.dgl=a,this.loadModel(),this.dgl.event.on("runAnimation",this.animate)}updateOverRideMaterialColor(){this.overRideMaterial&&this.overRideMaterial.map.dispose(),this.overRideMaterial&&this.overRideMaterial.dispose(),this.overRideMaterial=null,this.overRideMaterial=this.createFloatTextureMaterial()}updateOverRideMaterial(){this.object&&this.object.children.forEach((a)=>{a.material=this.overRideMaterial})}updateModel(){this.updateOverRideMaterialColor(),this.options.overrideMaterial&&this.updateOverRideMaterial(),this.object&&(this.object.rotation.set(this.options.rotation.x*g,this.options.rotation.y*g,this.options.rotation.z*g),this.object.position.set(this.options.transform.x,this.options.transform.y,this.options.transform.z),this.object.scale.set(this.options.scale.x,this.options.scale.y,this.options.scale.z),this.object.children.forEach((a)=>{a.material&&this.options.doubleSideMaterial?a.material.side=i.DoubleSide:a.material&&!this.options.doubleSideMaterial&&(a.material.side=null),a.material&&this.options.enableZFighting&&(a.material.polygonOffset=!0,a.material.polygonOffsetFactor=this.options.polygonOffsetFactor,a.material.polygonOffsetUnits=this.options.polygonOffsetUnits)}))}updateOptions(a){let b=this.options.loaderObj.rootUrl!==a.loaderObj.rootUrl||this.options.loaderObj.modelName!==a.loaderObj.modelName,c=this.options.materialFloat.hue!==a.materialFloat.hue||this.options.materialFloat.light!==a.materialFloat.light;this.options=e(this.options,a),b&&this.loadModel(),c&&this.updateOverRideMaterialColor(),this.updateModel()}remove(){this.object&&this.dgl.scene.remove(this.object),this.object&&this.dgl.disposeNode(this.object),this.object=null}initOverRideMaterial(){this.overRideMaterial=this.createFloatTextureMaterial()}loadModel(){this.clearMesh(),this.initOverRideMaterial(),this.loadObjFormat()}loadObjFormat(){const a=new i.MTLLoader;a.setCrossOrigin("*"),a.setPath(this.options.loaderObj.rootUrl),a.load(this.options.loaderObj.modelName+".mtl",(a)=>{a.preload();const b=new i.OBJLoader;b.setMaterials(a),b.setPath(this.options.loaderObj.rootUrl),b.load(this.options.loaderObj.modelName+".obj",(a)=>{console.log("review obj model"),console.log(a);let b=new i.Box3;b.setFromObject(a);let c=b.getCenter(),d=b.getSize();console.log("obj model center: "),console.log(c),console.log("obj model size: "),console.log(d),a.children.forEach((a)=>{this.options.overrideMaterial&&(a.material=this.overRideMaterial),a.material&&a.material.side&&(a.material.side=i.DoubleSide),a.material&&this.options.doubleSideMaterial&&(a.material.side=i.DoubleSide),a.material&&this.options.enableZFighting&&(a.material.polygonOffset=!0,a.material.polygonOffsetFactor=this.options.polygonOffsetFactor,a.material.polygonOffsetUnits=this.options.polygonOffsetUnits)}),this.object=a,this.dgl.scene.add(this.object),this.object.rotation.set(this.options.rotation.x*g,this.options.rotation.y*g,this.options.rotation.z*g),this.object.position.set(this.options.transform.x,this.options.transform.y,this.options.transform.z),this.object.scale.set(this.options.scale.x,this.options.scale.y,this.options.scale.z)},this.onProgress,this.onError)},this.onProgress,this.onError)}createFloatTextureMaterial(){let a=this;this.sceneRTT=new i.Scene,this.cameraRTT=new i.OrthographicCamera(-256,256,256,-256,-1e4,1e4),this.cameraRTT.position.z=0,this.rtTexture=new i.WebGLRenderTarget(512,512,{minFilter:i.LinearFilter,magFilter:i.LinearFilter,format:i.RGBAFormat,type:i.FloatType});let b=function(){let b=f.hsl(a.options.materialFloat.hue,1,0.6).gl(),c=b[0]*(1-0.3)*a.options.materialFloat.light,d=b[1]*(1-0.59)*a.options.materialFloat.light,e=b[2]*(1-0.11)*a.options.materialFloat.light,g=new i.PlaneGeometry(512,512),k=new i.ShaderMaterial({uniforms:{uColor:{value:new i.Vector3(c,d,e)}},vertexShader:h,fragmentShader:j,transparent:!0,opacity:1}),l=new i.Mesh(g,k);return l}();this.sceneRTT.add(b);var c=new i.MeshBasicMaterial({color:16777215,map:this.rtTexture.texture,side:i.DoubleSide});return c}renderRttPerFrame(){this.rtTexture&&this.dgl.renderer.render(this.sceneRTT,this.cameraRTT,this.rtTexture,!0)}clearMesh(){this.object&&this.dgl.scene.remove(this.object),this.object&&this.dgl.disposeNode(this.object)}animate(){this.renderRttPerFrame()}}},a.exports});;
Cube("datav:/com/guston-3d-layer-loader-obj/0.0.3",["datav:/npm/bcore/0.0.21/event","datav:/npm/safely-merge/1.0.0"],function(a,b,c){const d=c("datav:/npm/bcore/0.0.21/event"),e=c("datav:/npm/safely-merge/1.0.0"),f=c("datav:/com/guston-3d-layer-loader-obj/0.0.3/LoaderObjLayer.js"),g={};return a.exports=class extends d{constructor(a,b){super(),this.apis=b.apis,this._data=null,this.config=b}init(a){let b=this.getOptions(),c=f(a);this.layer=new c(b)}addTo(a){this.init(a)}getOptions(){return this.config=e(g,this.config),this.config}data(a){return console.log("data called in index.js"),a&&(this._data=a),this._data}remove(){this.layer&&this.layer.remove&&this.layer.remove(),this.layer=null,this._data=null}render(){}updateOptions(a){this.config=e(this.config,a),a=this.getOptions(),this.layer&&this.layer.updateOptions(a)}},a.exports});