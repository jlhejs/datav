// env=undefined => env=publish 
Cube("datav:/com/@datav-city-pro-v2/datav-engine-contrast-column/2.1.3/shader/frag.glsl",[],function(e,n,o,d,i,c){return e.exports="#define GLSLIFY 1\nuniform vec4 u_side_color;\nuniform vec4 u_side_tex_color;\n// uniform vec4 u_clicked_color;\nuniform vec2 u_uvscale1;\nuniform vec2 u_uvscale2;\nuniform float u_speed1;\nuniform float u_speed2;\nuniform sampler2D u_side_tex;\nuniform sampler2D u_side_add_tex;\n\n#include <common>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n\nvarying vec2 vUv;\n// flat varying int vFaceType;\n// flat varying int vPick;\n\nbool isPicked(int pick){\n  if(pick == 1){\n    return true;\n  }else{\n    return false;\n  }\n}\n\nvoid main() {\n  #include <logdepthbuf_fragment>\n\n  vec2 uv1 = vUv * u_uvscale1;\n  vec2 uv2 = vUv * u_uvscale2;\n\n  #ifdef USE_HORIZONTAL_ANIM\n    uv1.x += u_speed1;\n    uv2.x += u_speed2;\n  #else\n    uv1.y -= u_speed1;\n    uv2.y -= u_speed2;\n  #endif\n\n  vec4 sideTex = texture2D(u_side_tex, uv1);\n  vec4 sideAddTex = texture2D(u_side_add_tex, uv2);\n\n  sideTex = mix(vec4(.0), sideTex, sideTex.a);\n  sideAddTex = mix(sideAddTex, vec4(1.0), sideAddTex);\n\n  vec4 addcolor = sideTex + sideAddTex;\n\n\tvec4 u_side_tex_color2 = vec4(pow(u_side_tex_color.r, 2.2), pow(u_side_tex_color.g, 2.2),pow(u_side_tex_color.b, 2.2), u_side_tex_color.a);\n\n  addcolor *= u_side_tex_color2;\n\n  vec4 color = vec4(1.0);\n\n  // 由于配置项显示的颜色已经是经过gamma校正的，而后期渲染模块会统一做gamma校正，\n  // 为了图元渲染颜色和配置项设置颜色保持一致，需要做以下处理以抵消\n\tvec4 u_side_color2 = vec4(pow(u_side_color.r, 2.2), pow(u_side_color.g, 2.2),pow(u_side_color.b, 2.2), u_side_color.a);\n\n  color = mix(u_side_color2, addcolor, addcolor);\n  \n  float opacityFactor = 1.0;\n\n  #ifdef USE_GRADIENT\n    opacityFactor = 1.0 * pow(1. - vUv.y, 2.0);\n  #endif\n\n  gl_FragColor = vec4(color.rgb, opacityFactor * color.a);\n\n  #include <fog_fragment>\n  #include <premultiplied_alpha_fragment>\n}",e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-contrast-column/2.1.3/shader/vert.glsl",[],function(n,i,e,t,o,v){return n.exports="#define GLSLIFY 1\nvarying vec2 vUv;\n// attribute int faceType;\n// attribute int pick;\n// flat varying int vFaceType;\n// flat varying int vPick;\n#include <common>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n\nvoid main() {\n  vUv = uv;\n  // vFaceType = faceType;\n  // vPick = pick;\n  // gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n  vec4 mvPosition = vec4(position, 1.0); //transformed\n  #ifdef USE_INSTANCING\n\n    mvPosition = instanceMatrix * mvPosition;\n\n  #endif\n\n  // vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n  mvPosition = modelViewMatrix * mvPosition;\n  gl_Position = projectionMatrix * mvPosition;\n\n  #include <fog_vertex>\n  #include <logdepthbuf_vertex>\n}",n.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-contrast-column/2.1.3/contrast-column",[],function(e,t,u,a,i,r){function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,a){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(i)return(i=Object.getOwnPropertyDescriptor(i,t)).get?i.get.call(arguments.length<3?e:a):i.value}).apply(this,arguments)}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function x(a){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=b(a),t=(e=i?(e=b(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===s(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}return e.exports=function(e){var p=e.THREE,h=e.Utils,a=e.VG,t=e.FormatTransformer,f=e.coordHelper,e=a.Layer,m=new p.Vector3,v=new p.Vector3,y=new p.Quaternion,g=new p.Vector3,_=new p.Matrix4,i=new p.TextureLoader,r=(i.setCrossOrigin("*"),n);if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&c(r,e);var s,o=x(n);function n(e){var t;if(this instanceof n)return(t=o.call(this)).classNameAlias="ContrastColumnLayer",t.layerName=t.classNameAlias,t.renderQueue=a.Transparent,t.needsAutoUpdate=!0,t.options=Object.assign({visible:!0},e||{}),t.defaultAltitude=0,t.defaultValue=1,t;throw new TypeError("Cannot call a class as a function")}return r=n,(e=[{key:"addTo",value:function(e){d(b(n.prototype),"addTo",this).call(this,e),this.formatTransformer=new t}},{key:"setData",value:function(e){this.clear(),this.data=e,this.formattedData=this.checkData(e),this.render()}},{key:"errorRender",value:function(){this.emit("rendered")}},{key:"checkData",value:function(e){if(!e)return console.error("ContrastColumnLayer no data");var t,a,i,r,s=e,o=[];if(!Array.isArray(e)){if("FeatureCollection"!==e.type)return console.error("ContrastColumnLayer: invalid data format.",e);s=this.formatTransformer.geojson2datav(e)}if(!s.length)return console.error("ContrastColumnLayer: the length of data is 0.",e);for(var n=0,l=s.length;n<l;n++)r=s[n],t=parseFloat(r.lng),a=parseFloat(r.lat),i=parseFloat(r.altitude),r=parseFloat(r.value),isNaN(t)||isNaN(a)||(i=isNaN(i)?this.defaultAltitude:i,r=isNaN(r)?this.defaultValue:r,o.push({lng:t,lat:a,altitude:i,value:r}));return o}},{key:"render",value:function(){if(!this.formattedData)return this.emit("rendered");this.material=this.initMaterial(),this.initStaticTexture();for(var e=this.options.options,t=e.general,e=e.graph,a=t.verticalOffset,i=t.heightScale,r=t.radiusScale,t=e.radialSegments,e=new p.CylinderBufferGeometry(1,1,1,t,1,!0),s=(e.computeVertexNormals(),e.computeBoundingBox(),e.computeBoundingSphere(),new p.InstancedMesh(e,this.material,this.formattedData.length)),o=(this.add(s),this.mesh=s,new p.Box3),n=0,l=this.formattedData.length;n<l;n++){var u=this.formattedData[n];f.setFromValues(u.lng,u.lat,u.altitude+a),f.toXYZ(m),o.expandByPoint(m),f.transfrom.decompose(v,y,g),g.set(u.value*r,u.value*i,u.value*r),_.compose(v,y,g),s.setMatrixAt(n,_)}var d=new p.Vector3;o.getCenter(d),s.position.copy(d);for(var h=0,c=this.formattedData.length;h<c;h++)s.getMatrixAt(h,_),_.elements[12]-=d.x,_.elements[13]-=d.y,_.elements[14]-=d.z,s.setMatrixAt(h,_);s.instanceMatrix.needsUpdate=!0,this.checkVisible(),this.emit("rendered")}},{key:"animate",value:function(){var e=this.options.options.animate.speed,t=e.speed1,e=e.speed2;this.material&&(this.material.uniforms.u_speed1.value<=10?this.material.uniforms.u_speed1.value+=t:this.material.uniforms.u_speed1.value=0,this.material.uniforms.u_speed2.value<=10?this.material.uniforms.u_speed2.value+=e:this.material.uniforms.u_speed2.value=0)}},{key:"autoUpdate",value:function(){this.animate()}},{key:"checkVisible",value:function(){this.options.visible?this.show():this.hide()}},{key:"show",value:function(){this.options.visible=!0,d(b(n.prototype),"show",this).call(this)}},{key:"hide",value:function(){this.options.visible=!1,d(b(n.prototype),"hide",this).call(this)}},{key:"initMaterial",value:function(){var e=this.options.options,t=e.general,a=e.graph,e=e.animate,i=a.isGradient,r=a.color,s=a.sideTexture,a=a.sideAddTexture,e=e.animDir,o=t.blendingType,n=t.depthWrite,t=t.depthTest,l=s.sideTexColor,s=s.uvScale1,a=a.uvScale2,r=h.Chroma(r).gl(),l=h.Chroma(l).gl(),r=p.UniformsUtils.merge([p.UniformsLib.fog,{u_side_color:{value:new p.Vector4(r[0],r[1],r[2],r[3])},u_side_tex_color:{value:new p.Vector4(l[0],l[1],l[2],l[3])},u_uvscale1:{value:new p.Vector2(s.x,s.y)},u_uvscale2:{value:new p.Vector2(a.x,a.y)},u_speed1:{value:0},u_speed2:{value:0},u_side_tex:{value:null},u_side_add_tex:{value:null}}]);return new p.ShaderMaterial({uniforms:r,vertexShader:u("datav:/com/@datav-city-pro-v2/datav-engine-contrast-column/2.1.3/shader/vert.glsl"),fragmentShader:u("datav:/com/@datav-city-pro-v2/datav-engine-contrast-column/2.1.3/shader/frag.glsl"),blending:p[o],side:p.DoubleSide,transparent:!0,depthWrite:n,depthTest:t,fog:!0,defines:{USE_GRADIENT:i,USE_HORIZONTAL_ANIM:"horizontal"===e}})}},{key:"initStaticTexture",value:function(){var e=this.options.options.graph,t=e.sideTexture,e=e.sideAddTexture,t=t.sideTextureUrl,e=e.sideAddTextureUrl;this.material.uniforms.u_side_tex.value=i.load(t),this.material.uniforms.u_side_add_tex.value=i.load(e),this.material.uniforms.u_side_tex.value.wrapS=p.RepeatWrapping,this.material.uniforms.u_side_tex.value.wrapT=p.RepeatWrapping,this.material.uniforms.u_side_add_tex.value.wrapS=p.RepeatWrapping,this.material.uniforms.u_side_add_tex.value.wrapT=p.RepeatWrapping}},{key:"updateScale",value:function(){if(this.mesh&&this.formattedData){for(var e=this.options.options.general,t=e.heightScale,a=e.radiusScale,i=0,r=this.formattedData.length;i<r;i++){var s=this.formattedData[i];this.mesh.getMatrixAt(i,_),_.decompose(v,y,g),g.set(s.value*a,s.value*t,s.value*a),_.compose(v,y,g),this.mesh.setMatrixAt(i,_)}this.mesh.instanceMatrix.needsUpdate=!0}}},{key:"updateVerticalOffset",value:function(){if(this.mesh&&this.formattedData){for(var e=this.options.options.general,t=e.verticalOffset,a=e.heightScale,i=e.radiusScale,r=new p.Box3,s=0,o=this.formattedData.length;s<o;s++){var n=this.formattedData[s];f.setFromValues(n.lng,n.lat,n.altitude+t),f.toXYZ(m),r.expandByPoint(m),(_=f.transfrom).decompose(v,y,g),g.set(n.value*i,n.value*a,n.value*i),_.compose(v,y,g),this.mesh.setMatrixAt(s,_)}var l=new p.Vector3;r.getCenter(l),this.mesh.position.copy(l);for(var u=0,d=this.formattedData.length;u<d;u++)this.mesh.getMatrixAt(u,_),_.elements[12]-=l.x,_.elements[13]-=l.y,_.elements[14]-=l.z,this.mesh.setMatrixAt(u,_);this.mesh.instanceMatrix.needsUpdate=!0,this.mesh.matrixNeedsUpdate=!0}}},{key:"updateSideColor",value:function(e){this.material&&e&&this.material.uniforms.u_side_color.value.set(e.r,e.g,e.b,e.a)}},{key:"sideTextureUrlHandler",value:function(e){this.material.uniforms.u_side_tex.value=i.load(e),this.material.uniforms.u_side_tex.value.wrapS=p.RepeatWrapping,this.material.uniforms.u_side_tex.value.wrapT=p.RepeatWrapping}},{key:"sideAddTextureUrlHandler",value:function(e){this.material.uniforms.u_side_add_tex.value=i.load(e),this.material.uniforms.u_side_add_tex.value.wrapS=p.RepeatWrapping,this.material.uniforms.u_side_add_tex.value.wrapT=p.RepeatWrapping}},{key:"updateOptions",value:function(e){var t=h.deepClone(this.options),a=(this.options=h.mergeOptions(this.options,e||{}),this.options.options),i=a.general,r=a.graph,a=a.animate,s=r.isGradient,o=r.color,n=r.sideTexture,r=r.sideAddTexture,a=a.animDir,l=i.blendingType,u=i.depthWrite,i=i.depthTest,d=n.sideTexColor,n=n.uvScale1,r=r.uvScale2;this.material&&(this.material.blending=p[l],this.material.depthWrite=u,this.material.depthTest=i,this.material.defines.USE_GRADIENT=s,this.material.defines.USE_HORIZONTAL_ANIM="horizontal"===a,l=h.Chroma(o).gl(),u=h.Chroma(d).gl(),this.material.uniforms.u_side_color.value.set(l[0],l[1],l[2],l[3]),this.material.uniforms.u_side_tex_color.value.set(u[0],u[1],u[2],u[3]),this.material.uniforms.u_uvscale1.value.set(n.x,n.y),this.material.uniforms.u_uvscale2.value.set(r.x,r.y),this.material.needsUpdate=!0),h.easyDiff(t.options.general.heightScale,e.options.general.heightScale)&&h.easyDiff(t.options.general.radiusScale,e.options.general.radiusScale)||this.updateScale(),h.easyDiff(t.options.graph.radialSegments,e.options.graph.radialSegments)||this.setData(this.data),h.easyDiff(t.options.general.verticalOffset,e.options.general.verticalOffset)||this.updateVerticalOffset(),h.easyDiff(t.sceneId.length,e.sceneId.length)&&h.deepDiff(t.sceneId,e.sceneId)||this.updateSceneId(),this.checkVisible()}},{key:"clear",value:function(){d(b(n.prototype),"clear",this).call(this),this.mesh&&this.mesh.dispose(),this.formattedData&&(this.formattedData.length=0),this.material&&(this.material.uniforms.u_side_tex.value.dispose(),this.material.uniforms.u_side_add_tex.value.dispose())}},{key:"destroy",value:function(){this.clear(),d(b(n.prototype),"destroy",this).call(this)}}])&&l(r.prototype,e),s&&l(r,s),Object.defineProperty(r,"prototype",{writable:!1}),n},e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-contrast-column/2.1.3",["datav:/npm/eventemitter3/3.0.0"],function(e,t,r,n,o,i){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=s(r),t=(e=n?(e=s(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var y=r("datav:/npm/eventemitter3/3.0.0"),f=r("datav:/com/@datav-city-pro-v2/datav-engine-contrast-column/2.1.3/contrast-column"),r=function(){var e=o,t=y;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t);var r,n=u(o);function o(e,t){var r;if(this instanceof o)return(r=n.call(this)).options=t,r.comId="",r;throw new TypeError("Cannot call a class as a function")}return e=o,(t=[{key:"addTo",value:function(e,t){return this.cityproCore=e,this.comId=t,this.initLayer()}},{key:"initLayer",value:function(){var e=f(this.cityproCore);this.layer=new e(this.options),this.cityproCore.viewer.addLayer(this.comId,this.layer)}},{key:"setData",value:function(e){this.layer&&this.layer.setData(e)}},{key:"errorRender",value:function(){console.log("烘托光柱组件数据错误"),this.layer&&this.layer.errorRender()}},{key:"getRootObj3d",value:function(){return[]}},{key:"enableInteractive",get:function(){return!1}},{key:"checkEventValid",value:function(e){return!(!e||"click"!==e.type)}},{key:"active",value:function(e,t){e=e.event,t=t[0]&&t[0].object;return!!this.checkEventValid(e)&&(this.inactive(),t&&(e.button,this.emit("leftClick",t),this.layer.active(t)),!0)}},{key:"inactive",value:function(){this.layer&&this.layer.inactive&&this.layer.inactive()}},{key:"updateOptions",value:function(e){this.layer&&this.layer.updateOptions&&this.layer.updateOptions(e)}},{key:"sideTextureUrlHandler",value:function(e){this.layer.sideTextureUrlHandler(e)}},{key:"sideAddTextureUrlHandler",value:function(e){this.layer.sideAddTextureUrlHandler(e)}},{key:"show",value:function(){this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.layer&&this.layer.hide&&this.layer.hide()}},{key:"remove",value:function(){console.log("remove is duplicate, please use clear instead.",this),this.clear()}},{key:"clear",value:function(){this.layer&&this.layer.clear&&this.layer.clear()}},{key:"destroy",value:function(){this.layer&&(this.layer.destroy&&this.layer.destroy(),this.layer=null)}}])&&c(e.prototype,t),r&&c(e,r),Object.defineProperty(e,"prototype",{writable:!1}),o}();return e.exports=r,e.exports});