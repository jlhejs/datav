// env=undefined => env=publish 
Cube("datav:/com/datav-2dmap-drill/3.0.27/src/geojson-objdecompress.js",[],function(i,s,l,e,t,r){function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}return parcelRequire=function(o,u,e){var t,a="function"==typeof parcelRequire&&parcelRequire,f="function"==typeof l&&l;function c(t,e){if(!u[t]){if(!o[t]){var r="function"==typeof parcelRequire&&parcelRequire;if(!e&&r)return r(t,!0);if(a)return a(t,!0);if(f&&"string"==typeof t)return f(t);e=new Error("Cannot find module '".concat(t,"'"));throw e.code="MODULE_NOT_FOUND",e}n.resolve=function(e){return o[t][1][e]||e},n.cache={};r=u[t]=new c.Module(t);o[t][0].call(r.exports,n,r,r.exports,this)}return u[t].exports;function n(e){return c(n.resolve(e))}}c.isParcelRequire=!0,c.Module=function(e){this.id=e,this.bundle=c,this.exports={}},c.modules=o,c.cache=u,c.parent=a,c.register=function(e,r){o[e]=[function(e,t){t.exports=r},{}]};for(var r,n=0;n<e.length;n++)try{c(e[n])}catch(o){t=t||o}if(e.length&&(r=c(e[e.length-1]),"object"===(void 0===s?"undefined":h(s))&&void 0!==i?i.exports=r:"function"==typeof define&&define.amd&&define(function(){return r})),parcelRequire=c,t)throw t;return c}({n09v:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return e}},{}],PG0d:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){var u,a,f,c,i,s;return null==e?n.default:(f=e.scale[0],c=e.scale[1],i=e.translate[0],s=e.translate[1],function(e,t){t||(u=a=0);var r=2,n=e.length,o=new Array(n);for(o[0]=(u+=e[0])*f+i,o[1]=(a+=e[1])*c+s;r<n;)o[r]=e[r],++r;return o})};var n=(r=e("./identity.js"))&&r.__esModule?r:{default:r}},{"./identity.js":"n09v"}],AUka:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){var t,o=(0,i.default)(e.transform),u=1/0,a=u,f=-u,c=-u;function r(e){(e=o(e))[0]<u&&(u=e[0]),e[0]>f&&(f=e[0]),e[1]<a&&(a=e[1]),e[1]>c&&(c=e[1])}function n(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(n);break;case"Point":r(e.coordinates);break;case"MultiPoint":e.coordinates.forEach(r)}}for(t in e.arcs.forEach(function(e){for(var t,r=-1,n=e.length;++r<n;)(t=o(e[r],r))[0]<u&&(u=t[0]),t[0]>f&&(f=t[0]),t[1]<a&&(a=t[1]),t[1]>c&&(c=t[1])}),e.objects)n(e.objects[t]);return[u,a,f,c]};var i=(r=e("./transform.js"))&&r.__esModule?r:{default:r}},{"./transform.js":"PG0d"}],wvdD:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){for(var r,n=e.length,o=n-t;o<--n;)r=e[o],e[o++]=e[n],e[n]=r}},{}],FNho:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(t,e){return"GeometryCollection"===(e="string"==typeof e?t.objects[e]:e).type?{type:"FeatureCollection",features:e.geometries.map(function(e){return u(t,e)})}:u(t,e)},r.object=a;var l=o(e("./reverse.js")),n=o(e("./transform.js"));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){var r=t.id,n=t.bbox,o=null==t.properties?{}:t.properties,e=a(e,t);return null==r&&null==n?{type:"Feature",properties:o,geometry:e}:null==n?{type:"Feature",id:r,properties:o,geometry:e}:{type:"Feature",id:r,bbox:n,properties:o,geometry:e}}function a(e,t){var i=(0,n.default)(e.transform),s=e.arcs;function o(e){return i(e)}function u(e){for(var t=[],r=0,n=e.length;r<n;++r){c=f=a=u=o=void 0;var o=e[r],u=t;u.length&&u.pop();for(var a=s[o<0?~o:o],f=0,c=a.length;f<c;++f)u.push(i(a[f],f));o<0&&(0,l.default)(u,c)}return t.length<2&&t.push(t[0]),t}function r(e){for(var t=u(e);t.length<4;)t.push(t[0]);return t}function a(e){return e.map(r)}return function e(t){var r,n=t.type;switch(n){case"GeometryCollection":return{type:n,geometries:t.geometries.map(e)};case"Point":r=o(t.coordinates);break;case"MultiPoint":r=t.coordinates.map(o);break;case"LineString":r=u(t.arcs);break;case"MultiLineString":r=t.arcs.map(u);break;case"Polygon":r=a(t.arcs);break;case"MultiPolygon":r=t.arcs.map(a);break;default:return null}return{type:n,coordinates:r}}(t)}},{"./reverse.js":"wvdD","./transform.js":"PG0d"}],ycfC:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(f,n){var o={},c={},i={},u=[],a=-1;function e(e,t){for(var r in e){r=e[r];delete t[r.start],delete r.start,delete r.end,r.forEach(function(e){o[e<0?~e:e]=1}),u.push(r)}}return n.forEach(function(e,t){var r=f.arcs[e<0?~e:e];r.length<3&&!r[1][0]&&!r[1][1]&&(r=n[++a],n[a]=e,n[t]=r)}),n.forEach(function(e){u=e,o=f.arcs[u<0?~u:u],a=o[0],f.transform?(r=[0,0],o.forEach(function(e){r[0]+=e[0],r[1]+=e[1]})):r=o[o.length-1];var t,r,n,o=u<0?[r,a]:[a,r],u=o[0],a=o[1];(o=i[u])?(delete i[o.end],o.push(e),o.end=a,(t=c[a])?(delete c[t.start],n=t===o?o:o.concat(t),c[n.start=o.start]=i[n.end=t.end]=n):c[o.start]=i[o.end]=o):(o=c[a])?(delete c[o.start],o.unshift(e),o.start=u,(t=i[u])?(delete i[t.end],n=t===o?o:t.concat(o),c[n.start=t.start]=i[n.end=o.end]=n):c[o.start]=i[o.end]=o):c[(o=[e]).start=u]=i[o.end=a]=o}),e(i,c),e(c,i),n.forEach(function(e){o[e<0?~e:e]||u.push([e])}),u}},{}],eNxS:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return(0,n.object)(e,o.apply(this,arguments))},r.meshArcs=o;var n=e("./feature.js"),p=(r=e("./stitch.js"))&&r.__esModule?r:{default:r};function o(e,t,r){var n,o,u,a,f,c,i;if(1<arguments.length)a=r,c=[],i=[],function e(t){switch((f=t).type){case"GeometryCollection":t.geometries.forEach(e);break;case"LineString":l(t.arcs);break;case"MultiLineString":case"Polygon":d(t.arcs);break;case"MultiPolygon":t.arcs.forEach(d)}}(t),i.forEach(null==a?function(e){c.push(e[0].i)}:function(e){a(e[0].g,e[e.length-1].g)&&c.push(e[0].i)}),n=c;else for(o=0,n=new Array(u=e.arcs.length);o<u;++o)n[o]=o;function s(e){var t=e<0?~e:e;(i[t]||(i[t]=[])).push({i:e,g:f})}function l(e){e.forEach(s)}function d(e){e.forEach(l)}return{type:"MultiLineString",arcs:(0,p.default)(e,n)}}},{"./feature.js":"FNho","./stitch.js":"ycfC"}],vI6u:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return(0,s.object)(e,n.apply(this,arguments))},r.mergeArcs=n;var s=e("./feature.js"),l=(r=e("./stitch.js"))&&r.__esModule?r:{default:r};function n(f,e){var c={},r=[],n=[];function o(t){t.forEach(function(e){e.forEach(function(e){(c[e=e<0?~e:e]||(c[e]=[])).push(t)})}),r.push(t)}function i(e){for(var t,r=(0,s.object)(f,{type:"Polygon",arcs:[e]}).coordinates[0],n=-1,o=r.length,u=r[o-1],a=0;++n<o;)t=u,u=r[n],a+=t[0]*u[1]-t[1]*u[0];return Math.abs(a)}return e.forEach(function e(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"Polygon":o(t.arcs);break;case"MultiPolygon":t.arcs.forEach(o)}}),r.forEach(function(e){if(!e._){var t=[],r=[e];for(e._=1,n.push(t);e=r.pop();)t.push(e),e.forEach(function(e){e.forEach(function(e){c[e<0?~e:e].forEach(function(e){e._||(e._=1,r.push(e))})})})}}),r.forEach(function(e){delete e._}),{type:"MultiPolygon",arcs:n.map(function(e){var t,r=[];if(e.forEach(function(e){e.forEach(function(e){e.forEach(function(e){c[e<0?~e:e].length<2&&r.push(e)})})}),1<(t=(r=(0,l.default)(f,r)).length))for(var n,o,u=1,a=i(r[0]);u<t;++u)(n=i(r[u]))>a&&(o=r[0],r[0]=r[u],r[u]=o,a=n);return r}).filter(function(e){return 0<e.length})}}},{"./feature.js":"FNho","./stitch.js":"ycfC"}],b9Vz:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){for(var r=0,n=e.length;r<n;){var o=r+n>>>1;e[o]<t?r=1+o:n=o}return r}},{}],ghmq:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){var n={},t=e.map(function(){return[]});function r(e,r){e.forEach(function(e){var t=n[e=e<0?~e:e];t?t.push(r):n[e]=[r]})}function o(e,t){e.forEach(function(e){r(e,t)})}var u,a={LineString:r,MultiLineString:o,Polygon:o,MultiPolygon:function(e,t){e.forEach(function(e){o(e,t)})}};for(u in e.forEach(function t(e,r){"GeometryCollection"===e.type?e.geometries.forEach(function(e){t(e,r)}):e.type in a&&a[e.type](e.arcs,r)}),n)for(var f=n[u],c=f.length,i=0;i<c;++i)for(var s=i+1;s<c;++s){var l,d=f[i],p=f[s];(l=t[d])[u=(0,h.default)(l,p)]!==p&&l.splice(u,0,p),(l=t[p])[u=(0,h.default)(l,d)]!==d&&l.splice(u,0,d)}return t};var h=(r=e("./bisect.js"))&&r.__esModule?r:{default:r}},{"./bisect.js":"b9Vz"}],W1fX:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){var a,f,c,i,s,l;return null==e?n.default:(c=e.scale[0],i=e.scale[1],s=e.translate[0],l=e.translate[1],function(e,t){t||(a=f=0);var r=2,n=e.length,o=new Array(n),t=Math.round((e[0]-s)/c),u=Math.round((e[1]-l)/i);for(o[0]=t-a,a=t,o[1]=u-f,f=u;r<n;)o[r]=e[r],++r;return o})};var n=(r=e("./identity.js"))&&r.__esModule?r:{default:r}},{"./identity.js":"n09v"}],CZtQ:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){if(e.transform)throw new Error("already quantized");if(t&&t.scale)f=e.bbox;else{if(!(2<=(r=Math.floor(t))))throw new Error("n must be ≥2");var r,n=(f=e.bbox||(0,h.default)(e))[0],o=f[1],u=f[2],a=f[3];t={scale:[u-n?(u-n)/(r-1):1,a-o?(a-o)/(r-1):1],translate:[n,o]}}var f,c,i=(0,y.default)(t),s=e.objects,l={};function d(e){return i(e)}function p(e){var t;switch(e.type){case"GeometryCollection":t={type:"GeometryCollection",geometries:e.geometries.map(p)};break;case"Point":t={type:"Point",coordinates:d(e.coordinates)};break;case"MultiPoint":t={type:"MultiPoint",coordinates:e.coordinates.map(d)};break;default:return e}return null!=e.id&&(t.id=e.id),null!=e.bbox&&(t.bbox=e.bbox),null!=e.properties&&(t.properties=e.properties),t}for(c in s)l[c]=p(s[c]);return{type:"Topology",bbox:f,transform:t,objects:l,arcs:e.arcs.map(function(e){var t,r=0,n=1,o=e.length,u=new Array(o);for(u[0]=i(e[0],0);++r<o;)((t=i(e[r],r))[0]||t[1])&&(u[n++]=t);return 1===n&&(u[n++]=[0,0]),u.length=n,u})}};var h=n(e("./bbox.js")),y=n(e("./untransform.js"));function n(e){return e&&e.__esModule?e:{default:e}}},{"./bbox.js":"AUka","./untransform.js":"W1fX"}],oNcQ:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"bbox",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(r,"feature",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(r,"mesh",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(r,"meshArcs",{enumerable:!0,get:function(){return u.meshArcs}}),Object.defineProperty(r,"merge",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(r,"mergeArcs",{enumerable:!0,get:function(){return a.mergeArcs}}),Object.defineProperty(r,"neighbors",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(r,"quantize",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(r,"transform",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(r,"untransform",{enumerable:!0,get:function(){return s.default}});var n=p(e("./bbox.js")),o=p(e("./feature.js")),u=d(e("./mesh.js")),a=d(e("./merge.js")),f=p(e("./neighbors.js")),c=p(e("./quantize.js")),i=p(e("./transform.js")),s=p(e("./untransform.js"));function l(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(l=function(e){return e?r:t})(e))}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==h(e)&&"function"!=typeof e)return{default:e};t=l(t);if(t&&t.has(e))return t.get(e);var r,n,o={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((n=u?Object.getOwnPropertyDescriptor(e,r):null)&&(n.get||n.set)?Object.defineProperty(o,r,n):o[r]=e[r]);return o.default=e,t&&t.set(e,o),o}function p(e){return e&&e.__esModule?e:{default:e}}},{"./bbox.js":"AUka","./feature.js":"FNho","./mesh.js":"eNxS","./merge.js":"vI6u","./neighbors.js":"ghmq","./quantize.js":"CZtQ","./transform.js":"PG0d","./untransform.js":"W1fX"}],rcFN:[function(e,t,r){var n={};function u(e){return Math.floor(Math.abs(e)+.5)*(0<=e?1:-1)}function f(e,t,r){var n=(e=u(e*r))-(t=u(t*r));n<<=1,e-t<0&&(n=~n);for(var o="";32<=n;)o+=String.fromCharCode(63+(32|31&n)),n>>=5;return o+String.fromCharCode(n+63)}function o(e){for(var t=[],r=0;r<e.length;r++){var n=e[r].slice();t.push([n[1],n[0]])}return t}n.decode=function(e,t){for(var r,n=0,o=0,u=0,a=[],f=0,c=0,i=null,s=Math.pow(10,Number.isInteger(t)?t:5);n<e.length;){for(i=null,c=f=0;c|=(31&(i=e.charCodeAt(n++)-63))<<f,f+=5,32<=i;);for(r=1&c?~(c>>1):c>>1,f=c=0;c|=(31&(i=e.charCodeAt(n++)-63))<<f,f+=5,32<=i;);o+=r,u+=1&c?~(c>>1):c>>1,a.push([o/s,u/s])}return a},n.encode=function(e,t){if(!e.length)return"";for(var r=Math.pow(10,Number.isInteger(t)?t:5),n=f(e[0][0],0,r)+f(e[0][1],0,r),o=1;o<e.length;o++)var u=e[o],a=e[o-1],n=(n+=f(u[0],a[0],r))+f(u[1],a[1],r);return n},n.fromGeoJSON=function(e,t){if((e=e&&"Feature"===e.type?e.geometry:e)&&"LineString"===e.type)return n.encode(o(e.coordinates),t);throw new Error("Input must be a GeoJSON LineString")},n.toGeoJSON=function(e,t){return{type:"LineString",coordinates:o(n.decode(e,t))}},"object"===h(t)&&t.exports&&(t.exports=n)},{}],Focm:[function(e,t,r){var p=e("topojson-client").feature,h=e("@mapbox/polyline");function y(e,t){for(var r=[],n=t[0],o=t[1],u=0;u<e.length;u+=2){var a=(a=e.charCodeAt(u)-64)>>1^-(1&a),f=(f=e.charCodeAt(u+1)-64)>>1^-(1&f),n=a+=n,o=f+=o;r.push([a/1024,f/1024])}return r}t.exports=function(e){if(e._flagEd){var t;if(3!==e._flagEd)return Number.isInteger(e._flagEd)?((d=e).arcs=d.polyarcs.map(function(e){return h.decode(e,d._flagEd)}),d.polyarcs=null,(r=p(d,d.objects.collection))._flagEd=0,r):((t=p(t=e,t.objects.collection))._flagEd=0,t);for(var r=e,n=r.features,o=0;o<n.length;o++)for(var u=n[o],a=u.geometry.coordinates,f=u.geometry.encodeOffsets,c=0;c<a.length;c++){var i=a[c];if("Polygon"===u.geometry.type)a[c]=y(i,f[c]);else if("MultiPolygon"===u.geometry.type)for(var s=0;s<i.length;s++){var l=i[s];i[s]=y(l,f[c][s])}}return r._flagEd=0,r}return e;var d}},{"topojson-client":"oNcQ","@mapbox/polyline":"rcFN"}]},{},["Focm"]),i.exports});;
Cube("datav:/com/datav-2dmap-drill/3.0.27/config",[],function(o,a,e,n,r,t){return o.exports={DEFAULT_OPTIONS:{tolerance:0,smoothFactor:1,bounds:null,renderer:"canvas",visibility:!0,general:{zoomRange:[0,18],minZoom:0,maxZoom:22,opacity:1},graph:{isShowParent:!1}}},o.exports});;
Cube("datav:/com/datav-2dmap-drill/3.0.27/src/drillLayer",[],function(e,t,o,a,n,r){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(t,e){var o,a=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,o)),a}function m(a){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach(function(e){var t,o;t=a,o=n[e=e],e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(n,e))})}return a}function v(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var o;if(e)return"string"==typeof e?l(e,t):"Map"===(o="Object"===(o=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:o)||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?l(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,a=new Array(t);o<t;o++)a[o]=e[o];return a}function b(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function j(){return(j="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,o){var a=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=O(e)););return e}(e,t);if(a)return(a=Object.getOwnPropertyDescriptor(a,t)).get?a.get.call(arguments.length<3?e:o):a.value}).apply(this,arguments)}function S(e,t){return(S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function D(o){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=O(o),t=(e=a?(e=O(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var P=o("datav:/com/datav-2dmap-drill/3.0.27/src/geojson-objdecompress.js");return e.exports=function(e){var p=e.L,l=e.map,t=e.Utils,o=e.Layer,a=e.GeoJson,d=e.GuiUtils,c=t._,u=t.mergeOptions,h=t.polylabel,n=(t.Chroma,t.geojsonBBox),r=t.getRange,i=t.getDashArray;function y(e){for(var t=0,o=0;o<e.length;o++)for(var a=e[o],n=0,r=a.length,i=r-1;n<r;i=n++)t+=(a[n][0]-a[i][0])*(a[n][1]+a[i][1])*(o?-1:1);return Math.abs(t)/2}e=g,t=o;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&S(e,t);var s,f=D(g);function g(e){var t;if(this instanceof g)return(t=f.call(this)).addTo(l),t.options=u({},e),t.options.general.minZoom=e.general.zoomRange[0],t.options.general.maxZoom=e.general.zoomRange[1],t.options.visibility=!0,t.init(),t;throw new TypeError("Cannot call a class as a function")}return e=g,(t=[{key:"init",value:function(){this.alldata={defaultArea:null,areaTopojson:null,adcodeKeys:null,areaGeojson:null,mappingData:null,mappingDataMap:null},this.popups={},this.getGeojsonStyle=this.getGeojsonStyle.bind(this),this.getMappingStyle=this.getMappingStyle.bind(this);var e=this.getGeojsonStyle();this.geojsonLayer=new a(e),this.borderLayer=new a({label:{isShow:!1},style:{fill:!1,stroke:this.options.graph.isShowParent,strokeColor:this.options.graph.lineStyle.strokeColor,weight:this.options.graph.lineStyle.weight,dashArray:i(this.options.graph.lineStyle.dashArray)},interaction:{graph:{show:!1},clickZoom:{show:!1}}}),this.addLayer(this.geojsonLayer),this.addLayer(this.borderLayer)}},{key:"setDefaultArea",value:function(e){e&&e.length&&(this.alldata.defaultArea=e,this.adcode=c.isNil(e[0].treeID)?e[0].adcode:e[0].treeID,this.genGeojson())}},{key:"render",value:function(e){var t,o=[];for(e&&e.length&&(o=e),this.alldata.mappingData=o,this.range=r(o),this.alldata.mappingDataMap={},t=0;t<o.length;t++){var a=o[t],n=c.isNil(a.treeID)?a.adcode:a.treeID;n&&(this.alldata.mappingDataMap[n]=a)}e=this.getGeojsonStyle();this.geojsonLayer.setOptions(e),this.onRender()}},{key:"decodeNodeData",value:function(e){return e.polyarcs||e.UTF8Encoding?P(e):p.topojson.feature(e,e.objects.collection)}},{key:"traverseTree",value:function(n,e,t){var r=this;if(n.children){var o,a,i=n.payloadGeoJSON||this.decodeNodeData(n.payload),s=i.features[0].properties;if(s.parent||(s.parent={}),c.isString(s.parent))try{s.parent=JSON.parse(s.parent)}catch(e){console.log(e)}for(a in s.parent.treeID=n.parent,s.adcode||(s.adcode=n.treeID),s.treeID=n.treeID,s.treeName=n.treeName,s.name=n.name,e[n.treeID]={name:n.name,treeID:n.treeID,treeName:n.treeName,parent:n.parent,geojson:i},e[n.treeID].properties=s,Object.keys(n.children).length?(o={type:"FeatureCollection",features:Object.keys(n.children).reduce(function(e,o,t){var a=r.decodeNodeData(n.children[o].payload);return n.children[o].payloadGeoJSON=a,e.push.apply(e,v(a.features.map(function(e){var t=e.properties;if(t.parent||(t.parent={}),c.isString(t.parent))try{t.parent=JSON.parse(t.parent)}catch(e){console.log(e)}return t.parent.treeID=n.treeID,t.adcode||(t.adcode=n.children[o].treeID),t.treeID=n.children[o].treeID,t.treeName=n.children[o].treeName,e}))),e},[])},s.adcode&&(e[s.adcode]={name:n.name,treeID:n.treeID,treeName:n.treeName,parent:n.parent,geojson:i,children:Object.keys(n.children),properties:s},t[s.adcode]=o),t[n.treeID]=o,e[n.treeID].children=Object.keys(n.children)):(s.adcode&&(e[s.adcode]={name:n.name,treeID:n.treeID,parent:n.parent,children:[],geojson:i,properties:s},t[s.adcode]=i),t[n.treeID]=i,e[n.treeID].children=[]),n.children)this.traverseTree(n.children[a],e,t)}}},{key:"setTopojson",value:function(e){var t,o,a,n=this;if(e.version&&"1.0.0"===e.version)this.alldata.areaTopojson=e,this.alldata.adcodeKeys={},this.alldata.areaGeojson_default={},this.traverseTree(e,this.alldata.adcodeKeys,this.alldata.areaGeojson_default);else{for(t in this.alldata.areaTopojson=e,this.alldata.adcodeKeys={},e){for(var r=e[t].objects.collection.geometries,i=[],s=0;s<r.length;s++){var l=r[s].properties.adcode;i.push(l),this.alldata.adcodeKeys[l]={parent:t,properties:r[s].properties,children:[]}}this.alldata.adcodeKeys[t]||(this.alldata.adcodeKeys[t]={}),this.alldata.adcodeKeys[t].children=i}for(a in this.alldata.areaGeojson_default={},this.alldata.areaTopojson)o=this.alldata.areaTopojson[a],(o=p.topojson.feature(o,o.objects.collection)).features=o.features.filter(function(e){var t=!0;return"district"===e.properties.level&&(t=!"".concat(e.properties.adcode).endsWith("00")),e.geometry&&("Polygon"===e.geometry.type||"MultiPolygon"===e.geometry.type)&&t}),o.features.forEach(function(e){var t=e.properties.adcode;n.alldata.areaGeojson_default[t]={type:"FeatureCollection",features:[e]}}),this.alldata.areaGeojson_default[a]=o}this.alldata.areaTopojson=null,this.genGeojson()}},{key:"genGeojson",value:function(){if(this.alldata.areaGeojson={},this.alldata.defaultArea&&this.alldata.areaGeojson_default){for(var e in this.alldata.areaGeojson_default){var t=c.cloneDeep(this.alldata.areaGeojson_default[e]);this.alldata.areaGeojson[e]=t}this.setGeojson(this.adcode);var o=this.alldata.adcodeKeys[this.adcode].geojson;o&&this.borderLayer.setData(o),this.onRender(!0)}}},{key:"setGeojson",value:function(e){this.geojson=c.cloneDeep(this.alldata.areaGeojson[e]);var a=this.options.mappingStyle||this.getMappingStyle();this.geojson.features.forEach(function(e){var t=e.properties,o=t.treeID,t=t.adcode;o&&a[o]&&(e.properties=m(m({},e.properties),a[o]),t&&t!==o&&(e.properties.adcode=o)),t&&a[t]&&(e.properties=m(m({},e.properties),a[t]))}),this.geojsonLayer.setData(this.geojson)}},{key:"getGeojsonStyle",value:function(){this.options.mappingStyle=this.getMappingStyle();var e=this.options,t=e.graph,o=e.label,e=e.interaction,t=t.lineStyle,a=c.get(this.options,"graph.colorMapping");return{label:o,interaction:e,style:{fill:!0,fillRule:"evenodd",fillColor:a.mapping?a.abnormal:a.fixed,fillOpacity:1,stroke:!0,strokeColor:t.strokeColor,weight:t.weight,lineJoin:"round",lineCap:"round",dashArray:i(t.dashArray)},mappingStyle:this.options.mappingStyle}}},{key:"getMappingStyle",value:function(){var e=this.alldata.mappingData;if(e){for(var t,o=d.validateCustomStyle,a=c.get(this.options,"condition.condition"),n=c.get(d,"scale.color")({config:c.get(this.options,"graph.colorMapping"),data:e,field:"colorField"}),r={},i=0;i<e.length;i++){var s=u({},e[i]),l=c.isNil(s.treeID)?s.adcode:s.treeID;l&&(t=(t=o({config:a,data:s,ruleKey:"rules"}))&&t[0]?t[0]:null,s.fillColor||(t&&t.fillColor.show?s.fillColor=t.fillColor.value:s.fillColor=n(s.colorField)),r[l]=s)}return r}}},{key:"updateOptions",value:function(e){this.options=u(this.options,e),this.options.general.minZoom=e.general.zoomRange[0],this.options.general.maxZoom=e.general.zoomRange[1],this.infoPopup&&(this.infoPopup&&!this.options.popupStyle.isShow&&this.infoPopup.remove(),p.customPopup.updatePopupStyle(this.infoPopup,this.convertToRootPopupStyle(this.options.popupStyle)));var t=this.getGeojsonStyle();this.geojsonLayer.setOptions(t),this.borderLayer.setOptions(u(t,{label:{isShow:!1},style:{fill:!1,stroke:e.graph.isShowParent}})),this.onRender()}},{key:"onClick",value:function(e){var t=this.options.popupStyle;t.isShow&&"click"===t.eventType&&this._openPopup(e)}},{key:"onMouseOver",value:function(e){var t=this.options.popupStyle;t.isShow&&"mouseover"===t.eventType&&this._openPopup(e)}},{key:"convertToRootPopupStyle",value:function(e){var t=e.domStyle,o=t.padding,a=t.border,n=t.boxShadow,r=t.backgroundColor,i=t.closeBtn,t=t.tipBtn,s=e.textStyle,e=e.offset;return{background:m({color:r},n),padding:o,border:a,closeBtn:i,tipBtn:t,textStyle:s,offset:e}}},{key:"_openPopup",value:function(e){var t=e.feature,o=t.properties,a=this.options,n=a.general,a=a.popupStyle,r=o.customLabelPosition||(i=1,(r=t).geometry&&"Polygon"===r.geometry.type?h(r.geometry.coordinates,i):r.geometry&&"MultiPolygon"===r.geometry.type?(r=r.geometry.coordinates.reduce(function(e,t){return y(e)>=y(t)?e:t},{}),h(r,i)):void 0),i="click"===a.eventType?e.latlng:{lat:+r[1],lng:+r[0]},e=o.popupType,s=this.popups[e];if(e&&s){e=a.offset,a={L:p,map:l,latlng:i,feature:t,offset:e,bindPopup:s,minZoom:n.minZoom,maxZoom:n.maxZoom};p.customPopup.openPopup(a)}else{t=this.convertToRootPopupStyle(this.options.popupStyle);if(!c.isEmpty(o.info))return e=p.popup({}).setLatLng(i).setContent(o.info).openOn(l),this.infoPopup=e,void p.customPopup.updatePopupStyle(e,t);if(this.options.popupStyle.isEmptyShow)return s=p.popup({}).setLatLng(i).setContent("无数据").openOn(l),this.infoPopup=s,void p.customPopup.updatePopupStyle(s,t);this.infoPopup&&this.infoPopup.remove()}this.infoPopup=null}},{key:"onDblclick",value:function(e){var e=e.feature,t=this.adcode;if(e||this.alldata.adcodeKeys[t].parent){if(e&&e.properties){t=e.properties.adcode;if(!this.alldata.adcodeKeys[t])return;this.adcode=t}else{this.adcode=this.alldata.adcodeKeys[this.adcode].parent;e=u({adcode:this.adcode},this.alldata.adcodeKeys[this.adcode].properties),e=u(e,this.options.mappingStyle[this.adcode]||{});this.emit("dblclick_up",e)}this.setGeojson(this.adcode);t=this.alldata.adcodeKeys[this.adcode].geojson;this.boundsGeojson=t||this.geojson,t&&this.borderLayer.setData(t),this.fitBounds(this.adcode)}}},{key:"setDrillArea",value:function(e){var e=c.isNil(e.treeID)?e.adcode:e.treeID;this.alldata.areaGeojson[e]&&(this.adcode=e,this.setGeojson(e),e=this.alldata.adcodeKeys[e].geojson,this.boundsGeojson=e||this.geojson,e&&this.borderLayer.setData(e),this.fitBounds(this.adcode))}},{key:"dblclickUp",value:function(){var e;this.alldata.adcodeKeys[this.adcode].parent&&(this.adcode=this.alldata.adcodeKeys[this.adcode].parent,e=u({},this.alldata.adcodeKeys[this.adcode].properties),e=u(e,this.options.mappingStyle[this.adcode]||{}),this.emit("dblclick_up",e),this.setGeojson(this.adcode),e=this.alldata.adcodeKeys[this.adcode].geojson,this.boundsGeojson=e||this.geojson,e&&this.borderLayer.setData(e),this.fitBounds(this.adcode))}},{key:"bindGroup",value:function(e,t,o){var a=+t.clientWidth,n=+t.clientHeight,r=(t.style.transform="",t.style.position="",t.style.display="none",p.popup({maxWidth:1200,maxHeight:1200,isCustomPopup:!0}));this.popups[e]={popup:r,container:t,clientWidth:a,clientHeight:n,popupStyle:o}}},{key:"fitBounds",value:function(e){var t=this.options.interaction;e=this.alldata.mappingDataMap[e]&&this.alldata.mappingDataMap[e].bounds?this.alldata.mappingDataMap[e].bounds:(e=[[(e=n(this.boundsGeojson||this.geojson))[1],e[0]],[e[3],e[2]]],this.featureBounds=e,l.isMapMoving=t.graph.clickZoom,t=t.graph.clickZoom.zoomPad-1,[[e[0][0]-(e[1][0]-e[0][0])*t/2,e[0][1]-(e[1][1]-e[0][1])*t/2],[e[1][0]+(e[1][0]-e[0][0])*t/2,e[1][1]+(e[1][1]-e[0][1])*t/2]]),l.fitBounds(e,{animate:!1,duration:3,easeLinearity:3,noMoveStart:!0})}},{key:"draw",value:function(e){var t=this.options.general;e.globalAlpha=.01*t.opacity,this.container&&e.drawImage(this.container,0,0,this.container.width,this.container.height)}},{key:"show",value:function(){this.onRender(!0),this.options.visibility=!0}},{key:"hide",value:function(){j(O(g.prototype),"hide",this).call(this),this.options.visibility=!1}},{key:"destroy",value:function(){this.options=null,this.geojson=null,this.adcode=null,this.alldata=null,delete this.options,this.geojson,this.adcode,this.alldata}}])&&b(e.prototype,t),s&&b(e,s),Object.defineProperty(e,"prototype",{writable:!1}),g},e.exports});;
Cube("datav:/com/datav-2dmap-drill/3.0.27",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(e,t,r,o,i,n){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function y(r){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=u(r),t=(e=o?(e=u(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c=r("datav:/npm/eventemitter3/3.0.0"),p=r("datav:/npm/safely-merge/1.0.1"),h=r("datav:/com/datav-2dmap-drill/3.0.27/src/drillLayer"),f=r("datav:/com/datav-2dmap-drill/3.0.27/config").DEFAULT_OPTIONS,r=function(){var e=i,t=c;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t);var r,o=y(i);function i(e,t){var r;if(this instanceof i)return r=o.call(this),t=t.options,r.options=p(f,t),r.options.general.minZoom=t.general.zoomRange[0],r.options.general.maxZoom=t.general.zoomRange[1],r.options.visibility=!0,r;throw new TypeError("Cannot call a class as a function")}return e=i,(t=[{key:"addTo",value:function(e){var t=this,e=h(e);this.layer=new e(this.options),this.layer.on("dblclick_up",function(e){t.emit("dblclick2",e)})}},{key:"render",value:function(e){this.layer&&this.layer.render&&this.layer.render(e)}},{key:"setDefaultArea",value:function(e){this.layer&&this.layer.setDefaultArea&&this.layer.setDefaultArea(e)}},{key:"setDrillArea",value:function(e){this.layer&&this.layer.setDrillArea&&this.layer.setDrillArea(e)}},{key:"setTopojson",value:function(e){var t=this;e&&e.type&&e.api?fetch(e.api).then(function(e){return e.json()}).then(function(e){t.layer&&t.layer.setTopojson&&t.layer.setTopojson(e)}):this.layer&&this.layer.setTopojson&&this.layer.setTopojson(e)}},{key:"onRender",value:function(e){this.layer&&this.layer.onRender&&this.layer.onRender(e)}},{key:"resize",value:function(e,t){this.layer&&this.layer.resize&&this.layer.resize(e,t)}},{key:"contains",value:function(e){return this.layer.contains(e)}},{key:"updateOptions",value:function(e){e=e.options;this.options=p(f,e),this.options.general.minZoom=e.general.zoomRange[0],this.options.general.maxZoom=e.general.zoomRange[1],this.layer&&this.layer.updateOptions&&this.layer.updateOptions(this.options)}},{key:"onClick",value:function(e){var t=e.feature;t&&t.properties&&(t=this.getProperties(this.layer,t.properties),this.emit("click",t)),this.layer&&this.layer.onClick&&this.layer.onClick(e)}},{key:"onDblclick",value:function(e){var t=e.feature;t&&t.properties&&(t=this.getProperties(this.layer,t.properties),this.emit("dblclick",t)),this.layer&&this.layer.onDblclick&&this.layer.onDblclick(e)}},{key:"dblclickUp",value:function(){this.layer&&this.layer.dblclickUp&&this.layer.dblclickUp()}},{key:"onMouseOver",value:function(e){var t=e.feature;t&&t.properties&&(t=this.getProperties(this.layer,t.properties),this.emit("mouseover",t)),this.layer&&this.layer.onMouseOver&&this.layer.onMouseOver(e)}},{key:"getProperties",value:function(e,t){var r=p({},t);return e&&e.getMappingStyle&&((e=e.getMappingStyle())[r.adcode]&&(r=p(r,e[t.adcode]))),r}},{key:"bindGroup",value:function(e){var t=e.popupType||"",r=e.container||"<div></div>",e=e.popupStyle||{};this.layer&&this.layer.bindGroup&&this.layer.bindGroup(t,r,e)}},{key:"draw",value:function(e){this.layer&&this.layer.draw&&this.layer.draw(e)}},{key:"show",value:function(){this.options.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.options.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"destroy",value:function(){this.layer&&this.layer.destroy&&this.layer.destroy(),this.layer=null,this.options=null,delete this.layer,this.options}}])&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}();return e.exports=r,e.exports});