// env=undefined => env=publish 
Cube("datav:/com/@datav-city-pro-v2/datav-engine-sequenceframe/2.1.2/shaders/sequenceFrame.frag.glsl",[],function(e,n,t,r,u,a){return e.exports="#ifdef GL_ES\n  precision highp float;\n#define GLSLIFY 1\n#endif\n\n#include <common>\n#include <logdepthbuf_pars_fragment>\n\nuniform sampler2D uTexture;\nuniform float uOpacity;\nuniform vec2 uTextureSegments; //horizontal and verticle segments of a texture, as frames of animation graph\nuniform vec2 uFrameCoord; // the 2D coord of current small fig in the big png pic.\nvarying vec2 vUv;\n\nvec2 scaleUv(vec2 uv, vec2 transformStep, vec2 uTextureSegments) {\n  float uSegmentUnit = 1.0 / uTextureSegments.x;\n  float vSegmentUnit = 1.0 / uTextureSegments.y;\n \n  return vec2(uv.x / uTextureSegments.x + uSegmentUnit * transformStep.x, \n  uv.y / uTextureSegments.y + vSegmentUnit * transformStep.y);\n}\n\nvoid main() {\n  #include <logdepthbuf_fragment>\n\n  vec2 scaledUvs = scaleUv(vUv, uFrameCoord, uTextureSegments);\n  vec4 fragColor = texture2D(uTexture, scaledUvs);\n\n  gl_FragColor = fragColor * uOpacity;\n\n  #include <premultiplied_alpha_fragment>\n}",e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-sequenceframe/2.1.2/shaders/sequenceFrame.vert.glsl",[],function(n,e,r,i,t,a){return n.exports="#define GLSLIFY 1\n#include <common>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#include <fog_pars_vertex>\n\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n\n  vec4 transformed = vec4(position, 1.0);\n\n  #ifdef USE_INSTANCING\n    transformed = instanceMatrix * transformed;\n  #endif\n\n  gl_Position = projectionMatrix * modelViewMatrix * transformed;\n\n  #include <logdepthbuf_vertex>\n  #include <clipping_planes_vertex>\n  #include <fog_vertex>\n}\n\n ",n.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-sequenceframe/2.1.2/squenceFramePrimitive",[],function(e,t,a,r,i,n){function o(e,t,r){return(o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch(e){}}()?Reflect.construct.bind():function(e,t,r){var i=[null];i.push.apply(i,t);t=new(Function.bind.apply(e,i));return r&&s(t,r.prototype),t}).apply(null,arguments)}function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var r;if(e)return"string"==typeof e?u(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function h(t,e){var r,i=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)),i}function m(i){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?h(Object(a),!0).forEach(function(e){var t,r;t=i,r=a[e=e],e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(a,e))})}return i}function c(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return e.exports=function(p,f){return t=e,(r=[{key:"calFrameCoord",value:function(){for(var e=this.materialOption,t=e.textureSegmentsX,r=[],i=e.textureSegmentsY-1;0<=i;i--)for(var a=0;a<t;a++)r.push([a,i]);this.frameCoords&&(this.frameCoords.length=0),this.frameCoords=r}},{key:"setGeometry",value:function(e){this.geometry&&this.geometry.dispose&&this.geometry.dispose(),this.geometryOption=m(m({},this.geometryOption),e);e=this.geometryOption.size,e=void 0===e?1:e;this.geometry=new p.PlaneBufferGeometry(e,e)}},{key:"setMaterial",value:function(e){this.materialOption=m(m({},this.materialOption),e);var e=this.materialOption,t=e.textureUrl,r=e.textureSegmentsX,i=e.textureSegmentsY,a=e.opacity,n=e.vertexShader,o=e.fragmentShader,s=e.blending,l=e.depthTest,e=e.depthWrite,u=(this.textureSegmentsLimit=r*i,this.calFrameCoord(),null),h=!1;this.textureUrl===t&&this.material||(this.texture&&this.texture.dispose(),(u=this.textureLoader.load(t)).minFilter=p.LinearMipMapLinearFilter,u.anisotropy=16,this.textureUrl=t,this.texture=u,h=!0),this.material?(h&&(this.material.uniforms.uTexture.value=u),this.material.uniforms.uTextureSegments.value=new p.Vector2(r,i),this.material.uniforms.uOpacity.value=a,this.material.blending=p[s],this.material.depthTest=l,this.material.depthWrite=e):this.material=new p.ShaderMaterial({uniforms:{uTexture:{value:u},uTextureSegments:{value:new p.Vector2(r,i)},uOpacity:{value:a},uFrameCoord:{value:new p.Vector2(0,0)}},vertexShader:n,fragmentShader:o,transparent:!0,blending:p[s],depthTest:l,depthWrite:e,side:p.DoubleSide}),this.material.needsUpdate=!0}},{key:"setMesh",value:function(e){var i=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],a=(this.mesh&&this.mesh.dispose(),this.geometry||this.setGeometry(this.geometryOption),this.material||this.setMaterial(this.materialOption),new p.InstancedMesh(this.geometry,this.material,e.length)),n=(this.mesh=a,this.data=e,f.coordHelper),o=new p.Vector3,s=new p.Quaternion,l=new p.Vector3,u=new p.Matrix4,h=new p.Matrix4,t=(h.makeRotationFromEuler(new p.Euler(-.5*Math.PI,0*Math.PI,0*Math.PI,"XYZ")),this.geometryOption),r=t.scaleFactor,m=void 0===r?1:r,r=t.verticalOffset,c=void 0===r?0:r;return e.forEach(function(e,t){var r=e.value||1,r=e.vismapProperties?e.vismapProperties.size||1:r,r=(l.set(m*r,m*r,1),n.setFromValues(e.lng,e.lat,e.altitude+c),n.transform.clone());i?s.setFromRotationMatrix(r.multiply(h)):s.setFromRotationMatrix(r),n.toXYZ(o),u.compose(o,s,l),a.setMatrixAt(t,u)}),a}},{key:"checkVisible",value:function(e){this.mesh&&(this.mesh.visible=e),this.visible=e}},{key:"animate",value:function(e){this.material&&this.visible&&(this.frameCursor>this.textureSegmentsLimit?this.frameCursor=0:this.frameCursor+=e,e=Math.floor(this.frameCursor)%this.textureSegmentsLimit,e=this.frameCoords[e],this.material.uniforms.uFrameCoord.value=new p.Vector2(e[0],e[1]))}},{key:"updateScale",value:function(i){var a,n,o,s,l=this;this.data&&this.mesh&&(a=new p.Vector3,n=new p.Quaternion,o=new p.Vector3,s=new p.Matrix4,this.data.forEach(function(e,t){l.mesh.getMatrixAt(t,s),s.decompose(a,n,o);var r=e.value||1,r=e.vismapProperties?e.vismapProperties.size||1:r;o.set(i*r,i*r,1),s.compose(a,n,o),l.mesh.setMatrixAt(t,s)}),this.mesh.instanceMatrix.needsUpdate=!0)}},{key:"updateColor",value:function(e){e=void 0!==e.r?[e.r,e.g,e.b,e.a]:f.Chroma(e).gl();this.material&&(this.material.uniforms.uColor.value=o(p.Vector4,l(e)))}},{key:"updateVerticalOffset",value:function(r){var i,a,n,o,s,l,u=this,h=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.data&&this.mesh&&(i=new p.Vector3,a=new p.Quaternion,n=new p.Vector3,o=new p.Matrix4,s=f.coordHelper,(l=new p.Matrix4).makeRotationFromEuler(new p.Euler(-.5*Math.PI,0*Math.PI,0*Math.PI,"XYZ")),this.data.forEach(function(e,t){u.mesh.getMatrixAt(t,o),o.decompose(i,a,n),s.setFromValues(e.lng,e.lat,e.altitude+r);e=s.transform;h?a.setFromRotationMatrix(e.multiply(l)):a.setFromRotationMatrix(e),s.toXYZ(i),o.compose(i,a,n),u.mesh.setMatrixAt(t,o)}),this.mesh.instanceMatrix.needsUpdate=!0)}},{key:"dispose",value:function(){this.geometry&&this.geometry.dispose&&this.geometry.dispose(),this.material&&this.material.dispose&&this.material.dispose(),this.mesh&&this.mesh.dispose&&this.mesh.dispose(),this.geometry=null,this.material=null,this.mesh=null,this.data&&(this.data.length=0),this.texture&&this.texture.dispose(),this.frameCoords&&(this.frameCoords.length=0)}}])&&c(t.prototype,r),i&&c(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e;function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.geometry=null,this.material=null,this.mesh=null,this.data=null,this.geometryOption={size:1,scaleFactor:1,verticalOffset:0},this.materialOption={textureUrl:"",textureSegmentsX:1,textureSegmentsY:1,color:16777215,vertexShader:a("datav:/com/@datav-city-pro-v2/datav-engine-sequenceframe/2.1.2/shaders/sequenceFrame.vert.glsl"),fragmentShader:a("datav:/com/@datav-city-pro-v2/datav-engine-sequenceframe/2.1.2/shaders/sequenceFrame.frag.glsl"),blending:"AdditiveBlending",depthTest:!1,depthWrite:!1},this.frameCursor=0,this.visible=!0,this.textureLoader=(new p.TextureLoader).setCrossOrigin("*"),this.textureUrl=null,this.texture=null}var t,r,i},e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-sequenceframe/2.1.2/sequenceFrame",[],function(e,t,c,r,i,n){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(i)return(i=Object.getOwnPropertyDescriptor(i,t)).get?i.get.call(arguments.length<3?e:r):i.value}).apply(this,arguments)}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function h(r){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=d(r),t=(e=i?(e=d(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}return e.exports=function(e){var t=e.THREE,l=e.Utils,r=e.VG,i=r.Layer,e=e.coordHelper,n=c("datav:/com/@datav-city-pro-v2/datav-engine-sequenceframe/2.1.2/squenceFramePrimitive")(t,{Chroma:l.Chroma,coordHelper:e}),t=s,e=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&p(t,e);var a,o=h(s);function s(e){var t;if(this instanceof s)return(t=o.call(this)).classNameAlias="SequenceFrameLayer",t.layerName=t.classNameAlias,t.renderQueue=r.Transparent,t.needsAutoUpdate=!0,t.options=Object.assign({visible:!0},e||{}),t.defaultValue=1,t.defaultAltitude=0,t;throw new TypeError("Cannot call a class as a function")}return t=s,(e=[{key:"addTo",value:function(e){f(d(s.prototype),"addTo",this).call(this,e),this.sequenceFramePrimitive=new n}},{key:"setData",value:function(e){if(this.clear(),!e)return this.emit("rendered"),console.error("".concat(this.classNameAlias,": no data."));var t,r,i,n,a=e,o=[];if(this.checkedData=o,!Array.isArray(e)){if("FeatureCollection"!==e.type)return this.emit("rendered"),console.error("".concat(this.classNameAlias,": invalid data format, ").concat(e,"."));a=this.formatTransformer.geojson2datav(e)}if(!a.length)return this.emit("rendered"),console.warn("".concat(this.classNameAlias,": the length of data is 0."));for(var s=0,c=a.length;s<c;s++)n=a[s],t=parseFloat(n.lng),r=parseFloat(n.lat),i=parseFloat(n.altitude),isNaN(t)||isNaN(r)||(n=parseFloat(n.value),i=isNaN(i)?this.defaultAltitude:i,n=isNaN(n)?this.defaultValue:n,o.push({lng:t,lat:r,altitude:i,value:n}));var e=this.options.options,u=e.general,e=e.graph,l=u.blending,f=u.depthWrite,p=u.depthTest,h=u.scaleFactor,u=u.verticalOffset,d=e.sequenceFrameTexture,m=e.opacity,e=e.segParams,y=e.textureSegmentsX,e=e.textureSegmentsY,h=(this.sequenceFramePrimitive.setGeometry({size:100,scaleFactor:h,verticalOffset:u}),this.sequenceFramePrimitive.setMaterial({textureUrl:d,textureSegmentsX:y,textureSegmentsY:e,opacity:m,blending:l,depthWrite:f,depthTest:p}),this.sequenceFramePrimitive.setMesh(o));this.sequenceFrameMesh=h,this.add(h),this.checkVisible(),this.emit("rendered")}},{key:"render",value:function(e){this.setData(e)}},{key:"animate",value:function(){var e=this.options.options.graph.segParams.sequenceFrameSpeed;this.sequenceFramePrimitive&&this.sequenceFramePrimitive.animate(e)}},{key:"autoUpdate",value:function(){this.animate()}},{key:"updateVerticalOffset",value:function(e){this.sequenceFramePrimitive&&this.sequenceFramePrimitive.updateVerticalOffset(e)}},{key:"updateScale",value:function(e){this.sequenceFramePrimitive&&this.sequenceFramePrimitive.updateScale(e)}},{key:"checkVisible",value:function(){this.options.visible?this.show():this.hide()}},{key:"hide",value:function(){this.options.visible=!1,f(d(s.prototype),"hide",this).call(this)}},{key:"show",value:function(){this.options.visible=!0,f(d(s.prototype),"show",this).call(this)}},{key:"updateOptions",value:function(e){var t=l.deepClone(this.options),e=(this.options=l.mergeOptions(this.options,e||{}),this.options.options),r=e.general,e=e.graph,i=r.blending,n=r.depthWrite,a=r.depthTest,o=r.scaleFactor,r=r.verticalOffset,s=e.sequenceFrameTexture,c=e.opacity,e=e.segParams,u=e.textureSegmentsX,e=e.textureSegmentsY;l.easyDiff(t.options.general.scaleFactor,o)||this.updateScale(o),l.easyDiff(t.options.general.verticalOffset,r)||this.updateVerticalOffset(r),this.sequenceFramePrimitive&&this.sequenceFramePrimitive.setMaterial({blending:i,depthWrite:n,depthTest:a,textureUrl:s,textureSegmentsX:u,textureSegmentsY:e,opacity:c})}},{key:"clear",value:function(){f(d(s.prototype),"clear",this).call(this),this.sequenceFramePrimitive&&this.sequenceFramePrimitive.dispose()}},{key:"destroy",value:function(){this.clear(),f(d(s.prototype),"destroy",this).call(this)}}])&&u(t.prototype,e),a&&u(t,a),Object.defineProperty(t,"prototype",{writable:!1}),s},e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-sequenceframe/2.1.2",["datav:/npm/eventemitter3/3.0.0"],function(t,e,r,o,n,i){function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function u(t,e){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function y(r){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=s(r),e=(t=o?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(t&&("object"===a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=r("datav:/npm/eventemitter3/3.0.0"),f=r("datav:/com/@datav-city-pro-v2/datav-engine-sequenceframe/2.1.2/sequenceFrame"),r=function(){var t=n,e=l;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e);var r,o=y(n);function n(t,e){var r;if(this instanceof n)return(r=o.call(this)).options=e,r.comId="",r;throw new TypeError("Cannot call a class as a function")}return t=n,(e=[{key:"addTo",value:function(t,e){this.cityproCore=t,this.comId=e,this.initLayer()}},{key:"initLayer",value:function(){var t=f(this.cityproCore);this.layer=new t(this.options),this.cityproCore.viewer.addLayer(this.comId,this.layer)}},{key:"setData",value:function(t){this.layer&&this.layer.setData(t)}},{key:"setOpacity",value:function(t){this.layer&&this.layer.setOpacity(t)}},{key:"updateOptions",value:function(t){this.layer&&this.layer.updateOptions&&this.layer.updateOptions(t)}},{key:"show",value:function(){this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.layer&&this.layer.hide&&this.layer.hide()}},{key:"clear",value:function(){this.layer&&this.layer.clear&&this.layer.clear()}},{key:"destroy",value:function(){this.layer&&(this.layer.destroy&&this.layer.destroy(),this.layer=null)}}])&&c(t.prototype,e),r&&c(t,r),Object.defineProperty(t,"prototype",{writable:!1}),n}();return t.exports=r,t.exports});