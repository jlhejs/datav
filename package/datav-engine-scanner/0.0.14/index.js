// env=undefined => env=publish 
Cube("datav:/com/datav-engine-scanner/0.0.14/shader/scanner.frag.glsl",[],function(a){return a.exports="#define GLSLIFY 1\nvarying vec3 pos;\nvarying vec2 vUv;\n\nuniform vec3 u_color;\nuniform float u_max_opacity;\nuniform float u_time_counter;\nuniform float u_axis;\nuniform vec2 u_extend;\nuniform float u_length;\nuniform float u_direction;\n#include <logdepthbuf_pars_fragment>\n\nfloat get_pos(vec3 pos){\n  if(u_axis == 1.) {\n    return pos.x;\n  } else if(u_axis == 2.) {\n    return pos.y;\n  } else {\n    return pos.z;\n  }\n}\n\nfloat calculateOpacity(float u_time_counter, vec3 pos) {\n  float opacity = 0.0;\n  float index;\n\n  if(u_direction == -1.){\n    index = (get_pos(pos) - u_extend.x) / (u_extend.y - u_extend.x); \n  } else if (u_direction == 1.) {\n    index = (u_extend.y - get_pos(pos)) / (u_extend.y - u_extend.x); \n  }\n\n  if (\n    (index > u_time_counter) && \n    (u_time_counter != .0) && \n    (index < (u_time_counter + u_length)) && \n    (u_time_counter + u_length) < 0.99\n  ) {\n    opacity = pow((index - u_time_counter) / 0.2, 3.0);\n  }\n\n  return opacity;\n}\n\nvoid main() {\n   #include <logdepthbuf_fragment>\n   \n  float opacity = calculateOpacity(u_time_counter, pos);\n  gl_FragColor = vec4(u_color, opacity * u_max_opacity);\n  #include <premultiplied_alpha_fragment>\n}",a.exports});;
Cube("datav:/com/datav-engine-scanner/0.0.14/shader/scanner.vert.glsl",[],function(a){return a.exports="#define GLSLIFY 1\nvarying vec2 vUv;\nvarying vec3 pos;\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n  vUv  = uv;\n  pos = position;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n   #include <logdepthbuf_vertex>\n}",a.exports});;
Cube("datav:/com/datav-engine-scanner/0.0.14/layer.js",["datav:/npm/eventemitter3/3.0.0"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=function(a){function b(){d(this,b);var a=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return a.preSceneName="main",a.usingSceneName="main",a}return f(b,a),g(b,[{key:"addTo",value:function(a){return a?void(this.viewer=a,this.Utils=a.Utils,this.controller=a.controller,this.scene=this.getAssignedScene(),this.viewer.on("projChanged",this.updatePostions.bind(this))):console.log("Layer needs viewer layer")}},{key:"getProjPos",value:function(a,b,c){return this.viewer&&this.viewer.Projection([a,b,c])}},{key:"updatePostions",value:function(){}},{key:"getAssignedScene",value:function(){var a=this.options;return a.isSceneGroup&&a.sceneName?a.sceneName?this.controller.getScene(a.sceneName)?this.controller.getScene(a.sceneName):this.controller.createScene(a.sceneName):void 0:this.controller.getScene("main")}},{key:"toggleScene",value:function(a,b,c){var d=this;this.controller.switchScene(a,b,c).then(function(){d.preSceneName=b,d.usingSceneName=c})}},{key:"show",value:function(){}},{key:"hide",value:function(){}},{key:"updateOptions",value:function(){}}]),b}(h);return a.exports=i,a.exports});;
Cube("datav:/com/datav-engine-scanner/0.0.14",[],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;return void 0===g?void 0:g.call(d)},i=null,j=null,k=c("datav:/com/datav-engine-scanner/0.0.14/layer.js"),l=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=Object.assign({scaleX:1.05,scaleY:1.05,scaleZ:1.05,depthTest:!1,axisType:2,direction:1,visible:!0,isloop:!0,speed:8e-3,length:0.2,color:"#6699ff",offsetX:0,offsetY:0,offsetZ:0,rotationX:0,rotationY:0,rotationZ:0},c||{}),f.active=!0,f}return f(b,a),g(b,[{key:"addTo",value:function(a){h(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"addTo",this).call(this,a),i=a.three,j=a.Utils,this.render(),this.viewer.on("animationFrame",this.animation.bind(this))}},{key:"render",value:function(){var a=this;this.dispose();var b=this.options,c=b.modelUrl;j.fetchModel(c,function(c){c&&c.scene&&(a.createGeometry(c.scene),a.createMaterial(),a.createMesh(),a.setScale(b.scaleX,b.scaleY,b.scaleZ),a.center=a.getCenter(),a.setRotation(b.rotationX,b.rotationY,b.rotationZ),a.updatePostions(),a.checkVisible())})}},{key:"createGeometry",value:function(a){var b=[],c=[],d=0;a.updateMatrixWorld(!0),a.traverse(function(a){if("Mesh"===a.type){var e=a.geometry;e.applyMatrix(a.matrixWorld);var f=e.attributes.position.array,g=e.index.array;b=b.concat(Array.from(f)),c=c.concat(Array.from(g).map(function(a){return a+d})),d+=e.attributes.position.count}}),this.geometry=new i.BufferGeometry,this.geometry.setIndex(new i.BufferAttribute(new Uint32Array(c),1)),this.geometry.addAttribute("position",new i.BufferAttribute(new Float32Array(b),3))}},{key:"createMaterial",value:function(){var a=this.options,b=j.Chroma(a.color).gl();this.material=new i.ShaderMaterial({uniforms:{u_time_counter:{type:"f",value:0},u_color:{type:"vec3",value:new i.Vector3(b[0],b[1],b[2])},u_direction:{value:a.direction},u_length:{value:a.length},u_extend:{value:this.getMotionExtend()},u_axis:{value:a.axisType},u_max_opacity:{type:"f",value:b[3]}},vertexShader:c("datav:/com/datav-engine-scanner/0.0.14/shader/scanner.vert.glsl"),fragmentShader:c("datav:/com/datav-engine-scanner/0.0.14/shader/scanner.frag.glsl"),side:i.DoubleSide,blending:i.AdditiveBlending,depthTest:a.depthTest,depthWrite:!1,transparent:!0})}},{key:"createMesh",value:function(){this.mesh=new i.Mesh(this.geometry,this.material),this.mesh.renderOrder=1e3,this.scene.add(this.mesh)}},{key:"updatePostions",value:function(){var a=this.options,b=this.getProjPos(a.offsetX,a.offsetY,a.offsetZ);this.setPosition(b[0],b[1],b[2])}},{key:"autoSetCoords",value:function(){var a=this.options;this.setRotation(a.rotationX,a.rotationY,a.rotationZ),this.updatePostions()}},{key:"getCenter",value:function(){return this.mesh?new i.Box3().setFromObject(this.mesh).getCenter():void 0}},{key:"setScale",value:function(a,b,c){this.mesh&&this.mesh.scale.set(a,b,c)}},{key:"setPosition",value:function(a,b,c){var d=a-this.center.x,e=b-this.center.y,f=c-this.center.z;this.mesh&&this.mesh.position.set(d,e,f)}},{key:"setRotation",value:function(a,b,c){this.mesh&&this.mesh.rotation.set(a*Math.PI,b*Math.PI,c*Math.PI)}},{key:"getMotionExtend",value:function(){var a="x";switch(this.options.axisType){case 1:a="x";break;case 2:a="y";break;case 3:a="z";}var b=new i.Box3;return b.setFromBufferAttribute(this.geometry.attributes.position),new i.Vector2(b.min[a],b.max[a])}},{key:"rotation",value:function(){var a=this.options,b=a.rotationX,c=a.rotationY,d=a.rotationZ;this.mesh&&this.mesh.rotation.set(b,c,d)}},{key:"updateMesh",value:function(){var a=this.options,b=j.Chroma(a.color).gl();this.material&&(this.material.depthTest=a.depthTest,this.material.uniforms.u_length.value=a.length,this.material.uniforms.u_axis.value=a.axisType,this.material.uniforms.u_max_opacity.value=b[3],this.material.uniforms.u_direction.value=a.direction,this.material.uniforms.u_color.value=new i.Vector3(b[0],b[1],b[2]))}},{key:"updateOptions",value:function(a){var b=Object.assign({},this.options);this.options=j.mergeOptions(this.options,a||{}),j.easyDiff(b.modelUrl,a.modelUrl)||this.render(),j.easyDiff(b.scaleX,a.scaleX)&&j.easyDiff(b.scaleY,a.scaleY)&&j.easyDiff(b.scaleZ,a.scaleZ)||this.setScale(a.scaleX,a.scaleY,a.scaleZ),j.easyDiff(b.sceneName,a.sceneName)||(this.scene=this.getAssignedScene(),this.toggleScene(this.mesh,this.usingSceneName,a.sceneName)),this.autoSetCoords(),this.updateMesh(),this.startAnimation(),this.checkVisible()}},{key:"checkVisible",value:function(){var a=this.options;a.visible?this.show():this.hide()}},{key:"hide",value:function(){this.options.visible=!1,this.mesh&&(this.mesh.visible=!1)}},{key:"show",value:function(){this.options.visible=!0,this.mesh&&(this.mesh.visible=!0)}},{key:"animation",value:function(){if(this.active){var a=this.options;this.material&&(this.material.uniforms.u_time_counter.value+=a.speed,1<this.material.uniforms.u_time_counter.value&&(this.material.uniforms.u_time_counter.value=0,!a.isloop&&this.stopAnimation()))}}},{key:"stopAnimation",value:function(){this.active=!1}},{key:"startAnimation",value:function(){this.active=!0}},{key:"dispose",value:function(){this.scene.remove(this.mesh),this.mesh&&this.mesh.dispose&&this.mesh.dispose(),this.material&&this.material.dispose&&this.material.dispose(),this.geometry&&this.geometry.dispose&&this.geometry.dispose(),this.mesh=null,this.material=null,this.geometry=null}},{key:"remove",value:function(){this.viewer.off("animationFrame",this.animation),this.dispose(),this.active=!0}}]),b}(k);return a.exports=l,a.exports});