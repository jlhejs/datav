// env=undefined => env=publish 
Cube("datav:/com/datav-2dmap-grid-cluster/3.0.10/src/grid",[],function(t,e,o,a,i,r){var s=function(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t};function n(t,e){for(var o=0;o<e.length;o++){var a=e[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return t.exports=function(t){var x=t.map,e=(t.L,t.Utils),k=t.GuiUtils,z=e._,o=e.mergeOptions,i=x.options.offset;return s(a,[{key:"setData",value:function(t){this.geojson=t}},{key:"setOptions",value:function(t){this.options=o(this.options,t);var e=this.options.graph,t=e.label.textStyle;this.gridOptions={graph:e,label:{show:e.label.show,font:t.fontWeight+" "+t.fontSize+"px "+t.fontFamily,fillStyle:t.color||"white"}}}},{key:"onRender",value:function(t,e){e&&this.getFeatures(),this.dataProcess(),this.draw(t)}},{key:"getFeatures",value:function(){if(this.features=[],this.geojson&&this.geojson.features)for(var t=void 0,e=void 0,t=0;t<this.geojson.features.length;t++){var o=(e=Object.assign({},this.geojson.features[t])).geometry.coordinates,a=x.latLngToLayerPoint([o[1],o[0]]);e.geometry._coordinates=[a.x-i.x,a.y-i.y],this.features.push(e)}}},{key:"dataProcess",value:function(){var t=this.options.graph;if(0!==t.opacity&&this.features){for(var e,o=t.sizeMapping,a=z.get(k,"scale.size"),i=z.get(this.options,"graph.sizeMapping"),r=i.mapping?o.scale.range[1]:i.fixed,s=void 0,n={},s=0;s<this.features.length;s++){var l=this.features[s].geometry._coordinates,l=Math.floor(l[0]/r)+"_"+Math.floor(l[1]/r);n[l]||(n[l]={},n[l].value=0),n[l].value+=1}var h,f=1,d=1;for(h in n){var u=n[h].value;u<f&&(f=u),d<u&&(d=u)}var g,c=this._data={};for(g in n){var p=n[g].value;c[p]||(c[p]={value:p,data:[]}),g=g.split("_"),e=x.layerPointToContainerPoint([g[0]*r,g[1]*r]),c[p].data.push([e.x,e.y])}var v,y=[];for(v in this._data)y.push({sizeField:v,colorField:v});var w,_=a({config:i,data:y,field:"sizeField"}),m=z.get(k,"scale.color")({config:z.get(this.options,"graph.colorMapping"),data:y,field:"colorField"});for(w in this._data){var b=_(w);this._data[w].size=b-t.padding/2,this._data[w].fillColor=m(w)}}}},{key:"draw",value:function(t){var e,o=this.gridOptions,a=o.graph,i=o.label,o=a.shadow,r=a.stroke;for(e in t.shadowColor=o.shadowColor,t.shadowBlur=o.shadowBlur,t.strokeStyle=r.color,t.lineWidth=r.weight,this._data){var s=this._data[e],n=s.fillColor,l=s.data,h=s.size;t.fillStyle=n,t.beginPath();for(var f,d=void 0,d=0;d<l.length;d++)f=l[d],t.rect(f[0],f[1],h,h);t.fill(),r.color&&r.weight&&t.stroke()}if(t.textAlign="center",t.textBaseline="middle",i&&!1!==i.show)for(var u in t.fillStyle=i.fillStyle||"white",t.font=i.font,t.shadowColor=i.shadowColor,t.shadowBlur=i.shadowBlur,this._data)for(var g,u=this._data[u],c=u.value,p=u.data,v=u.size,y=void 0,y=0;y<p.length;y++)g=p[y],t.fillText(c,g[0]+v/2,g[1]+v/2)}}]),a;function a(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),this.options=o({zIndex:0,tolerance:3,smoothFactor:1},t),this.setOptions()}},t.exports});;
Cube("datav:/com/datav-2dmap-grid-cluster/3.0.10/config",[],function(o,a,r,e,t,n){return o.exports={DEFAULT_OPTIONS:{renderer:"canvas",general:{zoomRange:[0,18],minZoom:0,maxZoom:22},graph:{shadow:{shadowColor:"rgba(7,245,22,0.24)",shadowBlur:5},stroke:{color:"rgba(43,228,25,0.8)",weight:2},label:{textStyle:{fontFamily:"Microsoft Yahei",fontSize:12,color:"#FFFFFF",fontWeight:"normal"}}}}},o.exports});;
Cube("datav:/com/datav-2dmap-grid-cluster/3.0.10/src/gridLayer.js",[],function(t,e,l,o,n,i){var p=function(t,e,o){return e&&r(t.prototype,e),o&&r(t,o),t};function r(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0!==n){if("value"in n)return n.value;n=n.get;return void 0!==n?n.call(o):void 0}if(null!==(t=Object.getPrototypeOf(t)))return u(t,e,o)}return t.exports=function(t){var o=t.map,e=t.Utils,n=t.Layer,a=e.arr2geojson,i=e.mergeOptions,r=l("datav:/com/datav-2dmap-grid-cluster/3.0.10/src/grid")(t);return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(s,n),p(s,[{key:"init",value:function(){var t=i({zIndex:0},this.options);this.grid=new r(t),this.addLayer(this.grid)}},{key:"render",value:function(t){if(t&&t.length){for(var e=[],o=void 0,n=void 0,i=t.length,o=0;o<i;o++)(n=t[o]).hasOwnProperty("lng")&&n.hasOwnProperty("lat")&&e.push({lng:+n.lng,lat:+n.lat,value:+n.value||1});var r=a(e);this.grid.setData(r),this.onRender(!0)}}},{key:"updateOptions",value:function(t){this.options=i(this.options,t),this.options.general.minZoom=t.general.zoomRange[0],this.options.general.maxZoom=t.general.zoomRange[1],this.grid.setOptions(this.options),this.onRender()}},{key:"draw",value:function(t){var e=this.options.general;t.globalAlpha=.01*e.opacity,this.container&&t.drawImage(this.container,0,0,this.container.width,this.container.height)}},{key:"show",value:function(){this.onRender(!0),this.options.visibility=!0}},{key:"hide",value:function(){u(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"hide",this).call(this),this.options.visibility=!1}},{key:"destroy",value:function(){this.options=null,delete this.options}}]),s;function s(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return e.addTo(o),e.options=i({},t),e.options.general.minZoom=t.general.zoomRange[0],e.options.general.maxZoom=t.general.zoomRange[1],e.options.visibility=!0,e.init(),e}},t.exports});;
Cube("datav:/com/datav-2dmap-grid-cluster/3.0.10",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(e,t,i,o,n,r){var a=function(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e};function s(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var l=i("datav:/npm/eventemitter3/3.0.0"),h=i("datav:/npm/safely-merge/1.0.1"),u=i("datav:/com/datav-2dmap-grid-cluster/3.0.10/src/gridLayer.js"),y=i("datav:/com/datav-2dmap-grid-cluster/3.0.10/config").DEFAULT_OPTIONS,a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(p,l),a(p,[{key:"addTo",value:function(e,t){this.options.id=t;e=u(e);return this.layer=new e(this.options),this}},{key:"onRender",value:function(e){this.layer&&this.layer.onRender&&this.layer.onRender(e)}},{key:"render",value:function(e){var t=[],i=0;if(e&&e.length){for(var o,n=void 0,n=0;n<e.length;n++)o=e[n],Number.isFinite(parseFloat(o.lng))&&Number.isFinite(parseFloat(o.lat))?t.push(o):i++;0<i&&console.log("网格聚合层：有 "+i+" 条异常数据。")}this.layer&&this.layer.render&&this.layer.render(t)}},{key:"resize",value:function(e,t){this.layer&&this.layer.resize&&this.layer.resize(e,t)}},{key:"updateOptions",value:function(e){e=e.options;this.options=h(this.options,e),this.options.general.minZoom=e.general.zoomRange[0],this.options.general.maxZoom=e.general.zoomRange[1],this.layer&&this.layer.updateOptions&&this.layer.updateOptions(this.options)}},{key:"draw",value:function(e){this.layer&&this.layer.draw&&this.layer.draw(e)}},{key:"show",value:function(){this.options.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.options.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"destroy",value:function(){this.layer&&this.layer.destroy&&this.layer.destroy(),this.layer=null,this.options=null,delete this.layer,this.options}}]),p);function p(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(p.__proto__||Object.getPrototypeOf(p)).call(this)),t=t.options;return i.options=h(y,t),i.options.general.minZoom=t.general.zoomRange[0],i.options.general.maxZoom=t.general.zoomRange[1],i.options.visibility=!0,i}return e.exports=a,e.exports});