// env=undefined => env=publish 
Cube("datav:/com/datav-2dmap-markercluster/3.0.17/src/markercluster",[],function(t,e,i,a,o,n){function s(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return t.exports=function(t){var e,Q=t.map,i=t.Utils,F=t.GuiUtils,B=i.Chroma,_=i._,a=i.RBush,q=i.measureText,r=i.geojsonBBox,n=i.mergeOptions,J=Q.options.offset;return t=o,(i=[{key:"setData",value:function(t){for(var e,i,a=[],o=0,n=t.features.length;o<n;o++)e=t.features[o],i=r(e),a.push({minX:i[0],minY:i[1],maxX:i[2],maxY:i[3],feature:e});this.rbush.dirty=a.length,this.rbush.total=a.length,this.rbush.clear(),0<a.length&&this.rbush.load(a)}},{key:"setOptions",value:function(t){this.options=n(this.options,t);var e,i,a=this.options.mappingStyle,h=this,l=[],o=[];for(e in a)(i=a[e]).iconUrl&&l.push(i.iconUrl),i.symbolMarker&&(l.push(i.symbolMarker),o.push(i.symbolMarker));l=Array.from(new Set(l)),new Promise(function(e,i){for(var t,a=[],n=l.length,r=0,s=0;s<n;s++)!function(){var o=l[s];t=new Promise(function(i,t){h.imageUrls[o]&&i(!0);var a=new Image;a.crossOrigin="anonymous",a.onload=function(){var t=document.createElement("canvas"),e=t.getContext("2d");t.width=a.width,t.height=a.height,e.imageSmoothingQuality="high",e.drawImage(a,0,0,a.width,a.height),h.imageUrls[o]={canvas:t,colorCanvas:{}},i(!0)},a.onerror=function(){t(new Error("Could not load image at ".concat(o)))},a.src=o}),a.push(t),Promise.all(a).then(function(t){++r==n&&e(!0)}).catch(function(t){++r==n&&i(!1)})}()}).then(function(t){t&&h.layer.onRender()}).catch(function(t){})}},{key:"getFeaturesInBounds",value:function(){for(var t,e=Q.options.paddingBoundsExtent,i=this.rbush.search(e),a=0;a<i.length;a++){t=(r=i[a].feature).geometry.coordinates,n=[],"Point"===r.geometry.type&&(o=Q.latLngToLayerPoint([t[1],t[0]]))&&(n=[o.x,o.y]),i[a].feature.geometry._coordinates=n;var o=r.properties,n=this.options.mappingStyle[o.data_index],r=(n.iconUrl=o.iconUrl||n.iconUrl,[n.offset.x,-n.offset.y]);"bottom"===n.position?r[1]-=n.iconSize.height:"center"===n.position&&(r[1]-=n.iconSize.height/2),n.popupOffset=r,i[a].feature.style=n,i[a].minX=t[0],i[a].minY=t[1],i[a].maxX=t[0],i[a].maxY=t[1]}this.rbushInBounds.clear(),this.rbushInBounds.load(i),this.featuresInBounds=i}},{key:"getFeatures",value:function(){var t,e;for(this.features=[],t=0;t<this.featuresInBounds.length;t++)e=this.featuresInBounds[t].feature,this.features.push(e)}},{key:"contains",value:function(t){var e,i,a=!1,o=Q.latLngToContainerPoint([t.lat,t.lng]),n=this.eventObjects;for(e in n)if(a=!(!(i=n[e]).coordinates||!i.coordinates[0])&&this.isPolygonContainsPoint([i.coordinates],[o.x-J.x,o.y-J.y]))return{flag:!void 0,feature:"group"===i.markerType?{type:"Feature",properties:{markerType:"group",binsById_key:i.binsById_key},geometry:{type:"Point",coordinates:[t.lng,t.lat]}}:i[0],featureBounds:i.featureBounds};return{flag:a,feature:null}}},{key:"isPolygonContainsPoint",value:function(t,e){for(var i,a,o,n,r,s,h=!1,l=0,c=t.length;l<c;l++)for(n=0,r=(s=(i=t[l]).length)-1;n<s;r=n++)a=i[n],o=i[r],a[1]>e[1]!=o[1]>e[1]&&e[0]<(o[0]-a[0])*(e[1]-a[1])/(o[1]-a[1])+a[0]&&(h=!h);return h}},{key:"onRender",value:function(t,e){e&&(this.getFeaturesInBounds(),this.getFeatures(),this.dataProcess());var h,l,e=this.options,i=e.graph,e=e.label;switch(i.markerType){case"vector":this.drawVector(t);break;case"symbol":this.drawSymbol(t)}this.drawImages(t),e.isShow&&(h=this,"vector"===e.backgroundStyle.backgroundType||h.imageUrls[e.backgroundStyle.imageUrl]?h.drawLables(t):"image"!==e.backgroundStyle.backgroundType||h.imageUrls[e.backgroundStyle.imageUrl]||(l=[e.backgroundStyle.imageUrl],new Promise(function(e,i){for(var t,a=[],n=l.length,r=0,s=0;s<n;s++)!function(){var o=l[s];t=new Promise(function(i,t){var a=new Image;a.onload=function(){var t=document.createElement("canvas"),e=t.getContext("2d");t.width=a.width,t.height=a.height,e.drawImage(a,0,0,t.width,t.height),h.imageUrls[o]=t,i(!0)},a.onerror=function(){t(new Error("Could not load image at ".concat(o)))},a.src=o}),a.push(t),Promise.all(a).then(function(t){++r==n&&e(!0)}).catch(function(t){++r==n&&i(!1)})}()}).then(function(t){t&&h.layer.onRender()}).catch(function(t){})))}},{key:"dataProcess",value:function(){var t,e,i=this.options.graph,a=i.sizeMapping.mapping?i.sizeMapping.scale.range[1]:i.sizeMapping.fixed,o=("vector"==i.markerType&&(a+=i.stroke.weight),2*(a/=Math.sin(Math.PI/3))*Math.sin(Math.PI/3)),n=1.5*a,r={};for(Q.getZoom()===Q.getMaxZoom()&&(n=o=1),t=0;t<this.features.length;t++){var s,h,l=(g=this.features[t].geometry._coordinates)[1]/n,c=Math.round(l),g=g[0]/o-(1&c?.5:0),d=Math.round(g),f=l-c,g=(1<3*Math.abs(f)&&((h=g-(s=d+(g<d?-1:1)/2))*h+(l=l-(h=c+(l<c?-1:1)))*l<(l=g-d)*l+f*f&&(d=s+(1&c?1:-1)/2,c=h)),"".concat(d,"-").concat(c)),l=r[g];l?l.push(this.features[t]):((l=r[g]=[this.features[t]]).i=d,l.j=c,l.x=(d+(1&c?.5:0))*o,l.y=c*n)}var u=1,p=1,y=[];for(e in r){var m=r[e],w=(m.length<u&&(u=m.length),m.length>p&&(p=m.length),1<m.length&&y.push({key:e,colorField:m.length,sizeField:m.length}),Q.layerPointToContainerPoint([m.x,m.y]));m._xy=[Math.floor(w.x-J.x),Math.floor(w.y-J.y)]}this.binsById=r,this._data=y}},{key:"drawVector",value:function(t){var e=this.binsById,i=_.get(F,"scale.color")({config:_.get(this.options,"graph.colorMapping"),data:this._data,field:"colorField"}),a=_.get(F,"scale.size")({config:_.get(this.options,"graph.sizeMapping"),data:this._data,field:"sizeField"}),o=this.options,n=o.graph,r=o.interaction,s=n.stroke;t.save(),t.lineWidth=s.weight,t.strokeStyle=s.strokeColor;var h,l=[];for(h in e)if(1<(z=e[h]).length){for(var l=[],c={x:z._xy[0],y:z._xy[1]},g=0,d=0;d<z.length;d++)g+=z[d].count||1;z.count=g;var f=a(z.length);for(Q.featureSelect&&Q.featureSelect.properties[["binsById_key"]]==h&&(f*=r.graph.sizeScale),d=0;d<6;d++){var u=Math.PI/180*(60*d+30),p=c.x+f*Math.cos(u),u=c.y+f*Math.sin(u);l.push([p,u])}if(s.strokeColor&&s.weight){if(t.beginPath(),"circle"===n.markerSelect||"Circle"===n.markerSelect)t.arc(c.x,c.y,f*Math.sin(Math.PI/180*60)+n.stroke.weight/2,0,2*Math.PI);else if("hexagon"===n.markerSelect||"Hexagon"===n.markerSelect)for(d=0;d<7;d++){var y=Math.PI/180*(60*d+30),m=c.x+(f+s.weight/2)*Math.cos(y),y=c.y+(f+s.weight/2)*Math.sin(y);t.lineTo(m,y)}t.closePath(),t.stroke()}var w=[],x=[];for(d=0;d<z.length;d++)w.push(+z[d].properties.lng),x.push(+z[d].properties.lat);e[h].featureBounds=[[Math.min.apply(Math,x),Math.min.apply(Math,w)],[Math.max.apply(Math,x),Math.max.apply(Math,w)]],e[h].markerType="group",e[h].binsById_key=h,e[h].coordinates=l}for(h in e){l=[];var v=e[h];if(t.beginPath(),1<v.length){var b={x:v._xy[0],y:v._xy[1]},k=0;for(d=0;d<v.length;d++)k+=v[d].count||1;v.count=k;var S=a(v.length),M=i(v.length);for(Q.featureSelect&&Q.featureSelect.properties[["binsById_key"]]==h&&(S*=r.graph.sizeScale),t.fillStyle=M,d=0;d<6;d++){var I=Math.PI/180*(60*d+30),P=b.x+S*Math.cos(I),I=b.y+S*Math.sin(I);l.push([P,I])}if("circle"===n.markerSelect||"Circle"===n.markerSelect)t.arc(b.x,b.y,S*Math.sin(Math.PI/180*60),0,2*Math.PI);else if("hexagon"===n.markerSelect||"Hexagon"===n.markerSelect)for(d=0;d<6;d++)t.lineTo(l[d][0],l[d][1]);t.closePath(),t.fill(),t.save()}}o=n.clusterLabel.textStyle;for(h in t.fillStyle=o.color,t.font="".concat(o.fontWeight," ").concat(o.fontSize,"px ").concat(o.fontFamily),e){var z,T=(T=(z=e[h]).count)<0?T.toFixed(2):~~T,B=t.measureText(T).width;1<z.length&&t.fillText(T,z._xy[0]-B/2,z._xy[1])}}},{key:"drawSymbol",value:function(t){var e=this.binsById,i=_.get(F,"scale.color")({config:_.get(this.options,"graph.colorMapping"),data:this._data,field:"colorField"}),a=_.get(F,"scale.size")({config:_.get(this.options,"graph.sizeMapping"),data:this._data,field:"sizeField"}),o=this.options,n=o.graph,r=o.interaction;t.save();var s,h=[];for(s in e)if(1<(P=e[s]).length){var h=[],l=P._xy[0],c=P._xy[1],g=0;for(S=0;S<P.length;S++)g+=P[S].count||1;P.count=g;var d=a(P.length);for(Q.featureSelect&&Q.featureSelect.properties[["binsById_key"]]==s&&(d*=r.graph.sizeScale),S=0;S<6;S++){var f=Math.PI/180*(60*S+30),u=l+d*Math.cos(f),f=c+d*Math.sin(f);h.push([u,f])}var p=i(P.length);if(this.imageUrls[this.options.graph.symbolMarker]&&this.imageUrls[this.options.graph.symbolMarker].colorCanvas){var y=this.imageUrls[this.options.graph.symbolMarker],m=y.canvas,y=y.colorCanvas;if(!y[p]){for(var w=document.createElement("canvas"),x=(w.width=m.width,w.height=m.height,w.getContext("2d")),v=m.getContext("2d").getImageData(0,0,m.width,m.height),b=v.data,k=B(p).rgba(),S=0;S<m.width*m.height;S++)(0<b[4*S+0]||0<b[4*S+1]||0<b[4*S+2]||0<b[4*S+3])&&(b[4*S+0]=k[0],b[4*S+1]=k[1],b[4*S+2]=k[2],b[4*S+3]=b[4*S+3]*k[3]);x.putImageData(v,0,0,0,0,m.width,m.height),y[p]=w}t.drawImage(y[p],l-d,c-d,2*d,2*d)}var M=[],I=[];for(S=0;S<P.length;S++)M.push(+P[S].properties.lng),I.push(+P[S].properties.lat);e[s].featureBounds=[[Math.min.apply(Math,I),Math.min.apply(Math,M)],[Math.max.apply(Math,I),Math.max.apply(Math,M)]],e[s].markerType="group",e[s].binsById_key=s,e[s].coordinates=h}o=n.clusterLabel.textStyle;for(s in t.fillStyle=o.color,t.font="".concat(o.fontWeight," ").concat(o.fontSize,"px ").concat(o.fontFamily),e){var P,z=(z=(P=e[s]).count)<0?z.toFixed(2):~~z,T=t.measureText(z).width;1<P.length&&t.fillText(z,P._xy[0]-T/2,P._xy[1])}}},{key:"drawImages",value:function(t){var e,i,a,o,n,r=this.options.interaction,s=this.binsById;for(e in s){var h=s[e];if(1===h.length){t.beginPath();var l=h[0].geometry.coordinates,l=Q.latLngToContainerPoint([l[1],l[0]]),c=this.options.mappingStyle[h[0].properties.data_index];if(this.imageUrls[c.iconUrl]){switch(i=this.imageUrls[c.iconUrl].canvas,a=c.iconSize.width,o=c.iconSize.height,n=Object.assign({},c.offset),c.position){case"bottom":n.y=-n.y;break;case"center":n.y=-n.y+o/2}l.x+=n.x,l.y+=n.y,Q.featureSelect&&Q.featureSelect.geometry.coordinates==h[0].geometry.coordinates&&(a*=r.graph.sizeScale,o*=r.graph.sizeScale),h[0]&&h[0].properties&&h[0].properties.rotationAngle?(t.save(),t.translate(l.x-J.x,l.y-o/2-J.y),t.rotate(h[0].properties.rotationAngle*Math.PI/180),i&&t.drawImage(i,-a/2,-o/2,a,o),t.restore()):i&&t.drawImage(i,l.x-a/2-J.x,l.y-o-J.y,a,o),c=[[l.x-a/2-J.x,l.y-o-J.y],[l.x+a/2-J.x,l.y-o-J.y],[l.x+a/2-J.x,l.y-J.y],[l.x-a/2-J.x,l.y-J.y],[l.x-a/2-J.x,l.y-o-J.y]],s[e].markerType="marker",s[e].coordinates=c}}}t.save(),this.eventObjects=s}},{key:"drawLables",value:function(t){var e=this.options,L=e.interaction,e=e.label,i=e.eventType,O=e.position,a=e.contentStyle,o=e.backgroundStyle,n=a.lineSeries,r=a.fieldWidth,j=a.lineHeight,s=a.textBorder;if(0!=n.length){n[0].content;var R,A=n[0].fieldName,N=(t.textAlign="left",t.textBaseline="middle",Object.assign({},e.offset)),V=this.binsById;for(R in V){var h=V[R];if(h&&1==h.length){var l=(h=h[0]).geometry,c=h.properties;if(Q.featureSelect&&Q.featureSelect.geometry.coordinates==h.geometry.coordinates){if("click"==i&&"click"!=Q.EventType||"mouseover"==i&&"mouseover"!=Q.EventType)continue}else if("all"!=i)continue;var g=this.options.mappingStyle[c.data_index];if(c[A]){for(var d=+g.iconSize.width,f=+g.iconSize.height,g=l._coordinates,l=Q.layerPointToContainerPoint(g),u=l.x-J.x+N.x,p=l.y-J.y-N.y-f/2,y=void 0,m=0,w=0,X=0,x=0;x<n.length;x++){var v=y=n[x],b=v.content,k=v.prefix,v=v.suffix,S=q(c[y.fieldName],b.fontFamily,b.fontWeight,b.fontSize).width;switch(r.widthAdapt){case"adapt":S=Math.min(S,r.maxWidth);break;case"fixedWidth":S=r.fixedWidth}w=S,k.show&&(w+=+k.padding+q(k.name,k.fontFamily,k.fontWeight,k.fontSize).width),v.show&&(w+=+v.padding+q(v.name,v.fontFamily,v.fontWeight,v.fontSize).width),m=Math.max(w,m),X+=Math.max(k.fontSize,b.fontSize,v.fontSize)}for(var M={left:0,right:0,top:0,bottom:0},I={width:m+(M=o.show?o.margin:M).left+M.right,height:X*j+M.top+M.bottom},g=o.border,l=document.createElement("canvas"),P=("vector"===o.backgroundType?(l.width=2*(I.width+g.weight),l.height=2*(I.height+g.weight),l.style.width="".concat(I.width+g.weight,"px"),l.style.height="".concat(I.height+g.weight,"px")):"image"==o.backgroundType&&(l.width=2*I.width,l.height=2*I.height,l.style.width="".concat(I.width,"px"),l.style.height="".concat(I.height,"px")),l.getContext("2d")),z=(P.scale(2,2),o.show&&("vector"===o.backgroundType?P.roundRect(0,0,I.width,I.height,o):"image"==o.backgroundType&&this.imageUrls[o.imageUrl]&&P.drawImage(this.imageUrls[o.imageUrl],0,0,I.width,I.height)),P.strokeStyle=s.color,P.lineWidth=s.weight,P.textBaseline="bottom",M.top),T=0;T<n.length;T++){var B=y=n[T],F=B.content,_=B.prefix,B=B.suffix,U=(z+=Math.max(_.fontSize,F.fontSize,B.fontSize)*j,q(c[y.fieldName],F.fontFamily,F.fontWeight,F.fontSize).width,_.show&&(P.font="".concat(_.fontWeight," ").concat(_.fontSize,"px ").concat(_.fontFamily),P.fillStyle=_.color,s.show&&P.strokeText(_.name,M.left,z),P.fillText(_.name,M.left,z)),P.font="".concat(F.fontWeight," ").concat(F.fontSize,"px ").concat(F.fontFamily),P.fillStyle=F.color,c[y.fieldName]),Y=q(U,F.fontFamily,F.fontWeight,F.fontSize).width,C=0;switch(r.widthAdapt){case"adapt":C=Math.min(Y,r.maxWidth);break;case"fixedWidth":C=r.fixedWidth}if(C<Y){for(var D=0,H=0,Z=P.measureText("...",F.fontFamily,F.fontWeight,F.fontSize).width,G=0;G<U.length;G++)(D+=P.measureText(U[G],F.fontFamily,F.fontWeight,F.fontSize).width)<C-Z&&H++;U="".concat(U.substring(0,H),"...")}var W=M.left;_.show&&(W+=_.padding+q(_.name,_.fontFamily,_.fontWeight,_.fontSize).width),s.show&&P.strokeText(U,W,z),P.fillText(U,W,z),B.show&&(P.font="".concat(B.fontWeight," ").concat(B.fontSize,"px ").concat(B.fontFamily),P.fillStyle=B.color,C=Math.min(C,Y),s.show&&P.strokeText(B.name,W+C+B.padding,z),P.fillText(B.name,W+C+B.padding,z))}var E;if(L.graph.show&&Q.featureSelect&&Q.featureSelect.geometry.coordinates==h.geometry.coordinates){switch(E=L.graph.sizeScale,O){case"top":u-=I.width/2*E,p-=f/2+I.height*E+f*(E-1);break;case"bottom":u-=I.width/2*E,p+=I.height*(E-1);break;case"left":u-=d/2+I.width*E+d*(E-1),p-=I.height/2*E+f/2*(E-1);break;case"right":u+=d/2+d*(E-1),p-=I.height/2*E+f/2*(E-1);break;case"center":u-=I.width/2*E,p-=I.height/2*E+f/2*(E-1)}t.drawImage(l,u,p,(I.width+g.weight)*E,(I.height+g.weight)*E)}else{switch(O){case"top":u-=I.width/2,p-=f/2+I.height;break;case"bottom":u-=I.width/2,p+=f/2;break;case"left":u-=d/2+I.width,p-=I.height/2;break;case"right":u+=d/2,p-=I.height/2;break;case"center":u-=I.width/2,p-=I.height/2}t.drawImage(l,u,p,I.width+g.weight,I.height+g.weight)}}}}}}}])&&s(t.prototype,i),e&&s(t,e),Object.defineProperty(t,"prototype",{writable:!1}),o;function o(t){if(!(this instanceof o))throw new TypeError("Cannot call a class as a function");this.options=n({},t),this.rbush=new a,this.rbush.dirty=0,this.rbush.total=0,this.rbushInBounds=new a,this.featuresInBounds=[],this.features=[],this.imageUrls={},this.dataProcess=this.dataProcess.bind(this),this.drawVector=this.drawVector.bind(this),this.drawSymbol=this.drawSymbol.bind(this),this.drawImages=this.drawImages.bind(this),this.drawLables=this.drawLables.bind(this),this.onRender=this.onRender.bind(this),this.getFeaturesInBounds=this.getFeaturesInBounds.bind(this),this.getFeatures=this.getFeatures.bind(this),this.contains=this.contains.bind(this),this.isPolygonContainsPoint=this.isPolygonContainsPoint.bind(this)}},t.exports});;
Cube("datav:/com/datav-2dmap-markercluster/3.0.17/config",[],function(o,e,t,r,i,l){return o.exports={DEFAULT_OPTIONS:{renderer:"canvas",general:{zoomRange:[0,18],minZoom:0,maxZoom:20},graph:{series:[],seriesOptions:{},mappingSeries:{},markerclusterStyle:{vectorType:"circle",size:32,fill:{minFillColor:"rgb(204, 32, 143)",maxFillColor:"rgb(40, 108, 255)"},stroke:{color:"rgba(45,203,18,0.2)",weight:10},textStyle:{fontFamily:"Microsoft Yahei",fontSize:12,color:"#fff",fontWeight:"normal"},defaultIconStyle:{type:"default",iconUrl:"https://img.alicdn.com/tfs/TB1u94apQP2gK0jSZPxXXacQpXa-200-200.png",iconSize:{width:26,height:26},position:"bottom",offset:{x:0,y:0}}}},popupStyle:{isBorderShadow:!0,show:!0,infoField:!1,eventType:"click",styleType:"parent",textStyle:{fontFamily:"Microsoft Yahei",fontSize:12,color:"#FFFFFF",fontWeight:"normal"},lineHeight:1.4,borderRadius:5,margin:{top:10,bottom:10,left:10,right:10},backgroundColor:"rgba(22,138,214,0.73)",closeBtn:{color:"#fff",size:16,top:0,right:0}}}},o.exports});;
Cube("datav:/com/datav-2dmap-markercluster/3.0.17/src/markerclusterLayer",[],function(t,e,c,o,n,i){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function p(e,t){var o,n=Object.keys(e);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(e),t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)),n}function h(n){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?p(Object(i),!0).forEach(function(t){var e,o;e=n,o=i[t=t],t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(i,t))})}return n}function f(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function d(){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,o){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=v(t)););return t}(t,e);if(n)return n=Object.getOwnPropertyDescriptor(n,e),n.get?n.get.call(arguments.length<3?t:o):n.value}).apply(this,arguments)}function m(t,e){return(m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function b(o){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=v(o),e=(t=n?(t=v(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}return t.exports=function(t){var a=t.L,u=t.map,e=t.Utils,o=t.Layer,y=t.GuiUtils,g=e._,r=e.arr2geojson,l=e.mergeOptions,n=c("datav:/com/datav-2dmap-markercluster/3.0.17/src/markercluster")(t),e=s,t=o;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t);var i,p=b(s);function s(t){var e;if(this instanceof s)return(e=p.call(this)).addTo(u),e.options=l({},t),e.options.general.minZoom=t.general.zoomRange[0],e.options.general.maxZoom=t.general.zoomRange[1],e.options.visibility=!0,e.init(),e;throw new TypeError("Cannot call a class as a function")}return e=s,(t=[{key:"init",value:function(){this.bounds=null,this.geojson=null,this.seriesOptions={},this.eventObjects={},this.popups={},this.draw=this.draw.bind(this),this.getMappingStyle=this.getMappingStyle.bind(this),this.updateOptions=this.updateOptions.bind(this);var t=l({zIndex:0},this.options);this.markerCluster=new n(t),(this.markerCluster.layer=this).addLayer(this.markerCluster)}},{key:"render",value:function(t){var e=[];if(t&&0<t.length)for(var o=0;o<t.length;o++){var n=t[o];n.data_index=o+1,e.push(n)}this.data=e,this.options.mappingStyle=this.getMappingStyle(),this.markerCluster.setOptions(this.options);var i=r(e),i=JSON.parse(JSON.stringify(i));this.markerCluster.setData(i),this.onRender(!0)}},{key:"updateOptions",value:function(t){this.options=l(this.options,t),this.options.general.minZoom=t.general.zoomRange[0],this.options.general.maxZoom=t.general.zoomRange[1],this.infoPopup&&a.customPopup.updatePopupStyle(this.infoPopup,this.convertToRootPopupStyle(this.options.popupStyle)),this.options.mappingStyle=this.getMappingStyle(),this.markerCluster.setOptions(this.options),this.onRender(!0)}},{key:"getMappingStyle",value:function(){for(var t,e,o=this.options.graph,n=o.symbolMarker,i=o.iconStyle,r=this.data,p=y.validateCustomStyle,s=g.get(this.options,"condition.condition"),a=g.get(y,"scale.marker")({config:g.get(this.options,"graph.iconStyle.iconUrlMapping"),data:r,field:"iconField"}),u={},l=0;l<r.length;l++){var c,h,f={};if((h=p({config:s,data:c=r[l],ruleKey:"rules"}))&&h.length){for(t=h.length-1;0<=t&&(e=h[t]).graph.show;t--)if(e.graph.iconUrl.show){f.iconUrl=e.graph.iconUrl.value;break}for(t=h.length-1;0<=t&&(e=h[t]).graph.show;t--)if(e.graph.iconSize.show){f.iconSize=e.graph.iconSize;break}for(t=h.length-1;0<=t&&(e=h[t]).graph.show;t--)if(e.graph.position.show){f.position=e.graph.position.value;break}for(t=h.length-1;0<=t&&(e=h[t]).graph.show;t--)if(e.graph.offset.show){f.offset=e.graph.offset;break}}f.hasOwnProperty("iconUrl")||(f.iconUrl=a(c.iconField)),f.hasOwnProperty("iconSize")||(f.iconSize=i.iconSize),f.hasOwnProperty("symbolMarker")||(f.symbolMarker=n),f.hasOwnProperty("position")||(f.position=i.position),f.hasOwnProperty("offset")||(f.offset=i.offset),u[c.data_index]=f}return u}},{key:"onClick",value:function(t){var e,o=this.options,n=o.interaction,o=o.popupStyle,i=t.feature.properties;i&&i.markerType&&"group"===i.markerType?(i=u.getZoom(),(e=u.getMaxZoom())<(i+=1)&&(i=e),e=t.featureBounds,i=n.graph.zoomPad-1,n=[[e[0][0]-(e[1][0]-e[0][0])*i,e[0][1]-(e[1][1]-e[0][1])*i],[e[1][0]+(e[1][0]-e[0][0])*i,e[1][1]+(e[1][1]-e[0][1])*i]],u.fitBounds(n,{animate:!0,duration:3,easeLinearity:3,noMoveStart:!0})):o.isShow&&"click"===o.eventType&&this._openPopup(t)}},{key:"onMouseOver",value:function(t){var e=this.options.popupStyle;e.isShow&&"mouseover"===e.eventType&&(e=t.feature.properties)&&"group"!==e.markerType&&this._openPopup(t)}},{key:"convertToRootPopupStyle",value:function(t){var e=t.domStyle,o=e.padding,n=e.border,i=e.boxShadow,r=e.backgroundColor,p=e.closeBtn,e=e.tipBtn,s=t.textStyle,t=t.offset;return{background:h({color:r},i),padding:o,border:n,closeBtn:p,tipBtn:e,textStyle:s,offset:t}}},{key:"_openPopup",value:function(t){var e=t.feature,o=e.geometry,n=e.properties,i=(e.style,n.popupType),r=this.popups[i],p=this.options,s=p.general,p=p.popupStyle,o=o.coordinates,t="click"===p.eventType?t.latlng:{lat:o[1],lng:o[0]};if(i&&r){o=p.offset,i=l({},o),p={L:a,map:u,latlng:t,feature:e,offset:i,bindPopup:r,minZoom:s.minZoom,maxZoom:s.maxZoom};a.customPopup.openPopup(p)}else{o=this.convertToRootPopupStyle(this.options.popupStyle);if(!g.isEmpty(n.info))return e=a.popup({}).setLatLng(t).setContent(n.info).openOn(u),this.infoPopup=e,void a.customPopup.updatePopupStyle(e,o);if(this.options.popupStyle.isEmptyShow)return i=a.popup({}).setLatLng(t).setContent("无数据").openOn(u),this.infoPopup=i,void a.customPopup.updatePopupStyle(i,o);this.infoPopup&&this.infoPopup.remove()}this.infoPopup=null}},{key:"bindGroup",value:function(t,e,o){var n=+e.clientWidth,i=+e.clientHeight,r=(e.style.transform="",e.style.position="",e.style.display="none",a.popup({maxWidth:1200,maxHeight:1200,isCustomPopup:!0}));this.popups[t]={popup:r,container:e,clientWidth:n,clientHeight:i,popupStyle:o}}},{key:"draw",value:function(t){var e=this.options.general;t.globalAlpha=.01*e.opacity,this.container&&t.drawImage(this.container,0,0,this.container.width,this.container.height)}},{key:"show",value:function(){this.onRender(!0),this.options.visibility=!0}},{key:"hide",value:function(){d(v(s.prototype),"hide",this).call(this),this.options.visibility=!1}},{key:"destroy",value:function(){this.options=null,this.geojson=null,this.bounds=null,this.seriesOptions=null,this.eventObjects=null,this.popups=null,this.ctx=null,this.container=null,delete this.options,this.geojson,this.bounds,this.seriesOptions,this.eventObjects,this.popups,this.ctx,this.container}}])&&f(e.prototype,t),i&&f(e,i),Object.defineProperty(e,"prototype",{writable:!1}),s},t.exports});;
Cube("datav:/com/datav-2dmap-markercluster/3.0.17",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(e,t,r,o,n,i){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(r){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=y(r),t=(e=o?(e=y(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=r("datav:/npm/eventemitter3/3.0.0"),c=r("datav:/npm/safely-merge/1.0.1"),f=r("datav:/com/datav-2dmap-markercluster/3.0.17/src/markerclusterLayer"),h=r("datav:/com/datav-2dmap-markercluster/3.0.17/config").DEFAULT_OPTIONS,r=function(){var e=n,t=p;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t);var r,o=u(n);function n(e,t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");var r=o.call(this),t=t.options;return r.options=c(h,t),r.options.general.minZoom=t.general.zoomRange[0],r.options.general.maxZoom=t.general.zoomRange[1],r.options.visibility=!0,r}return e=n,(t=[{key:"addTo",value:function(e,t){this.options.id=t;t=f(e);return this.layer=new t(this.options),this}},{key:"onRender",value:function(e){this.layer&&this.layer.onRender&&this.layer.onRender(e)}},{key:"render",value:function(e){var t=[],r=0;if(e&&e.length){for(var o,n=0;n<e.length;n++)o=e[n],Number.isFinite(parseFloat(o.lng))&&Number.isFinite(parseFloat(o.lat))?t.push(o):r++;0<r&&console.log("符号聚合层：有 ".concat(r," 条异常数据。"))}this.layer&&this.layer.render&&this.layer.render(t)}},{key:"resize",value:function(e,t){this.layer&&this.layer.resize&&this.layer.resize(e,t)}},{key:"onClick",value:function(e){var t=e.feature,r=t.properties;r&&r.markerType&&"group"===r.markerType||this.emit("click",t.properties),this.layer&&this.layer.onClick&&this.layer.onClick(e)}},{key:"onMouseOver",value:function(e){var t=e.feature,r=t.properties;r&&r.markerType&&"group"===r.markerType||this.emit("mouseover",t.properties),this.layer&&this.layer.onMouseOver&&this.layer.onMouseOver(e)}},{key:"contains",value:function(e){return this.layer.contains(e)}},{key:"bindGroup",value:function(e){var t=e.popupType||"",r=e.container||"<div></div>",e=e.popupStyle||{};this.layer&&this.layer.bindGroup&&this.layer.bindGroup(t,r,e)}},{key:"updateOptions",value:function(e){e=e.options;this.options=c(this.options,e),this.options.general.minZoom=e.general.zoomRange[0],this.options.general.maxZoom=e.general.zoomRange[1],this.layer&&this.layer.updateOptions&&this.layer.updateOptions(this.options)}},{key:"draw",value:function(e){this.layer&&this.layer.draw&&this.layer.draw(e)}},{key:"show",value:function(){this.options.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.options.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"destroy",value:function(){this.layer&&this.layer.destroy&&this.layer.destroy(),this.layer=null,this.options=null,delete this.layer,this.options}}])&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),n}();return e.exports=r,e.exports});