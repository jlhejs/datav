// env=undefined => env=publish 
Cube("datav:/com/datavmap-2d/1.3.27/index.css", [], function(m){m.exports=".leaflet-image-layer.leaflet-interactive,.leaflet-marker-icon.leaflet-interactive,.leaflet-pane>svg path.leaflet-interactive{pointer-events:visiblePainted;pointer-events:inherit!important}.leaflet-tile-pane{z-index:200!important}.leaflet-fill-pane{z-index:250!important}.leaflet-line-pane{z-index:300!important}.leaflet-point-pane{z-index:550!important}.leaflet-overlay-pane{z-index:400!important}.leaflet-shadow-pane{z-index:500!important}.leaflet-marker-pane{z-index:600!important}.leaflet-tooltip-pane{z-index:650!important}.leaflet-popup-pane{z-index:700!important}";return m.exports});;
Cube("datav:/com/datavmap-2d/1.3.27",["datav:/npm/datav-map/0.0.12","datav:/npm/bcore/0.0.21/event","datav:/npm/lodash.throttle/4.1.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();window.devicePixelRatio=1;var h=c("datav:/npm/datav-map/0.0.12"),i=c("datav:/npm/bcore/0.0.21/event"),j=h.datavUtils,k=h.DomEvent,l=c("datav:/npm/lodash.throttle/4.1.1");c("datav:/com/datavmap-2d/1.3.27/index.css","");var m={fill:1,line:2,point:3};h.Polygon.prototype._containsPoint=function(a){var b,c,d,e,f,g,h,i,j=!1;if(!this._pxBounds||!this._pxBounds.contains(a))return!1;for(e=0,h=this._parts.length;e<h;e++)for(b=this._parts[e],f=0,i=b.length,g=i-1;f<i;g=f++)c=b[f],d=b[g],c.y>a.y!==d.y>a.y&&a.x<(d.x-c.x)*(a.y-c.y)/(d.y-c.y)+c.x&&(j=!j);return j};var n={center:[30,114],zoom:8,maxZoom:20,scaleX:1,scaleY:1,zoomControl:!1,zoomSnap:0.1,preferCanvas:!0,attributionControl:!1,zoomDelta:0.1,crs:h.CRS.EPSG3857,worldCopyJump:!1,keyboard:!0,doubleClickZoom:!1,keyboardPanDelta:80,scaleControl:!1,scaleControlFontColor:"#fff",scaleControlBorderColor:"#777",isInteractive:!0},o=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.container="string"===typeof a?document.querySelector(a):a,f.apis=c.apis,f.map=null,f._data=null,f.subcoms={},f.config=c,f.init(),f._ratioChange=f._ratioChange.bind(f),f}return f(b,a),g(b,[{key:"init",value:function(){var a=this.getOptions();this.map=new h.Map(this.container,a),this.mouseState="",this.map.on("move",this.onMapMove.bind(this)),this.map.on("moveend",this.onMapMoveEnd.bind(this)),this.map.L=h,this.updateScaleControl(a),a.scrollWheelZoom?this.map.touchZoom.enable():this.map.touchZoom.disable(),window.share.event&&window.share.event.on("ratio-change",this._ratioChange.bind(this)),k.on(this.container,{mouseout:l(this.onMouseOut.bind(this),32),mousemove:l(this.onMouseMove.bind(this),32),click:l(this.onClick.bind(this),32),mousedown:l(this.onMouseDown.bind(this),32)},this)}},{key:"onMouseDown",value:function(){this.mouseState="mousedown"}},{key:"onMapMove",value:function(){var a=this.map.getCenter(),b="move";switch(this.mouseState){case"mousedown":b+="_mouse";break;case"setMapState":b+="_setMapState";break;case"updateOptions":b+="_updateOptions";break;default:}var c={type:b,zoom:this.map.getZoom(),lng:+a.lng.toFixed(6),lat:+a.lat.toFixed(6)};this.emit("map-move",c)}},{key:"onMapMoveEnd",value:function(){var a=this.map.getCenter(),b="moveend";switch(this.mouseState){case"mousedown":b+="_mouse";break;case"setMapState":b+="_setMapState";break;case"updateOptions":b+="_updateOptions";break;default:}var c={type:b,zoom:this.map.getZoom(),lng:+a.lng.toFixed(6),lat:+a.lat.toFixed(6)};this.emit("map-moveend",c),this.mouseState=""}},{key:"onMouseOut",value:function(a){var b=this;if(this.config.mapOptions.isInteractive){var c=Object.keys(this.subcoms).filter(function(a){return b.subcoms[a].layer.renderer&&0<b.subcoms[a].layer.options.opacity});c.forEach(function(c){var d=b.subcoms[c].layer.renderer;b.container.style.cursor="";var e=j.mergeOptions(a,{clientX:-1e5,clientY:-1e5});h.Util.throttle(d._onMouseMove,32,d)(e)})}}},{key:"onMouseMove",value:function(a){var c=this;if(this.config.mapOptions.isInteractive&&!(this.map.boxZoom&&this.map.boxZoom.moved())){var b=Object.keys(this.subcoms).filter(function(a){return c.subcoms[a].layer.renderer&&0<c.subcoms[a].layer.options.opacity});b.sort(function(d,a){return m[c.subcoms[d].layer.type]-m[c.subcoms[a].layer.type]});for(var d,e=b.length-1;0<=e;e--)if(d=this.subcoms[b[e]].config,d.visibility&&d.interactive&&d.interactive.isHover&&d.interactive.isHover.show){var f=this.subcoms[b[e]].layer.renderer,g=f._drawnLayers;if(void 0==g)break;for(var i=Object.keys(g),k=!1,l=!1,n=i.length-1;0<=n;n--)if(l=g[i[n]]._containsPoint(this.map.mouseEventToLayerPoint(a)),l){k=!0;break}if(k){this.container.style.cursor="pointer",h.Util.throttle(f._onMouseMove,32,f)(a),f._onMouseMove(a);for(var o=b.length-1;0<=o;o--)if(o!==e){var p=j.mergeOptions(a,{clientX:-1e5,clientY:-1e5});h.Util.throttle(this.subcoms[b[o]].layer.renderer._onMouseMove,32,this.subcoms[b[o]].layer.renderer)(p)}break}else{this.container.style.cursor="";var q=j.mergeOptions(a,{clientX:-1e5,clientY:-1e5});h.Util.throttle(f._onMouseMove,32,f)(q)}}}}},{key:"onClick",value:function(a){var c=this;if(this.config.mapOptions.isInteractive&&!(a.target.className.includes("leaflet-marker")||a.target.parentNode.className.includes("main-img"))&&!(this.map.boxZoom&&this.map.boxZoom.moved())){var b=Object.keys(this.subcoms).filter(function(a){return c.subcoms[a].layer.renderer&&0<c.subcoms[a].layer.options.opacity});b.sort(function(d,a){return m[c.subcoms[d].layer.type]-m[c.subcoms[a].layer.type]});for(var d,e=b.length-1;0<=e;e--)if(d=this.subcoms[b[e]].config,d.visibility){var f=this.subcoms[b[e]].layer.renderer,g=f._drawnLayers;if(void 0==g)break;for(var h=Object.keys(g),i=!1,k=h.length-1;0<=k;k--)if(g[h[k]]._containsPoint(this.map.mouseEventToLayerPoint(a))){i=!0;break}if(i){this.subcoms[b[e]].layer.renderer._onClick(a);break}else{var l=j.mergeOptions(a,{clientX:-1e5,clientY:-1e5});this.subcoms[b[e]].layer.renderer._onClick(l)}}}}},{key:"getOptions",value:function(){var a=this.config,b=j.mergeOptions(n,{background:a.mapOptions.background,zoom:a.mapOptions.zoom,maxZoom:a.mapOptions.maxZoom,center:[a.mapOptions.center.lat,a.mapOptions.center.lng],scaleControl:a.mapOptions.scaleControl.show,scaleControlFontColor:a.mapOptions.scaleControl.fontColor,scaleControlBorderColor:a.mapOptions.scaleControl.borderColor,isInteractive:a.mapOptions.isInteractive,dragging:void 0==a.mapOptions.dragging||a.mapOptions.dragging,scrollWheelZoom:void 0==a.mapOptions.scrollWheelZoom||a.mapOptions.scrollWheelZoom}),c=this.container;return c.style.background=b.background,c.style.pointerEvents=b.isInteractive?"auto":"none",b}},{key:"addScaleControl",value:function(){this.scaleControl&&this.removeScaleControl();var a=this.scaleControl=h.control.scale({imperial:!1,maxWidth:150});a.addTo(this.map)}},{key:"updateScaleControl",value:function(a){if(a.scaleControl){this.addScaleControl();var b=this.scaleControl.getContainer().querySelector(".leaflet-control-scale-line");b.style.background="rgba(0,0,0,0)",b.style.color=a.scaleControlFontColor,b.style.borderColor=a.scaleControlBorderColor}else this.removeScaleControl()}},{key:"removeScaleControl",value:function(){this.scaleControl&&this.scaleControl.remove(),this.scaleControl=null}},{key:"data",value:function(a){return a&&(this._data=a),this._data}},{key:"_ratioChange",value:function(a){a&&this.map&&this.map.setScale(a.ratioX,a.ratioY)}},{key:"get",value:function(a){return this.coms[a]}},{key:"add",value:function(a,b){return a?void(a.addTo&&a.addTo(this.map),this.subcoms[b]=a):console.log("layer \u6CA1\u6709\u5B9A\u4E49")}},{key:"remove",value:function(a,b){a.remove&&a.remove(),delete this.subcoms[b]}},{key:"setMapState",value:function(a){if(a&&(this.mouseState="setMapState",a.length)){var b=this.getOptions(),c=b.zoom,d=b.center;void 0==a[0].zoom||isNaN(a[0].zoom)||(c=+a[0].zoom),void 0==a[0].lng||void 0==a[0].lat||isNaN(a[0].lng)||isNaN(a[0].lat)||(d=[+a[0].lat,+a[0].lng]),a[0].noFly?(this.map.isFly=!1,this.map.setView(d,c)):(this.map.isFly=!0,this.map.flyTo(d,c,{duration:a[0].duration||0.25}))}}},{key:"resize",value:function(){this.map.invalidateSize(!0)}},{key:"destroy",value:function(){k.off(this.container,{mouseout:l(this.onMouseOut,32),mousemove:l(this.onMouseMove,32),click:this.onClick,mousedown:l(this.onMouseDown,32)},this),this.map.off("move"),this.map.off("moveend"),this.map.remove()}},{key:"updateOptions",value:function(a){this.mouseState="updateOptions",this.config=j.mergeOptions(this.config,a),a=this.getOptions(),this.map.setView(a.center,a.zoom),this.updateScaleControl(a),a.dragging?this.map.dragging.enable():this.map.dragging.disable(),a.scrollWheelZoom?(this.map.scrollWheelZoom.enable(),this.map.touchZoom.enable()):(this.map.scrollWheelZoom.disable(),this.map.touchZoom.disable())}}]),b}(i);return a.exports=o,a.exports});