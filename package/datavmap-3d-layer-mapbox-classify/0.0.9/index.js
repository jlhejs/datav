// env=undefined => env=publish 
Cube("datav:/com/datavmap-3d-layer-mapbox-classify/0.0.9/m-classify-layer.js",["datav:/npm/eventemitter3/2.0.3","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/2.0.3"),i=c("datav:/npm/safely-merge/1.0.1");return a.exports=function(a){var b=a.datavgl,c={};return function(b){function h(a){d(this,h);var b=e(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));return a=i(c,a),b.options=i(b.options,a),b.init(),b}return f(h,b),g(h,[{key:"init",value:function(){this.data=[],this.geojson={type:"FeatureCollection",features:[]},a.getSource(this.options.id)||a.addSource(this.options.id,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.updateLayers()}},{key:"setData",value:function(b){b&&"FeatureCollection"===b.type&&(b.features.forEach(function(a){var b=a.properties;Object.keys(b).forEach(function(a){b[a]=""+b[a]})}),this.geojson=b,a.getSource(this.options.id)&&a.getSource(this.options.id).setData(b),this.updateData())}},{key:"findCorrectInsertIndex",value:function(){var a=this.options,b=this.options.geomtype,c=void 0;switch(b){case"circle":c=this.findCircleCorrectInsertIndex();break;case"line":c=this.findLineCorrectInsertIndex();break;case"fill":c=this.findFillCorrectInsertIndex();break;default:}return c}},{key:"findCircleCorrectInsertIndex",value:function(){var b=a.submtags,c=void 0;return 1<b.circle.length&&(c=this.findInsertIndexByLayerTag(b.circle),-1!==c)?c:b.line.length&&(c=this.findAfterIndexByLayerTag(b.line[b.line.length-1]),-1!==c)?c:b.fill.length&&(c=this.findAfterIndexByLayerTag(b.fill[b.fill.length-1]),-1!==c)?c:b.basemap.length&&(c=this.findAfterIndexByLayerTag(b.basemap[b.basemap.length-1]),-1!==c)?c:a.getStyle().layers.length}},{key:"findLineCorrectInsertIndex",value:function(){var b=a.submtags,c=void 0;return 1<b.line.length&&(c=this.findInsertIndexByLayerTag(b.line),-1!==c)?c:b.circle.length&&(c=this.findBeforeIndexByLayerTag(b.circle[0]),-1!==c)?c:b.fill.length&&(c=this.findAfterIndexByLayerTag(b.fill[b.fill.length-1]),-1!==c)?c:b.basemap.length&&(c=this.findAfterIndexByLayerTag(b.basemap[b.basemap.length-1]),-1!==c)?c:a.getStyle().layers.length}},{key:"findFillCorrectInsertIndex",value:function(){var b=a.submtags,c=void 0;return 1<b.fill.length&&(c=this.findInsertIndexByLayerTag(b.fill),-1!==c)?c:b.line.length&&(c=this.findBeforeIndexByLayerTag(b.line[0]),-1!==c)?c:b.circle.length&&(c=this.findBeforeIndexByLayerTag(b.circle[0]),-1!==c)?c:b.basemap.length&&(c=this.findAfterIndexByLayerTag(b.basemap[b.basemap.length-1]),-1!==c)?c:a.getStyle().layers.length}},{key:"findInsertIndexByLayerTag",value:function(a){var b=this,c=a.findIndex(function(a){return-1!==a.indexOf(b.options.id)});return c===a.length-1?this.findAfterIndexByLayerTag(a[c-1]):this.findBeforeIndexByLayerTag(a[c+1])}},{key:"findAfterIndexByLayerTag",value:function(b){var c=a.getStyle(),e=-1;return c.layers.forEach(function(a,c){-1!==a.id.indexOf(b)&&(e=c+1)}),e}},{key:"findBeforeIndexByLayerTag",value:function(b){var c=a.getStyle();return c.layers.findIndex(function(a){return-1!==a.id.indexOf(b)})}},{key:"removeLayers",value:function(){var b=this;Object.keys(a.style._layers).forEach(function(c){-1!==c.indexOf(b.options.id)&&a.getLayer(c)&&a.removeLayer(c)})}},{key:"updateLayers",value:function(){var a=this;this.removeLayers();var b=this.options,c=this.options["circle-default"],d=this.options["line-default"],e=this.options["fill-default"],f=this.options.circle,g=this.options.line,h=this.options.fill,i=this.options.geomtype,j=this.layers=[];switch(i){case"circle":var k=[[this.options.id,"rgba(0,0,0,0)"]],l=[[this.options.id,0]],m=[[this.options.id,0]],n=[[this.options.id,0]],o=[[this.options.id,"rgba(0,0,0,0)"]];f.forEach(function(a){k.push([a["classify-value"],a["circle-color"]]),l.push([a["classify-value"],a["circle-radius"]]),m.push([a["classify-value"],a["circle-blur"]]),n.push([a["classify-value"],a["circle-stroke-width"]]),o.push([a["classify-value"],a["circle-stroke-color"]])}),j.push({id:this.options.id+"_layer",type:"circle",source:this.options.id,layout:{},paint:{"circle-color":{type:"categorical",default:c["circle-color"],property:this.options["classify-key"],stops:k},"circle-radius":{type:"categorical",default:c["circle-radius"],property:this.options["classify-key"],stops:l},"circle-blur":{type:"categorical",default:c["circle-blur"],property:this.options["classify-key"],stops:m},"circle-stroke-width":{type:"categorical",default:c["circle-stroke-width"],property:this.options["classify-key"],stops:n},"circle-stroke-color":{default:c["circle-stroke-color"],type:"categorical",property:this.options["classify-key"],stops:o}},filter:["==","$type","Point"]});break;case"line":var p=[[this.options.id,"rgba(0,0,0,0)"]],q=[[this.options.id,0]],r=[[this.options.id,0]];g.forEach(function(a){p.push([a["classify-value"],a["line-color"]]),q.push([a["classify-value"],a["line-width"]]),r.push([a["classify-value"],a["line-blur"]])}),j.push(JSON.parse(JSON.stringify({id:this.options.id+"_layer",type:"line",source:this.options.id,layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":{type:"categorical",default:d["line-color"],property:this.options["classify-key"],stops:p},"line-width":{type:"categorical",default:d["line-width"],property:this.options["classify-key"],stops:q},"line-blur":{type:"categorical",default:d["line-blur"],property:this.options["classify-key"],stops:r},"line-dasharray":d["line-dasharray"]?d["line-dasharray"].split(",").map(function(a){return+a||0}):void 0},filter:["any",["==","$type","LineString"],["==","$type","Polygon"]]})));break;case"fill":var t=[[this.options.id,"rgba(0,0,0,0)"]],u=[[this.options.id,"rgba(0,0,0,0)"]];h.forEach(function(a){t.push([a["classify-value"],a["fill-color"]]),u.push([a["classify-value"],a["fill-outline-color"]])}),j.push({id:this.options.id+"_layer",type:"fill",source:this.options.id,layout:{},paint:{"fill-color":{type:"categorical",default:e["fill-color"],property:this.options["classify-key"],stops:t},"fill-outline-color":{type:"categorical",default:e["fill-outline-color"],property:this.options["classify-key"],stops:u}},filter:["==","$type","Polygon"]});break;default:}this.updateStyle(),this.endID=setTimeout(function(){a.resetID&&clearTimeout(a.resetID)},100000)}},{key:"updateStyle",value:function(){var b=this;if(a.loaded()&&a.isStyleLoaded()){this.resetID&&clearTimeout(this.resetID);var c=this.findCorrectInsertIndex(),d=a.getStyle(),e=this.layers;e.forEach(function(a){a.layout&&(a.layout.visibility=b.options.visible?"visible":"none"),a.layout||(a.layout={visibility:b.options.visible?"visible":"none"})}),[].splice.apply(d.layers,[c,0].concat(e)),a.setStyle(d)}else this.resetID&&clearTimeout(this.resetID),this.resetID=setTimeout(function(){b.updateStyle()},200)}},{key:"updateData",value:function(){}},{key:"updateOptions",value:function(a){this.options=i(this.options,a),this.updateLayers()}},{key:"show",value:function(){this.options.visible=!0,this.updateOptions(this.options)}},{key:"hide",value:function(){this.options.visible=!1,this.updateOptions(this.options)}},{key:"remove",value:function(){this.endID&&clearTimeout(this.endID),this.resetID&&clearTimeout(this.resetID),this.removeLayers(),a.getSource(this.options.id)&&a.removeSource(this.options.id)}}]),h}(h)},a.exports});;
Cube("datav:/com/datavmap-3d-layer-mapbox-classify/0.0.9",["datav:/npm/eventemitter3/2.0.3","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/2.0.3"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/com/datavmap-3d-layer-mapbox-classify/0.0.9/m-classify-layer.js"),k={},l=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.container="string"===typeof a?document.querySelector(a):a,f.apis=c.apis,f.map=null,f._data=null,f.config=c,f}return f(b,a),g(b,[{key:"initLayer",value:function(){var a=this.getOptions(),b=j(this.map);this.layer=new b(a)}},{key:"addTo",value:function(a){var b=this;this.map=a,this.config.id=this.mtag=this.id+"_datav_"+this.config.geomtype,this.resetID&&clearTimeout(this.resetID),this.init(),this.endID=setTimeout(function(){b.resetID&&clearTimeout(b.resetID)},100000)}},{key:"init",value:function(){var a=this;this.map.loaded()&&this.map.isStyleLoaded()?(this.resetID&&clearTimeout(this.resetID),this.initLayer(),this.data&&this.render(this.data)):(this.resetID&&clearTimeout(this.resetID),this.resetID=setTimeout(function(){a.init()},100))}},{key:"getOptions",value:function(){return this.config=i(k,this.config),this.config}},{key:"show",value:function(){this.config.visible=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.config.visible=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"remove",value:function(){this.endID&&clearTimeout(this.endID),this.resetID&&clearTimeout(this.resetID),this.layer&&this.layer.remove&&this.layer.remove(),this.layer=null,this._data=null}},{key:"render",value:function(a){a&&(this.data=a,this.layer&&this.layer.setData(a))}},{key:"updateOptions",value:function(a){this.config=i(this.config,a),a=this.getOptions(),this.layer&&this.layer.updateOptions(a)}}]),b}(h);return a.exports=l,a.exports});