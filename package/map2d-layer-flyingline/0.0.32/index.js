Cube('datav:/com/map2d-layer-flyingline/0.0.32',['datav:/npm/bcore/0.0.21/utils','datav:/npm/bcore/0.0.21/event','datav:/npm/ldmap/0.1.45/layer/flyinglines'],function(i,n,a,m,l,k){function j(a){return c[a]?c[a]:c[a]=d[a]()}function b(){var a=arguments[arguments.length-1];this.options=e.deepMerge(b.options,a),this.initDataPool()}var d={},c={};d['coms/map2d-layer-flyingline/0.0.32/data_buffer']=d['coms/map2d-layer-flyingline/0.0.32/data_buffer.js']=function(){function b(a){this.datas=[],this.loopIndex=0,this.dataIndex=0,this.options=e.deepMerge(b.options,a)}var d={},c={exports:d},e=a('datav:/npm/bcore/0.0.21/utils'),f=a('datav:/npm/bcore/0.0.21/event');return b.options={isCache:!0,maxLength:200,updateInterval:10,updateStep:2,handler:'render'},b=f.extend(b,{bindTo:function(a){this.visualizer=a,this.tryStart()},clean:function(){this.loopIndex=0,this.dataIndex=0,this.datas=[],window.cancelAnimationFrame(this.loopId)},tryStart:function(){if(this.loopId||!this.visualizer)return;this.loop()},data:function(b){var a=this.datas;[].push.apply(a,b),this.resume()},stop:function(){this.isStop=!0},resume:function(){this.isStop=!1},check:function(){var b=this.options.maxLength,c,a=this.datas;if(a.length<b)return;c=a.length-b,a.splice(0,c)},loop:function(){var a=this.options.updateInterval;this.loopIndex%a===0&&this.update(),this.loopIndex++,this.loopId=window.requestAnimationFrame(this.loop.bind(this))},setUpdateSpeed:function(a){this.options.updateStep=a},setIsCahe:function(a){this.options.isCache=a},shuffle:function(e){var a=e.slice(0),c,d,b;for(b=a.length;b;b--)c=Math.floor(Math.random()*b),d=a[b-1],a[b-1]=a[c],a[c]=d;return a},update:function(){if(this.isStop)return;var d=this.options.updateStep,e=this.options.handler,c=this.visualizer;if(!c)return;var h=this.options.maxLength,a=this.datas;if(!a.length)return;var f=this.shuffle(a);for(var b=a.length-1;b>=a.length-d;b--){var g=f[b];c[e]([g]),this.options.isCache||a.splice(0,1)}this.check()},render:function(){}}),c.exports=b,c.exports};var h=a('datav:/npm/bcore/0.0.21/event'),e=a('datav:/npm/bcore/0.0.21/utils'),g=j('coms/map2d-layer-flyingline/0.0.32/data_buffer'),f=a('datav:/npm/ldmap/0.1.45/layer/flyinglines');return b.options={isCache:!0,maxLengthDataPool:200,updateStepDataPool:.1,lineN:20,type:'gradient',lifeSpeed:.01,kHeight:1.1,range:.5,displayLine:{weight:3,colorTo:'rgba(250,150,50,1)',colorFrom:'rgba(255,0,0,.1)',colorNormal:'rgba(250,250,250,0.1)'},interactiveLine:{weight:15,color:'rgba(250,150,50,0.0)',colorHover:'rgba(250,150,50,0.1)'},fromMarker:{display:!0,backgroundColor:'#0f0',fontColor:'#fff',fontFamily:'Microsoft Yahei',fontSize:12,fadeInTime:.5,fadeOutTime:.5,keepTime:.5,position:'left'},toMarker:{display:!0,backgroundColor:'#f00',fontColor:'#fff',fontFamily:'Microsoft Yahei',fontSize:12,fadeInTime:.5,fadeOutTime:.5,keepTime:.5,position:'right'},toRippleMarker:{display:!0,color:'#ff0',r:20,fadeInTime:.5}},b=h.extend(b,{addTo:function(a){a._map&&(a=a._map),this._map=a,this.initCom()},initDataPool:function(){var a=this.getPoolOptions(this.options);this.dataPool=new g(a)},getPoolOptions:function(a){return{isCache:a.isCache===undefined?!0:a.isCache,maxLength:a.maxLengthDataPool,updateStep:a.updateStepDataPool}},getOptions:function(){var a=this.options;return a.fromMarker.fontSize+='px',a.toMarker.fontSize+='px',{lineN:a.lineN,type:a.type,flying:{lifeSpeed:a.lifeSpeed,displayLine:a.displayLine,interactiveLine:a.interactiveLine,kHeight:a.kHeight,range:a.range,fromMarker:a.fromMarker,toMarker:a.toMarker,toRippleMarker:a.toRippleMarker}}},initCom:function(){var b=this.getOptions(this.options),a=this.layer=new f(b);a.addTo(this._map),this.dataPool.bindTo(a)},updateOptions:function(a){a=this.options=e.deepMerge(this.options,a),this.layer.updateOptions(this.getOptions(a)),this.dataPool.setUpdateSpeed(this.options.updateStepDataPool),this.dataPool.setIsCahe(this.options.isCache)},data:function(a){a&&(this._data=a)},remove:function(){this.layer.remove&&this.layer.remove(),this.layer.distroy&&this.layer.distroy(),this.layer.clean&&this.layer.clean(),this.dataPool&&this.dataPool.clean()},render:function(a){if(!a)return console.log('地图组件Map2dFlyingline未收到数据...');this.dataPool.data(a)}}),i.exports=b,i.exports})