// env=undefined => env=publish 
Cube("datav:/com/datav-2dmap-isosurface/3.0.7/src/libs/kriging-contour",[],function(r,t,n,o,e,a){function i(r,t){return r<t?-1:t<r?1:t<=r?0:NaN}var f,u;1===(f=i).length&&(u=f,f=function(r,t){return i(u(r),t)});var l=Math.sqrt(50),c=Math.sqrt(10),y=Math.sqrt(2);function d(r){return Math.ceil(Math.log(r.length)/Math.LN2)+1}var v=Array.prototype.slice;function m(r,t){return r-t}function M(r){return function(){return r}}function A(r,t){for(var n,o=-1,e=t.length;++o<e;)if(n=function(r,t){for(var n=t[0],o=t[1],e=-1,a=0,i=r.length,f=i-1;a<i;f=a++){var u=r[a],h=u[0],l=u[1],c=r[f],s=c[0],g=c[1];if(function(r,t,n){return function(r,t,n){return(t[0]-r[0])*(n[1]-r[1])==(n[0]-r[0])*(t[1]-r[1])}(r,t,n)&&function(r,t,n){return r<=t&&t<=n||n<=t&&t<=r}(r[r=+(r[0]===t[0])],n[r],t[r])}(u,c,t))return 0;o<l!=o<g&&n<(s-h)*(o-l)/(g-l)+h&&(e=-e)}return e}(r,t[o]))return n;return 0}function w(){}var x=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function h(){var s=1,g=1,u=d,a=t;function o(t){var r,n,o,e,a,i,f=u(t);return(f=Array.isArray(f)?f.slice().sort(m):(r=(i=function(r,t){var n,o,e,a=r.length,i=-1;if(null==t){for(;++i<a;)if(null!=(n=r[i])&&n<=n)for(o=e=n;++i<a;)null!=(n=r[i])&&(n<o&&(o=n),e<n&&(e=n))}else for(;++i<a;)if(null!=(n=t(r[i],i,r))&&n<=n)for(o=e=n;++i<a;)null!=(n=t(r[i],i,r))&&(n<o&&(o=n),e<n&&(e=n));return[o,e]}(t))[0],n=i[1],o=r,e=n,a=f,i=Math.abs(e-o)/Math.max(0,a),a=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),l<=(i=i/a)?a*=10:c<=i?a*=5:y<=i&&(a*=2),f=e<o?-a:a,function(r,t,n){r=+r,t=+t,n=(e=arguments.length)<2?(t=r,r=0,1):e<3?1:+n;for(var o=-1,e=0|Math.max(0,Math.ceil((t-r)/n)),a=new Array(e);++o<e;)a[o]=r+o*n;return a}(Math.floor(r/f)*f,Math.floor(n/f)*f,f))).map(function(r){return h(t,r)})}function h(t,n){var e=[],o=[];return function(r,t,i){var f,u,n,o,e,a,h=new Array,l=new Array;f=u=-1,o=r[0]>=t,x[o<<1].forEach(c);for(;++f<s-1;)n=o,o=r[f+1]>=t,x[n|o<<1].forEach(c);x[o<<0].forEach(c);for(;++u<g-1;){for(f=-1,o=r[u*s+s]>=t,e=r[u*s]>=t,x[o<<1|e<<2].forEach(c);++f<s-1;)n=o,o=r[u*s+s+f+1]>=t,a=e,e=r[u*s+f+1]>=t,x[n|o<<1|e<<2|a<<3].forEach(c);x[o|e<<3].forEach(c)}f=-1,e=r[u*s]>=t,x[e<<2].forEach(c);for(;++f<s-1;)a=e,e=r[u*s+f+1]>=t,x[e<<2|a<<3].forEach(c);function c(r){var t,n=[r[0][0]+f,r[0][1]+u],o=[r[1][0]+f,r[1][1]+u],e=p(n),a=p(o);(r=l[e])?(t=h[a])?(delete l[r.end],delete h[t.start],r===t?(r.ring.push(o),i(r.ring)):h[r.start]=l[t.end]={start:r.start,end:t.end,ring:r.ring.concat(t.ring)}):(delete l[r.end],r.ring.push(o),l[r.end=a]=r):(r=h[a])?(t=l[e])?(delete h[r.start],delete l[t.end],r===t?(r.ring.push(o),i(r.ring)):h[t.start]=l[r.end]={start:t.start,end:r.end,ring:t.ring.concat(r.ring)}):(delete h[r.start],r.ring.unshift(n),h[r.start=e]=r):h[e]=l[a]={start:e,end:a,ring:[n,o]}}x[e<<3].forEach(c)}(t,n,function(r){a(r,t,n),0<function(r){for(var t=0,n=r.length,o=r[n-1][1]*r[0][0]-r[n-1][0]*r[0][1];++t<n;)o+=r[t-1][1]*r[t][0]-r[t-1][0]*r[t][1];return o}(r)?e.push([r]):o.push(r)}),o.forEach(function(r){for(var t,n=0,o=e.length;n<o;++n)if(-1!==A((t=e[n])[0],r))return void t.push(r)}),{type:"MultiPolygon",value:n,coordinates:e}}function p(r){return 2*r[0]+r[1]*(s+1)*4}function t(r,f,u){r.forEach(function(r){var t,n=r[0],o=r[1],e=0|n,a=0|o,i=f[a*s+e];0<n&&n<s&&e===n&&(t=f[a*s+e-1],r[0]=n+(u-t)/(i-t)-.5),0<o&&o<g&&a===o&&(t=f[(a-1)*s+e],r[1]=o+(u-t)/(i-t)-.5)})}return o.contour=h,o.size=function(r){if(!arguments.length)return[s,g];var t=Math.ceil(r[0]),n=Math.ceil(r[1]);if(!(0<t&&0<n))throw new Error("invalid size");return s=t,g=n,o},o.thresholds=function(r){return arguments.length?(u="function"==typeof r?r:Array.isArray(r)?M(v.call(r)):M(r),o):u},o.smooth=function(r){return arguments.length?(a=r?t:w,o):a===t},o}function E(r,t){for(var n=[0].rep(t*t),o=0;o<t;o++)n[o*t+o]=r;return n}function b(r,t,n,o){for(var e,a=Array(n*o),i=0;i<n;i++)for(e=0;e<o;e++)a[i*o+e]=r[i*o+e]+t[i*o+e];return a}function C(r,t,n,o,e){for(var a,i,f=Array(n*e),u=0;u<n;u++)for(a=0;a<e;a++)for(i=f[u*e+a]=0;i<o;i++)f[u*e+a]+=r[u*o+i]*t[i*e+a];return f}function z(r,t){for(var n,o,e=Array(t),a=0;a<t;a++)e[a]=r[a*t+a];for(a=0;a<t;a++){for(n=0;n<a;n++)e[a]-=r[a*t+n]*r[a*t+n];if(e[a]<=0)return;for(e[a]=Math.sqrt(e[a]),n=a+1;n<t;n++){for(o=0;o<a;o++)r[n*t+a]-=r[n*t+o]*r[a*t+o];r[n*t+a]/=e[a]}}for(a=0;a<t;a++)r[a*t+a]=e[a];return 1}function _(r,t){for(var n,o,e,a=0;a<t;a++)for(r[a*t+a]=1/r[a*t+a],n=a+1;n<t;n++){for(e=0,o=a;o<n;o++)e-=r[n*t+o]*r[o*t+a];r[n*t+a]=e/r[n*t+n]}for(a=0;a<t;a++)for(n=a+1;n<t;n++)r[a*t+n]=0;for(a=0;a<t;a++){for(r[a*t+a]*=r[a*t+a],o=a+1;o<t;o++)r[a*t+a]+=r[o*t+a]*r[o*t+a];for(n=a+1;n<t;n++)for(o=n;o<t;o++)r[a*t+n]+=r[o*t+a]*r[o*t+n]}for(a=0;a<t;a++)for(n=0;n<a;n++)r[a*t+n]=r[n*t+a]}function k(r,t){for(var n,o,e,a,i,f,u,h,l,c,s=t,g=Array(t*t),p=Array(t),y=Array(t),d=Array(t),v=0;v<t;v++)for(e=0;e<t;e++)g[v*t+e]=v==e?1:0;for(e=0;e<t;e++)d[e]=0;for(v=0;v<t;v++){for(e=u=0;e<t;e++)if(1!=d[e])for(a=0;a<t;a++)0==d[a]&&Math.abs(r[e*t+a])>=u&&(u=Math.abs(r[e*t+a]),o=e,n=a);if(++d[n],o!=n){for(i=0;i<t;i++)c=r[o*t+i],r[o*t+i]=r[n*t+i],r[n*t+i]=c;for(i=0;i<s;i++)c=g[o*t+i],g[o*t+i]=g[n*t+i],g[n*t+i]=c}if(y[v]=o,0==r[(p[v]=n)*t+n])return;for(l=1/r[n*t+n],r[n*t+n]=1,i=0;i<t;i++)r[n*t+i]*=l;for(i=0;i<s;i++)g[n*t+i]*=l;for(f=0;f<t;f++)if(f!=n){for(h=r[f*t+n],i=r[f*t+n]=0;i<t;i++)r[f*t+i]-=r[n*t+i]*h;for(i=0;i<s;i++)g[f*t+i]-=g[n*t+i]*h}}for(i=t-1;0<=i;i--)if(y[i]!=p[i])for(a=0;a<t;a++)c=r[a*t+y[i]],r[a*t+y[i]]=r[a*t+p[i]],r[a*t+p[i]]=c;return 1}function q(r,t,n,o,e){return t+(o-t)/n*(1-Math.exp(-1/e*Math.pow(r/n,2)))}function N(r,t,n,o,e){return t+(o-t)/n*(1-Math.exp(-1/e*(r/n)))}function V(r,t,n,o,e){return n<r?t+(o-t)/n:t+(o-t)/n*(r/n*1.5-.5*Math.pow(r/n,3))}Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.mean=function(){for(var r=0,t=0;r<this.length;r++)t+=this[r];return t/this.length},Array.prototype.rep=function(r){for(var t=new Array(r),n=this[0],o=0;o<r;o++)t[o]=n;return t},Array.prototype.pip=function(r,t){for(var n=!1,o=0,e=this.length-1;o<this.length;e=o++)this[o][1]>t!=this[e][1]>t&&r<(this[e][0]-this[o][0])*(t-this[o][1])/(this[e][1]-this[o][1])+this[o][0]&&(n=!n);return n};var F={};function s(r,t,n,o){var e=[],a=[],i=[],f=[1e8,1e8,-1e8,-1e8];r.features.forEach(function(r){e.push(r.properties[n]),a.push(r.geometry.coordinates[0]),i.push(r.geometry.coordinates[1]),f[0]>r.geometry.coordinates[0]&&(f[0]=r.geometry.coordinates[0]),f[1]>r.geometry.coordinates[1]&&(f[1]=r.geometry.coordinates[1]),f[2]<r.geometry.coordinates[0]&&(f[2]=r.geometry.coordinates[0]),f[3]<r.geometry.coordinates[1]&&(f[3]=r.geometry.coordinates[1])});o=F.train(e,a,i,o.model,o.sigma2,o.alpha),f=t;return F.getGridInfo(f,o,200)}return F.train=function(r,t,n,o,e,a){var i={t:r,x:t,y:n,nugget:0,range:0,sill:0,A:1/3,n:0};switch(o){case"gaussian":i.model=q;break;case"exponential":i.model=N;break;case"spherical":i.model=V}for(var f,u,h=r.length,l=Array((h*h-h)/2),c=0,s=0;c<h;c++)for(f=0;f<c;f++,s++)l[s]=Array(2),l[s][0]=Math.pow(Math.pow(t[c]-t[f],2)+Math.pow(n[c]-n[f],2),.5),l[s][1]=Math.abs(r[c]-r[f]);l.sort(function(r,t){return r[0]-t[0]}),i.range=l[(h*h-h)/2-1][0];var g=30<(h*h-h)/2?30:(h*h-h)/2,p=i.range/g,y=[0].rep(g),d=[0].rep(g);if(g<30)for(u=0;u<g;u++)y[u]=l[u][0],d[u]=l[u][1];else{for(u=s=f=c=0;c<g&&f<(h*h-h)/2;c++,s=0){for(;l[f][0]<=(c+1)*p&&(y[u]+=l[f][0],d[u]+=l[f][1],s++,!((h*h-h)/2<=++f)););0<s&&(y[u]/=s,d[u]/=s,u++)}if(u<2)return i}h=u,i.range=y[h-1]-y[0];var v=[1].rep(2*h),m=Array(h),M=i.A;for(c=0;c<h;c++){switch(o){case"gaussian":v[2*c+1]=1-Math.exp(-1/M*Math.pow(y[c]/i.range,2));break;case"exponential":v[2*c+1]=1-Math.exp(-1/M*y[c]/i.range);break;case"spherical":v[2*c+1]=y[c]/i.range*1.5-.5*Math.pow(y[c]/i.range,3)}m[c]=d[c]}var A=function(r,t,n){for(var o,e=Array(n*t),a=0;a<t;a++)for(o=0;o<n;o++)e[o*t+a]=r[a*n+o];return e}(v,h,2),w=C(A,v,2,h,2),a=(w=b(w,E(1/a,2),2,2)).slice(0);z(w,2)?_(w,2):(k(a,2),w=a);A=C(C(w,A,2,2,h),m,2,h,1);i.nugget=A[0],i.sill=A[1]*i.range+i.nugget,i.n=t.length;var h=t.length,x=Array(h*h);for(c=0;c<h;c++){for(f=0;f<c;f++)x[c*h+f]=i.model(Math.pow(Math.pow(t[c]-t[f],2)+Math.pow(n[c]-n[f],2),.5),i.nugget,i.range,i.sill,i.A),x[f*h+c]=x[c*h+f];x[c*h+c]=i.model(0,i.nugget,i.range,i.sill,i.A)}A=b(x,E(e,h),h,h),e=A.slice(0);z(A,h)?_(A,h):(k(e,h),A=e);x=A.slice(0),A=C(A,r,h,h,1);return i.K=x,i.M=A,i},F.predict=function(r,t,n){for(var o=Array(n.n),e=0;e<n.n;e++)o[e]=n.model(Math.pow(Math.pow(r-n.x[e],2)+Math.pow(t-n.y[e],2),.5),n.nugget,n.range,n.sill,n.A);return C(o,n.M,1,n.n,1)[0]},F.variance=function(r,t,n){for(var o=Array(n.n),e=0;e<n.n;e++)o[e]=n.model(Math.pow(Math.pow(r-n.x[e],2)+Math.pow(t-n.y[e],2),.5),n.nugget,n.range,n.sill,n.A);return n.model(0,n.nugget,n.range,n.sill,n.A)+C(C(o,n.K,1,n.n,n.n),o,1,n.n,1)[0]},F.getGridInfo=function(r,t,n){for(var o,e,a=[],i=[r[0],r[2]],f=[r[1],r[3]],u=[t.t.min(),t.t.max()],h=i[1]-i[0],l=f[1]-f[0],c=void 0,s=void 0,g=h/(c=n?Math.ceil(n):200),p=l/(s=Math.ceil(c/(h/l))),y=0;y<s;y++)for(var d=0;d<c;d++)o=r[0]+d*g,e=r[1]+y*p,a.push(F.predict(o,e,t));return{grid:a,n:c,m:s,xlim:i,ylim:f,zlim:u,x_resolution:g,y_resolution:p}},F.getVectorContour=function(n,r){var r=h().size([n.n,n.m]).thresholds(r)(n.grid),o={type:"FeatureCollection",features:[]},e=n.xlim[1]-n.xlim[0],a=n.ylim[1]-n.ylim[0];return r.forEach(function(t){t.coordinates.forEach(function(r){r=r.map(function(r){return r.map(function(r){return[n.xlim[0]+e*(+r[0]/n.n),n.ylim[0]+a*(+r[1]/n.m)]})});o.features.push({type:"Feature",properties:{contour_value:t.value},geometry:{type:"Polygon",coordinates:r}})})}),o},F.drawCanvasContour=function(r,t,n,o,e){var a=t.getContext("2d");a.clearRect(0,0,t.width,t.height);for(var i=[n[1]-n[0],o[1]-o[0],r.zlim[1]-r.zlim[0]],f=r.n,u=r.m,h=Math.ceil(r.x_resolution*t.width/(n[1]-n[0])),l=Math.ceil(r.y_resolution*t.height/(o[1]-o[0])),c=0;c<u;c++)for(var s=0;s<f;s++){var g,p,y=c*f+s;null!=r.grid[y]&&(g=t.width*(s*r.x_resolution+r.xlim[0]-n[0])/i[0],p=t.height*(1-(c*r.y_resolution+r.ylim[0]-o[0])/i[1]),(y=(r.grid[y]-r.zlim[0])/i[2])<0?y=0:1<y&&(y=1),a.fillStyle=e[Math.floor((e.length-1)*y)],a.fillRect(Math.round(g-h/2),Math.round(p-l/2),h,l))}},r.exports={getVectorContour:function(r,t,n,o,e){return o=s(r,t,n,o),F.getVectorContour(o,e)}},r.exports});;
Cube("datav:/com/datav-2dmap-isosurface/3.0.7/src/isosurface",[],function(e,t,i,o,r,s){var a=function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e};function n(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return e.exports=function(e){var u=e.map,l=e.L,t=e.Utils,j=e.GuiUtils,C=t._,o=t.RBush,n=t.geojsonBBox,r=t.mergeOptions,h=u.options.offset,_=i("datav:/com/datav-2dmap-isosurface/3.0.7/src/libs/kriging-contour").getVectorContour;return a(s,[{key:"setData",value:function(e){this.data=e,this.range=this.getRange(e);var t,o,r=void 0;for(this._geojson={type:"FeatureCollection",features:[]},r=0;r<this.data.length;r++)o={type:"Feature",properties:{value:+(t=this.data[r]).value||0},geometry:{type:"Point",coordinates:[+t.lng,+t.lat]}},this._geojson.features.push(o);this.genGeojson()}},{key:"setClipArea",value:function(e){this.clipGeojson=e,this.bbox=n(this.clipGeojson),this.genGeojson()}},{key:"setOptions",value:function(e){this.options=r(this.options,e),this.genGeojson()}},{key:"initRbush",value:function(){for(var e,t,o=this.geojson.features,r=void 0,s=[],r=0,i=o.length;r<i;r++)e=o[r],t=n(e),s.push({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],feature:e});this.rbush.dirty=s.length,this.rbush.total=s.length,this.rbush.clear(),0<s.length&&this.rbush.load(s),this.layer.onRender(!0)}},{key:"genGeojson",value:function(){if(this._geojson&&this.clipGeojson&&this.range){var e=C.get(j,"scale.color"),t=C.get(this.options,"graph.colorMapping"),o=[];if(t.scale.custom&&t.scale.domain.length)o=t.scale.domain;else{for(var r=this.range,s=t.scale.range.length,i=(r[1]-r[0])/s,n=r[0];n<r[1];n+=+i.toFixed())o.push(+n.toFixed(0));o.push(r[1])}for(var a=_(this._geojson,this.bbox,"value",{model:"exponential",sigma2:0,alpha:100},o),l=void 0,u=void 0,h=void 0,f=void 0,g=[],c=[],p=[],d=[],l=a.features.length-1;0<=l;l--)a.features[l].properties.value=a.features[l].properties.contour_value,c.push(a.features[l].properties.contour_value),d.push({contour_value:a.features[l].properties.contour_value});for(l=0;l<a.features.length;l++)(f=a.features[l]).geometry&&f.geometry.coordinates&&0<f.geometry.coordinates.length&&g.push(f);this.geojson={type:"FeatureCollection",features:[]};var v=e({config:t,data:d,field:"contour_value"});for(l=0;l<g.length;l++){(f=g[l]).properties._fillColor=v(+f.properties.contour_value);var y=f.geometry,b=y.type,m=y.coordinates;switch(b){case"Polygon":for(u=0;u<m.length;u++)3<=(h=this.project(m[u])).length&&p.push(h);break;case"MultiPolygon":for(u=0;u<m.length;u++)for(k=0;k<m[u].length;k++)3<=(h=this.project(m[u][k])).length&&p.push(h)}f.geometry._coordinates=p,this.geojson.features.push(f)}this.initRbush()}}},{key:"getRange",value:function(e){if(!e.length)return null;var t=e.filter(function(e){return null!=e.value&&!isNaN(+e.value)&&""!==e.value}),e=t.reduce(function(e,t){return+e.value<=+t.value?e:t},{}),t=t.reduce(function(e,t){return+e.value>=+t.value?e:t},{});return[+e.value,+t.value]}},{key:"onRender",value:function(e,t){t&&(this.getFeaturesInBounds(),this.getFeatures()),this.features&&this.clipGeojson&&(this._dataProcess(),this.draw(e))}},{key:"_dataProcess",value:function(){for(var e=void 0,t=void 0,o=void 0,r=void 0,s=void 0,e=0;e<this.clipGeojson.features.length;e++){var s=[],i=this.clipGeojson.features[e].geometry,n=i.type,a=i.coordinates;switch(n){case"Polygon":for(t=0;t<a.length;t++)3<=(r=this.project(a[t])).length&&s.push(r);break;case"MultiPolygon":for(t=0;t<a.length;t++)for(o=0;o<a[t].length;o++)3<=(r=this.project(a[t][o])).length&&s.push(r)}this.clipGeojson.features[e].geometry._coordinates=s}}},{key:"draw",value:function(e){if(this.drawAreas(e),this.clipGeojson){e.globalCompositeOperation="destination-in",e.fillStyle="rgba(0,0,0,1)",e.beginPath();for(var t,o=void 0,o=0;o<this.clipGeojson.features.length;o++)t=this.clipGeojson.features[o],this.drawPolygon(e,t.geometry._coordinates);e.fill(),e.globalCompositeOperation="source-over"}}},{key:"getFeaturesInBounds",value:function(){for(var e,t,o=u.options.paddingBoundsExtent,r=this.rbush.search(o),s=void 0,i=void 0,n=void 0,a=void 0,l=void 0,s=0;s<r.length;s++){switch(t=(e=r[s].feature).geometry.coordinates,l=[],e.geometry.type){case"Polygon":for(i=0;i<t.length;i++)3<=(a=this.project(t[i])).length&&l.push(a);break;case"MultiPolygon":for(i=0;i<t.length;i++)for(n=0;n<t[i].length;n++)3<=(a=this.project(t[i][n])).length&&l.push(a)}r[s].feature.geometry._coordinates=l}return this.rbushInBounds.clear(),this.rbushInBounds.load(r),this.featuresInBounds=r}},{key:"getFeatures",value:function(){for(var e,t=void 0,o=[],r=this.featuresInBounds,t=0;t<r.length;t++)e=r[t].feature,o.push(e);return o=o.sort(function(e,t){return e.properties.contour_value<t.properties.contour_value?-1:e.properties.contour_value==t.properties.contour_value?0:1}),this.features=o,this.features}},{key:"project",value:function(e){for(var t,o,r=this.options.smoothFactor,s=void 0,i=[],n=void 0,a=[],s=0;s<e.length;s++)!(t=e[s])[0]&&0!=t[0]||!t[1]&&0!=t[1]||(o=u.latLngToContainerPoint([t[1],t[0]]),i.push({x:o.x-h.x,y:o.y-h.y}));for(i.length&&(n=l.LineUtil.simplify(i,r)),s=0;s<n.length;s++)a.push([n[s].x,n[s].y]);return a}},{key:"drawAreas",value:function(e){e.shadowColor=null,e.shadowBlur=null,e.globalCompositeOperation="source-over";for(var t=this.options.graph.stroke,o=void 0,r=void 0,s=void 0,i=void 0,i={fill:!0,fillRule:"evenodd",fillColor:(s=Object.assign({},this.features[0].properties))._fillColor||"rgba(2,111,222,0.3)",fillOpacity:1,stroke:!0,strokeColor:t.strokeColor,weight:t.weight,lineJoin:"round",lineCap:"square",dashArray:s.dashArray||t.dashArray||""},o=0;o<this.clipGeojson.features.length;o++)r=this.clipGeojson.features[o],this.drawPolygon(e,r.geometry._coordinates,i);for(o=1;o<this.features.length;o++)switch(r=this.features[o],i={fill:!0,fillRule:"evenodd",fillColor:(s=Object.assign({},r.properties))._fillColor||"rgba(2,111,222,0.3)",fillOpacity:1,stroke:!0,strokeColor:t.strokeColor,weight:t.weight,lineJoin:"round",lineCap:"square",dashArray:s.dashArray||t.dashArray||""},r.geometry.type){case"Polygon":case"MultiPolygon":this.drawPolygon(e,r.geometry._coordinates,i)}}},{key:"drawPolygon",value:function(e,t,o){if(t&&0!==t.length){e.beginPath();for(var r,s=void 0,i=void 0,s=0;s<t.length;s++){for(i=0;i<t[s].length;i++)r=t[s][i],e[i?"lineTo":"moveTo"](r[0],r[1]);e.closePath()}o&&this.fillStroke(e,o)}}},{key:"fillStroke",value:function(e,t){var o;t.fill&&(e.globalAlpha=t.fillOpacity,e.fillStyle=t.fillColor||t.color,e.fill(t.fillRule||"evenodd")),t.stroke&&0!==t.weight&&(e.setLineDash&&(o=this.getDashArray(t)||[],e.setLineDash(o)),e.globalAlpha=t.opacity,e.lineWidth=t.weight,e.strokeStyle=t.strokeColor,e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.stroke())}},{key:"getDashArray",value:function(e){if(""===e.dashArray)r=[];else if("string"==typeof e.dashArray)for(var t,o=e.dashArray.split(/[, ]+/),r=[],s=0;s<o.length;s++){if(t=Number(o[s]),isNaN(t))return;r.push(t)}else r=e.dashArray||[];return r}}]),s;function s(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.options=r({zIndex:0,tolerance:3,smoothFactor:1},e),this.setOptions(this.options),this.rbush=new o,this.rbush.dirty=0,this.rbush.total=0,this.rbushInBounds=new o,this.featuresInBounds=[],this.features=[],this.genGeojson=this.genGeojson.bind(this),this.initRbush=this.initRbush.bind(this)}},e.exports});;
Cube("datav:/com/datav-2dmap-isosurface/3.0.7/config",[],function(o,r,a,e,i,l){return o.exports={DEFAULT_OPTIONS:{renderer:"canvas",visibility:!0,tolerance:0,smoothFactor:1,general:{zoomRange:[0,18],minZoom:0,maxZoom:22,opacity:1},graph:{fill:{minFillColor:"rgba(5, 96, 125, 0.8)",maxFillColor:"rgba(0, 255, 240, 0.5)"},colorLevel:10,stroke:{color:"#fff",weight:1,dashArray:""}}}},o.exports});;
Cube("datav:/com/datav-2dmap-isosurface/3.0.7/src/isosurfaceLayer",["datav:/npm/safely-merge/1.0.1"],function(e,t,s,o,n,i){var l=function(e,t,o){return t&&r(e.prototype,t),o&&r(e,o),e};function r(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,o){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0!==n){if("value"in n)return n.value;n=n.get;return void 0!==n?n.call(o):void 0}if(null!==(e=Object.getPrototypeOf(e)))return u(e,t,o)}s("datav:/npm/safely-merge/1.0.1");return e.exports=function(e){e.L;var o=e.map,t=e.Utils,n=e.Layer,i=t.mergeOptions,r=s("datav:/com/datav-2dmap-isosurface/3.0.7/src/isosurface")(e);return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,n),l(a,[{key:"init",value:function(){this.geojson=null,this.clipGeojson=null;var e=i({zIndex:0},this.options);this.isosurface=new r(e),(this.isosurface.layer=this).addLayer(this.isosurface)}},{key:"render",value:function(e){e&&e.length&&(this.data=e||[],this.isosurface.setData(e),this.onRender(!0))}},{key:"setClipArea",value:function(e){this.isosurface.setClipArea(e),this.onRender(!0)}},{key:"updateOptions",value:function(e){this.options=i({},e),this.options.general.minZoom=e.general.zoomRange[0],this.options.general.maxZoom=e.general.zoomRange[1],this.isosurface.setOptions(this.options)}},{key:"draw",value:function(e){var t=this.options.general;e.globalAlpha=.01*t.opacity,this.container&&e.drawImage(this.container,0,0,this.container.width,this.container.height)}},{key:"show",value:function(){this.onRender(!0),this.options.visibility=!0}},{key:"hide",value:function(){u(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"hide",this).call(this),this.options.visibility=!1}},{key:"destroy",value:function(){this.options=null,delete this.options}}]),a;function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return t.addTo(o),t.options=i({},e),t.options.general.minZoom=e.general.zoomRange[0],t.options.general.maxZoom=e.general.zoomRange[1],t.options.visibility=!0,t.init(),t}},e.exports});;
Cube("datav:/com/datav-2dmap-isosurface/3.0.7",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(e,t,i,o,r,a){var n=function(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e};function s(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var l=i("datav:/npm/eventemitter3/3.0.0"),y=i("datav:/npm/safely-merge/1.0.1"),u=i("datav:/com/datav-2dmap-isosurface/3.0.7/src/isosurfaceLayer"),h=i("datav:/com/datav-2dmap-isosurface/3.0.7/config").DEFAULT_OPTIONS,n=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(p,l),n(p,[{key:"addTo",value:function(e,t){this.options.id=t;e=u(e);return this.layer=new e(this.options),this}},{key:"onRender",value:function(e){this.layer&&this.layer.onRender&&this.layer.onRender(e)}},{key:"resize",value:function(e,t){this.layer&&this.layer.resize&&this.layer.resize(e,t)}},{key:"render",value:function(e){var t=[],i=0;if(e&&e.length){for(var o,r=void 0,r=0;r<e.length;r++)o=e[r],Number.isFinite(parseFloat(o.lng))&&Number.isFinite(parseFloat(o.lat))?t.push(o):i++;0<i&&console.log("等值面层：有 "+i+" 条异常数据。")}this.layer&&this.layer.render&&this.layer.render(t)}},{key:"setClipArea",value:function(e){this.layer&&this.layer.setClipArea&&this.layer.setClipArea(e)}},{key:"updateOptions",value:function(e){e=e.options;this.options=y(this.options,e),this.options.general.minZoom=e.general.zoomRange[0],this.options.general.maxZoom=e.general.zoomRange[1],this.layer&&this.layer.updateOptions&&this.layer.updateOptions(this.options)}},{key:"draw",value:function(e){this.layer&&this.layer.draw&&this.layer.draw(e)}},{key:"show",value:function(){this.options.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.options.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"destroy",value:function(){this.layer&&this.layer.destroy&&this.layer.destroy(),this.layer=null,delete this.layer}}]),p);function p(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(p.__proto__||Object.getPrototypeOf(p)).call(this)),t=t.options;return i.options=y(h,t),i.options.general.minZoom=t.general.zoomRange[0],i.options.general.maxZoom=t.general.zoomRange[1],i.options.visibility=!0,i}return e.exports=n,e.exports});