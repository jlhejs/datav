// env=undefined => env=publish 
Cube("datav:/com/map3d-plane-flyingline/0.2.10/data_buffer",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=c("datav:/npm/safely-merge/1.0.1"),j=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.datas=[],f.loopIndex=0,f.dataIndex=0,f.options=i({maxLength:2e3,updateInterval:1,updateStep:2},c),f}return f(b,a),g(b,[{key:"bindTo",value:function(a){this.visualizer=a,this.tryStart()}},{key:"clean",value:function(){this.loopIndex=0,this.dataIndex=0,this.datas=[],window.cancelAnimationFrame(this.loopId)}},{key:"tryStart",value:function(){this.loopId||!this.visualizer||this.loop()}},{key:"data",value:function(a){this.datas=[],this.datas=a,this.resume()}},{key:"stop",value:function(){this.isStop=!0}},{key:"resume",value:function(){this.isStop=!1}},{key:"check",value:function(){var a,b=this.options.maxLength,c=this.datas;c.length<b||(a=c.length-b,c.splice(0,a))}},{key:"loop",value:function(){var a=this.options.updateInterval;0===this.loopIndex%a&&this.update(),this.loopIndex++,this.loopId=window.requestAnimationFrame(this.loop.bind(this))}},{key:"setUpdateSpeed",value:function(a){this.options.updateStep=a}},{key:"shuffle",value:function(c){var a,d,e,f=c.slice(0);for(e=f.length;e;e--)a=Math.floor(Math.random()*e),d=f[e-1],f[e-1]=f[a],f[a]=d;return f}},{key:"update",value:function(){if(!this.isStop){var a=this.options.updateStep,b=this.visualizer;if(b){var c=this.options.maxLength,e=this.datas;if(e.length){for(var f,d=this.shuffle(e),g=e.length-1;g>=e.length-a;g--)f=d[g],b.data([f]);this.check()}}}}},{key:"render",value:function(){}}]),b}(h);return a.exports=j,a.exports});;
Cube("datav:/com/map3d-plane-flyingline/0.2.10",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1","datav:/npm/dmap/0.2.9"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/npm/dmap/0.2.9"),l=j.THREE,k=c("datav:/com/map3d-plane-flyingline/0.2.10/data_buffer"),m=j.FlyingLines,n=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=i({maxLengthDataPool:500,updateIntervalDataPool:1,updateStepDataPool:2,lifeSpeed:0.01,kHeight:1.3,kHeightJitter:0.5,hue:0.8,range:0.3,weight:2,color:function(a,b){b=1-b;var c=this.hue;return new l.Color().setHSL(c,1-0.4*b,0.3+0.5*Math.pow(b,8))},indensty:3,opacity:function(a){return a=1-a,0.99<a?1:1*Math.pow(a,3)},visibility:!0},c),f.initDataPool(),f}return f(b,a),g(b,[{key:"addTo",value:function(a){a._map&&(a=a._map),this._map=a;var b=this.getLayerOptions(),c=this.layer=new m(b);c.addTo(this._map),this.dataPool.bindTo(c)}},{key:"initDataPool",value:function(){var a=this.options;this.dataPool=new k({maxLength:a.maxLengthDataPool,updateInterval:a.updateIntervalDataPool,updateStep:a.updateStepDataPool})}},{key:"getLayerOptions",value:function(){var a=Object.assign({},this.options);return{lifeSpeed:a.lifeSpeed/500,weight:a.weight,flying:{kHeight:a.kHeight,indensty:a.indensty,range:a.range,style:{hue:a.hue,color:a.color,opacity:a.opacity}}}}},{key:"updateOptions",value:function(a){a&&(a=this.options=i(this.options,a)),this.updateDataPoolSpeed(),this.layer.updateOptions(this.getLayerOptions())}},{key:"updateDataPoolSpeed",value:function(){this.dataPool.setUpdateSpeed(this.options.updateStepDataPool)}},{key:"render",value:function(a){a&&(this.data=a,this.dataPool&&this.dataPool.data(a),this.options.visibility?this.show():this.hide())}},{key:"show",value:function(){this.options.visibility=!0,this.layer.updateOptions(this.getLayerOptions()),this.dataPool&&this.dataPool.resume()}},{key:"hide",value:function(){this.options.visibility=!1;var a=Object.assign({},this.getLayerOptions());a.flying.style.opacity=0,a.weight=0,this.layer.updateOptions(a),this.dataPool&&this.dataPool.stop()}},{key:"remove",value:function(){this.dataPool&&this.dataPool.clean(),this.layer&&this.layer.remove()}}]),b}(h);return a.exports=n,a.exports});