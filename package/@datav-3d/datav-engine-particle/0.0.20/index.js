// env=undefined => env=publish 
Cube("datav:/com/@datav-3d/datav-engine-particle/0.0.20/shader/pick.frag.glsl",[],function(a){return a.exports="#define GLSLIFY 1\nuniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nflat in vec3 vIdColor;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\tgl_FragColor = vec4(vIdColor, 1.0);\n}",a.exports});;
Cube("datav:/com/@datav-3d/datav-engine-particle/0.0.20/shader/point.frag.glsl",[],function(a){return a.exports="#define GLSLIFY 1\nuniform vec3 diffuse;\nuniform float opacity;\nuniform float pickedId;\nuniform vec3 pickedColor;\nuniform float pickedOpacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nflat in float vId;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tbool isPicked = pickedId > vId - 0.5 && pickedId < vId + 0.5;\n\tvec4 diffuseColor = isPicked ? vec4( 1.0, 1.0, 1.0, pickedOpacity ) : vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = isPicked ? pickedColor : diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",a.exports});;
Cube("datav:/com/@datav-3d/datav-engine-particle/0.0.20/shader/pick.vert.glsl",[],function(a){return a.exports="#define GLSLIFY 1\nattribute vec3 idColor;\n\nuniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nflat out vec3 vIdColor;\n\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\tvIdColor = idColor;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",a.exports});;
Cube("datav:/com/@datav-3d/datav-engine-particle/0.0.20/shader/point.vert.glsl",[],function(a){return a.exports="#define GLSLIFY 1\nattribute float id;\n\nuniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nflat out float vId;\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\tvId = id;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",a.exports});;
Cube("datav:/com/@datav-3d/datav-engine-particle/0.0.20/pickmaterial",[],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();return a.exports=function(a){var b=function(){function b(){d(this,b),this._material=new a.PointsMaterial({}),this._material.onBeforeCompile=function(a){a.vertexShader=c("datav:/com/@datav-3d/datav-engine-particle/0.0.20/shader/pick.vert.glsl"),a.fragmentShader=c("datav:/com/@datav-3d/datav-engine-particle/0.0.20/shader/pick.frag.glsl")}}return e(b,[{key:"dispose",value:function(){this._material&&(this._material.dispose(),this._material=null)}},{key:"size",set:function(a){this._material&&(this._material.size=a)}},{key:"map",set:function(a){this._material&&(this._material.map=a)}},{key:"material",get:function(){return this._material}},{key:"needsUpdate",set:function(a){this._material&&(this._material.needsUpdate=a)}}]),b}();return b},a.exports});;
Cube("datav:/com/@datav-3d/datav-engine-particle/0.0.20/material",[],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();return a.exports=function(a,b){var f=function(){function f(){var b=this;d(this,f),this._pickedColor={value:new a.Color},this._pickedId={value:0},this._pickedOpacity={value:0},this._material=new a.PointsMaterial({depthWrite:!1,transparent:!0}),this._material.onBeforeCompile=function(a){var d=a.uniforms;a.vertexShader=c("datav:/com/@datav-3d/datav-engine-particle/0.0.20/shader/point.vert.glsl"),a.fragmentShader=c("datav:/com/@datav-3d/datav-engine-particle/0.0.20/shader/point.frag.glsl"),d.pickedId=b._pickedId,d.pickedColor=b._pickedColor,d.pickedOpacity=b._pickedOpacity,b._uniforms=d}}return e(f,[{key:"dispose",value:function(){this._material&&(this._material.dispose(),this._material=null)}},{key:"size",set:function(a){this._material&&(this._material.size=a)}},{key:"color",set:function(a){a=b(a).gl(),this._material&&this._material.color.fromArray(a)}},{key:"opacity",set:function(a){this._material&&(this._material.opacity=a)}},{key:"pickedId",set:function(a){this._pickedId.value=a}},{key:"pickedColor",set:function(a){a=b(a).gl(),this._pickedColor.value.fromArray(a)}},{key:"pickedOpacity",set:function(a){this._pickedOpacity.value=a}},{key:"map",set:function(a){this._material&&(this._material.map=a)},get:function(){return this._material?this._material.map:null}},{key:"blending",set:function(a){this._material&&(this._material.blending=a)}},{key:"material",get:function(){return this._material}},{key:"needsUpdate",set:function(a){this._material&&(this._material.needsUpdate=a)}}]),f}();return f},a.exports});;
Cube("datav:/com/@datav-3d/datav-engine-particle/0.0.20/particle",[],function(a,b,c){function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function g(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;return void 0===g?void 0:g.call(d)};return a.exports=function(a){var b=a.THREE,j=a.Utils,k=c("datav:/com/@datav-3d/datav-engine-particle/0.0.20/material")(b,j.Chroma),l=c("datav:/com/@datav-3d/datav-engine-particle/0.0.20/pickmaterial")(b),m=new b.TextureLoader;m.setCrossOrigin("anonymous");var n=new b.Box3,o=new b.Color;return function(c){function p(a){e(this,p);var b=f(this,(p.__proto__||Object.getPrototypeOf(p)).call(this));return b.options=j.mergeOptions({visible:!0,sceneNames:[{sceneName:"main"}],interactive:{enableInteractive:!1,callbackId:"",color:"rgb(255, 0, 0)",opacity:1},blendingType:"NormalBlending"},a||{}),b.classNameAlias="ParticleLayer",b}return g(p,c),h(p,[{key:"init",value:function(){this.group.ignoreWaterReflection=!0,this._propertiesData=[],this._styles=new Map,this._textureCache=new Map,this._materials=new Map,this._pickMaterials=new Map,this._typeInfo=new Map,this._center=new b.Vector3,this._eventCnt=0,this.initPick(),this.updateMaterial()}},{key:"initPick",value:function(){var c=this;this.gpuPicker=a.interactiveGPU,this.gpuPicker._container.removeEventListener("click",this.gpuPicker.interactive),this.gpuPicker.interactive=function(){},this.gpuPicker._container.addEventListener("click",function(a){a.preventDefault(),c._eventCnt++,c.gpuPicker._mouse.set(a.offsetX,a.offsetY),c.gpuPicker.emit("clicked")},!1),this.pickScene=new b.Scene,this.pickedData=[],this.pick=this.pick.bind(this),this.gpuPicker.on("clicked",this.pick)}},{key:"addTo",value:function(a){i(p.prototype.__proto__||Object.getPrototypeOf(p.prototype),"addTo",this).call(this,a),this.init()}},{key:"show",value:function(){this.options.visible=!0,i(p.prototype.__proto__||Object.getPrototypeOf(p.prototype),"show",this).call(this)}},{key:"hide",value:function(){this.options.visible=!1,i(p.prototype.__proto__||Object.getPrototypeOf(p.prototype),"hide",this).call(this)}},{key:"fetchTexture",value:function(a){var b=this._textureCache.get(a);return b||(b=new Promise(function(b,c){m.load(a,b,null,c)}),this._textureCache.set(a,b)),b}},{key:"pick",value:function(){if(this.options.interactive.enableInteractive&&0!==this._eventCnt&&this.options.visible){this._eventCnt--;var a=this.gpuPicker.pixelBuffer,b=this.gpuPicker._engine,c=b.camera,d=b.renderer,e=d.getPixelRatio(),f=d.getContext().drawingBufferWidth,g=d.getContext().drawingBufferHeight,h=0|parseInt(this.gpuPicker._mouse.x,10)*e,i=0|parseInt(this.gpuPicker._mouse.y,10)*e;this.gpuPicker._pickingRT.setSize(f,g);var j=d.getClearColor(),k=d.getClearAlpha(),l=d.getRenderTarget();d.setClearColor(0,1),d.setRenderTarget(this.gpuPicker._pickingRT),d.clear(),d.render(this.pickScene,c),d.setClearColor(j,k),d.setRenderTarget(l),d.readRenderTargetPixels(this.gpuPicker._pickingRT,h,g-i-1,1,1,a);var m=a[0]<<16|a[1]<<8|a[2];if(this._defaultMaterial.pickedId=m,this._materials.forEach(function(a){a.pickedId=m}),0<m){var n=this._propertiesData[m-1],o=this.options.interactive.callbackId;this.emit("pick",{id:o,data:n,callbackData:n[o],clickPosition:{x:this.gpuPicker._mouse.x,y:this.gpuPicker._mouse.y}})}}}},{key:"setData",value:function(a){var c=this;this.disposeGeometry(),this._propertiesData.length=0,this._typeInfo.clear();var e=[],f=[],g=[],h=0;a.forEach(function(a){var b=a.type;b="string"===typeof b?b:""+b,c._typeInfo.has(b)?c._typeInfo.get(b).count++:c._typeInfo.set(b,{index:h++,count:1})}),a.sort(function(d,a){var b="string"===typeof d.type?d.type:""+d.type,e="string"===typeof a.type?a.type:""+a.type;return c._typeInfo.get(b).index-c._typeInfo.get(e).index}),h=0,a.forEach(function(a){var b=a.x,i=a.y,j=a.z;if(b="string"===typeof b?parseFloat(b):b,i="string"===typeof i?parseFloat(i):i,j="string"===typeof j?parseFloat(j):j,"number"===typeof b&&"number"===typeof i&&"number"===typeof j){e.push.apply(e,d(c.getProjPos(b,i,j))),c._propertiesData.push(a);var k=++h;o.setHex(k),f.push(k),g.push(o.r,o.g,o.b)}}),n.setFromArray(e),n.getCenter(this._center);for(var j=2,i=e.length;j<i;j+=3)e[j-2]-=this._center.x,e[j-1]-=this._center.y,e[j]-=this._center.z;var k=new b.BufferGeometry;k.setAttribute("id",new b.BufferAttribute(new Float32Array(f),1)),k.setAttribute("idColor",new b.BufferAttribute(new Float32Array(g),3)),k.setAttribute("position",new b.BufferAttribute(new Float32Array(e),3)),this.geometry=k,this.updateParticle()}},{key:"getMaterial",value:function(a){var b=this._defaultMaterial;return this._styles.has(a)&&(b=this._materials.get(a),!b&&(b=new k,this._materials.set(a,b))),b}},{key:"getPickMaterial",value:function(a){var b=this._defaultPickMaterial;return this._styles.has(a)&&(b=this._pickMaterials.get(a),!b&&(b=new l,this._pickMaterials.set(a,b))),b}},{key:"updateParticle",value:function(){var a=this;if(this.geometry){var c=0,d=[],e=[];this.geometry.clearGroups(),this._typeInfo.forEach(function(b,f){d.push(a.getMaterial(f).material),e.push(a.getPickMaterial(f).material),a.geometry.addGroup(c,b.count,b.index),c+=b.count}),this.particle?(this.particle.geometry=this.geometry,this.particle.material=d,this.pickParticle.geometry=this.geometry,this.pickParticle.material=e):(this.particle=new b.Points(this.geometry,d),this.particle.frustumCulled=!1,this.particle.matrixAutoUpdate=!1,this.addObject(this.particle),this.pickParticle=new b.Points(this.geometry,e),this.pickParticle.frustumCulled=!1,this.pickParticle.matrixAutoUpdate=!1,this.pickScene.add(this.pickParticle)),this.particle.position.copy(this._center),this.particle.matrix.setPosition(this.particle.position),this.pickParticle.position.copy(this._center),this.pickParticle.matrix.setPosition(this.particle.position)}}},{key:"updateDefaultStyle",value:function(){var a=this,c=this.options,d=c.defaultStyle,e=c.interactive,f=c.blendingType;this._defaultMaterial||(this._defaultMaterial=new k,this._defaultPickMaterial=new l),this._defaultMaterial.pickedColor=e.color,this._defaultMaterial.pickedOpacity=e.opacity,this._defaultMaterial.color=d.color,this._defaultMaterial.opacity=d.opacity,this._defaultMaterial.size=d.size,this._defaultMaterial.blending=b[f],this._defaultPickMaterial.size=d.size,d.icon?this.fetchTexture(d.icon).then(function(c){c&&(c.encoding=b.sRGBEncoding,a._defaultMaterial.map=c,a._defaultPickMaterial.map=c,a._defaultMaterial.needsUpdate=!0,a._defaultPickMaterial.needsUpdate=!0)}):this._defaultMaterial.map&&(this._defaultMaterial.map=null,this._defaultPickMaterial.map=null,this._defaultMaterial.needsUpdate=!0,this._defaultPickMaterial.needsUpdate=!0)}},{key:"updateStyle",value:function(){var a=this,c=this.options,d=c.style,e=c.interactive,f=c.blendingType;this._styles.clear(),d.forEach(function(c){a._styles.set(c.particleType,!0);var d=a.getMaterial(c.particleType),g=a.getPickMaterial(c.particleType);d.pickedColor=e.color,d.pickedOpacity=e.opacity,d.color=c.color,d.opacity=c.opacity,d.size=c.size,d.blending=b[f],g.size=c.size,c.icon?a.fetchTexture(c.icon).then(function(a){a&&(a.encoding=b.sRGBEncoding,d.map=a,g.map=a,d.needsUpdate=!0,g.needsUpdate=!0)}):d.map&&(d.map=null,g.map=null,d.needsUpdate=!0,g.needsUpdate=!0)})}},{key:"updateMaterial",value:function(){this.updateDefaultStyle(),this.updateStyle(),this.updateParticle()}},{key:"updateOptions",value:function(a){this.options=j.mergeOptions(this.options,a||{}),this.updateMaterial()}},{key:"disposeGeometry",value:function(){this.geometry&&(this.geometry.dispose(),this.geometry=null)}},{key:"disposeTextures",value:function(){this._textureCache.forEach(function(a){a.then(function(a){a.dispose(),a.image&&a.image.src&&(a.image.src="")})}),this._textureCache.clear()}},{key:"disposeMaterial",value:function(){this._defaultPickMaterial.dispose(),this._defaultMaterial.dispose(),this._materials.forEach(function(a){a.dispose()}),this._materials.clear(),this._pickMaterials.forEach(function(a){a.dispose()}),this._pickMaterials.clear()}},{key:"remove",value:function(){this.disposeMaterial(),this.disposeGeometry(),this.disposeTextures(),this.particle&&(this.removeObject(this.particle),this.particle=null)}}]),p}(a.Layer)},a.exports});;
Cube("datav:/com/@datav-3d/datav-engine-particle/0.0.20",["datav:/npm/eventemitter3/3.0.0"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=c("datav:/com/@datav-3d/datav-engine-particle/0.0.20/particle"),j=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=c,f.pick=f.pick.bind(f),f}return f(b,a),g(b,[{key:"addTo",value:function(a){this.viewer=a,this.initLayer()}},{key:"initLayer",value:function(){var a=i(this.viewer);this.layer=new a(this.options),this.layer.addTo(this.viewer),this.layer.on("pick",this.pick)}},{key:"pick",value:function(a){this.emit("global_var",a.id,a.callbackData),this.emit("interactive",{data:a.data,clickPosition:a.clickPosition}),console.log(a)}},{key:"setData",value:function(a){a&&this.layer&&this.layer.setData(a)}},{key:"show",value:function(){this.layer&&this.layer.show()}},{key:"hide",value:function(){this.layer&&this.layer.hide()}},{key:"updateOptions",value:function(a){this.layer&&this.layer.updateOptions(a)}},{key:"getThemableConfig",value:function(a){var b=a.point.scatterColors,c={defaultStyle:{color:0<b.length?b[0]:this.options.defaultStyle.color,opacity:1},style:[]};return this.options.style.forEach(function(a,d){c.style.push({color:b.length>d?b[d]:a.color,opacity:1})}),c}},{key:"destroy",value:function(){this.layer&&(this.layer.off("pick"),this.layer.remove(),this.layer=null)}}]),b}(h);return a.exports=j,a.exports});