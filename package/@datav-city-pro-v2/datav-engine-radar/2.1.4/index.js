// env=undefined => env=publish 
Cube("datav:/com/@datav-city-pro-v2/datav-engine-radar/2.1.4/shaders/radar.frag.glsl",[],function(n,t,o,e,l,a){return n.exports="#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\n#define halfPi 1.57079\n#include <logdepthbuf_pars_fragment>\n\nuniform sampler2D uTexture;\nuniform float uTimeCounter;\nuniform float uAngle;\nuniform vec4 uColor;\n// uniform float uOpacity;\nuniform float uLight;\nuniform vec4 uActiveColor;\nvarying vec2 vUv;\nflat varying int vPick; // 待恢复 \n\nvec2 rotateUv(float angle,vec2 uv);\nfloat calOpacityByPolarDistance(float polarLength,float startPoint);\nfloat calculateHightColor(float uvPosition,float thickness,float intensity);\nfloat calculateTimeGapOpacity(float timeCounter);\n// float softPolarEdge(float innerPoint, float outPoint, float edgelength);\nfloat softInnerPolarEdge(float polar,float startPoint,float edgelength);\nfloat softOutPolarEdge(float polar,float startPoint,float edgelength);\nfloat tweenBounceOut(float k);\nfloat tweenBounceIn(float k);\nfloat tweenBounceInOut(float k);\n\nvoid main(){\n  #include <logdepthbuf_fragment>\n  \n  //draw the outside bubble ring\n  vec2 polarSt=vec2(atan(vUv.y-.5,vUv.x-.5),distance(vUv,vec2(.5,.5)));\n\n  \n  float thickness=.6;\n  float intensity=1.5;\n  float col=25.;//25.\n  float uvY=polarSt.y*col;\n  \n  float fractUvY=fract(uvY+uTimeCounter);\n  float centerY=.5;\n  float ringColor=calculateHightColor(fractUvY,thickness,intensity);\n  \n  \n  //draw the rotating radar wave with texture\n  vec2 rotatedUv=rotateUv(uAngle,vUv);\n  gl_FragColor=texture2D(uTexture,rotatedUv);\n  \n  //compose radar wave, bubble ring, bubbles\n  float bubbleCircleColor=0.;\n  \n  // outer bubble rings\n  if(polarSt.y<=.5 && polarSt.y>=.4 ){  \n    bubbleCircleColor=ringColor*softOutPolarEdge(polarSt.y,.45,.05)*softInnerPolarEdge(polarSt.y,.4,.02);  \n    bubbleCircleColor*=calculateTimeGapOpacity(uAngle);\n  }\n  \n  // inner bubble near the center\n  if(polarSt.y<=.05){\n    bubbleCircleColor=ringColor*softOutPolarEdge(polarSt.y,.03,.02);\n  }\n  \n  float spreadRingColor = 0.0;\n  // two gradient circles spread from center to border\n  if(polarSt.y < 0.4 && polarSt.y > .05){\n    bubbleCircleColor = 0.0;  \n\n    float uAngleFnValue = 0.38 * cos(mod(uAngle * 0.5, halfPi));\n    if(polarSt.y < uAngleFnValue + .02){\n      bubbleCircleColor = min(pow(polarSt.y / uAngleFnValue, 2.0), 1.0);\n      bubbleCircleColor *= softOutPolarEdge(polarSt.y ,uAngleFnValue, .02);\n      bubbleCircleColor *= 1.0 - uAngleFnValue / 0.47; //fade the circle when approaching border\n    } \n\n    float uAngleFnValue2 = 0.38 * cos(mod(uAngle * 0.5+ halfPi*0.5, halfPi));\n    if(polarSt.y < uAngleFnValue2 + .02){\n      float bubbleCircleColor2 = min(pow(polarSt.y / uAngleFnValue2, 2.0), 1.0);\n      bubbleCircleColor2 *= softOutPolarEdge(polarSt.y ,uAngleFnValue2, .02);\n      bubbleCircleColor2 *= 1.0 - uAngleFnValue2 / 0.47; //fade the circle when approaching border\n      bubbleCircleColor += bubbleCircleColor2;\n    } \n   \n    // thin rings spread from center to border\n    float thinRingHalfWidth = .01;\n    //first inner thin ring\n    float r1 = uAngleFnValue * 0.33;\n    if(abs(polarSt.y - r1) < thinRingHalfWidth){\n      spreadRingColor = 0.6 * softOutPolarEdge(polarSt.y, r1, thinRingHalfWidth) * softInnerPolarEdge(polarSt.y, r1-thinRingHalfWidth, thinRingHalfWidth); \n    }\n    //second inner thin ring\n    float r2 = uAngleFnValue *0.66;\n    if(abs(polarSt.y - r2) < thinRingHalfWidth){\n      spreadRingColor = 0.6 * softOutPolarEdge(polarSt.y, r2, thinRingHalfWidth) * softInnerPolarEdge(polarSt.y, r2-thinRingHalfWidth, thinRingHalfWidth); \n    }\n\n  }\n  \n  gl_FragColor += bubbleCircleColor + spreadRingColor;\n  \n  //color the gray\n  vec4 colorMask = vec4(0.);\n\n  //后期渲染模块会统一做gamma校正，\n  //为了图元渲染颜色和配置项设置颜色保持一致，需要做以下处理以抵消\n\tvec4 uActiveColor2 = vec4(pow(uActiveColor.r, 2.2), pow(uActiveColor.g, 2.2),pow(uActiveColor.b, 2.2), uActiveColor.a);\n\tvec4 uColor2 = vec4(pow(uColor.r, 2.2), pow(uColor.g, 2.2),pow(uColor.b, 2.2), uColor.a);\n\n  // 待恢复pick\n  if(vPick ==1){\n    colorMask = uActiveColor2;\n  }else{\n    colorMask = uColor2;\n  }\n  \n  gl_FragColor*=colorMask;\n  \n  gl_FragColor*=uLight;\n  \n  #include <premultiplied_alpha_fragment>\n}\n\nvec2 rotateUv(float angle,vec2 uv){\n  vec2 coord=uv;\n  \n  float sin_factor=sin(angle);\n  float cos_factor=cos(angle);\n  \n  // coord = vec2((coord.x - 0.5), (coord.y - 0.5)) * mat2(cos_factor, sin_factor, -sin_factor, cos_factor);\n  \n  coord=(coord-.5) * mat2(cos_factor,sin_factor,-sin_factor,cos_factor);\n  \n  coord+=.5;\n  \n  return coord;\n}\n\n// float softPolarEdge(float polar, float innerPoint, float outPoint, float edgelength) {\n  //   if((outPoint - innerPoint) < edgelength * 2.0) {\n    //     return 0.0;\n  //   }\n  \n  //   if(polar >= innerPoint) {\n    \n  //   }\n// }\n\nfloat calculateHightColor(float uvPosition,float thickness,float intensity){\n  float e=(.5-abs(uvPosition-.5))/.5;\n  return pow(e*thickness,intensity);\n}\n\nfloat calOpacityByPolarDistance(float polarLength,float startPoint){\n  float totalPolarLength=.5;\n  float opacity=1.;\n  if(polarLength>startPoint){\n    float distancePercent=(totalPolarLength-polarLength)/(totalPolarLength-startPoint);\n    return pow(distancePercent,2.);\n  }else{\n    return 1.;\n  }\n}\n\nfloat softInnerPolarEdge(float polar,float startPoint,float edgelength){\n  if(polar>=startPoint&&polar<=(startPoint+edgelength)){\n    float distancePercent=(polar-startPoint)/edgelength;\n    return pow(distancePercent,3.);\n  }else{\n    return 1.;\n  }\n}\n\nfloat softOutPolarEdge(float polar,float startPoint,float edgelength){\n  if(polar>=startPoint&&polar<=(startPoint+edgelength)){\n    float distancePercent=(startPoint+edgelength-polar)/edgelength;\n    return pow(distancePercent,3.);\n  }else{\n    return 1.;\n  }\n}\n\nfloat calculateTimeGapOpacity(float timeCounter){\n  float opacity=sin(timeCounter);\n  if(opacity>0.){\n    return opacity;\n  }else{\n    return 0.;\n  }\n}\n\nfloat tweenBounceOut(float k){\n  if(k<(1./2.75)){\n    return 7.5625*k*k;\n  }else if(k<(2./2.75)){\n    return 7.5625*(k-=(1.5/2.75))*k+.75;\n  }else if(k<(2.5/2.75)){\n    return 7.5625*(k-=(2.25/2.75))*k+.9375;\n  }else{\n    return 7.5625*(k-=(2.625/2.75))*k+.984375;\n  }\n}\n\nfloat tweenBounceIn(float k){\n  return 1.-tweenBounceOut(1.-k);\n}\n\nfloat tweenBounceInOut(float k){\n  if(k<.5){\n    return tweenBounceIn(k*2.)*.5;\n  }\n  \n  return tweenBounceOut(k*2.-1.)*.5+.5;\n}",n.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-radar/2.1.4/shaders/radar.vert.glsl",[],function(n,i,t,e,r,a){return n.exports="#define GLSLIFY 1\n#include <logdepthbuf_pars_vertex>\n\nuniform int uPickCount;\nuniform int uPickIds[20]; //must be constant\n\nvarying vec2 vUv;\nflat varying int vPick;\n\nvoid main() {\n  vUv = uv;\n  vPick = 0;\n   \n  vec4 transformed = vec4(position, 1.0);\n  #ifdef USE_INSTANCING\n    for(int i=0; i<uPickCount; i++){\n      if(uPickIds[i] == gl_InstanceID){\n          vPick = 1;\n          break;\n      }\n    }\n\n    transformed = instanceMatrix * transformed;\n  #endif\n\n  gl_Position = projectionMatrix * modelViewMatrix * transformed;\n\n  #include <logdepthbuf_vertex>\n}",n.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-radar/2.1.4/shaders/sequenceFrame.frag.glsl",[],function(e,n,t,r,a,u){return e.exports="#ifdef GL_ES\n  precision highp float;\n#define GLSLIFY 1\n#endif\n\n#include <common>\n#include <logdepthbuf_pars_fragment>\n\nuniform sampler2D uTexture;\nuniform float uOpacity;\nuniform vec2 uTextureSegments; //horizontal and verticle segments of a texture, as frames of animation graph\nuniform vec2 uFrameCoord; // the 2D coord of current small fig in the big png pic.\nvarying vec2 vUv;\n\nvec2 scaleUv(vec2 uv, vec2 transformStep, vec2 uTextureSegments) {\n  float uSegmentUnit = 1.0 / uTextureSegments.x;\n  float vSegmentUnit = 1.0 / uTextureSegments.y;\n \n  return vec2(uv.x / uTextureSegments.x + uSegmentUnit * transformStep.x, \n  uv.y / uTextureSegments.y + vSegmentUnit * transformStep.y);\n}\n\nvoid main() {\n  #include <logdepthbuf_fragment>\n\n  vec2 scaledUvs = scaleUv(vUv, uFrameCoord, uTextureSegments);\n  vec4 fragColor = texture2D(uTexture, scaledUvs);\n\n  gl_FragColor = fragColor * uOpacity;\n\n  #include <premultiplied_alpha_fragment>\n}",e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-radar/2.1.4/shaders/sequenceFrame.vert.glsl",[],function(n,e,r,t,a,i){return n.exports="#define GLSLIFY 1\n#include <logdepthbuf_pars_vertex>\n\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n\n  vec4 transformed = vec4(position, 1.0);\n\n  #ifdef USE_INSTANCING\n    transformed = instanceMatrix * transformed;\n  #endif\n\n  gl_Position = projectionMatrix * modelViewMatrix * transformed;\n\n  #include <logdepthbuf_vertex>\n}\n\n ",n.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-radar/2.1.4/squenceFramePrimitive",[],function(e,t,a,r,i,o){function n(e,t,r){return(n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch(e){}}()?Reflect.construct.bind():function(e,t,r){var i=[null];i.push.apply(i,t);t=new(Function.bind.apply(e,i));return r&&s(t,r.prototype),t}).apply(null,arguments)}function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var r;if(e)return"string"==typeof e?u(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function h(t,e){var r,i=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)),i}function m(i){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?h(Object(a),!0).forEach(function(e){var t,r;t=i,r=a[e=e],e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(a,e))})}return i}function c(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return e.exports=function(p,d){return t=e,(r=[{key:"calFrameCoord",value:function(){for(var e=this.materialOption,t=e.textureSegmentsX,r=[],i=e.textureSegmentsY-1;0<=i;i--)for(var a=0;a<t;a++)r.push([a,i]);this.frameCoords&&(this.frameCoords.length=0),this.frameCoords=r}},{key:"setGeometry",value:function(e){this.geometry&&this.geometry.dispose&&this.geometry.dispose(),this.geometryOption=m(m({},this.geometryOption),e);e=this.geometryOption.size,e=void 0===e?1:e;this.geometry=new p.PlaneBufferGeometry(e,e)}},{key:"setMaterial",value:function(e){this.materialOption=m(m({},this.materialOption),e);var e=this.materialOption,t=e.textureUrl,r=e.textureSegmentsX,i=e.textureSegmentsY,a=e.opacity,o=e.vertexShader,n=e.fragmentShader,s=e.blending,l=e.depthTest,e=e.depthWrite,u=(this.textureSegmentsLimit=r*i,this.calFrameCoord(),null),h=!1;this.textureUrl===t&&this.material||(this.texture&&this.texture.dispose(),(u=this.textureLoader.load(t)).minFilter=p.LinearMipMapLinearFilter,u.anisotropy=16,this.textureUrl=t,this.texture=u,h=!0),this.material?(h&&(this.material.uniforms.uTexture.value=u),this.material.uniforms.uTextureSegments.value=new p.Vector2(r,i),this.material.uniforms.uOpacity.value=a,this.material.blending=p[s],this.material.depthTest=l,this.material.depthWrite=e):this.material=new p.ShaderMaterial({uniforms:{uTexture:{value:u},uTextureSegments:{value:new p.Vector2(r,i)},uOpacity:{value:a},uFrameCoord:{value:new p.Vector2(0,0)}},vertexShader:o,fragmentShader:n,transparent:!0,blending:p[s],depthTest:l,depthWrite:e,side:p.DoubleSide}),this.material.needsUpdate=!0}},{key:"setMesh",value:function(e){var i=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],a=(this.mesh&&this.mesh.dispose(),this.geometry||this.setGeometry(this.geometryOption),this.material||this.setMaterial(this.materialOption),new p.InstancedMesh(this.geometry,this.material,e.length)),o=(this.mesh=a,this.data=e,d.coordHelper),n=new p.Vector3,s=new p.Quaternion,l=new p.Vector3,u=new p.Matrix4,h=new p.Matrix4,t=(h.makeRotationFromEuler(new p.Euler(-.5*Math.PI,0*Math.PI,0*Math.PI,"XYZ")),this.geometryOption),r=t.scaleFactor,m=void 0===r?1:r,r=t.verticalOffset,c=void 0===r?0:r;return e.forEach(function(e,t){var r=e.value||1,r=e.vismapProperties?e.vismapProperties.size||1:r,r=(l.set(m*r,m*r,1),o.setFromValues(e.lng,e.lat,e.altitude+c),o.transform.clone());i?s.setFromRotationMatrix(r.multiply(h)):s.setFromRotationMatrix(r),o.toXYZ(n),u.compose(n,s,l),a.setMatrixAt(t,u)}),a}},{key:"checkVisible",value:function(e){this.mesh&&(this.mesh.visible=e),this.visible=e}},{key:"animate",value:function(e){this.material&&this.visible&&(this.frameCursor>this.textureSegmentsLimit?this.frameCursor=0:this.frameCursor+=e,e=Math.floor(this.frameCursor)%this.textureSegmentsLimit,e=this.frameCoords[e],this.material.uniforms.uFrameCoord.value=new p.Vector2(e[0],e[1]))}},{key:"updateScale",value:function(i){var a,o,n,s,l=this;this.data&&this.mesh&&(a=new p.Vector3,o=new p.Quaternion,n=new p.Vector3,s=new p.Matrix4,this.data.forEach(function(e,t){l.mesh.getMatrixAt(t,s),s.decompose(a,o,n);var r=e.value||1,r=e.vismapProperties?e.vismapProperties.size||1:r;n.set(i*r,i*r,1),s.compose(a,o,n),l.mesh.setMatrixAt(t,s)}),this.mesh.instanceMatrix.needsUpdate=!0)}},{key:"updateColor",value:function(e){e=void 0!==e.r?[e.r,e.g,e.b,e.a]:d.Chroma(e).gl();this.material&&(this.material.uniforms.uColor.value=n(p.Vector4,l(e)))}},{key:"updateVerticalOffset",value:function(r){var i,a,o,n,s,l,u=this,h=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.data&&this.mesh&&(i=new p.Vector3,a=new p.Quaternion,o=new p.Vector3,n=new p.Matrix4,s=d.coordHelper,(l=new p.Matrix4).makeRotationFromEuler(new p.Euler(-.5*Math.PI,0*Math.PI,0*Math.PI,"XYZ")),this.data.forEach(function(e,t){u.mesh.getMatrixAt(t,n),n.decompose(i,a,o),s.setFromValues(e.lng,e.lat,e.altitude+r);e=s.transform;h?a.setFromRotationMatrix(e.multiply(l)):a.setFromRotationMatrix(e),s.toXYZ(i),n.compose(i,a,o),u.mesh.setMatrixAt(t,n)}),this.mesh.instanceMatrix.needsUpdate=!0)}},{key:"dispose",value:function(){this.geometry&&this.geometry.dispose&&this.geometry.dispose(),this.material&&this.material.dispose&&this.material.dispose(),this.mesh&&this.mesh.dispose&&this.mesh.dispose(),this.geometry=null,this.material=null,this.mesh=null,this.data&&(this.data.length=0),this.texture&&this.texture.dispose(),this.frameCoords&&(this.frameCoords.length=0)}}])&&c(t.prototype,r),i&&c(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e;function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.geometry=null,this.material=null,this.mesh=null,this.data=null,this.geometryOption={size:1,scaleFactor:1,verticalOffset:0},this.materialOption={textureUrl:"",textureSegmentsX:1,textureSegmentsY:1,color:16777215,vertexShader:a("datav:/com/@datav-city-pro-v2/datav-engine-radar/2.1.4/shaders/sequenceFrame.vert.glsl"),fragmentShader:a("datav:/com/@datav-city-pro-v2/datav-engine-radar/2.1.4/shaders/sequenceFrame.frag.glsl"),blending:"AdditiveBlending",depthTest:!1,depthWrite:!1},this.frameCursor=0,this.visible=!0,this.textureLoader=(new p.TextureLoader).setCrossOrigin("*"),this.textureUrl=null,this.texture=null}var t,r,i},e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-radar/2.1.4/radarPrimitive",[],function(e,t,a,r,i,o){function u(e,t,r){return(u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch(e){}}()?Reflect.construct.bind():function(e,t,r){var i=[null];i.push.apply(i,t);t=new(Function.bind.apply(e,i));return r&&n(t,r.prototype),t}).apply(null,arguments)}function n(e,t){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function h(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var r;if(e)return"string"==typeof e?s(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function l(t,e){var r,i=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)),i}function c(i){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?l(Object(a),!0).forEach(function(e){var t,r;t=i,r=a[e=e],e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(a,e))})}return i}function m(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t,r,i,a){return 1===a?r<=(e+=i)&&(e=t):(e-=i)<=r&&(e=t),e}return e.exports=function(p,d){var e,t,r;function i(){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.geometry=null,this.material=null,this.mesh=null,this.data=null,this.geometryOption={diameter:1,scaleFactor:1,verticalOffset:0},this.materialOption={color:65280,activeColor:16711680,textureUrl:"",light:1,vertexShader:a("datav:/com/@datav-city-pro-v2/datav-engine-radar/2.1.4/shaders/radar.vert.glsl"),fragmentShader:a("datav:/com/@datav-city-pro-v2/datav-engine-radar/2.1.4/shaders/radar.frag.glsl")},this.textureLoader=(new p.TextureLoader).setCrossOrigin("*"),this.textureUrl=null}return e=i,(t=[{key:"setGeometry",value:function(e){this.geometry&&this.geometry.dispose&&this.geometry.dispose(),this.geometryOption=c(c({},this.geometryOption),e);e=this.geometryOption.diameter,e=void 0===e?1:e,e=new p.PlaneBufferGeometry(e,e);this.geometry=e}},{key:"setMaterial",value:function(e){this.materialOption=c(c({},this.materialOption),e);var e=this.materialOption,t=e.color,r=e.activeColor,i=e.textureUrl,a=e.light,o=e.vertexShader,n=e.fragmentShader,s=e.blending,l=e.depthWrite,e=e.depthTest,t=d.Chroma(t).gl(),r=d.Chroma(r).gl();this.material?(this.updateTexture(i),this.material.uniforms.uColor.value=u(p.Vector4,h(t)),this.material.uniforms.uActiveColor.value=u(p.Vector4,h(r)),this.material.uniforms.uLight.value=a,this.material.blending=p[s],this.material.depthTest=e,this.material.depthWrite=l):(this.textureUrl=i,(i=this.textureLoader.load(i)).minFilter=p.LinearMipMapLinearFilter,i.anisotropy=16,this.texture=i,this.material=new p.ShaderMaterial({uniforms:{uTexture:{value:i},uColor:{value:u(p.Vector4,h(t))},uAngle:{value:6.2831852},uLight:{value:a},uTimeCounter:{value:1e4},uActiveColor:{value:u(p.Vector4,h(r))},uPickIds:{value:[-1]},uPickCount:{value:1}},vertexShader:o,fragmentShader:n,transparent:!0,blending:p[s],depthTest:e,depthWrite:l,side:p.DoubleSide})),this.material.needsUpdate=!0}},{key:"setMesh",value:function(e){var i=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],a=(this.mesh&&this.mesh.dispose(),this.geometry||this.setGeometry(this.geometryOption),this.material||this.setMaterial(this.materialOption),new p.InstancedMesh(this.geometry,this.material,e.length)),o=(this.mesh=a,this.data=e,new p.Vector3),n=new p.Quaternion,s=new p.Vector3,l=new p.Matrix4,t=this.geometryOption,r=t.scaleFactor,u=void 0===r?1:r,r=t.verticalOffset,h=void 0===r?0:r,c=d.coordHelper,m=new p.Matrix4;return m.makeRotationFromEuler(new p.Euler(-.5*Math.PI,0*Math.PI,0*Math.PI,"XYZ")),e.forEach(function(e,t){var r=e.value||1,r=e.vismapProperties?e.vismapProperties.size||1:r,r=(s.set(u*r,u*r,1),c.setFromValues(e.lng,e.lat,e.altitude+h),c.transform.clone());i?n.setFromRotationMatrix(r.multiply(m)):n.setFromRotationMatrix(r),c.toXYZ(o),l.compose(o,n,s),a.setMatrixAt(t,l)}),a}},{key:"animate",value:function(e){this.material&&(this.material.uniforms.uTimeCounter.value=f(this.material.uniforms.uTimeCounter.value,1e4,0,e,0),this.material.uniforms.uAngle.value=f(this.material.uniforms.uAngle.value,6.2831852,0,2*e,0))}},{key:"active",value:function(e){if(this.inactive(),e.length||(e=[e]),this.material&&(this.material.uniforms.uPickIds.value=e,this.material.uniforms.uPickCount.value=e.length),1===e.length)return this.data[e[0]]}},{key:"inactive",value:function(){this.material&&(this.material.uniforms.uPickIds.value=[-1],this.material.uniforms.uPickCount.value=1)}},{key:"updateScale",value:function(i){var a,o,n,s,l=this;this.data&&this.mesh&&(a=new p.Vector3,o=new p.Quaternion,n=new p.Vector3,s=new p.Matrix4,this.data.forEach(function(e,t){l.mesh.getMatrixAt(t,s),s.decompose(a,o,n);var r=e.value||1,r=e.vismapProperties?e.vismapProperties.size||1:r;n.set(i*r,i*r,1),s.compose(a,o,n),l.mesh.setMatrixAt(t,s)}),this.mesh.instanceMatrix.needsUpdate=!0)}},{key:"updateVerticalOffset",value:function(r){var i,a,o,n,s,l,u=this,h=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.data&&this.mesh&&(i=new p.Vector3,a=new p.Quaternion,o=new p.Vector3,n=new p.Matrix4,s=d.coordHelper,(l=new p.Matrix4).makeRotationFromEuler(new p.Euler(-.5*Math.PI,0*Math.PI,0*Math.PI,"XYZ")),this.data.forEach(function(e,t){u.mesh.getMatrixAt(t,n),n.decompose(i,a,o),s.setFromValues(e.lng,e.lat,e.altitude+r);e=s.transform;h?a.setFromRotationMatrix(e.multiply(l)):a.setFromRotationMatrix(e),s.toXYZ(i),n.compose(i,a,o),u.mesh.setMatrixAt(t,n)}),this.mesh.instanceMatrix.needsUpdate=!0)}},{key:"updateColor",value:function(e){e=void 0!==e.r?[e.r,e.g,e.b,e.a]:d.Chroma(e).gl();this.material&&(this.material.uniforms.uColor.value=u(p.Vector4,h(e)))}},{key:"updateTexture",value:function(e){var t,r;e!==this.textureUrl&&(this.texture&&this.texture.dispose(),(t=this.textureLoader.load(e)).minFilter=p.LinearMipMapLinearFilter,t.anisotropy=16,(r=this.material.uniforms.uTexture).value&&r.value.dispose(),r.value=t,this.texture=t,this.textureUrl=e)}},{key:"show",value:function(){this.mesh&&(this.mesh.visible=!0)}},{key:"hide",value:function(){this.mesh&&(this.mesh.visible=!1)}},{key:"dispose",value:function(){this.geometry&&this.geometry.dispose&&this.geometry.dispose(),this.material&&this.material.dispose&&this.material.dispose(),this.mesh&&this.mesh.dispose&&this.mesh.dispose(),this.texture&&this.texture.dispose(),this.geometry=null,this.material=null,this.mesh=null,this.data&&(this.data.length=0),this.texture=null}}])&&m(e.prototype,t),r&&m(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i},e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-radar/2.1.4/radar",[],function(e,t,u,i,r,a){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}(e,t);if(r)return(r=Object.getOwnPropertyDescriptor(r,t)).get?r.get.call(arguments.length<3?e:i):r.value}).apply(this,arguments)}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function v(i){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=m(i),t=(e=r?(e=m(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}return e.exports=function(e){var t=e.THREE,f=e.Utils,i=e.VG,r=e.FormatTransformer,e=e.coordHelper,a=i.Layer,n=u("datav:/com/@datav-city-pro-v2/datav-engine-radar/2.1.4/radarPrimitive")(t,{Chroma:f.Chroma,coordHelper:e}),s=u("datav:/com/@datav-city-pro-v2/datav-engine-radar/2.1.4/squenceFramePrimitive")(t,{Chroma:f.Chroma,coordHelper:e}),t=l,e=a;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&p(t,e);var o,c=v(l);function l(e){var t;if(this instanceof l)return(t=c.call(this)).classNameAlias="RadarLayer",t.layerName=t.classNameAlias,t.renderQueue=i.Geometry,t.needsAutoUpdate=!0,t.options=Object.assign({visible:!0},e||{}),t.formatTransformer=new r,t.defaultValue=1,t.defaultAltitude=0,t.enableInteractive=t.options.options.interaction.enableInteractive,t.lastestSpeed=t.options.options.animate.speed,t.highlightedMeshArr=[],t;throw new TypeError("Cannot call a class as a function")}return t=l,(e=[{key:"allowPicking",get:function(){return this.enableInteractive}},{key:"addTo",value:function(e){d(m(l.prototype),"addTo",this).call(this,e),this.radarPrimitive=new n,this.sequenceFramePrimitive=new s}},{key:"checkData",value:function(e){if(!e)return console.error("".concat(this.classNameAlias,": no data."));var t=e,i=[];if(!Array.isArray(e)){if("FeatureCollection"!==e.type)return console.error("".concat(this.classNameAlias,": invalid data format, ").concat(e,"."));t=this.formatTransformer.geojson2datav(e)}if(!t.length)return console.warn("".concat(this.classNameAlias,": the length of data is 0."));for(var r=0,a=t.length;r<a;r++){var n,s,o=t[r],c=parseFloat(o.lng),l=parseFloat(o.lat);n=parseFloat(o.altitude),isNaN(c)||isNaN(l)||(s=parseFloat(o.value),n=isNaN(n)?this.defaultAltitude:n,s=isNaN(s)?this.defaultValue:s,o=o.id,i.push({lng:c,lat:l,altitude:n,value:s,id:o}))}return i}},{key:"setData",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(this.clear(),this.data=null,t||(this.data=this.checkData(e)),!this.data)return this.emit("rendered");var i=this.options.options,r=i.general,a=i.animate,n=i.graph,i=i.interaction,a=a.sequenceFrame,s=r.blendingType,o=r.depthWrite,c=r.depthTest,l=r.scaleFactor,r=r.verticalOffset,u=n.radarUrl,h=n.color,n=n.light,i=i.activeColor,s=(this.radarPrimitive.setGeometry({diameter:100,scaleFactor:l,verticalOffset:r}),this.radarPrimitive.setMaterial({blending:s,depthWrite:o,depthTest:c,color:h,activeColor:i,textureUrl:u,light:n}),this.radarPrimitive.setMesh(this.data)),o=(this.radarMesh=s,this.add(s),a.enableSequenceFrame),c=a.params;o&&this.addSequenceFrame(l,r,c),this.checkVisible(),t||this.emit("rendered")}},{key:"dataErrorHandler",value:function(){this.emit("rendered")}},{key:"addSequenceFrame",value:function(e,t,i){var r=i.sequenceFrameTexture,a=i.blending,n=i.verticalGap,s=i.opacity,o=i.textureSegmentsX,i=i.textureSegmentsY,e=(this.sequenceFramePrimitive.setGeometry({size:100,scaleFactor:e,verticalOffset:t+n}),this.sequenceFramePrimitive.setMaterial({textureUrl:r,textureSegmentsX:o,textureSegmentsY:i,opacity:s,blending:a}),this.sequenceFramePrimitive.setMesh(this.data));this.sequenceFrameMesh=e,this.add(e)}},{key:"isEnableSequenceFrame",value:function(){return this.options.options.animate.sequenceFrame.enableSequenceFrame}},{key:"render",value:function(e){this.setData(e)}},{key:"getPickCandidate",value:function(){return this.radarMesh?[this.radarMesh]:[]}},{key:"active",value:function(e){if(this.data)return this.radarPrimitive.active(e,!(1<arguments.length&&void 0!==arguments[1])||arguments[1]),this.data[e]}},{key:"inactive",value:function(){this.radarPrimitive&&this.radarPrimitive.inactive(!(0<arguments.length&&void 0!==arguments[0])||arguments[0])}},{key:"highlight",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];if(20<e.length)return console.log("雷达：高亮id不可大于20");this.radarPrimitive&&this.radarPrimitive.active(e)}},{key:"unhightlight",value:function(){this.radarPrimitive&&this.radarPrimitive.inactive()}},{key:"autoUpdate",value:function(){this.animate()}},{key:"animate",value:function(){var e;this.radarPrimitive&&(this.radarPrimitive.animate(this.lastestSpeed),this.isEnableSequenceFrame()&&(e=this.options.options.animate.sequenceFrame.params.sequenceFrameSpeed,this.sequenceFramePrimitive.animate(e)))}},{key:"updateUniformCounters",value:function(e,t,i,r,a){return 1===a?i<=(e+=r)&&(e=t):(e-=r)<=i&&(e=t),e}},{key:"updateVerticalOffset",value:function(e){var t;this.radarPrimitive&&(this.radarPrimitive.updateVerticalOffset(e),this.isEnableSequenceFrame()&&(t=this.options.options.animate.sequenceFrame.params.verticalGap,this.sequenceFramePrimitive.updateVerticalOffset(e+t)))}},{key:"updateLight",value:function(e){this.radarPrimitive&&(this.materialRadar.uniforms.uLight.value=e)}},{key:"updateMeshScale",value:function(e){this.radarPrimitive&&(this.radarPrimitive.updateScale(e),this.isEnableSequenceFrame()&&this.sequenceFramePrimitive.updateScale(e))}},{key:"color",set:function(e){this.radarPrimitive&&this.radarPrimitive.updateColor(e)}},{key:"getColorInOption",value:function(){return this.options.options.graph.color}},{key:"scaleFactor",set:function(e){this.updateMeshScale(e)}},{key:"getScaleFactorInOption",value:function(){return this.options.options.general.scaleFactor}},{key:"checkVisible",value:function(){this.options.visible?this.show():this.hide()}},{key:"checkInteractive",value:function(e){this.enableInteractive=e}},{key:"hide",value:function(){this.radarPrimitive&&(this.options.visible=!1,this.radarPrimitive.hide(),this.sequenceFramePrimitive.checkVisible(!1))}},{key:"show",value:function(){this.radarPrimitive&&(this.options.visible=!0,this.radarPrimitive.show(),this.sequenceFramePrimitive.checkVisible(!0))}},{key:"updateOptions",value:function(e){var t,i,r,a,n,s,o,c,l,u,h,d,p;this.radarPrimitive&&(t=f.deepClone(this.options),this.options=f.mergeOptions(this.options,e||{}),r=(u=this.options.options).general,s=u.graph,c=u.animate,u=u.interaction,h=r.blendingType,p=r.depthWrite,d=r.depthTest,i=r.scaleFactor,r=r.verticalOffset,a=s.color,n=s.light,s=s.radarUrl,o=c.speed,c=c.sequenceFrame,l=u.enableInteractive,u=u.activeColor,this.radarPrimitive.setMaterial({blending:h,depthTest:d,depthWrite:p,color:a,activeColor:u,light:n,textureUrl:s}),f.easyDiff(t.options.general.verticalOffset,r)||this.updateVerticalOffset(r),f.easyDiff(t.options.general.scaleFactor,i)||this.updateMeshScale(i),this.lastestSpeed=o,this.checkVisible(),this.checkInteractive(l),h=c.enableSequenceFrame,d=c.params,this.isEnableSequenceFrame()&&(this.sequenceFrameMesh?(d.textureUrl=d.sequenceFrameTexture,this.sequenceFramePrimitive.setMaterial(d),p=d.verticalGap,t.options.animate.sequenceFrame.params.verticalGap!==p&&this.sequenceFramePrimitive.updateVerticalOffset(r+p)):this.addSequenceFrame(i,r,d)),this.sequenceFramePrimitive&&this.sequenceFramePrimitive.checkVisible(h),f.easyDiff(t.sceneId.length,e.sceneId.length)&&f.deepDiff(t.sceneId,e.sceneId)||this.updateSceneId())}},{key:"clear",value:function(){this.radarPrimitive&&this.radarPrimitive.dispose(),this.sequenceFramePrimitive&&this.sequenceFramePrimitive.dispose(),d(m(l.prototype),"clear",this).call(this)}},{key:"destroy",value:function(){this.clear(),d(m(l.prototype),"destroy",this).call(this),this.data.length=0}}])&&h(t.prototype,e),o&&h(t,o),Object.defineProperty(t,"prototype",{writable:!1}),l},e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-radar/2.1.4",["datav:/npm/eventemitter3/3.0.0"],function(t,e,r,n,i,o){function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function u(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=y(r),e=(t=n?(t=y(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(t&&("object"===a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var s=r("datav:/npm/eventemitter3/3.0.0"),h=r("datav:/com/@datav-city-pro-v2/datav-engine-radar/2.1.4/radar"),r=function(){var t=i,e=s;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e);var r,n=u(i);function i(t,e){var r;if(this instanceof i)return(r=n.call(this)).options=e,r.comId="",r.type="Radar",r.isActived=!1,r;throw new TypeError("Cannot call a class as a function")}return t=i,(e=[{key:"addTo",value:function(t,e){this.cityproCore=t,this.comId=e,this.initLayer()}},{key:"initLayer",value:function(){var t=h(this.cityproCore);this.layer=new t(this.options),this.cityproCore.viewer.addLayer(this.comId,this.layer)}},{key:"setData",value:function(t){this.layer&&this.layer.setData(t)}},{key:"errorRender",value:function(){console.log("雷达组件数据错误"),this.layer&&this.layer.dataErrorHandler()}},{key:"updateOptions",value:function(t){this.layer&&this.layer.updateOptions&&this.layer.updateOptions(t)}},{key:"radarUrlHandler",value:function(t){this.layer.radarUrlHandler(t)}},{key:"enableInteractive",get:function(){return!!this.layer&&this.layer.enableInteractive}},{key:"active",value:function(t){var e,r=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).instanceId,n=!1;return null!=r&&(e={clickPosition:{x:t.offsetX,y:t.offsetY},data:{}},0===t.button&&this.layer&&this.layer.active&&(r=this.layer.active(r),e.data=r,this.emit("leftClick",e),n=!0),this.isActived=n),n}},{key:"inactive",value:function(){this.isActived&&this.layer&&this.layer.inactive&&this.layer.inactive(),this.isActived=!1}},{key:"highlight",value:function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).ids;this.layer.highlight(t)}},{key:"unhighlight",value:function(){this.layer.unhightlight()}},{key:"updateColor",value:function(t){this.layer&&(this.layer.color=t)}},{key:"colorInOption",value:function(){return this.layer.getColorInOption()}},{key:"updateScaleFactor",value:function(t){this.layer&&(this.layer.scaleFactor=t)}},{key:"scaleFactorInOption",value:function(){return this.layer.getScaleFactorInOption()}},{key:"show",value:function(){this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.layer&&this.layer.hide&&this.layer.hide()}},{key:"clear",value:function(){this.layer&&this.layer.clear&&this.layer.clear()}},{key:"destroy",value:function(){this.layer&&(this.layer.destroy&&this.layer.destroy(),this.layer=null)}}])&&l(t.prototype,e),r&&l(t,r),Object.defineProperty(t,"prototype",{writable:!1}),i}();return t.exports=r,t.exports});