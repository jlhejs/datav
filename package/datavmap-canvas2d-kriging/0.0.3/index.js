// env=undefined => env=publish 
Cube("datav:/com/datavmap-canvas2d-kriging/0.0.3/src/libs/kriging-contour",[],function(a){function b(c,a){return c<a?-1:c>a?1:c>=a?0:NaN}function c(a){return function(c,d){return b(a(c),d)}}function d(a,b){var c,d,e,f=a.length,g=-1;if(null==b){for(;++g<f;)if(null!=(c=a[g])&&c>=c)for(d=e=c;++g<f;)null!=(c=a[g])&&(d>c&&(d=c),e<c&&(e=c));}else for(;++g<f;)if(null!=(c=b(a[g],g,a))&&c>=c)for(d=e=c;++g<f;)null!=(c=b(a[g],g,a))&&(d>c&&(d=c),e<c&&(e=c));return[d,e]}function e(a,b,c){a=+a,b=+b,c=2>(e=arguments.length)?(b=a,a=0,1):3>e?1:+c;for(var d=-1,e=0|Math.max(0,Math.ceil((b-a)/c)),f=Array(e);++d<e;)f[d]=a+d*c;return f}function f(a,b,c){var d=Math.abs(b-a)/Math.max(0,c),e=Math.pow(10,Math.floor(Math.log(d)/Math.LN10)),f=d/e;return f>=y?e*=10:f>=A?e*=5:f>=C&&(e*=2),b<a?-e:e}function g(a){return Math.ceil(Math.log(a.length)/Math.LN2)+1}function h(c,a){return c-a}function i(a){for(var b=0,c=a.length,d=a[c-1][1]*a[0][0]-a[c-1][0]*a[0][1];++b<c;)d+=a[b-1][1]*a[b][0]-a[b-1][0]*a[b][1];return d}function j(a){return function(){return a}}function k(a,b){for(var d,c=-1,e=b.length;++c<e;)if(d=l(a,b[c]))return d;return 0}function l(a,b){for(var c=b[0],d=b[1],e=-1,f=0,g=a.length,h=g-1;f<g;h=f++){var i=a[f],j=i[0],k=i[1],l=a[h],n=l[0],o=l[1];if(m(i,l,b))return 0;k>d!==o>d&&c<(n-j)*(d-k)/(o-k)+j&&(e=-e)}return e}function m(d,a,b){var c;return n(d,a,b)&&o(d[c=+(d[0]===a[0])],b[c],a[c])}function n(d,a,b){return(a[0]-d[0])*(b[1]-d[1])===(b[0]-d[0])*(a[1]-d[1])}function o(a,b,c){return a<=b&&b<=c||c<=b&&b<=a}function p(){}function q(){function a(a){var c=q(a);if(!Array.isArray(c)){var g=d(a),i=g[0],j=g[1];c=f(i,j,c),c=e(Math.floor(i/c)*c,Math.floor(j/c)*c,c)}else c=c.slice().sort(h);return c.map(function(c){return b(a,c)})}function b(a,b){var d=[],e=[];return c(a,b,function(c){r(c,a,b),0<i(c)?d.push([c]):e.push(c)}),e.forEach(function(a){for(var b,c=0,e=d.length;c<e;++c)if(-1!==k((b=d[c])[0],a))return void b.push(a)}),{type:"MultiPolygon",value:b,coordinates:d}}function c(a,b,c){function d(a){var b,d,f=[a[0][0]+e,a[0][1]+h],g=[a[1][0]+e,a[1][1]+h],i=l(f),j=l(g);(b=m[i])?(d=k[j])?(delete m[b.end],delete k[d.start],b===d?(b.ring.push(g),c(b.ring)):k[b.start]=m[d.end]={start:b.start,end:d.end,ring:b.ring.concat(d.ring)}):(delete m[b.end],b.ring.push(g),m[b.end=j]=b):(b=k[j])?(d=m[i])?(delete k[b.start],delete m[d.end],b===d?(b.ring.push(g),c(b.ring)):k[d.start]=m[b.end]={start:d.start,end:b.end,ring:d.ring.concat(b.ring)}):(delete k[b.start],b.ring.unshift(f),k[b.start=i]=b):k[i]=m[j]={start:i,end:j,ring:[f,g]}}var e,h,f,g,i,j,k=[],m=[];for(e=h=-1,g=a[0]>=b,I[g<<1].forEach(d);++e<n-1;)f=g,g=a[e+1]>=b,I[f|g<<1].forEach(d);for(I[g<<0].forEach(d);++h<o-1;){for(e=-1,g=a[h*n+n]>=b,i=a[h*n]>=b,I[g<<1|i<<2].forEach(d);++e<n-1;)f=g,g=a[h*n+n+e+1]>=b,j=i,i=a[h*n+e+1]>=b,I[f|g<<1|i<<2|j<<3].forEach(d);I[g|i<<3].forEach(d)}for(e=-1,i=a[h*n]>=b,I[i<<2].forEach(d);++e<n-1;)j=i,i=a[h*n+e+1]>=b,I[i<<2|j<<3].forEach(d);I[i<<3].forEach(d)}function l(a){return 2*a[0]+4*(a[1]*(n+1))}function m(a,b,c){a.forEach(function(a){var d,e=a[0],f=a[1],g=0|e,h=0|f,i=b[h*n+g];0<e&&e<n&&g===e&&(d=b[h*n+g-1],a[0]=e+(c-d)/(i-d)-0.5),0<f&&f<o&&h===f&&(d=b[(h-1)*n+g],a[1]=f+(c-d)/(i-d)-0.5)})}var n=1,o=1,q=g,r=m;return a.contour=b,a.size=function(b){if(!arguments.length)return[n,o];var c=Math.ceil(b[0]),d=Math.ceil(b[1]);if(!(0<c)||!(0<d))throw new Error("invalid size");return n=c,o=d,a},a.thresholds=function(b){return arguments.length?(q="function"===typeof b?b:Array.isArray(b)?j(H.call(b)):j(b),a):q},a.smooth=function(b){return arguments.length?(r=b?m:p,a):r===m},a}function r(a,b){var c,d=[0].rep(b*b);for(c=0;c<b;c++)d[c*b+c]=a;return d}function s(a,b,c){var d,e,f=Array(c*b);for(d=0;d<b;d++)for(e=0;e<c;e++)f[e*b+d]=a[d*c+e];return f}function u(a,b,c,d){var e,f,g=Array(c*d);for(e=0;e<c;e++)for(f=0;f<d;f++)g[e*d+f]=a[e*d+f]+b[e*d+f];return g}function v(a,b,c,d,e){var f,g,h,i=Array(c*e);for(f=0;f<c;f++)for(g=0;g<e;g++)for(i[f*e+g]=0,h=0;h<d;h++)i[f*e+g]+=a[f*d+h]*b[h*e+g];return i}function w(a,b){var c,d,e,f=Array(b);for(c=0;c<b;c++)f[c]=a[c*b+c];for(c=0;c<b;c++){for(d=0;d<c;d++)f[c]-=a[c*b+d]*a[c*b+d];if(0>=f[c])return!1;for(f[c]=Math.sqrt(f[c]),d=c+1;d<b;d++){for(e=0;e<c;e++)a[d*b+c]-=a[d*b+e]*a[c*b+e];a[d*b+c]/=f[c]}}for(c=0;c<b;c++)a[c*b+c]=f[c];return!0}function z(a,b){var c,d,e,f;for(c=0;c<b;c++)for(a[c*b+c]=1/a[c*b+c],d=c+1;d<b;d++){for(f=0,e=c;e<d;e++)f-=a[d*b+e]*a[e*b+c];a[d*b+c]=f/a[d*b+d]}for(c=0;c<b;c++)for(d=c+1;d<b;d++)a[c*b+d]=0;for(c=0;c<b;c++){for(a[c*b+c]*=a[c*b+c],e=c+1;e<b;e++)a[c*b+c]+=a[e*b+c]*a[e*b+c];for(d=c+1;d<b;d++)for(e=d;e<b;e++)a[c*b+d]+=a[e*b+c]*a[e*b+d]}for(c=0;c<b;c++)for(d=0;d<c;d++)a[c*b+d]=a[d*b+c]}function B(a,c){var d,e,f,g,h,i,j,k,l,n,o,p=c,m=Array(c*c),b=Array(c),q=Array(c),r=Array(c);for(d=0;d<c;d++)for(g=0;g<c;g++)m[d*c+g]=d==g?1:0;for(g=0;g<c;g++)r[g]=0;for(d=0;d<c;d++){for(k=0,g=0;g<c;g++)if(1!=r[g])for(h=0;h<c;h++)0==r[h]&&Math.abs(a[g*c+h])>=k&&(k=Math.abs(a[g*c+h]),f=g,e=h);if(++r[e],f!=e){for(i=0;i<c;i++)o=a[f*c+i],a[f*c+i]=a[e*c+i],a[e*c+i]=o;for(i=0;i<p;i++)o=m[f*c+i],m[f*c+i]=m[e*c+i],m[e*c+i]=o}if(q[d]=f,b[d]=e,0==a[e*c+e])return!1;for(n=1/a[e*c+e],a[e*c+e]=1,i=0;i<c;i++)a[e*c+i]*=n;for(i=0;i<p;i++)m[e*c+i]*=n;for(j=0;j<c;j++)if(j!=e){for(l=a[j*c+e],a[j*c+e]=0,i=0;i<c;i++)a[j*c+i]-=a[e*c+i]*l;for(i=0;i<p;i++)m[j*c+i]-=m[e*c+i]*l}}for(i=c-1;0<=i;i--)if(q[i]!=b[i])for(h=0;h<c;h++)o=a[h*c+q[i]],a[h*c+q[i]]=a[h*c+b[i]],a[h*c+b[i]]=o;return!0}function D(a,b,c,d,e){return b+(d-b)/c*(1-Math.exp(-(1/e)*Math.pow(a/c,2)))}function E(a,b,c,d,e){return b+(d-b)/c*(1-Math.exp(-(1/e)*(a/c)))}function F(a,b,c,d){return a>c?b+(d-b)/c:b+(d-b)/c*(1.5*(a/c)-0.5*Math.pow(a/c,3))}function t(a,b,c,d){var e=[],f=[],g=[],h=[100000000,100000000,-100000000,-100000000];a.features.forEach(function(a){e.push(a.properties[c]),f.push(a.geometry.coordinates[0]),g.push(a.geometry.coordinates[1]),h[0]>a.geometry.coordinates[0]&&(h[0]=a.geometry.coordinates[0]),h[1]>a.geometry.coordinates[1]&&(h[1]=a.geometry.coordinates[1]),h[2]<a.geometry.coordinates[0]&&(h[2]=a.geometry.coordinates[0]),h[3]<a.geometry.coordinates[1]&&(h[3]=a.geometry.coordinates[1])});var i=J.train(e,f,g,d.model,d.sigma2,d.alpha);h=b;var j=J.getGridInfo(h,i,200);return j}var x=function(b){return 1===b.length&&(b=c(b)),{left:function(c,a,d,e){for(null==d&&(d=0),null==e&&(e=c.length);d<e;){var f=d+e>>>1;0>b(c[f],a)?d=f+1:e=f}return d},right:function(c,a,d,e){for(null==d&&(d=0),null==e&&(e=c.length);d<e;){var f=d+e>>>1;0<b(c[f],a)?e=f:d=f+1}return d}}}(b),y=Math.sqrt(50),A=Math.sqrt(10),C=Math.sqrt(2),G=Array.prototype,H=G.slice,I=[[],[[[1,1.5],[0.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[0.5,1]]],[[[1,0.5],[1.5,1]]],[[[1,1.5],[0.5,1]],[[1,0.5],[1.5,1]]],[[[1,0.5],[1,1.5]]],[[[1,0.5],[0.5,1]]],[[[0.5,1],[1,0.5]]],[[[1,1.5],[1,0.5]]],[[[0.5,1],[1,0.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,0.5]]],[[[0.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[0.5,1],[1,1.5]]],[]];Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.mean=function(){var a,b;for(a=0,b=0;a<this.length;a++)b+=this[a];return b/this.length},Array.prototype.rep=function(a){for(var b=Array(a),c=this[0],d=0;d<a;d++)b[d]=c;return b},Array.prototype.pip=function(a,b){var d,e,f=!1;for(d=0,e=this.length-1;d<this.length;e=d++)this[d][1]>b!=this[e][1]>b&&a<(this[e][0]-this[d][0])*(b-this[d][1])/(this[e][1]-this[d][1])+this[d][0]&&(f=!f);return f};var J={};return J.train=function(a,b,c,d,e,f){var g={t:a,x:b,y:c,nugget:0,range:0,sill:0,A:1/3,n:0};"gaussian"===d?g.model=D:"exponential"===d?g.model=E:"spherical"===d?g.model=F:void 0;var h,i,j,k,l=a.length,m=Array((l*l-l)/2);for(h=0,j=0;h<l;h++)for(i=0;i<h;i++,j++)m[j]=[,,],m[j][0]=Math.pow(Math.pow(b[h]-b[i],2)+Math.pow(c[h]-c[i],2),0.5),m[j][1]=Math.abs(a[h]-a[i]);m.sort(function(c,a){return c[0]-a[0]}),g.range=m[(l*l-l)/2-1][0];var n=30<(l*l-l)/2?30:(l*l-l)/2,o=g.range/n,p=[0].rep(n),q=[0].rep(n);if(30>n)for(k=0;k<n;k++)p[k]=m[k][0],q[k]=m[k][1];else{for(h=0,i=0,j=0,k=0;h<n&&i<(l*l-l)/2;h++,j=0){for(;m[i][0]<=(h+1)*o&&(p[k]+=m[i][0],q[k]+=m[i][1],i++,j++,!(i>=(l*l-l)/2)););0<j&&(p[k]/=j,q[k]/=j,k++)}if(2>k)return g}l=k,g.range=p[l-1]-p[0];var G=[1].rep(2*l),H=Array(l),I=g.A;for(h=0;h<l;h++)"gaussian"===d?G[2*h+1]=1-Math.exp(-(1/I)*Math.pow(p[h]/g.range,2)):"exponential"===d?G[2*h+1]=1-Math.exp(-(1/I)*p[h]/g.range):"spherical"===d?G[2*h+1]=1.5*(p[h]/g.range)-0.5*Math.pow(p[h]/g.range,3):void 0,H[h]=q[h];var A=s(G,l,2),J=v(A,G,2,l,2);J=u(J,r(1/f,2),2,2);var L=J.slice(0);w(J,2)?z(J,2):(B(L,2),J=L);var N=v(v(J,A,2,2,l),H,2,l,1);g.nugget=N[0],g.sill=N[1]*g.range+g.nugget,g.n=b.length,l=b.length;var O=Array(l*l);for(h=0;h<l;h++){for(i=0;i<h;i++)O[h*l+i]=g.model(Math.pow(Math.pow(b[h]-b[i],2)+Math.pow(c[h]-c[i],2),0.5),g.nugget,g.range,g.sill,g.A),O[i*l+h]=O[h*l+i];O[h*l+h]=g.model(0,g.nugget,g.range,g.sill,g.A)}var K=u(O,r(e,l),l,l),C=K.slice(0);w(K,l)?z(K,l):(B(C,l),K=C);var O=K.slice(0),P=v(K,a,l,l,1);return g.K=O,g.M=P,g},J.predict=function(a,b,c){var d,e=Array(c.n);for(d=0;d<c.n;d++)e[d]=c.model(Math.pow(Math.pow(a-c.x[d],2)+Math.pow(b-c.y[d],2),0.5),c.nugget,c.range,c.sill,c.A);return v(e,c.M,1,c.n,1)[0]},J.variance=function(a,b,c){var d,e=Array(c.n);for(d=0;d<c.n;d++)e[d]=c.model(Math.pow(Math.pow(a-c.x[d],2)+Math.pow(b-c.y[d],2),0.5),c.nugget,c.range,c.sill,c.A);return c.model(0,c.nugget,c.range,c.sill,c.A)+v(v(e,c.K,1,c.n,c.n),e,1,c.n,1)[0]},J.getGridInfo=function(a,b,c){var d=[],e=[a[0],a[2]],f=[a[1],a[3]],g=[b.t.min(),b.t.max()],h=e[1]-e[0],i=f[1]-f[0],l=void 0,m=void 0;l=c?Math.ceil(c):200,m=Math.ceil(l/(h/i));for(var n,o,p=1*h/l,q=1*i/m,r=0;r<m;r++)for(var j=0;j<l;j++)n=a[0]+j*p,o=a[1]+r*q,d.push(J.predict(n,o,b));return{grid:d,n:l,m:m,xlim:e,ylim:f,zlim:g,x_resolution:p,y_resolution:q}},J.getVectorContour=function(a,b){var c=q().size([a.n,a.m]).thresholds(b)(a.grid),d={type:"FeatureCollection",features:[]},e=a.xlim[1]-a.xlim[0],f=a.ylim[1]-a.ylim[0];return c.forEach(function(b){b.coordinates.forEach(function(c){var g=c.map(function(b){var c=b.map(function(b){var c=a.xlim[0]+e*(1*b[0]/a.n),d=a.ylim[0]+f*(1*b[1]/a.m);return[c,d]});return c});d.features.push({type:"Feature",properties:{contour_value:b.value},geometry:{type:"Polygon",coordinates:g}})})}),d},J.drawCanvasContour=function(a,b,c,d,e){var f=b.getContext("2d");f.clearRect(0,0,b.width,b.height);for(var g=[c[1]-c[0],d[1]-d[0],a.zlim[1]-a.zlim[0]],h=a.n,k=a.m,l=Math.ceil(a.x_resolution*b.width/(c[1]-c[0])),m=Math.ceil(a.y_resolution*b.height/(d[1]-d[0])),n=0;n<k;n++)for(var i,o=0;o<h;o++)if(i=n*h+o,void 0!=a.grid[i]){var j=b.width*(o*a.x_resolution+a.xlim[0]-c[0])/g[0],p=b.height*(1-(n*a.y_resolution+a.ylim[0]-d[0])/g[1]),q=(a.grid[i]-a.zlim[0])/g[2];0>q?q=0:1<q&&(q=1),f.fillStyle=e[Math.floor((e.length-1)*q)],f.fillRect(Math.round(j-l/2),Math.round(p-m/2),l,m)}},a.exports={getVectorContour:function(a,b,c,d,e){var f=t(a,b,c,d),g=J.getVectorContour(f,e);return g}},a.exports});;
Cube("datav:/com/datavmap-canvas2d-kriging/0.0.3/src/libs/geojson-bbox",[],function(a){function b(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function c(a){var d;return"Point"==a.type?d=[a.coordinates]:"LineString"==a.type||"MultiPoint"==a.type?d=a.coordinates:"Polygon"==a.type||"MultiLineString"==a.type?d=a.coordinates.reduce(function(a,c){return a.push.apply(a,b(c)),a},[]):"MultiPolygon"==a.type?d=a.coordinates.reduce(function(a,c){return a.push.apply(a,b(c.reduce(function(a,c){return a.push.apply(a,b(c)),a},[]))),a},[]):"Feature"==a.type?d=c(a.geometry):"GeometryCollection"==a.type?d=a.geometries.reduce(function(a,d){return a.push.apply(a,b(c(d))),a},[]):"FeatureCollection"==a.type&&(d=a.features.reduce(function(a,d){return a.push.apply(a,b(c(d))),a},[])),d}return a.exports=function(a){var b;if(a.hasOwnProperty("type"))return b=c(a),b.reduce(function(a,b){return[Math.min(b[0],a[0]),Math.min(b[1],a[1]),Math.max(b[0],a[2]),Math.max(b[1],a[3])]},[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY])},a.exports});;
Cube("datav:/com/datavmap-canvas2d-kriging/0.0.3/src/krigingLayer",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1","datav:/npm/chroma-js/1.3.3","datav:/npm/polylabel/1.0.2","datav:/npm/rbush/3.0.0"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),l=c("datav:/npm/safely-merge/1.0.1"),m=c("datav:/npm/chroma-js/1.3.3"),n=c("datav:/npm/polylabel/1.0.2"),o=c("datav:/npm/rbush/3.0.0"),p=c("datav:/com/datavmap-canvas2d-kriging/0.0.3/src/libs/geojson-bbox"),q=c("datav:/com/datavmap-canvas2d-kriging/0.0.3/src/libs/kriging-contour"),r=q.getVectorContour,s=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=l({tolerance:0,smoothFactor:1,zoomRange:[0,18],minZoom:0,maxZoom:22,fill:{minFillColor:"rgba(5, 96, 125, 0.8)",maxFillColor:"rgba(0, 255, 240, 0.5)"},colorLevel:10,stroke:{color:"#fff",weight:1,dashArray:""}},c),f.options.minZoom=c.zoomRange[0],f.options.maxZoom=c.zoomRange[1],f.options.visibility=!0,f.map=a,f.init(),f}return f(b,a),g(b,[{key:"init",value:function(){this.container=document.createElement("canvas");var a=this.padding=this.map.canvasLayer&&this.map.canvasLayer.options&&this.map.canvasLayer.options.padding?this.map.canvasLayer.options.padding:0.1,b=this.map.getSize();this.offset=b.multiplyBy(-a).round();var c=b.x-2*this.offset.x,d=b.y-2*this.offset.y,e=2;this.container.width=c*e,this.container.height=d*e,this.container.style.width=c+"px",this.container.style.height=d+"px",this.ctx=this.container.getContext("2d"),this.ctx.scale(e,e),this.geojson=null,this.clipGeojson=null,this.rbush=new o,this.rbush.dirty=0,this.rbush.total=0,this.rbushInBounds=new o,this.featuresInBounds=[]}},{key:"onRender",value:function(a){this.ctx.clearRect(0,0,this.container.width,this.container.height),this.geojson&&(a&&"needUpdata"===a&&this.getFeaturesInBounds(),this.draw())}},{key:"onResize",value:function(a,b){var c=this.map.devicePixelRatio||1;this.container.width=a*c,this.container.height=b*c,this.container.style.width=a+"px",this.container.style.height=b+"px",this.ctx.scale(c,c)}},{key:"render",value:function(a){this.data=a||[];var b={type:"FeatureCollection",features:[]},c=void 0,e=void 0,d=void 0;for(c=0;c<a.length;c++)e=a[c],d={type:"Feature",properties:{value:+e.value||0},geometry:{type:"Point",coordinates:[+e.lng,+e.lat]}},b.features.push(d);this.dataset=b,this.genGeojson()}},{key:"setClipArea",value:function(a){this.clipGeojson=a,this.genGeojson()}},{key:"genGeojson",value:function(){var a=this,b=this;if(this.clipGeojson&&this.dataset&&this.dataset.features&&this.dataset.features.length){for(var c=p(this.clipGeojson),d=this.range=b.getRange(),e=0<d[0]?[0]:[],f=this.options.colorLevel,g=(d[1]-d[0])/f,h=d[0];h<d[1];h+=+g.toFixed())e.push(+h.toFixed(0));e.push(d[1]);var l=r(this.dataset,c,"value",{model:"exponential",sigma2:0,alpha:100},e),n=[];for(i=l.features.length-1;0<=i;i--)l.features[i].properties.value=l.features[i].properties.contour_value,n.push(l.features[i].properties.contour_value);this.geojson=l;var o=this.options.fill;b.colorScale=m.scale([o.minFillColor,o.maxFillColor]).domain(d);for(var q=null,s=JSON.parse(JSON.stringify(b.geojson)),t=[],u=void 0,v=0;v<s.features.length;v++)u=s.features[v],u.geometry&&u.geometry.coordinates&&0<u.geometry.coordinates.length&&t.push(u);s.features=t.map(function(b){return q=q||b.properties.ad_code&&"ad_code",q=q||b.properties.adcode&&"adcode",q=q||b.properties.id&&"id",q=q||b.properties.name&&"name",b.properties._fillColor=b.properties.fillColor?b.properties.fillColor:a.range?b.properties.contour_value>=a.range[0]&&b.properties.contour_value<=a.range[1]?a.colorScale(+b.properties.contour_value).css():o.minFillColor:o.minFillColor,b}),this.initRBush(s),this.getFeaturesInBounds(),this.onRender()}else this.ctx.clearRect(0,0,this.container.width,this.container.height),this.rbush.dirty=0,this.rbush.total=0,this.rbush.clear()}},{key:"getRange",value:function(){if(!this.data.length)return null;var a=this.data.filter(function(a){return void 0!=a.value&&!isNaN(+a.value)&&""!==a.value}),b=a.reduce(function(c,a){return+c.value<=+a.value?c:a},{}),c=a.reduce(function(c,a){return+c.value>=+a.value?c:a},{});return[+b.value,+c.value]}},{key:"initRBush",value:function(a){var b=[],c=void 0,d=void 0;for(c=0,d=a.features.length;c<d;c++){var e=a.features[c],f=p(e);b.push({minX:f[0],minY:f[1],maxX:f[2],maxY:f[3],feature:e})}b.length&&(this.rbush.dirty=b.length,this.rbush.total=b.length,this.rbush.clear(),this.rbush.load(b))}},{key:"getFeaturesInBounds",value:function(){var a=this.map.getBounds(),b=a.pad(this.padding),c={minX:b.getWest(),minY:b.getSouth(),maxX:b.getEast(),maxY:b.getNorth()},d=this.rbush.search(c),e=void 0,f=void 0,g=void 0,h=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=void 0;for(e=0;e<d.length;e++){switch(m=d[e].feature,n=m.geometry.coordinates,p=[],m.geometry.type){case"Polygon":for(f=0;h=n.length,f<h;f++)o=this.pointsProject(n[f]),3<=o.length&&p.push(o);break;case"MultiPolygon":for(f=0;h=n.length,f<h;f++)for(g=0;l=n[f].length,g<l;g++)o=this.pointsProject(n[f][g]),3<=o.length&&p.push(o);break;default:}d[e].feature.geometry.coordinatesXY=p}return this.rbushInBounds.clear(),this.rbushInBounds.load(d),this.featuresInBounds=d,d}},{key:"draw",value:function(){var a=this;if(this.options.visibility&&this.geojson&&this.rbush&&this.rbush.total){this.ctx.clearRect(0,0,this.container.width,this.container.height);var b=this.featuresInBounds;b=b.sort(function(c,a){return c.feature.properties.contour_value<a.feature.properties.contour_value?-1:c.feature.properties.contour_value==a.feature.properties.contour_value?0:1}),this.drawAreas(b);var c=this.ctx;if(this.clipGeojson){c.globalCompositeOperation="destination-in",c.fillStyle="rgba(0,0,0,1)",c.beginPath();var d,e,f;for(d=0;d<this.clipGeojson.features.length;d++){switch(e=this.clipGeojson.features[d],coordinates=e.geometry.coordinates,f=[],e.geometry.type){case"Polygon":for(j=0;j<coordinates.length;j++)pointsProjected=this.pointsProject(coordinates[j]),3<=pointsProjected.length&&f.push(pointsProjected);break;case"MultiPolygon":for(j=0;j<coordinates.length;j++)for(k=0;k<coordinates[j].length;k++)pointsProjected=this.pointsProject(coordinates[j][k]),3<=pointsProjected.length&&f.push(pointsProjected);break;default:}this.clipGeojson.features[d].geometry.coordinatesXY=f}a.clipGeojson.features.forEach(function(b){switch(b.geometry.type){case"Polygon":a.drawPolygon(a.ctx,b.geometry.coordinatesXY);break;case"MultiPolygon":a.drawPolygon(a.ctx,b.geometry.coordinatesXY);}}),a.ctx.fill()}a.ctx.restore()}}},{key:"drawAreas",value:function(a){this.ctx.shadowColor=null,this.ctx.shadowBlur=null,this.ctx.globalCompositeOperation="source-over";var b=this.options.stroke,c=void 0,d=a.length;for(c=0;d,c<d;c++){var e=a[c].feature,f=Object.assign({},e.properties),g=f._fillColor,h=f.strokeColor||b.color,l=f.weight||b.weight,m=f.dashArray||b.dashArray,n={fill:!0,fillRule:"evenodd",fillColor:g||"rgba(2,111,222,0.3)",fillOpacity:1,stroke:!0,strokeColor:h||"rgba(255,255,255,0.3)",weight:l,lineJoin:"round",lineCap:"square",dashArray:m||""};switch(e.geometry.type){case"Polygon":this.drawPolygon(this.ctx,e.geometry.coordinatesXY,n);break;case"MultiPolygon":this.drawPolygon(this.ctx,e.geometry.coordinatesXY,n);break;default:}}}},{key:"area",value:function(a){for(var b,c=0,d=0;d<a.length;d++){b=a[d];for(var e=0,f=b.length,g=f-1;e<f;g=e++)c+=(b[e][0]-b[g][0])*(b[e][1]+b[g][1])*(d?-1:1)}return Math.abs(c)/2}},{key:"calLabelPos",value:function(a,b){var c=this;if(a.geometry&&"Polygon"===a.geometry.type)return n(a.geometry.coordinates,b);if(a.geometry&&"MultiPolygon"===a.geometry.type){var d=a.geometry.coordinates.reduce(function(d,a){return c.area(d)>=c.area(a)?d:a},{});return n(d,b)}}},{key:"pointsProject",value:function(a){var b=[],c=void 0,e=void 0;for(c=0;e=a.length,c<e;c++){var f=a[c];if((f[0]||0==f[0])&&(f[1]||0==f[1])){var d=this.map.latLngToContainerPoint([f[1],f[0]]);b.push({x:d.x-this.offset.x,y:d.y-this.offset.y})}}var g=this.options.smoothFactor,h=b;return b.length&&(h=this.map.L.LineUtil.simplify(b,g)),h}},{key:"drawPolygon",value:function(a,b,c){if(b&&0!==b.length){a.beginPath();var d,e,f;for(d=0;d<b.length;d++){for(e=0;e<b[d].length;e++)f=b[d][e],a[e?"lineTo":"moveTo"](f.x,f.y);a.closePath()}c&&this.fillStroke(a,c)}}},{key:"fillStroke",value:function(a,b){if(b.fill&&(a.globalAlpha=b.fillOpacity,a.fillStyle=b.fillColor||b.color,a.fill(b.fillRule||"evenodd")),b.stroke&&0!==b.weight){if(a.setLineDash){var c=this.getDashArray(b)||[];a.setLineDash(c)}a.globalAlpha=b.opacity,a.lineWidth=b.weight,a.strokeStyle=b.strokeColor,a.lineCap=b.lineCap,a.lineJoin=b.lineJoin,a.stroke()}}},{key:"getDashArray",value:function(a){if(""===a.dashArray)e=[];else if("string"===typeof a.dashArray){var b,c,d=a.dashArray.split(/[, ]+/),e=[];for(c=0;c<d.length;c++){if(b=+d[c],isNaN(b))return;e.push(b)}}else e=a.dashArray||[];return e}},{key:"updateOptions",value:function(a){this.options=l(this.options,a),this.options.minZoom=a.zoomRange[0],this.options.maxZoom=a.zoomRange[1],this.genGeojson()}},{key:"show",value:function(){this.options.visibility=!0,this.onRender("needUpdata")}},{key:"hide",value:function(){this.options.visibility=!1,this.ctx.clearRect(0,0,this.container.width,this.container.height)}},{key:"destroy",value:function(){this.rbushInBounds.clear(),this.rbushInBounds=null,this.rbush.clear(),this.rbush=null,this.options=null,this.ctx=null,this.container=null,delete this.options,this.ctx,this.container}}]),b}(h);return a.exports=s,a.exports});;
Cube("datav:/com/datavmap-canvas2d-kriging/0.0.3",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/com/datavmap-canvas2d-kriging/0.0.3/src/krigingLayer"),k=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=i({renderer:"canvas"},c),f.options.minZoom=c.zoomRange[0],f.options.maxZoom=c.zoomRange[1],f.options.visibility=!0,f}return f(b,a),g(b,[{key:"addTo",value:function(a,b){return this.options.id=b,this.layer=new j(a,this.options),this}},{key:"onRender",value:function(){this.layer&&this.layer.onRender&&this.layer.onRender()}},{key:"onResize",value:function(a,b){this.layer&&this.layer.onResize&&this.layer.onResize(a,b)}},{key:"render",value:function(a){this.layer&&this.layer.render&&this.layer.render(a)}},{key:"setClipArea",value:function(a){this.layer&&this.layer.setClipArea&&this.layer.setClipArea(a)}},{key:"updateOptions",value:function(a){this.options=i(this.options,a),this.options.minZoom=a.zoomRange[0],this.options.maxZoom=a.zoomRange[1],this.layer&&this.layer.updateOptions&&this.layer.updateOptions(a)}},{key:"show",value:function(){this.options.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.options.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"destroy",value:function(){this.layer&&this.layer.destroy&&this.layer.destroy(),this.layer=null,delete this.layer}}]),b}(h);return a.exports=k,a.exports});