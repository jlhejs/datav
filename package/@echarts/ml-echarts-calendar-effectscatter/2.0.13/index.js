// env=undefined => env=publish 
Cube("datav:/com/@echarts/ml-echarts-calendar-effectscatter/2.0.13",["datav:/com/maliang-echarts-utils/0.0.18","datav:/npm/bcore/0.0.18/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.6.1","datav:/npm/echarts/3.5.4","datav:/npm/echarts/3.5.4/lib/util/number"],function(t,e,i,a,n,c){var s=i("datav:/npm/bcore/0.0.18/event"),r=i("datav:/npm/jquery/2.1.4"),o=i("datav:/npm/lodash/4.6.1"),h=i("datav:/npm/echarts/3.5.4"),l=i("datav:/npm/echarts/3.5.4/lib/util/number"),d=i("datav:/com/maliang-echarts-utils/0.0.18");return t.exports=s.extend(function(t,e){this.config={calendar:{yearLabel:{formatter:"{start}"}},series:[{type:"scatter"},{type:"effectScatter"}]},this.container=r(t),this.apis=e.apis,this._data=null,this.chart=null,this.init(e)},{init:function(t){var i=this;t=this.mergeConfig(t),this.chart=h.init(this.container[0]),this.chart.off(),this.chart.on("click",function(e){var t=i._data.filter(function(t){return t.value===e.data[1]&&t.name===e.data[0]&&t.s===e.seriesName});i.emit("click",t.length&&t[0])}),this.chart.on("legendselectchanged",function(e){var t=o.filter(o.keys(e.selected),function(t){return e.selected[t]});i.emit("legend-select-changed",{selected:t,name:e.name})})},highlight:function(t){t=o.merge(t||{},{type:"highlight"}),this.chart.dispatchAction(t)},downplay:function(t){t=o.merge(t||{},{type:"downplay"}),this.chart.dispatchAction(t)},showTip:function(){var t=o.merge(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{type:"showTip"});this.chart.dispatchAction(t)},hideTip:function(){this.chart.dispatchAction({type:"hideTip"})},legendAction:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.type,e=void 0===e?"legendToggleSelect":e,t=t.name;e&&-1!==["legendSelect","legendUnSelect","legendToggleSelect"].indexOf(e)&&this.chart.dispatchAction({type:e,name:t})},numToMoneyField:function(t){return regExp=/(\d{1,3})(?=(\d{3})+(?:$|\.))/g,t.toString().replace(regExp,"$1,")},data2echartsEffectscatter:function(t,e){var i=this,a={series:[]};return o.map(o.groupBy(t,"s"),function(t){a.series.push({data:o.map(t,function(t){return[t.name,t.value]})})}),o.map(e,function(t){t&&t.data&&(t.data=[])}),a.series=o.defaultsDeep(a.series,this.fixArray4cycle(e,a.series.length)),a.tooltip=o.defaultsDeep(a.tooltip,{formatter:function(t){return"\n        ".concat(t.seriesName&&"<div>".concat(t.seriesName,"</div>"),"\n        ").concat(t.color&&'<i style="display: inline-block;width: 10px;height: 10px;background: '.concat(t.color,';border-radius: 50%"></i>'),"\n        ").concat(t.data&&0<t.data.length&&'<div style="display: inline-block;">'.concat(t.data[0].replace(/-/g,"/")+" ").concat(i.numToMoneyField(t.data[1]),"</div>"),"\n      ")}}),a},fixArray4cycle:function(t,e){var i;return e<=t.length?t:(i=parseInt(e/t.length),e=e%t.length,i=o.concat.apply(this,this.fillArr(t,i)),o.concat(i,o.slice(t,0,e)))},fillArr:function(t,e){for(var i=[],a=0;a<e;a++)i[a]=o.cloneDeep(t);return i},render:function(t){t=this.data(t);t=this.mergeConfig(this.data2echartsEffectscatter(t,this.config.series));this.chart.setOption(d.config2echartsOptions(t))},resize:function(t,e){this.chart.resize({width:t,height:e})},data:function(t){return t&&(this._data=t),this._data},mergeConfig:function(t){return t&&(this.config=o.defaultsDeep(t||{},this.config),this.config.legend.data=o.map(this.config.series,"name"),this.config.series&&this.config.series.forEach(function(e){e.type=e.stype,e._symbolSize.mappingValue?e.symbolSize=function(t){return t[1]*e._symbolSize.scale/1e3}:e.symbolSize=e._symbolSize.size}),this.config.calendar.range=[this.config.calendar.startDate,this.config.calendar.endDate],this.config.tooltip.showContent=this.config.tooltip.show),this.config},updateOptions:function(t){var e=o.defaultsDeep(this.data2echartsEffectscatter(this._data,t.series),t);t=this.mergeConfig(e),"Invalid Date"!=l.parseDate(this.config.calendar.range[1])&&this.chart.setOption(d.config2echartsOptions(t))},clear:function(){this.chart&&this.chart.clear&&this.chart.clear()},destroy:function(){this.chart&&this.chart.dispose&&this.chart.dispose()}}),t.exports});