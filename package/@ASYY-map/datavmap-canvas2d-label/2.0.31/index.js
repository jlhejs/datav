// env=undefined => env=publish 
Cube("datav:/com/datavmap-canvas2d-label/2.0.31/src/libs/geojson-bbox",[],function(a){function b(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function c(a){var d;return"Point"==a.type?d=[a.coordinates]:"LineString"==a.type||"MultiPoint"==a.type?d=a.coordinates:"Polygon"==a.type||"MultiLineString"==a.type?d=a.coordinates.reduce(function(a,c){return a.push.apply(a,b(c)),a},[]):"MultiPolygon"==a.type?d=a.coordinates.reduce(function(a,c){return a.push.apply(a,b(c.reduce(function(a,c){return a.push.apply(a,b(c)),a},[]))),a},[]):"Feature"==a.type?d=c(a.geometry):"GeometryCollection"==a.type?d=a.geometries.reduce(function(a,d){return a.push.apply(a,b(c(d))),a},[]):"FeatureCollection"==a.type&&(d=a.features.reduce(function(a,d){return a.push.apply(a,b(c(d))),a},[])),d}return a.exports=function(a){var b;if(a.hasOwnProperty("type"))return b=c(a),b.reduce(function(a,b){return[Math.min(b[0],a[0]),Math.min(b[1],a[1]),Math.max(b[0],a[2]),Math.max(b[1],a[3])]},[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY])},a.exports});;
Cube("datav:/com/datavmap-canvas2d-label/2.0.31/src/labelLayer",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1","datav:/npm/rbush/3.0.0"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),j=c("datav:/npm/safely-merge/1.0.1"),k=c("datav:/npm/rbush/3.0.0"),l=c("datav:/com/datavmap-canvas2d-label/2.0.31/src/libs/geojson-bbox"),m=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));f.openPopup=function(a){var b=a.feature,c=b.properties,d=b.geometry.coordinates,e={lat:d[1],lng:d[0]},g=void 0,h=void 0,k=void 0;"custom"===f.options.popupStyle.styleType?(h=f.options.popupStyle,c.type&&f.popups[c.type]&&(h=j(h,f.popups[c.type].popupStyle))):h=f.map.popupStyle;var l=h.margin,m=l.top+"px "+l.right+"px "+l.bottom+"px "+l.left+"px";if(c.type&&f.popups[c.type]){var n=f.popups[c.type].clientWidth,o=f.popups[c.type].clientHeight;g=f.popups[c.type].popup,k=f.popups[c.type].container,k.style.display="block",k.style.width=n+"px",k.style.height=o+"px",k.style.margin=m}else{if(h.infoField&&void 0===c.info)return;var p="";if(void 0!=c.info)p=""+c.info;else if(void 0!=c.name&&void 0!=c.value)p="\u540D\u79F0\uFF1A"+c.name+"<br/>\u6570\u503C\uFF1A"+c.value;else if(void 0!=c.name)p="\u540D\u79F0\uFF1A"+c.name;else if(void 0!=c.value)p="\u6570\u503C\uFF1A"+c.value;else return;var q=h.textStyle,r=h.lineHeight;k="<div style=\"\n        margin: "+m+";\n        padding: 0px;\n        font-family: "+q.fontFamily+";\n        font-size: "+q.fontSize+"px;\n        color: "+q.color+"; \n        font-weight: "+q.fontWeight+"; \n        line-height: "+r+";\n        white-space: nowrap;\n        display: inline-table;\n        text-align: left;\n      \"> "+p+"</div>",g=f.map.L.popup({maxWidth:1200,maxHeight:1200,isCustomPopup:!0,offset:[0,-q.fontSize/2]})}g.setLatLng(e),g.setContent(k),g.openOn(f.map),f.map.L.customPopup.updatePopupStyle(g,h),f.map._popup.minZoom=f.options.minZoom,f.map._popup.maxZoom=f.options.maxZoom};return f.options=j({zoomRange:[0,18],minZoom:0,maxZoom:22,labelStyle:{textStyle:{fontFamily:"Microsoft Yahei",fontSize:12,color:"#FFFFFF",fontWeight:"normal",shadowColor:"rgba(0, 0, 0, 0.85)",shadowBlur:5}},popupStyle:{isBorderShadow:!0,show:!0,infoField:!1,eventType:"click",styleType:"parent",textStyle:{fontFamily:"Microsoft Yahei",fontSize:12,color:"#FFFFFF",fontWeight:"normal"},lineHeight:1.4,borderRadius:5,margin:{top:10,bottom:10,left:10,right:10},backgroundColor:"rgba(22,138,214,0.73)",closeBtn:{color:"#fff",size:16,top:0,right:0}},interactive:{isHover:{hoverScale:1.5}}},c),f.options.minZoom=c.zoomRange[0],f.options.maxZoom=c.zoomRange[1],f.options.visibility=!0,f.map=a,f.init(),f}return f(b,a),g(b,[{key:"init",value:function(){this.container=document.createElement("canvas");var a=this.padding=this.map.canvasLayer&&this.map.canvasLayer.options&&this.map.canvasLayer.options.padding?this.map.canvasLayer.options.padding:0.1,b=this.map.getSize();this.offset=b.multiplyBy(-a).round();var c=b.x-2*this.offset.x,d=b.y-2*this.offset.y,e=this.map.devicePixelRatio||1;this.container.width=c*e,this.container.height=d*e,this.container.style.width=c+"px",this.container.style.height=d+"px",this.ctx=this.container.getContext("2d"),this.ctx.scale(e,e),this.data=null,this.geojson=null,this.mappingData=null,this.rbush=new k,this.rbush.dirty=0,this.rbush.total=0,this.rbushInBounds=new k,this.featuresInBounds=[],this.popups={}}},{key:"onRender",value:function(){this.getFeaturesInBounds(),this.ctx.clearRect(0,0,this.container.width,this.container.height),this.draw()}},{key:"onResize",value:function(a,b){var c=this.map.devicePixelRatio||1;this.container.width=a*c,this.container.height=b*c,this.container.style.width=a+"px",this.container.style.height=b+"px",this.ctx.scale(c,c)}},{key:"render",value:function(a){var b=this;this.data=[],a&&0<a.length&&(this.data=a),this.group={},a.forEach(function(a){b.group[a.type]||(b.group[a.type]=[]),b.group[a.type].push(a)});var c=this.map.L.datavUtils.arr2geojson(a);this.geojson=JSON.parse(JSON.stringify(c)),this.genGeojson()}},{key:"updateOptions",value:function(a){this.options=j(this.options,a),this.options.minZoom=a.zoomRange[0],this.options.maxZoom=a.zoomRange[1],this.genGeojson()}},{key:"onClick",value:function(a){this.options.popupStyle.show&&"click"===this.options.popupStyle.eventType&&this.openPopup(a)}},{key:"onMouseOver",value:function(a){this.options.popupStyle.show&&"mouseover"===this.options.popupStyle.eventType&&this.openPopup(a)}},{key:"bindGroup",value:function(a,b,c){var d=+b.clientWidth,e=+b.clientHeight;b.style.transform="",b.style.position="",b.style.display="none";var f=this.map.L.popup({maxWidth:1200,maxHeight:1200,isCustomPopup:!0});this.popups[a]={popup:f,container:b,clientWidth:d,clientHeight:e,popupStyle:c}}},{key:"genGeojson",value:function(){if(this.geojson&&this.geojson.features&&this.geojson.features.length){var a={},b=this.options,c=b.series,d=void 0,e=void 0;if(c&&c.length)for(d=0;d<c.length;d++)e=c[d].type,e&&(a[e]=c[d]);var f=null,g=this.geojson.features.map(function(a){return f=f||a.properties.id&&"id",f=f||a.properties.name&&"name",f=f||a.properties.name&&"type",a});this.geojson={type:"FeatureCollection",features:g},this.initRBush(),this.getFeaturesInBounds(),this.onRender()}else this.ctx.clearRect(0,0,this.container.width,this.container.height),this.rbush.dirty=0,this.rbush.total=0,this.rbush.clear()}},{key:"initRBush",value:function(){var a=this.geojson,b=[],c=void 0,d=void 0;for(c=0,d=a.features.length;c<d;c++){var e=a.features[c],f=l(e);b.push({minX:f[0],minY:f[1],maxX:f[2],maxY:f[3],feature:e})}this.rbush.dirty=b.length,this.rbush.total=b.length,this.rbush.clear(),this.rbush.load(b)}},{key:"getFeaturesInBounds",value:function(){var a=this.map.getBounds(),b=a.pad(this.padding),c={minX:b.getWest(),minY:b.getSouth(),maxX:b.getEast(),maxY:b.getNorth()},d=this.queryFeaturesInBounds(this.rbush,c);this.rbushInBounds.clear(),this.rbushInBounds.load(d),this.featuresInBounds=d}},{key:"draw",value:function(){this.options.visibility&&this.geojson&&this.rbush&&this.rbush.total&&this.drawLables(this.featuresInBounds)}},{key:"drawBackground",value:function(a){var b=this.ctx;b.fillStyle=this.options.background.backgroundColor;var c=this.options.background.borderRadius,d=this.options.labelStyle.textStyle;for(b.shadowColor=null,b.shadowBlur=0,i=0;len=a.length,i<len;i++){var e=a[i].feature,f=e.geometry._coordinates,g=e.properties;if(g.name){var h=f[0]-this.offset.x,j=f[1]-this.offset.y,k=1;this.options.interactive.isHover.show&&this.map.featureSelect&&this.map.featureSelect.geometry.coordinates==e.geometry.coordinates&&(k=this.options.interactive.isHover.hoverScale),this.drawRoundedRect(b,h-50,j-d.fontSize,100,2*d.fontSize,c,"green","white")}}}},{key:"drawRoundedRect",value:function(a,b,c,d,e,f,g,h){a.save(),a.beginPath(),a.moveTo(b+f,c),a.arcTo(b+d,c,b+d,c+f,f),a.arcTo(b+d,c+e,b+d-f,c+e,f),a.arcTo(b,c+e,b,c+e-f,f),a.arcTo(b,c,b+f,c,f),g&&a.fill(),h&&a.stroke(),a.restore()}},{key:"drawLables",value:function(a){var b=this.ctx,c=this.options.labelStyle,d=c.textStyle,e=c.fieldName;b.fillStyle=d.color,b.shadowColor=d.shadowColor,b.shadowBlur=d.shadowBlur,b.textAlign="center",b.textBaseline="middle";var f,g,h;for(f=0;g=a.length,f<g;f++){var j=a[f].feature,k=j.geometry._coordinates,l=j.properties;if(h=l[e],h){var m=k[0]-this.offset.x,n=k[1]-this.offset.y,o=1;this.options.interactive.isHover.show&&this.map.featureSelect&&this.map.featureSelect.geometry.coordinates==j.geometry.coordinates&&(o=this.options.interactive.isHover.hoverScale),b.font=""+d.fontWeight+" "+d.fontSize*o+"px "+d.fontFamily,b.fillText(h,m,n)}}}},{key:"queryFeaturesInBounds",value:function(a,b){var c=a.search(b),d=void 0,e=void 0,f=void 0,g=void 0,h=void 0,j=void 0,k=void 0;for(d=0;e=c.length,d<e;d++){switch(f=c[d].feature,h=f.geometry.coordinates,k=[],f.geometry.type){case"Point":j=this.map.latLngToContainerPoint([h[1],h[0]]),j&&(k=[j.x,j.y]);break;default:}c[d].feature.geometry._coordinates=k,g=f.properties;var l=g.radius||5,m=this.map.L.point(k[0]-l,k[1]+l),n=this.map.L.point(k[0]+l,k[1]-l),o=this.map.containerPointToLatLng(m),p=this.map.containerPointToLatLng(n);c[d].minX=o.lng,c[d].minY=o.lat,c[d].maxX=p.lng,c[d].maxY=p.lat}return c}},{key:"pointsProject",value:function(a){var b=[],c=void 0,e=void 0;for(c=0;e=a.length,c<e;c++){var f=a[c];if((f[0]||0==f[0])&&(f[1]||0==f[1])){var d=this.map.latLngToContainerPoint([f[1],f[0]]);b.push({x:d.x-this.offset.x,y:d.y-this.offset.y})}}var g=this.options.smoothFactor,h=b;return b.length&&(h=this.map.L.LineUtil.simplify(b,g)),h}},{key:"containsLatLng",value:function(a){var b=void 0,c={minX:a.lng,minY:a.lat,maxX:a.lng,maxY:a.lat},d=this.rbushInBounds.search(c);if(0===d.length)return{flag:!1,feature:null};var e=[];return b=d[d.length-1].feature,e=[[d[d.length-1].minY,d[d.length-1].minX],[d[d.length-1].maxY,d[d.length-1].maxX]],{flag:!0,feature:b,featureBounds:e}}},{key:"show",value:function(){this.options.visibility=!0,this.data&&this.data.length&&this.onRender()}},{key:"hide",value:function(){this.options.visibility=!1,this.ctx.clearRect(0,0,this.container.width,this.container.height)}},{key:"destroy",value:function(){this.rbush.clear(),this.rbushInBounds.clear(),this.rbush=null,this.rbushInBounds=null,this.featuresInBounds=null,this.options=null,this.geojson=null,this.data=null,this.dataRanges=null,this.mappingData=null,this.group=null,this.ctx=null,this.container=null,delete this.rbush,this.rbushInBounds,this.featuresInBounds,this.options,this.geojson,this.data,this.dataRanges,this.mappingData,this.group,this.ctx,this.container,this.id}}]),b}(h);return a.exports=m,a.exports});;
Cube("datav:/com/datavmap-canvas2d-label/2.0.31",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/com/datavmap-canvas2d-label/2.0.31/src/labelLayer"),k=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=i({renderer:"canvas"},c),f.options.minZoom=c.zoomRange[0],f.options.maxZoom=c.zoomRange[1],f.options.visibility=!0,f}return f(b,a),g(b,[{key:"addTo",value:function(a,b){return this.options.id=b,this.layer=new j(a,this.options),this}},{key:"onRender",value:function(){this.layer&&this.layer.onRender&&this.layer.onRender()}},{key:"onResize",value:function(a,b){this.layer&&this.layer.onResize&&this.layer.onResize(a,b)}},{key:"render",value:function(a){this.layer&&this.layer.render&&this.layer.render(a)}},{key:"updateOptions",value:function(a){this.options=i(this.options,a),this.options.minZoom=a.zoomRange[0],this.options.maxZoom=a.zoomRange[1],this.layer&&this.layer.updateOptions&&this.layer.updateOptions(a)}},{key:"onClick",value:function(a){var b=a.feature;this.emit("click",b.properties),this.layer&&this.layer.onClick&&this.layer.onClick(a)}},{key:"onMouseOver",value:function(a){var b=a.feature;b&&b.properties&&this.emit("mouseover",b.properties),this.layer&&this.layer.onMouseOver&&this.layer.onMouseOver(a)}},{key:"bindGroup",value:function(a){var b=a.type||"",c=a.container||"<div></div>",d=a.popupStyle||{};this.layer&&this.layer.bindGroup&&this.layer.bindGroup(b,c,d)}},{key:"show",value:function(){this.options.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.options.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"containsLatLng",value:function(a){return this.layer.containsLatLng(a)}},{key:"destroy",value:function(){this.layer&&this.layer.destroy&&this.layer.destroy(),this.layer=null,delete this.layer}}]),b}(h);return a.exports=k,a.exports});