// env=undefined => env=publish 
Cube("datav:/com/map3d-plane/1.3.19",["datav:/npm/@tweenjs/tween.js/17.4.0","datav:/npm/dmap/0.2.9/core/utils","datav:/npm/dmap/0.2.9/map/interactions.js","datav:/npm/dmap/0.2.9","datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1","datav:/npm/dmap/0.2.9/layer/areas"],function(t,e,n,o,r,a){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function p(t,e){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function c(n){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=u(n),e=(t=o?(t=u(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=n("datav:/npm/@tweenjs/tween.js/17.4.0"),f=n("datav:/npm/dmap/0.2.9/core/utils").requestAnimationFrame,d=n("datav:/npm/dmap/0.2.9/map/interactions.js"),y=!0;d.prototype.loop=function(){this.update(),l.update(),y&&f(this.loop.bind(this))};var m=n("datav:/npm/dmap/0.2.9").Map,h=n("datav:/npm/eventemitter3/3.0.0"),v=n("datav:/npm/safely-merge/1.0.1"),b=n("datav:/npm/dmap/0.2.9/layer/areas"),d=Math.PI,O=d/180,n=function(){var t=r,e=h;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&p(t,e);var n,o=c(r);function r(t,e){var n;if(this instanceof r)return(n=o.call(this)).container="string"==typeof t?document.querySelector(t):t,n.options=v({projection:"plane",distance:17843979,rotation:{x:1.5192036732051035,y:.45},center:{lat:30,lng:120},subcoms:{},autoRotateSpeed:0,clearAlpha:0,background:"transparent",fill:{transparent:!1,type:"flat",colorBack:2236962,colorFrontDefault:"#4d4d4d",colorFrontFrom:"#ff7070",colorFrontTo:"#61057d"},stroke:{opacity:1,transparent:!0,linewidth:1,linecap:"round",linejoin:"round"},ratio:1},e),n.options.mapData=e.mapData||"//sh-conf.oss-cn-shanghai.aliyuncs.com/datav-coms-data/world2.json",n.init(),n.subcoms={},n;throw new TypeError("Cannot call a class as a function")}return t=r,(e=[{key:"init",value:function(){var e=this;this._map=new m(this.container,this.getMapOptions(this.options.mapOptions)),this.container.style.pointerEvents=this.options.mapOptions.isInteractive?"auto":"none",this._map.three3D.canvas.style.pointerEvents=this.options.mapOptions.isInteractive?"auto":"none",(this.layer=new b(this.getLayerOptions(this.options.areaOptions))).addTo(this._map),fetch(this.options.mapData).then(function(t){return t.json()}).then(function(t){t&&(e.mapdata=t,e.layer.geojson(t),e.render(e.ds||[]))}).catch(function(t){return console.log("fetch error",t)})}},{key:"getMapOptions",value:function(t){return(t=v(this.options,t)).distance=1e5*t.distance,t.rotation.x=t.rotation.x*O,t.rotation.y=t.rotation.y*O,t}},{key:"getLayerOptions",value:function(t){var e=(t=v(this.options,t)).fill;return{ratio:t.ratio,shape:{fill:{colorFront:{from:e.colorFrontFrom,to:e.colorFrontTo,default:e.colorFrontDefault,easing:"Linear.None.1.7",space:"rgb"},colorBack:e.colorBack,transparent:e.transparent},stroke:t.stroke}}}},{key:"updateMapOptions",value:function(t){t=this.getMapOptions(t);this._map&&this._map.updateOptions(t),this.container.style.pointerEvents=t.isInteractive?"auto":"none",this._map.three3D.canvas.style.pointerEvents=t.isInteractive?"auto":"none"}},{key:"updateAreaOptions",value:function(t){t=this.getLayerOptions(t);this.layer&&this.layer.updateOptions(t)}},{key:"get",value:function(t){return this.subcoms[t]}},{key:"add",value:function(t,e){if(!t)return console.log("layer 没有定义");t.addTo&&t.addTo(this._map),this.subcoms[e]=t}},{key:"updateAllOptions",value:function(){var t,e=this.subcoms;for(t in e)e[t].updateOptions()}},{key:"resize",value:function(t,e){this._map.three3D&&this._map.three3D.onWindowResize()}},{key:"remove",value:function(t,e){t.remove&&t.remove(),delete this.subcoms[e]}},{key:"render",value:function(t,e){var n=[];if(t&&t.length)for(var o=0;o<t.length;o++){var r=t[o];r.value=+r.value,n.push(r)}this.ds=n,this.mapdata&&this.layer.render(n),e&&this.get(e)&&this.get(e).render(n)}},{key:"destroy",value:function(){y=!1,this.options=null,this.subcoms=null,this.container.remove()}}])&&s(t.prototype,e),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),r}();return t.exports=n,t.exports});