// env=undefined => env=publish 
Cube("datav:/com/datavmap-2d-layer-footprint/0.2.14/lib/frag.js",[],function(a){return fragmentShader="precision mediump float;\nvarying float vTime;\nuniform float uTime;\nuniform vec3 uColor;\nuniform float uOpacity;\nuniform float uTimeGap;\nuniform sampler2D texture;\nfloat calculateTimeContrlOpacity(float timeCounter, float timeStamp){\nfloat timeGap = uTimeGap;\nfloat timeCounterHead = timeCounter + timeGap;\nif ((timeStamp > timeCounter) && (timeStamp < timeCounterHead)) {\nfloat opacity = (timeStamp - timeCounter) / timeGap;\nreturn opacity;\n} else {\nreturn 0.0;\n}\n}\nvoid main() {\nfloat visibleOpacity = 0.2;\nfloat currentOpacity = calculateTimeContrlOpacity(uTime, vTime);\ngl_FragColor = vec4(uColor, currentOpacity);\nfloat r = 0.0, delta = 0.0, alpha = 1.0;\nvec2 cxy = 2.0 * gl_PointCoord - 1.0;\nr = dot(cxy, cxy);\ndelta = fwidth(r);\nalpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\ngl_FragColor = gl_FragColor * alpha;\ngl_FragColor = gl_FragColor * uOpacity;\n}\n",a.exports=fragmentShader,a.exports});;
Cube("datav:/com/datavmap-2d-layer-footprint/0.2.14/lib/vertex.js",[],function(a){return vertexShader="const float PI = 3.141592653;\nuniform vec2 center;\nuniform vec2 viewport;\nuniform float zoom;\nuniform float uSize;\nattribute float aTime;\nvarying float vTime;\nvec3 realPoint(vec2 center, vec2 viewport, float zoom, vec3 lnglat2) {\n  float scale = 256.0 * 0.5 / PI * pow(2.0, zoom);\n  float lamda = radians(center.x);\n  float phi = radians(center.y);\n  float x = scale * (lamda + PI);\n  float y = scale * (PI - log(tan(PI * 0.25 + phi * 0.5)));\n  float offsetX = viewport.x * 0.5 - x;\n  float offsetY = viewport.y * 0.5 - y;\n  float lamda2 = radians(lnglat2.x);\n  float phi2 = radians(lnglat2.y);\n  float x2 = scale * (lamda2 + PI);\n  float y2 = scale * (PI - log(tan(PI * 0.25 + phi2 * 0.5)));\n  return vec3(x2 + offsetX - viewport.x / 2.0, -(y2 + offsetY) + viewport.y / 2.0, lnglat2.z);\n}\nvoid main() {\n  vTime = aTime;\n  gl_PointSize = uSize;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(realPoint(center, viewport, zoom, position), 1.0);\n}\n",a.exports=vertexShader,a.exports});;
Cube("datav:/com/datavmap-2d-layer-footprint/0.2.14/lib/texture.js",[],function(a){return a.exports={particle:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAJ2UExURUxpcXx8fH5+fnp6en19fX5+fnx8fHt7e3p6en9/f3t7e3x8fH5+fnt7e3x8fHx8fHx8fHx8fHx8fHp6ent7e3t7e3t7e3t7e3x8fHt7e3x8fHx8fHx8fHx8fH19fX19fX19fXh4eHl5eXp6enx8fH19fX19fXx8fHx8fHx8fHx8fHx8fHt7e3x8fHx8fH19fXt7e319fXx8fHx8fHx8fHx8fH19fXx8fH19fXx8fH19fX19fXx8fH19fXx8fH19fX19fX19fXl5eXd3d3h4eHx8fH19fXx8fHx8fHp6enl5eX9/f3x8fH19fXx8fHt7e3l5eXt7e319fXt7e3l5eXt7e319fXt7e3x8fH19fX19fXx8fHt7e3x8fHp6enx8fHx8fHp6ent7e319fXt7e3x8fHp6ent7e3x8fHx8fH19fXp6en5+fnx8fHx8fH19fX19fXt7e3p6enx8fHx8fHx8fHt7e3p6enx8fH19fXt7e3x8fHx8fHt7e3x8fH19fX5+fnx8fHt7e39/f3t7e3x8fHx8fH19fXt7e4KCgn19fX19fX19fYGBgXx8fHx8fIKCgnx8fH9/f4GBgX5+foGBgX5+foiIiIaGhoODg319fYeHh39/f319fX5+fn19fYGBgX9/f35+fn19fYWFhZWVlYCAgIODg5CQkKCgoJKSkn5+foqKiqOjo4WFhX9/f5ubm5CQkI+Pj4uLi4eHh4iIiIKCgoqKip+fn5GRkYiIiJmZmYCAgJCQkJKSksDAwKampo6OjrW1tb+/v6urq5+fn7q6upubm7CwsLa2tpqamrm5uaSkpLS0tJ2dnbOzs66urqioqGIoHgkAAAC/dFJOUwAEBAwECI4bBAQMcQwUMx83PlcURRAXIzBQVDpqeZOrCAgICAwfF21NKlxZTXx3jEp3bnR/mJiQyq2erZuQobW2pgwEBBsMCCYfBAgQGyMIHypfciOGOjNiED4UN48mRiwbMGpZSjM+pYAjShQXZEpZZze0mnUsKrCHQZmjZIOO0Ydi2p6KuH+c7p2ibueUvdmGyd+ezrL88Nmw+rWppL3Z0bqz4fzY3/3+/rby/uPK/fX09ujz2vT++e391vv7bjKWfAAAAZBJREFUOMtjYBiBwItDWUmZgwOXNIeCKG+iZ4ArLzMjVnkWHjFNgSgREUE+DzFmFizyzPzhGkHJ6uoyWvES7G4YhjBx8YdpB4fGmrPpZxpJCbAroSvwZ49J0TXNsKywrjFj0xPi43VBM0A0QVKvpNiiefKESbPs2Lh14phRPcPKnp7HJt/QOXvF0k0z51g11hZFo7qTVTy/tLqtd/rBUwfWbpw6V467il0RRYFKuZRuS/+MVccvnjy0Yck0U1kDflYUBVxlQu0d89ecO3J6/7GVW1bbmOhkeaMoYNaUMrGx37Xj/OH9Z3evW2wmm6qKagJPiIFxn/y2nWcunDi6eaG8HLcIuzuaLwQLW+0WLd++b+/WBQ5WlRF8vKhhyeQTKGloO89h/Z5lFvbd9dwafipoIcmqJlAgKzfF0drSsYvNUIhP2BlNASePqrS28UQ2c1v9Om4hAbRQgKjgT5NskjHqkdHKTvJ1whLfTFzC4hLSgoLSEuLCCpzYkxRXpJpYbo4oFyPORMnEycjCyTnYsgoAkORh7O6won4AAAAASUVORK5CYII="},a.exports});;
Cube("datav:/com/datavmap-2d-layer-footprint/0.2.14/lib/loadStaticRouters.js",[],function(a){return a.exports=function(a,b){var c=b.timeBase||1.49e9,d={};return d.positionsDataArray=[],d.timeDataArray=[],d.sizeDataArray=[],d.maxTime=0,d.minTime=1e7,a.forEach(function(a){var b=a.coordinates,e=a.timeStamp,f=a.weight,g=[];b.forEach(function(a){g.push(a[0],a[1],0)}),[].push.apply(d.positionsDataArray,g),f.forEach(function(a){var b=3+Math.log2(a);d.sizeDataArray.push(b)}),e.forEach(function(a){var b=a-c;d.timeDataArray.push(b),b>d.maxTime&&(d.maxTime=b),b<d.minTime&&(d.minTime=b)})}),d},a.exports});;
Cube("datav:/com/datavmap-2d-layer-footprint/0.2.14/footprintLayer.js",["datav:/npm/three/0.82.0","datav:/npm/chroma-js/1.3.3","datav:/npm/viewport-mercator-project/4.0.2"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;return void 0===g?void 0:g.call(d)},i=null;return a.exports=function(a){var b=a.datavUtils,j=a.CanvasLayer,k=c("datav:/npm/three/0.82.0"),l=c("jquery"),m=c("datav:/npm/chroma-js/1.3.3"),n=c("datav:/npm/viewport-mercator-project/4.0.2").FlatMercatorViewport,o=c("datav:/com/datavmap-2d-layer-footprint/0.2.14/lib/loadStaticRouters.js"),p=c("datav:/com/datavmap-2d-layer-footprint/0.2.14/lib/vertex.js"),q=c("datav:/com/datavmap-2d-layer-footprint/0.2.14/lib/frag.js"),r=c("datav:/com/datavmap-2d-layer-footprint/0.2.14/lib/texture.js"),s={pane:"pointPane",opacity:1};return i||(i=function(a){function c(a){d(this,c);var f=e(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));return f.animationId="",a=b.mergeOptions(s,a),f.options=b.mergeOptions(f.options,a),f.type="point",f.timeTickStep=f.options.footprintSpeed/60,f.startTimeStamp=0,f.endTimeStamp=0,f}return f(c,a),g(c,[{key:"onInit",value:function(){this.initGL(),this.animate()}},{key:"onRender",value:function(){}},{key:"setData",value:function(){}},{key:"onUpdateOptions",value:function(a){this.options=b.mergeOptions(this.options,a),this.timeTickStep=this.options.footprintSpeed/60;var c=m(this.options.footprintColor).gl(),d=new k.Vector3(c[0],c[1],c[2]);this.shaderMaterial.uniforms.uColor.value=d,this.shaderMaterial.uniforms.uOpacity.value=this.options.footprintOpacity,this.shaderMaterial.uniforms.uTimeGap.value=this.options.footprintLength,this.shaderMaterial.uniforms.uSize.value=this.options.footprintSize}},{key:"_onmoveend",value:function(){if(h(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"_onmoveend",this).call(this),this.footprint){this.threeRenderer.setSize(this.width,this.height),this.camera.left=-this.width/2,this.camera.right=this.width/2,this.camera.top=this.height/2,this.camera.bottom=-this.height/2,this.camera.updateProjectionMatrix();var a=this.map.getCenter();this.uniforms&&(this.uniforms.center={value:[a.lng,a.lat]},this.uniforms.zoom={value:this.map.getZoom()},this.uniforms.viewport={value:[this.width,this.height]}),this.footprint.geometry&&(this.footprint.geometry.attributes.position.needsUpdate=!0)}}},{key:"initGL",value:function(){var a=this.scene=new k.Scene,b=this.width,c=this.height,d=this.camera=new k.OrthographicCamera(b/-2,b/2,c/2,c/-2,1,1e3);d.position.z=1;var e=this.threeRenderer=new k.WebGLRenderer({alpha:!0,canvas:this.canvas});e.setClearColor("rgb(0,0,0)",0);var f=new k.AmbientLight(4210752);this.scene.add(f)}},{key:"initFootprint",value:function(a){var b=this,c=o(a,{});this.startTimeStamp=c.minTime,this.endTimeStamp=c.maxTime;var d=this.map.getCenter(),e=m(this.options.footprintColor).gl(),f=new k.Vector3(e[0],e[1],e[2]),g=b.uniforms={center:{value:[d.lng,d.lat]},zoom:{value:b.map.getZoom()},viewport:{value:[b.width,b.height]},uTime:{value:b.startTimeStamp},uColor:{value:f},uOpacity:{value:this.options.footprintOpacity},uTimeGap:{value:this.options.footprintLength},uSize:{value:this.options.footprintSize}},h=b.shaderMaterial=new k.ShaderMaterial({uniforms:g,vertexShader:p,fragmentShader:q,depthTest:!1,blending:k.AdditiveBlending,transparent:!0});h.needsUpdate=!0,h.extensions.derivatives=!0;var i=b.geometry=new k.BufferGeometry,j=new Float32Array(c.positionsDataArray),l=new Float32Array(c.timeDataArray),n=new Float32Array(c.sizeDataArray);i.addAttribute("position",new k.BufferAttribute(j,3)),i.addAttribute("aTime",new k.BufferAttribute(l,1)),b.footprint=new k.Points(i,h),b.scene.add(b.footprint)}},{key:"render",value:function(){}},{key:"animate",value:function(){this.animationId=requestAnimationFrame(this.animate.bind(this)),this.threeRenderer.render(this.scene,this.camera),this.footprint&&(this.footprint.material.uniforms.uTime.value+=this.timeTickStep,this.footprint.material.uniforms.uTime.value>this.endTimeStamp&&(this.footprint.material.uniforms.uTime.value=this.startTimeStamp))}},{key:"show",value:function(){this.canvas&&this.canvas.style&&(this.canvas.style.opacity=1)}},{key:"hide",value:function(){this.canvas&&this.canvas.style&&(this.canvas.style.opacity=0)}},{key:"onRemove",value:function(){cancelAnimationFrame(this.animationId),this.scene.remove(this.footprint),this.footprint&&this.footprint.material&&this.footprint.material.dispose(),this.footprint&&(this.footprint.material=null),this.footprint&&this.footprint.geometry&&this.footprint.geometry.dispose(),this.footprint&&(this.footprint.geometry=null)}}]),c}(j))},a.exports});;
Cube("datav:/com/datavmap-2d-layer-footprint/0.2.14",["datav:/npm/bcore/0.0.21/event"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/bcore/0.0.21/event"),i=c("datav:/com/datavmap-2d-layer-footprint/0.2.14/footprintLayer.js"),j=void 0,k={},l=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.container="string"===typeof a?document.querySelector(a):a,f.apis=c.apis,f.map=null,f.config=c,f.config.visibility=!1,f}return f(b,a),g(b,[{key:"init",value:function(){var a=this.getOptions(),b=i(this.map.L);this.layer=new b(a),this.layer.addTo(this.map)}},{key:"addTo",value:function(a){this.map=a,j=a.L.datavUtils,this.init()}},{key:"getOptions",value:function(){var a=this.config=j.mergeOptions(k,this.config);return a}},{key:"setData",value:function(a){!a.length,this.layer&&this.layer.initFootprint(a)}},{key:"updateOptions",value:function(a){var b=this.config=j.mergeOptions(this.config,a);this.layer&&this.layer.onUpdateOptions(b),this.config.visibility?this.show():this.hide()}},{key:"show",value:function(){this.config.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.config.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"remove",value:function(){this.layer&&this.layer.remove()}}]),b}(h);return a.exports=l,a.exports});