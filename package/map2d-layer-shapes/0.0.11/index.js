Cube('datav:/com/map2d-layer-shapes/0.0.11',['datav:/npm/bcore/0.0.21/event','datav:/npm/ldmap/0.1.29/core/utils','datav:/npm/ldmap/0.1.29/leaflet'],function(d,j,c,i,h,g){function a(){var c=arguments[arguments.length-1];this.options=b.deepMerge(a.options,c),this.shapes={},this.points=[]}var e=c('datav:/npm/bcore/0.0.21/event'),b=c('datav:/npm/ldmap/0.1.29/core/utils'),f=c('datav:/npm/ldmap/0.1.29/leaflet');return a.options={id:function(a,b){return a.id||b},popup:function(a){return a.info?a.info:b.popupFromObject(a)},isClickZoom:!1,clickZoom:{paddingTopBottom:10,paddingLeftRight:10},shape:{normal:{fillColor:'rgb(255,255,100)',fillOpacity:.5,weight:2,dashArray:null,color:'rgb(255,255,100)',opacity:1},hover:{fillOpacity:.8}},lat:null,lng:null,point:{opacity:0,fillOpacity:.8,color:null,weightRatio:2}},a=e.extend(a,{addTo:function(a){a._map&&(a=a._map),this._map=a},getOptions:function(){var a=this.options;return a},parseLatlngs:function(a){return a.map(this.parseLatlng.bind(this))},parseLatlng:function(a){var b=this.options,c=b.lat,d=b.lng;return c&&d?L.latLng(c(a),d(a)):L.latLng(a.lat||a[1],a.lng||a[0])},renderShape:function(c,q){var d=this.options,e=c.type||'circle',l=d.id,h=d.popup,f=l(c,q);e=e.toLowerCase();var a,b,o=this.shapes,g=d.shape.normal,m=d.shape.hover;switch(e){case'circle':var n=this.parseLatlng(c.center);a=L.circle(n,c.radius,g);var j=a.getBounds();var k=j._northEast;var p=j._southWest;var r=k.lat,s=(k.lng+p.lng)/2;a.__top=a.getBounds().getCenter();break;case'polygon':b=this.parseLatlngs(c.latlngs);var i=b[Math.floor(b.length/2)];a=L.polygon(b,g);a.__top=a.getBounds().getCenter();break;case'polyline':b=this.parseLatlngs(c.latlngs);var i=b[Math.floor(b.length/2)];a=L.polyline(b,g);a.__top=a.getBounds().getCenter();break}a.__id=f,a.addTo(this._map),o[f]=a,m&&this.initEventsShape(a,c,f),h&&(a.__popup=h(c)),b&&b.forEach(this.renderPoint.bind(this))},getOptionsPoint:function(){var b=this.options,a=b.point;return a?(a.color=b.shape.normal.color,a.radius=b.shape.normal.weight*a.weightRatio/2,a):void 0},focus:function(a){typeof a==='string'&&(a=this.shapes[a]);var b=this.options.shape,c=b.focus||b.normal;a&&a.setStyle(c)},renderPoint:function(c){var a=this.getOptionsPoint();if(!a)return;var b=L.circleMarker(c,a);b.setRadius(a.radius),b.addTo(this._map),this.points.push(b)},updateOptions:function(a){a=this.options=b.deepMerge(this.options,a),a=this.getOptions(a);var c=this,d=a.shape.normal;this.each(function(a){a.setStyle(d)}),this.points.forEach(function(a){a.setStyle(c.getOptionsPoint())})},each:function(d){var a=this.shapes;for(var b in a){var c=a[b];d(c)}},destory:function(){var a=this._map;this.each(function(b){b.clearAllEventListeners(),a.removeLayer(b)}),this.points.forEach(function(b){a.removeLayer(b)}),this.shapes={},this.points=[]},select:function(a){this.zoomToShape(a),this.focus(a)},zoomToShape:function(e){var c=this._map,a=e.getBounds();a=[[a._southWest.lat,a._southWest.lng],[a._northEast.lat,a._northEast.lng]];var b=this.options.clickZoom,d={padding:[b.paddingTopBottom,b.paddingLeftRight]};c.fitBounds(a,d)},initEventsShape:function(c,h,i){var e=this.options,j=e.shape,a=this,f=this._map,d={data:h,layer:c,id:i},g;c.on('mouseover',function(){g=b.deepMerge(a.options.shape.normal,a.options.shape.hover),c.setStyle(g),a.emit('child-mouseover',d)}).on('mouseout',function(){c.setStyle(a.options.shape.normal),a.emit('child-mouseout',d)}).on('click',function(b){a.emit('child-click',d),a.options.isClickZoom&&a.select(c),c.__popup&&f.openPopup(c.__popup,c.__top)})},data:function(a){a&&(this._data=a)},render:function(a){if(!a)return console.log('地图组件Map2dPolygon未收到数据...');var c;for(var b in a)c=a[b],this.renderShape(c,b)}}),d.exports=a,d.exports})