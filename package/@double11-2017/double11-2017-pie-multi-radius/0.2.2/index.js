// env=undefined => env=publish 
Cube("datav:/com/@double11-2017/double11-2017-pie-multi-radius/0.2.2/pie",["datav:/com/maliang-utils/0.0.6","datav:/npm/bcore/0.0.21/event","datav:/npm/dchart-pie-multi-radius/0.4.2","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.6.1","datav:/npm/chroma-js/1.3.4","datav:/npm/d3/3.5.12"],function(a,b,c){function e(a,b){for(var c=0;a>=b[c].pos;)c++;return c}function d(a,b,c,d){var e=i.cloneDeep(a),f=Math.min(c,d);e.width=c,e.height=d,e.paxis={dr:f*a.label.dr/2,dx:c*a.label.dx/2},e.xaxis=null,e.yaxis=null,e.arc={},e.arc.radius=f*a.arc.outerRadius/2,e.arc.innerRadius=f*a.arc.innerRadius/2,e.arc.outerRadius=f*a.arc.outerRadius/2,e.arc.padAngle=a.arc.padAngle,e.arc.net=a.arc.net.show,e.arc.netColor=a.arc.net.color,e.innerArr=i.map(a.series,"inner"),e.outerArr=i.map(a.series,"outer");var g=a.label.account,h=a.label.cate;return e.paxis.nlabel=function(a){var c=i.sumBy(b,"y"),d="<tspan x=\"0\" dy=\""+h.pos+"\" style=\"font-size: "+h.fontSize+"px; fill: "+h.color+"\">"+a.x+"</tspan>";return(h.show&&d||"")+"<tspan dy=\""+(h.show?g.pos:3)+"\" x=\"0\" style=\"font-size: "+g.fontSize+"px; fill: "+g.color+"\">"+(g.real&&a.y.toFixed(g.decimal)||(100*(a.y/c)).toFixed(g.decimal)+"%")+"</tspan>"},e}var f=c("datav:/npm/bcore/0.0.21/event"),g=c("datav:/npm/dchart-pie-multi-radius/0.4.2"),h=c("datav:/npm/jquery/2.1.4"),i=c("datav:/npm/lodash/4.6.1"),j=c("datav:/com/maliang-utils/0.0.6"),k=c("datav:/npm/chroma-js/1.3.4"),l=c("datav:/npm/d3/3.5.12"),m=Math.PI;return a.exports=f.extend(function(a,b){this.config={theme:{},chart:{background:"transparent"},legend:{},series:[{value:"1",color:"#2F8FBE"}]},this.container=h(a),this._width=this.container.width(),this.init(b)},{init:function(a){this.apis=a.apis;var b=this.mergeConfig(a);this.chart=new g(this.container[0],b)},isSafeNumber:function(a){return i.isNumber(a)&&!i.isNaN(a)&&i.isFinite(a)?a:null},render:function(a,b){var c=this.mergeConfig(b);a=this.data(a),a&&a.length&&(a&&this.chart.render(a,d(c,a,this._width,c.height)),this.updateStyle())},updateStyle:function(){var a=this.config,b=this.chart.el,c=this;if(b){b.selectAll(".serie-bg").style("stroke","none"),b.select(".con-svg").style("background","transparent"),b.select(".bg-outer-circle").style("stroke-width","2px"),b.selectAll(".bg-outer-circle, .bg-inner-circle").style({fill:"none",stroke:a.outerBorderColor||"#fff"}),b.selectAll(".series-pies .serie").style("stroke","none"),b.selectAll(".serie-cord").style({stroke:a.label.line.color,"stroke-width":a.label.line.width+"px"}),b.selectAll(".serie-label").style("text-anchor",function(a){return(a.endAngle-a.startAngle)/2+a.startAngle<=m?"end":"start"}).style("font-weight",a.label.account.weight),b.select("defs").remove(),this.clipath=b.select(".series").insert("defs",".series-cords").append("clipPath").attr("id","pieMultiClipath");var d=b.select(".series-pies");d.selectAll("path").each(function(){c.clipath[0][0].appendChild(this)}),b.select(".clip-main").remove(),this.center=b.select(".series").append("g").style({"clip-path":"url(#pieMultiClipath)"}).attr({class:"clip-main",transform:b.select(".series-pies").attr("transform")});var f=a.arc.colors;this.scales=i.map(f,function(a,b,c){return 0==b?null:k.scale([c[b-1].color,a.color]).mode("lch").domain([c[b-1].pos,a.pos])});var g=l.range(360).map(function(a,b){var d=(b-90+360)%360/360;return{startAngle:b*(m/180),endAngle:(b+1)*(m/180),fill:c.scales[e(d,f)](d)}});this.pie=l.svg.arc().innerRadius(0).outerRadius(Math.min(this._width,a.height)*a.arc.outerRadius/2),this.bgPie=this.center.selectAll(".bg-pie").append("g").data(g).enter().append("path").attr({class:"bg-pie",d:this.pie}).style({fill:function(a){return a.fill},stroke:function(a){return a.fill},"stroke-width":0.5})}},setColors:function(){},hasS:function(a){var b=0;return i.map(a,function(a){void 0!==a.s&&b++}),a&&b===a.length||0!==b&&!1},data:function(a){return a&&(this.__data=i.clone(a)),this._data=this.hasS(this.__data)?j.threeD2Two(this.__data,"x","y","s",j.getSeriesValue(this.config.series,"value")):i.clone(this.__data),this._data},mergeConfig:function(a){return a?(this.config.theme=i.defaultsDeep(a.theme||{},this.config.theme),this.setColors(),a.series&&(this.config.series=a.series),this.config=i.defaultsDeep(a||{},this.config),this.config):this.config},resize:function(a,b){this._width=a,this.config.height=b,this.render()},clear:function(){this.chart&&this.chart.empty()},destroy:function(){this.chart&&this.chart.destroy(),this._data=this.__data=null},clean:function(){}}),a.exports});;
Cube("datav:/com/@double11-2017/double11-2017-pie-multi-radius/0.2.2",["datav:/com/legend/0.0.8","datav:/npm/bcore/0.0.21/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.6.1"],function(a,b,c){var d=c("datav:/npm/bcore/0.0.21/event"),e=c("datav:/npm/jquery/2.1.4"),f=c("datav:/npm/lodash/4.6.1"),g=c("datav:/com/@double11-2017/double11-2017-pie-multi-radius/0.2.2/pie"),h=c("datav:/com/legend/0.0.8");return a.exports=d.extend(function(a,b){this.config={theme:{},chart:{background:"transparent"},legend:{innerStyle:{"line-height":1.3}},series:[{value:"1",color:"#2F8FBE"}]},this.container=e(a).css("padding","10px 0"),this.chart=null,this.legend=null,this.init(b)},{init:function(a){this.apis=a.apis;var b=this.mergeConfig(a),c=b.legend,d=c.layout.loc.split("-")[0];this.chartDom=e("<div class=\"dchart-pie-multi-radius\" style=\"width: 100%;\"></div>"),this.legendDom=e("<div class=\"dchart-legend\" style=\"left: 0;width: 100%;\"></div>"),"bottom"===d?(this.container.append(this.chartDom),this.container.append(this.legendDom)):(this.container.append(this.legendDom),this.container.append(this.chartDom)),this.legend=new h(this.legendDom[0],b.legend),this.chartDom.height(this.container.height()-(b.legend.show&&this.legendDom.height()||0)),this.chart=new g(this.chartDom[0],b),this.legendDom.css("display",c.show&&"block"||"none")},render:function(a,b){var c=this.mergeConfig(b);if(a=this.data(a),a&&a.length){f.map(c.series,function(b,c){a[c]&&(b.showName=a[c].x)}),this.legend.render(c.series,c.legend);var d=this.container.height()-(c.legend.show&&this.legendDom.height()||0);this.chartDom.height(d),this.config.height=d,a&&this.chart.render(a,c)}},updateStyle:function(){},setColors:function(){},data:function(a){return a&&(this._data=f.clone(a),this._data.length&&this._data.forEach(function(a){a.y=f.toNumber(a.y)})),this._data},mergeConfig:function(a){return a?(a.series&&(this.config.series=a.series),a.arc&&a.arc.colors&&this.config&&this.config.arc&&(this.config.arc.colors=a.arc.colors),this.config=f.defaultsDeep(a||{},this.config),this.config.legend.textarea.fontFamily=this.config.fontFamily,this.config):this.config},resize:function(a,b){this.chart.resize(a,b-(this.config.legend.show&&this.legendDom.outerHeight()||0)-20)},updateLegendLayout:function(a){var b=this.config.legend;if(b.show!==a.show&&(this.legendDom.css("display",a.show&&"block"||"none"),this.config.chart.height=this.container.height()-(a.show&&this.legendDom.height()||0)),b.textarea.fontSize!==a.textarea.fontSize&&(this.legendDom.find(".legend-item").css("fontSize",a.textarea.fontSize),this.config.chart.height=this.container.height()-(a.show&&this.legendDom.height()||0)),JSON.stringify(b.layout.margin)!==JSON.stringify(a.layout.margin)){var c=a.layout.margin;this.legendDom.find(".legend-item").css("margin",c.vertiInterval+"px "+c.horiInterval+"px"),this.config.chart.height=this.container.height()-(a.show&&this.legendDom.height()||0)}var d=b.layout.loc.split("-")[0],e=a.layout.loc.split("-")[0];d!==e&&("top"===e?this.container[0].appendChild(this.chartDom[0]):"bottom"===e&&this.container[0].appendChild(this.legendDom[0])),this.render(null,{legend:a})},clear:function(){this.chart&&this.chart.clear()},destroy:function(){this.chart&&this.chart.destroy(),this.chart=null,this.legend&&this.legend.destroy(),this.legend=null,this.chartDom=null,this.legendDom=null,this.container&&this.container.empty(),this._data=null}}),a.exports});