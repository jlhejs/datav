// env=undefined => env=publish 
Cube("datav:/com/@datav-3d/datav-engine-sprite-text/0.0.8/textLabel",[],function(a){function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var c=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),d=document.createElement("canvas"),e=d.getContext("2d"),f=function(a,b,c,d){return e.font=c+" "+d+"px "+b,{width:Math.ceil(e.measureText(a).width),height:d}},g=function(a,b,c,f,g,h,i){d.width=h,d.height=i,e.font=c+" "+f+"px "+b,e.textBaseline="hanging",e.fillStyle=g,e.fillText(a,0,0)};return a.exports=function(){function a(c){b(this,a),this.options=c}return c(a,[{key:"drawTextLabel",value:function(a,b,c){var e=this.options,h=e.padding,i=e.background,j=e.splitLine,k=this.options.title,l=f(b,k.fontFamily,k.fontWeight,k.fontSize),m=this.options.content,n=f(c,m.fontFamily,m.fontWeight,m.fontSize),o=this.options.icon,p=a?o.width:0,q=a?o.height:0,r=Math.max(l.height+n.height+h.titleContent,q),s=p+Math.max(l.width,n.width);s+=h.left+h.iconTitleContent+h.right,r+=h.bottom+h.top;var t=document.createElement("canvas"),u=t.getContext("2d");t.width=s,t.height=r,u.fillStyle=i.color,u.fillRect(0,0,s,r),u.strokeStyle=i.outlineColor;var v=i.outlineWidth;u.lineWidth=v,u.strokeRect(0.5*v,0.5*v,s-v,r-v);var w=h.left,x=void 0;return a&&(x=0.5*(t.height-q),u.drawImage(a,w,x,p,q)),s=l.width,r=l.height,g(b,k.fontFamily,k.fontWeight,k.fontSize,k.fontColor,s,r),w+=q+h.iconTitleContent,x=0.5*(t.height-h.titleContent)-r,u.drawImage(d,w,x,s,r),u.strokeStyle=j.color,u.lineWidth=j.width,u.moveTo(w,0.5*t.height),u.lineTo(w+Math.max(l.width,n.width),0.5*t.height),u.stroke(),s=n.width,r=n.height,g(c,m.fontFamily,m.fontWeight,m.fontSize,m.fontColor,s,r),x=0.5*(t.height+h.titleContent),u.drawImage(d,w,x,s,r),t}},{key:"updateOptions",value:function(a){this.options=a}}]),a}(),a.exports});;
Cube("datav:/com/@datav-3d/datav-engine-sprite-text/0.0.8/spriteText",[],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;return void 0===g?void 0:g.call(d)};return a.exports=function(a){var b=a.THREE,i=a.Utils,j=c("datav:/com/@datav-3d/datav-engine-sprite-text/0.0.8/textLabel"),k=new b.ImageLoader;return k.setCrossOrigin("*"),function(a){function c(a){d(this,c);var b=e(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));return b.options=i.mergeOptions({isSceneGroup:!1,sceneNames:[{sceneName:"main"}],size:0.1,padding:{left:32,right:64,top:16,bottom:16,titleContent:8,iconTitleContent:8},background:{color:"rgba(100, 100, 100, 1.0)",outlineWidth:1,outlineColor:"#fff"},title:{fontFamily:"Microsoft Yahei",fontWeight:"normal",fontSize:24,fontColor:"#fff"},content:{fontFamily:"Microsoft Yahei",fontWeight:"normal",fontSize:24,fontColor:"#fff"},icon:{width:32,height:64}},a||{}),b.classNameAlias="SpriteTextLayer",b}return f(c,a),g(c,[{key:"init",value:function(){this.textLabel=new j(this.options),this.group.ignoreWaterReflection=!0,this._imagesCache=new Map,this._sprites=[]}},{key:"addTo",value:function(a){h(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"addTo",this).call(this,a),this.init()}},{key:"show",value:function(){this.options.visible=!0,h(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"show",this).call(this)}},{key:"hide",value:function(){this.options.visible=!1,h(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"hide",this).call(this)}},{key:"fetchImage",value:function(a){var b=this._imagesCache.get(a);return b||(b=new Promise(function(b,c){k.load(a,b,null,c)}),this._imagesCache.set(a,b)),b}},{key:"setData",value:function(a){var b=this;this.remove(),a.forEach(function(a){a.iconUrl?b.fetchImage(a.iconUrl).then(function(c){return b.createSprite(a,c)}):b.createSprite(a)})}},{key:"createSprite",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=arguments[1],d=a.x,e=a.y,f=a.z,g=a.title,h=a.content;if((d="string"===typeof d?parseFloat(d):d,e="string"===typeof e?parseFloat(e):e,f="string"===typeof f?parseFloat(f):f,"number"===typeof d&&"number"===typeof e&&"number"===typeof f)&&(g||h||c)){var i=this.textLabel.drawTextLabel(c,g,h),j=new b.CanvasTexture(i);j.anisotropy=16,j.needsUpdate=!0;var k=new b.SpriteMaterial({map:j,depthWrite:!1}),l=new b.Sprite(k);l.userData={img:c,title:g,content:h},l.scale.set(this.options.size*i.width/i.height,this.options.size,1),l.position.fromArray(this.getProjPos(d,e,f)),this.addObject(l),this._sprites.push(l)}}},{key:"updateOptions",value:function(a){var b=this;this.options=i.mergeOptions(this.options,a||{}),this.textLabel.updateOptions(this.options),this._sprites.forEach(function(a){var c=a.userData,d=c.img,e=c.title,f=c.content,g=b.textLabel.drawTextLabel(d,e,f);a.material.map.image=g,a.material.map.needsUpdate=!0,a.scale.set(b.options.size*g.width/g.height,b.options.size,1)})}},{key:"disposeSprites",value:function(){var a=this;this._sprites.forEach(function(b){a.removeObject(b),b.geometry.dispose(),b.material.dispose();var c=b.material.map;c&&c.dispose()}),this._sprites.length=0}},{key:"remove",value:function(){this.disposeSprites(),this._imagesCache.forEach(function(a){a.then(function(a){a.src=""})}),this._imagesCache.clear()}}]),c}(a.Layer)},a.exports});;
Cube("datav:/com/@datav-3d/datav-engine-sprite-text/0.0.8",["datav:/npm/eventemitter3/3.0.0"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=c("datav:/com/@datav-3d/datav-engine-sprite-text/0.0.8/spriteText"),j=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=c,f}return f(b,a),g(b,[{key:"addTo",value:function(a){this.viewer=a,this.initLayer()}},{key:"initLayer",value:function(){var a=i(this.viewer);this.layer=new a(this.options),this.layer.addTo(this.viewer)}},{key:"setData",value:function(a){a&&this.layer&&this.layer.setData(a)}},{key:"show",value:function(){this.layer&&this.layer.show()}},{key:"hide",value:function(){this.layer&&this.layer.hide()}},{key:"getThemableConfig",value:function(a){var b=a.text,c=b.textlabelBgBorderColor,d=b.textlabelColor,e=b.textlabelBgColor;return void 0===c&&(c=e),{title:{fontColor:d},content:{fontColor:d},splitLine:{color:d},background:{color:e,outlineColor:c}}}},{key:"updateOptions",value:function(a){this.layer&&this.layer.updateOptions(a)}},{key:"destroy",value:function(){this.layer&&(this.layer.remove(),this.layer=null)}}]),b}(h);return a.exports=j,a.exports});