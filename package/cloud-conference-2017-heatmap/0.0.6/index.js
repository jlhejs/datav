// env=undefined => env=publish 
Cube("datav:/com/cloud-conference-2017-heatmap/0.0.6",["datav:/npm/three/0.83.0","datav:/npm/bcore/0.0.21/utils","datav:/npm/bcore/0.0.21/event","datav:/npm/simpleheat/0.4.0"],function(a,b,c){const d=c("datav:/npm/three/0.83.0"),e=c("datav:/npm/bcore/0.0.21/utils"),f=c("datav:/npm/bcore/0.0.21/event"),g=c("datav:/npm/simpleheat/0.4.0"),h={width:145,height:75,minOpacity:0.6,maxZoom:18,radius:5,blur:15,max:1,offsetX:0,offsetY:0,offsetZ:0,rotationX:0,rotationY:0,rotationZ:0};return a.exports=class extends f{constructor(a,b){super(),this.options=e.deepMerge(h,b||{})}addTo(a){a||console.error("heatmap need scene"),this.scene=a,this.init()}init(){let a=this.options,b=a.width,c=a.height,e=this.canvas=document.createElement("canvas");e.width=b,e.height=c,this.heatmap=new g(e),this.updateHeatmapOptions();let f=this.texture=new d.Texture(e),h=new d.PlaneBufferGeometry(1,1),i=new d.MeshBasicMaterial({map:f,transparent:!0,depthWrite:!1,color:16776960}),j=this.mesh=new d.Mesh(h,i);this.setRotation(a.rotationX,a.rotationY,a.rotationZ),this.setPosition(a.offsetX,a.offsetY,a.offsetZ),j.scale.set(b,c,1),this.scene.add(j)}setData(a){a||console.error("heatmap need data"),this.ds=a,this.render()}render(){this.heatmap.resize();let a=this.options,b=this.ds.map((a)=>{return[a.x,a.y,a.value||1]});this.heatmap.data(b).draw(a.minOpacity),this.texture.needsUpdate=!0}redraw(){let a=this.options;this.updateCanvas(),this.updateHeatmapOptions(),this.render(),this.setRotation(a.rotationX,a.rotationY,a.rotationZ),this.setPosition(a.offsetX,a.offsetY,a.offsetZ)}setRotation(a,b,c){var d=Math.PI;this.mesh&&this.mesh.rotation.set(a*d,b*d,c*d)}setPosition(a,b,c){this.mesh&&this.mesh.position.set(a,b,c)}updateCanvas(){let a=this.options;this.canvas.width=a.width,this.canvas.height=a.height,this.mesh.scale.set(a.width,a.height,1)}updateHeatmapOptions(){let a=this.options;this.heatmap.radius(a.radius,a.blur),a.gradient&&this.heatmap.gradient(a.gradient),a.max&&this.heatmap.max(a.max)}updateOptions(a){this.options=e.deepMerge(this.options,a||{}),this.redraw()}remove(){this.scene.remove(this.mesh),this.mesh&&this.mesh.dispose&&this.mesh.dispose(),this.mesh.geometry&&this.mesh.geometry.dispose(),this.mesh.material&&this.mesh.material.dispose(),this.mesh=null,this.heatmap.clear(),this.heatmap=null,this.canvas=null}},a.exports});