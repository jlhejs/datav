// env=undefined => env=publish 
Cube("datav:/com/datavmap-canvas2d-tile-wms/0.0.19/src/wms",[],function(a){function b(a,b){var c={};for(var d in a)0<=b.indexOf(d)||Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d]);return c}function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function e(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var f=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();return a.exports=function(a){return function(h){function i(a,b,e){c(this,i);var f=d(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,a,b));return f.trans=e,f}return e(i,h),g(i,[{key:"getTileUrl",value:function(b){var c=this._tileCoordsToNwSe(b),d=this._crs,e=a.bounds(d.project(c[0]),d.project(c[1])),f=e.min,g=e.max,h=this.trans,i=h.translateX,j=h.translateY;f.x+=i,g.x+=i,f.y+=j,g.y+=j;var k=[f.x,f.y,g.x,g.y].join(","),l=a.TileLayer.prototype.getTileUrl.call(this,b),m=Object.assign({},this.wmsParams),n=""+m.epsg;return"4490"==n?(m.crs="EPSG:4490",m.srs="EPSG:4490"):(m.crs="EPSG:"+m.epsg,m.srs="EPSG:"+m.epsg),l+a.Util.getParamString(m,l,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+k}},{key:"updateOptions",value:function(a){var c=a.url,d=a.options;this.setUrl(c);var e=d.translateX,g=d.translateY,h=b(d,["translateX","translateY"]),i=Object.assign(this.options,f({},h));this.trans={translateX:e,translateY:g},this.updateCrs(h),this.setParams(i)}},{key:"updateCrs",value:function(a){this._crs=a.crs;var b="1.3.0"===this.wmsParams.version?"crs":"srs";this.wmsParams[b]="EPSG:"+a.epsg;var c=""+a.epsg;"4490"==c?(this.wmsParams.crs="EPSG:4490",this.wmsParams.srs="EPSG:4490"):(this.wmsParams.crs="EPSG:"+c,this.wmsParams.srs="EPSG:"+c)}}]),i}(a.TileLayer.WMS)},a.exports});;
Cube("datav:/com/datavmap-canvas2d-tile-wms/0.0.19/src/filter",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=c("datav:/npm/safely-merge/1.0.1"),j=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.DEFAULTS={brightness:1,contrast:1,grayscale:0,hueRotate:0,invert:0,saturate:1,sepia:0,blur:0},f.options=i(f.DEFAULTS,c),f.container=a,f}return f(b,a),g(b,[{key:"reset",value:function(){this.updateFilter(this.DEFAULTS)}},{key:"updateFilter",value:function(a){this.container.style.transition="-webkit-filter .2s",this.container.style["-webkit-filter"]="brightness("+this.toPercent(a.brightness)+") contrast("+this.toPercent(a.contrast)+") grayscale("+this.toPercent(a.grayscale)+") hue-rotate("+a.hueRotate+"deg) invert("+this.toPercent(a.invert)+") saturate("+this.toPercent(a.saturate)+") sepia("+this.toPercent(a.sepia)+") blur("+a.blur+"px)"}},{key:"toPercent",value:function(a){return(Math.round(1e4*a)/100).toFixed(2)+"%"}},{key:"updateOptions",value:function(a){this.options=i(this.options,a),this.updateFilter(this.options)}}]),b}(h);return a.exports=j,a.exports});;
Cube("datav:/com/datavmap-canvas2d-tile-wms/0.0.19/src/tileLayer",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){var c={};for(var d in a)0<=b.indexOf(d)||Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d]);return c}function e(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function h(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var i=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},j=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),k=c("datav:/npm/eventemitter3/3.0.0"),l=c("datav:/npm/safely-merge/1.0.1"),m=c("datav:/com/datavmap-canvas2d-tile-wms/0.0.19/src/filter"),n=c("datav:/com/datavmap-canvas2d-tile-wms/0.0.19/src/wms"),o=function(a){function b(a,c){var d;f(this,b);var h=g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this)),i=(d={zoomRange:[0,18],minZoom:0,maxZoom:18,translateX:.2,translateY:.35,format:"image/png",transparent:!0,layers:"",crs:"3857",url:"",errorTileUrl:"",subdomains:[],tms:!1,crossOrigin:!1,maskColor:"rgba(0,0,0,0)",opacity:1},e(d,"url","GeoQBlue"),e(d,"isAutoRefresh",!1),e(d,"refreshTime",10),e(d,"filter",{show:!1,brightness:1,contrast:1,grayscale:0,hueRotate:0,invert:0,saturate:1,sepia:0,blur:0}),d);return h.options=l(i,c),h.options.minZoom=c.zoomRange[0],h.options.maxZoom=c.zoomRange[1],h.options.visibility=!0,h.map=a,h.init(),h}return h(b,a),j(b,[{key:"init",value:function(){var a=this,b=this.tileOptions=this.getTileOptions(),c=b.options,e=c.translateX,f=c.translateY,g=d(c,["translateX","translateY"]),h=this.map.L,i=n(h,this.map);this.layer=new i(b.url,g,{translateX:e,translateY:f}),this.layer.addTo(this.map),this.initFilter(),this.updateFilter(this.options),this.options.isAutoRefresh&&this.autoRefresh();var j=this.mask=document.createElement("div"),k=this.map.getSize();j.style.width=k.x+"px",j.style.height=k.y+"px",j.style.position="absolute",j.style.top=0,j.style.left=0,j.style.zIndex=1,j.style.pointerEvents="none",j.style.background=this.options.maskColor||"rgba(0,0,0,0)",j.setAttribute("class","leaflet-mask"),this.map.getPane("tilePane").appendChild(j),this.map.on("move",function(){if(a.mask){var b=a.map.getSize();a.mask.style.width=b.x+"px",a.mask.style.height=b.y+"px";var c=a.map.L.DomUtil.getPosition(a.map.getPane("mapPane"));c&&a.map.L.DomUtil.setPosition(a.mask,{x:-c.x,y:-c.y})}},this),this.options.visibility?this.show():this.hide()}},{key:"getTileOptions",value:function(){var a=this.options,b=a.url,c=a.crs,d=a.version,e=a.layers,f=a.format,g=a.transparent,h=a.minZoom,i=a.maxZoom,j=a.maxNativeZoom,k=a.opacity,l=a.translateX,m=a.translateY,n=L.CRS["EPSG"+("4490"===""+c?4326:c)],o="China"+("3857"===c?"":"_4326"),p={url:"https://iserver.supermap.io/iserver/services/map-china400/wms111/"+o,options:{layers:o}},q={url:""===b?p.url:b,options:{minZoom:h||0,maxZoom:i||20,maxNativeZoom:j||18,opacity:k||1,crs:n,epsg:c,layers:e,version:d,format:f,transparent:g,translateX:l,translateY:m}};return""===b&&(q.options=Object.assign(q.options,p.options)),q}},{key:"initFilter",value:function(){this.filter=new m(this.layer.getContainer(),this.options.filter)}},{key:"autoRefresh",value:function(){var a=this,b=this.tileOptions.url;"string"===typeof b?this.layer&&this.layer.setUrl(b+(b.split("?")[1]?"&":"?")+"random="+Math.random()):this.layer&&this.layer.setUrl(b);var c=this.options.refreshTime;this.timer=setTimeout(function(){a.autoRefresh&&a.autoRefresh()},60*(1e3*c))}},{key:"stopAutoRefresh",value:function(){this.timer&&clearTimeout(this.timer),this.timer=null}},{key:"isLayerUpdate",value:function(a){var b=this,c=a.url,e=a.options,f=e.translateX,g=e.translateY,h=d(e,["translateX","translateY"]),j=Object.keys(h),k=Object.keys(this.layer.trans),l=j.some(function(a){return b.layer.options[a]!==i({},h)[a]})||k.some(function(c){return b.layer.trans[c]!==a.options[c]})||this.layer._url!==c;return l}},{key:"updateOptions",value:function(a){this.options=l(this.options,a),this.options.minZoom=a.zoomRange[0],this.options.maxZoom=a.zoomRange[1];var b=this.tileOptions=this.getTileOptions();this.isLayerUpdate(b)&&this.layer.updateOptions(b),this.mask.style.background=a.maskColor,this.layer&&(this.options.visibility?this.layer.setOpacity(a.opacity):this.layer.setOpacity(0)),this.timer&&this.stopAutoRefresh(),this.options.isAutoRefresh&&this.autoRefresh(),this.updateFilter(a);var c=this.map.getZoom();c<this.options.minZoom||c>this.options.maxZoom?(this.layer&&this.layer.setOpacity(0),this.mask&&(this.mask.style.display="none")):(this.layer&&this.layer.setOpacity(this.options.opacity),this.mask&&(this.mask.style.display="block"))}},{key:"updateFilter",value:function(a){a.filter.show?this.filter.updateOptions(a.filter):this.filter&&this.filter.reset()}},{key:"setZIndex",value:function(a){this.layer&&this.layer.setZIndex(a),this.mask&&(this.mask.style.zIndex=a+1)}},{key:"show",value:function(){this.options.visibility=!0,this.layer&&this.layer.setOpacity(this.options.opacity),this.mask&&(this.mask.style.display="block")}},{key:"hide",value:function(){this.options.visibility=!1,this.layer&&this.layer.setOpacity(0),this.mask&&(this.mask.style.display="none")}},{key:"destroy",value:function(){this.stopAutoRefresh(),this.mask&&this.mask.remove(),this.mask=null,this.layer&&this.layer.remove(),this.layer=null,this.options=null,this.filter=null,this.tileOptions=null,delete this.options,this.mask,this.filter,this.tileOptions,this.layer}}]),b}(k);return a.exports=o,a.exports});;
Cube("datav:/com/datavmap-canvas2d-tile-wms/0.0.19",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/com/datavmap-canvas2d-tile-wms/0.0.19/src/tileLayer"),k=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=i({renderer:"basemap",basemapType:"tile"},c),f.options.minZoom=c.zoomRange[0],f.options.maxZoom=c.zoomRange[1],f.options.visibility=!0,f}return f(b,a),g(b,[{key:"addTo",value:function(a,b){this.options.id=b,this.layer=new j(a,this.options)}},{key:"updateOptions",value:function(a){this.options=i(this.options,a),this.options.minZoom=a.zoomRange[0],this.options.maxZoom=a.zoomRange[1],this.layer&&this.layer.updateOptions&&this.layer.updateOptions(a)}},{key:"setZIndex",value:function(a){this.layer&&this.layer.setZIndex&&this.layer.setZIndex(a)}},{key:"show",value:function(){this.options.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.options.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"destroy",value:function(){this.layer&&this.layer.destroy&&this.layer.destroy(),this.layer=null,this.options=null}}]),b}(h);return a.exports=k,a.exports});