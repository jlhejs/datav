// env=undefined => env=publish 
Cube("datav:/com/datavmap-canvas2d-heatmap/2.0.33/src/simpleheat",[],function(a){function b(a){return this instanceof b?void(this._canvas=a="string"===typeof a?document.getElementById(a):a,this._ctx=a.getContext("2d"),this._width=a.width,this._height=a.height,this._max=1,this._data=[]):new b(a)}return"undefined"!==typeof a&&(a.exports=b),b.prototype={defaultRadius:25,defaultGradient:{1:"red",0.4:"blue",0.6:"cyan",0.7:"lime",0.8:"yellow"},data:function(a){return this._data=a,this},max:function(a){return this._max=a,this},add:function(a){return this._data.push(a),this},clear:function(){return this._data=[],this},radius:function(a,b){b=void 0===b?15:b;var c=this._circle=this._createCanvas(),d=c.getContext("2d"),e=this._r=a+b;return c.width=c.height=2*e,d.shadowOffsetX=d.shadowOffsetY=2*e,d.shadowBlur=b,d.shadowColor="black",d.beginPath(),d.arc(-e,-e,a,0,2*Math.PI,!0),d.closePath(),d.fill(),this},resize:function(){this._width=this._canvas.width,this._height=this._canvas.height},gradient:function(a){var b=this._createCanvas(),c=b.getContext("2d"),d=c.createLinearGradient(0,0,0,256);for(var e in b.width=1,b.height=256,a)d.addColorStop(+e,a[e]);return c.fillStyle=d,c.fillRect(0,0,1,256),this._grad=c.getImageData(0,0,1,256).data,this},draw:function(a){this._circle||this.radius(this.defaultRadius),this._grad||this.gradient(this.defaultGradient);var b=this._ctx;b.clearRect(0,0,this._width,this._height);for(var c,d=0,e=this._data.length;d<e;d++)c=this._data[d],b.globalAlpha=a+c[2]*(1-a),console.log(b.globalAlpha),b.drawImage(this._circle,c[0]-this._r,c[1]-this._r);var f=b.getImageData(0,0,this._width,this._height);return this._colorize(f.data,this._grad),b.putImageData(f,0,0),this},_colorize:function(a,b){for(var c,d=0,e=a.length;d<e;d+=4)c=4*a[d+3],c&&(a[d]=b[c],a[d+1]=b[c+1],a[d+2]=b[c+2])},_createCanvas:function(){return"undefined"===typeof document?new this._canvas.constructor:document.createElement("canvas")}},a.exports});;
Cube("datav:/com/datavmap-canvas2d-heatmap/2.0.33/src/heatmapLayer.js",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/com/datavmap-canvas2d-heatmap/2.0.33/src/simpleheat"),k=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=i({zoomRange:[0,18],minZoom:0,maxZoom:22,opacity:1,minOpacity:0.8,radius:10,blur:10,gradient:{0.2:"rgb(0,0,255)",0.4:"rgb(0,0,255)",0.6:"rgb(0,255,0)",0.8:"rgb(255,255,0)","1.0":"rgb(255,0,0)"}},c),f.options.minZoom=c.zoomRange[0],f.options.maxZoom=c.zoomRange[1],f.options.visibility=!0,f.map=a,f.init(),f}return f(b,a),g(b,[{key:"init",value:function(){this.container=document.createElement("canvas");var a=this.padding=this.map.canvasLayer&&this.map.canvasLayer.options&&this.map.canvasLayer.options.padding?this.map.canvasLayer.options.padding:0.1,b=this.map.getSize();this.offset=b.multiplyBy(-a).round();var c=b.x-2*this.offset.x,d=b.y-2*this.offset.y,e=this.map.devicePixelRatio||1;this.container.width=c*e,this.container.height=d*e,this.container.style.width=c+"px",this.container.style.height=d+"px",this.ctx=this.container.getContext("2d"),this.ctx.scale(e,e),this.data=[],this.heat=j(this.container)}},{key:"render",value:function(a){var b=this;this.data=[],a&&a.length&&a.map(function(a){a.hasOwnProperty("lng")&&a.hasOwnProperty("lat")&&b.data.push([+a.lng,+a.lat,+a.value||1])}),this.onRender()}},{key:"onRender",value:function(){var a=this.options;if(!a||a.visibility){this.options.visibility=a.visibility;var b=this.map.devicePixelRatio||1;this.heat._width=this.container.width*b,this.heat._height=this.container.height*b,this.heat.radius(a.radius||this.heat.defaultRadius,a.blur),a.gradient&&this.heat.gradient(a.gradient),a.max&&this.heat.max(a.max);var c,d,e,f,g,h,i,j,l,k=[],m=this.heat._r,n=this.map.getSize(),o=new this.map.L.Bounds(this.map.L.point([-m,-m]),n.add([m,m])),p=void 0===this.options.max?1:this.options.max,q=void 0===this.options.maxZoom?this.map.getMaxZoom():this.options.maxZoom,s=1/Math.pow(2,Math.max(0,Math.min(q-this.map.getZoom(),12))),t=m/2,u=[],v=this.map._getMapPanePos(),w=v.x%t,x=v.y%t;for(c=0,d=this.data.length;c<d;c++)e=this.map.latLngToContainerPoint([this.data[c][1],this.data[c][0]]),o.contains(e)&&(g=~~((e.x-w)/t)+2,h=~~((e.y-x)/t)+2,l=+this.data[c][2]||1,u[h]=u[h]||[],f=u[h][g],f?(f[0]=(f[0]*f[2]+(e.x-this.offset.x)*l)/(f[2]+l),f[1]=(f[1]*f[2]+(e.y-this.offset.y)*l)/(f[2]+l),f[2]+=l):u[h][g]=[e.x-this.offset.x,e.y-this.offset.y,l]);var y=null,z=null;for(c=0,d=u.length;c<d;c++)if(u[c])for(i=0,j=u[c].length;i<j;i++)f=u[c][i],f&&((null===y||null===z)&&(y=f[2],z=f[2]),y=Math.min(y,f[2]),z=Math.max(z,f[2]),k.push([~~(f[0]+0.5),~~(f[1]+0.5),f[2]]));var A=[];for(c=0;c<k.length;c++)f=k[c],A.push([f[0],f[1],+([f[2]-y]/[z-y]).toFixed(2)]);this.heat.data(A).draw(a.minOpacity)}}},{key:"onResize",value:function(a,b){var c=this.map.devicePixelRatio||1;this.container.width=a*c,this.container.height=b*c,this.container.style.width=a+"px",this.container.style.height=b+"px",this.ctx.scale(c,c)}},{key:"updateOptions",value:function(a){a&&(this.options=i(this.options,a),this.options.minZoom=a.zoomRange[0],this.options.maxZoom=a.zoomRange[1],this.onRender())}},{key:"show",value:function(){this.options.visibility=!0,this.data&&this.data.length&&this.onRender()}},{key:"hide",value:function(){this.options.visibility=!1,this.heat.clear()}},{key:"destroy",value:function(){this.data=null,this.options=null,this.padding=null,this.offset=null,this.heat.clear(),this.heat=null,this.container=null,delete this.data,this.options,this.padding,this.offset,this.heat,this.container}}]),b}(h);return a.exports=k,a.exports});;
Cube("datav:/com/datavmap-canvas2d-heatmap/2.0.33",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/com/datavmap-canvas2d-heatmap/2.0.33/src/heatmapLayer.js"),k=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=i({renderer:"canvas"},c),f.options.minZoom=c.zoomRange[0],f.options.maxZoom=c.zoomRange[1],f.options.visibility=!0,f}return f(b,a),g(b,[{key:"addTo",value:function(a){this.layer=new j(a,this.options)}},{key:"onRender",value:function(){this.layer&&this.layer.onRender&&this.layer.onRender()}},{key:"onResize",value:function(a,b){this.layer&&this.layer.onResize&&this.layer.onResize(a,b)}},{key:"render",value:function(a){this.layer&&this.layer.render&&this.layer.render(a)}},{key:"updateOptions",value:function(a){this.options=i(this.options,a),this.options.minZoom=a.zoomRange[0],this.options.maxZoom=a.zoomRange[1],this.layer&&this.layer.updateOptions&&this.layer.updateOptions(a)}},{key:"show",value:function(){this.options.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.options.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"destroy",value:function(){this.layer&&this.layer.destroy&&this.layer.destroy(),this.options=null,this.layer=null,delete this.options,this.layer}}]),b}(h);return a.exports=k,a.exports});