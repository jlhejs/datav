// env=undefined => env=publish 
Cube("datav:/com/datav-slider/0.0.8",["datav:/npm/bcore/0.0.18/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.6.1"],function(a,b,c){var d=c("datav:/npm/bcore/0.0.18/event"),f=c("datav:/npm/jquery/2.1.4"),e=c("datav:/npm/lodash/4.6.1");return Date.prototype.pattern=function(a){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":0==this.getHours()%12?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},c={0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"};for(var d in /(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(a)&&(a=a.replace(RegExp.$1,(1<RegExp.$1.length?2<RegExp.$1.length?"/u661f/u671f":"/u5468":"")+c[this.getDay()+""])),b)new RegExp("("+d+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?b[d]:("00"+b[d]).substr((""+b[d]).length)));return a},a.exports=d.extend(function(a,b){this.container=f(a),this.config={width:this.container.width(),height:this.container.height(),slider:{"background-color":"#fff","margin-left":20,"margin-right":20,width:80,height:18,stepNum:20,color:"#f5f5f5","border-color":"#c5c5c5","border-width":1},button:{radius:16,color:"#ededed","border-color":"#c5c5c5"},preText:{context:"2015-01-01 00:00:00",format:"yyyy-MM-dd",textStyle:{fontFamily:"Microsoft Yahei",fontSize:18,color:"#fff"}},sufText:{context:"2018-01-01 00:00:00",format:"yyyy-MM-dd",textStyle:{fontFamily:"Microsoft Yahei",fontSize:18,color:"#fff"}},tip:{format:"yyyy-MM-dd",textStyle:{fontFamily:"Microsoft Yahei",fontSize:18,color:"#fff"}},theme:{}},this.apis=b.apis,this._data=null,this.chart=null,this.init(b)},{setStyle:function(){var a=this,b=a.config;a.sliderDom.css({display:"flex","text-align":"left",width:"100%",height:b.slider.height,background:"-webkit-linear-gradient(top, "+b.slider.color+" 0%,"+b.slider.color+" 100%)","margin-top":"auto","margin-bottom":"auto","margin-left":b.slider["margin-left"]+"px","margin-right":b.slider["margin-right"]+"px",border:b.slider["border-width"]+"px solid "+b.slider["border-color"],"box-shadow":"0 3px 5px rgba(0,0,0,0.05) inset","border-radius":b.slider.height+2}),a.buttonDom.css({width:b.button.radius,height:b.button.radius,cursor:"pointer","margin-top":"auto","margin-bottom":"auto",background:"-webkit-linear-gradient(top, "+b.button.color+" 0%,"+b.button.color+" 100%)",border:"1px solid "+b.button["border-color"],"box-shadow":"0 3px 5px rgba(0,0,0,0.1) inset","border-radius":b.button.radius,transform:"translateX(0)"});var c=b.preText.textStyle;a.preDom.css({"font-family":c.fontFamily,"font-size":c.fontSize,color:c.color,"font-weight":c.fontWeight});var d=b.sufText.textStyle;a.sufDom.css({"font-family":d.fontFamily,"font-size":d.fontSize,color:d.color,"font-weight":d.fontWeight});var e=b.tip.textStyle;a.tipDom.css({position:"fixed",width:"fit-content",height:e.fontSize,"margin-top":f(a.container).height()/2-b.slider.height/2-1.5*e.fontSize,"font-family":e.fontFamily,"font-size":e.fontSize,color:e.color,"font-weight":e.fontWeight})},setContectDom:function(a,b,c){var a=f(a),d=b.pattern(c.format);a.css(c.textStyle),a.html(d)},setSlider:function(){var a=this,b=this.container,c=a.config,d=a.sliderDom,g=a.buttonDom,h=a.tipDom,i=new Date(c.preText.context),e=new Date(c.sufText.context);this.setContectDom(a.preDom,i,c.preText),this.setContectDom(a.sufDom,e,c.sufText);var j=new WebKitCSSMatrix(window.getComputedStyle(f("body")[0]).webkitTransform),k=f(d).width()-c.button.radius,l=c.slider.stepNum,m=k/l,n=e.getTime()-i.getTime();b.unbind("mousemove"),b.unbind("mouseup"),b.unbind("mouseleave");var o=function(){var b=parseFloat(f(g).css("transform").substring(7).split(",")[4])||0;b%m>m/2?b+=m-b%m:b-=b%m;var e=b/k*n+i.getTime(),j=new Date(e),l=(new Date(j).getTime()-i)/n*k;0>l?l=0:l>k-m/2&&(l=k),g.css("transform","translateX("+l+"px)"),c.callbackCfg.onCallback&&c.callbackCfg.callbackId&&a.emit("global_var",c.callbackCfg.callbackId,j.pattern(c.callbackCfg.format)),h.css("opacity",0),a.flag=!1};b.mousemove(function(b){if(a.flag){var d=b?b:window.event,e=b.target,l=f(this),m=d.clientX-a.currentMouseX;m=(m+a.currentX)/j.a,0>m?m=0:m>k&&(m=k);var o=new Date(m/k*n+i.getTime()).pattern(c.tip.format);h.html(o),g.css("transform","translateX("+m+"px)");var p=m-h.width()/2+c.button.radius/2+c.slider["margin-left"];return h.css("transform","translateX("+p+"px)"),b.preventDefault&&b.preventDefault(),h.css("opacity",1),!1}}).mouseup(function(){o()}),b.mouseleave(function(){o()}),g.unbind("hover"),g.hover(function(){h.css("opacity",1)},function(){h.css("opacity",0)})},initSlider:function(){var a=this.config,b=this.container,c=this;c.flag=!1,b.css({display:"inline-flex","text-align":"center"});var d=f("<div class=\"datav-slider-pre\"></div>");d.css({margin:"auto auto","white-space":"nowrap"});var e=f("<div class=\"datav-slider-mid\"></div>");e.css({width:"70%",height:"100%",display:"flex",margin:"auto auto","white-space":"nowrap"});var g=f("<div class=\"datav-slider-pre\"></div>");g.css({margin:"auto auto","white-space":"nowrap"});var h=f("<div class=\"datav-slider\"></div>"),i=f("<div class=\"datav-slider-button\"></div>"),j=f("<div class=\"datav-slider-tip\"></div>").css({"white-space":"nowrap"});i.mousedown(function(a){c.flag=!0,c.currentMouseX=a.clientX,c.currentX=parseFloat(f(this).css("transform").substring(7).split(",")[4])||0}),h.append(i),e.append(j),e.append(h),b.append(d),b.append(e),b.append(g),c.sliderDom=h,c.buttonDom=i,c.tipDom=j,c.preDom=d,c.sufDom=g,c.setStyle(),c.setSlider()},init:function(a){this.mergeConfig(a),this.initSlider(),this.updateStyle()},render:function(a,b){a=this.data(a);var c=this.config;if(a&&0<a.length)b?(b.preText.context=a[0].preText||c.preText.context,b.sufText.context=a[0].sufText||c.sufText.context):b={preText:{context:a[0].preText||c.preText.context},sufText:{context:a[0].sufText||c.sufText.context}};else return;e.isEqual(b,c)||(this.mergeConfig(b),this.setStyle(),this.setSlider()),this.updateStyle()},resize:function(a,b){this.updateLayout(a,b)},setColors:function(){},data:function(a){return a&&(this._data=a),this._data},mergeConfig:function(a){if(!a)return this.config;var b=this.config;return this.config=e.defaultsDeep(a||{},b),this.config},updateLayout:function(){this.setStyle(),this.setSlider()},updateStyle:function(){this.config},destroy:function(){console.log("\u8BF7\u5B9E\u73B0 destroy \u65B9\u6CD5")}}),a.exports});