// env=undefined => env=publish 
Cube("datav:/com/@echarts/ml-echarts-pie-custom/2.0.10",["datav:/com/maliang-echarts-utils/0.0.19","datav:/npm/bcore/0.0.18/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.6.1","datav:/npm/echarts/3.5.4"],function(a,b,c){var d=c("datav:/npm/bcore/0.0.18/event"),e=c("datav:/npm/jquery/2.1.4"),f=c("datav:/npm/lodash/4.6.1"),g=c("datav:/npm/echarts/3.5.4"),h=c("datav:/com/maliang-echarts-utils/0.0.19");return a.exports=d.extend(function(a,b){this.config={title:{textStyle:{color:"#ccc"}},tooltip:{formatter:"{a} <br/>{b} : {c} ({d}%)"},_series:{type:"pie"},visualMap:{show:!1,inRange:{colorLightness:[0,1]}}},this.container=e(a),this.apis=b.apis,this._data=null,this.chart=null,this.init(b)},{init:function(a){var b=this;a=this.mergeConfig(a),this.chart=g.init(this.container[0]),this.chart.setOption(this.cfg2echarts(f.cloneDeep(h.config2echartsOptions(a)))),this.updateStyle(),this.chart.off(),this.chart.on("pieselectchanged",function(a){var c={name:a.name,selected:f.filter(f.keys(a.selected),function(b){return a.selected[b]})};b.emit("pie-select-changed",c)}),this.chart.on("click",function(a){b.emit("click",a.data)})},highlight:function(a){a=f.merge(a||{},{type:"highlight"}),this.chart.dispatchAction(a)},downplay:function(a){a=f.merge(a||{},{type:"downplay"}),this.chart.dispatchAction(a)},showTip:function(a){a=f.merge(a||{},{type:"showTip"}),this.chart.dispatchAction(a)},hideTip:function(){this.chart.dispatchAction({type:"hideTip"})},pieAction:function(a){a&&a.type&&-1!==["pieSelect","pieUnSelect","pieToggleSelect"].indexOf(a.type)&&this.chart.dispatchAction(a)},render:function(a,b){a=this.data(a);var b=this.mergeConfig(b),c=h.config2echartsOptions(this.mergeConfig(h.data2echartsPie(a,b)));this.chart.setOption(this.cfg2echarts(f.cloneDeep(c)),!0),this.updateStyle()},cfg2echarts:function(a){var b=f.map(this.data(),"y");return a.visualMap&&((""===a.visualMap.min||"auto"===a.visualMap.min)&&b&&0<b.length&&(a.visualMap.min=f.sortBy(b)[0]/4),(""===a.visualMap.max||"auto"===a.visualMap.max)&&b&&0<b.length&&(a.visualMap.max=1.5*f.sortBy(b)[b.length-1]),a.visualMap.show=!1,a.visualMap.inRange={colorLightness:[0,1]}),a},resize:function(a,b){this.chart.resize({width:a,height:b})},data:function(a){return a&&(this._data=a),this._data},mergeConfig:function(a){return a?(a.series&&(a.series[0].data&&this.config.series[0]&&(this.config.series[0].data=a.series[0].data),this.config.series[0]=f.defaultsDeep(a.series[0]||{},this.config.series[0])),this.config=f.defaultsDeep(a||{},this.config),this.config.series=[this.config._series],this.config.series&&(this.config.tooltip&&(this.config.series[0].name=this.config.tooltip.title),this.config.series[0].itemStyle.normal.defaultColor&&(this.config.series[0].itemStyle.normal.color=null)),a.visualMap.open||(a.visualMap=!1),this.config.tooltip.showContent=this.config.tooltip.show,this.config):this.config},updateStyle:function(){this.config},clear:function(){this.chart&&this.chart.clear&&this.chart.clear()},destroy:function(){this.chart&&this.chart.dispose&&this.chart.dispose()}}),a.exports});