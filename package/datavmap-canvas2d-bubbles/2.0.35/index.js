// env=undefined => env=publish 
Cube("datav:/com/datavmap-canvas2d-bubbles/2.0.35/src/colorConfig",[],function(a){return a.exports={类型一:[{percent:0,opacity:1},{percent:0.35,opacity:1},{percent:0.35,opacity:0.3},{percent:1,opacity:0.3}],类型二:[{percent:0,opacity:0.99},{percent:0.4,opacity:0.99},{percent:0.4,opacity:0.7},{percent:0.6,opacity:0.7},{percent:0.6,opacity:0.5},{percent:0.8,opacity:0.5},{percent:0.8,opacity:0.2},{percent:1,opacity:0.2}],类型三:[{percent:0,opacity:0.99},{percent:0.65,opacity:0.99},{percent:0.65,opacity:0.7},{percent:0.75,opacity:0.7},{percent:0.75,opacity:0.5},{percent:0.85,opacity:0.5},{percent:0.85,opacity:0.2},{percent:1,opacity:0.2}],类型四:[{percent:0,opacity:0.99},{percent:0.55,opacity:0.99},{percent:0.55,opacity:0},{percent:0.62,opacity:0},{percent:0.63,opacity:0.8},{percent:0.65,opacity:0.8},{percent:0.72,opacity:0},{percent:0.73,opacity:0.7},{percent:0.75,opacity:0.7},{percent:0.82,opacity:0},{percent:0.83,opacity:0.6},{percent:0.85,opacity:0.6},{percent:0.92,opacity:0},{percent:0.93,opacity:0.5},{percent:0.95,opacity:0.5}],类型五:[{percent:0,opacity:1},{percent:1,opacity:1}],类型六:[{percent:0,opacity:0.99},{percent:0.1,opacity:0.9},{percent:0.3,opacity:0.9},{percent:0.3,opacity:0.11},{percent:0.7,opacity:0.2},{percent:0.7,opacity:0.2},{percent:1,opacity:0.7}],类型七:[{percent:0,opacity:0.1},{percent:0.6,opacity:0.1},{percent:0.6,opacity:0.2},{percent:0.75,opacity:0.3},{percent:0.75,opacity:0.99},{percent:0.85,opacity:0.7},{percent:1,opacity:0.3}]},a.exports});;
Cube("datav:/com/datavmap-canvas2d-bubbles/2.0.35/src/bubblesLayer",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1","datav:/npm/chroma-js/1.3.3","datav:/npm/rbush/3.0.0"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),j=c("datav:/npm/safely-merge/1.0.1"),k=c("datav:/com/datavmap-canvas2d-bubbles/2.0.35/src/colorConfig"),l=c("datav:/npm/chroma-js/1.3.3"),i=c("datav:/npm/rbush/3.0.0"),m=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=j({zoomRange:[0,18],minZoom:0,maxZoom:22,defaultStyle:{animationType:"breathe",offset:2.5,speed:0.05,opacity:0.85,sizeRange:[6,10]},typeSeries:[],typeSeriesOptions:{},size:function(a,b,c){var d=this.options.defaultStyle.sizeRange;if(c===b)return(d[1]+d[0])/2;return(a-b)/(c-b)*(d[1]-d[0])+d[0]}},c),f.options.minZoom=c.zoomRange[0],f.options.maxZoom=c.zoomRange[1],f.options.visibility=!0,f.ratio=0,f.reverseRatio=0,f.index=0,f.fade=1,f.reverseFade=0,f.map=a,f.init(),f}return f(b,a),g(b,[{key:"init",value:function(){this.container=document.createElement("canvas");var a=this.padding=this.map.canvasLayer&&this.map.canvasLayer.options&&this.map.canvasLayer.options.padding?this.map.canvasLayer.options.padding:0.1,b=this.map.getSize();this.offset=b.multiplyBy(-a).round();var c=b.x-2*this.offset.x,d=b.y-2*this.offset.y,e=this.map.devicePixelRatio||1;this.container.width=c*e,this.container.height=d*e,this.container.style.width=c+"px",this.container.style.height=d+"px",this.ctx=this.container.getContext("2d"),this.ctx.scale(e,e),this.data=null,this.rbush=new i,this.rbush.dirty=0,this.rbush.total=0,this.rbushInBounds=new i,this.featuresInBounds=[],this.featuresInBoundsByType={},this.updateTypeSerie(),this.updateOptions(Object.assign({},this.options))}},{key:"updateTypeSerie",value:function(){var a=this.options;if(a&&a.typeSeries&&a.typeSeries.length)for(var b=0;b<a.typeSeries.length;b++){var c=a.typeSeries[b],d=c.bubbleKey;c.colorSeries=k[d]?k[d]:[]}this.options.typeSerie=c}},{key:"onRender",value:function(a){a&&"needUpdata"===a&&(this.ctx.clearRect(0,0,this.container.width,this.container.height),this.getFeaturesInBounds()),this.data&&0!==this.data.length&&this.update()}},{key:"render",value:function(a){this.data=[],a&&a.length&&(this.data=a),this.initRBush(),this.getFeaturesInBounds(),this.updateColors()}},{key:"initRBush",value:function(){var a=this.data,b=[],c=void 0,e=void 0,f=void 0,g=void 0,h=void 0;for(c=0;c<a.length;c++)f=a[c],!f.hasOwnProperty("lng")||!f.hasOwnProperty("lat")||(f.value=+f.value||0,b.push({minX:+f.lng,minY:+f.lat,maxX:+f.lng,maxY:+f.lat,feature:f}),e=f.value,!isNaN(e)&&((null===g||void 0===g)&&(g=e),(null===h||void 0===h)&&(h=e),g>e&&(g=e),h<e&&(h=e)));this.max=h,this.min=g,this.rbush.dirty=b.length,this.rbush.total=b.length,this.rbush.clear(),this.rbush.load(b)}},{key:"getFeaturesInBounds",value:function(){var a=this.map.getBounds(),b=a.pad(this.padding),c={minX:b.getWest(),minY:b.getSouth(),maxX:b.getEast(),maxY:b.getNorth()},d=this.queryFeaturesInBounds(this.rbush,c);this.rbushInBounds.clear(),this.rbushInBounds.load(d),this.featuresInBounds=d,this.featuresInBoundsByType={};for(var e=void 0,f=0;f<d.length;f++)e=d[f].feature,this.featuresInBoundsByType[e.type]||(this.featuresInBoundsByType[e.type]=[]),this.featuresInBoundsByType[e.type].push(e)}},{key:"queryFeaturesInBounds",value:function(a,b){for(var c=a.search(b),d=this.options.size.bind(this),e=void 0,f=void 0,g=this.min,h=this.max,j=0;j<c.length;j++)e=c[j].feature,f=this.map.latLngToContainerPoint([+e.lat,+e.lng]),e.x=f.x-this.offset.x,e.y=f.y-this.offset.y,e.type=e.type||this.options.typeSeries[0].bubbleType,e.size=d(e.value,g,h);return c}},{key:"draw",value:function(){var a=this.ctx,b=this.min,c=this.max,e=this.options;if(c&&0!==Object.keys(e.typeSeriesOptions).length){var f=e.defaultStyle.animationType;ratio=e.defaultStyle.ratio,getSize=e.size.bind(this);var g,h,j,k,l;switch(f){case"breathe":ratio=this.ratio,g=this.reverseRatio;break;case"fade":ratio=g=0;break;default:}for(h in this.featuresInBoundsByType){j=this.featuresInBoundsByType[h];var m=e.typeSeriesOptions[h];m||(m=e.typeSeriesOptions[this.options.typeSeries[0].bubbleType]),"breathe"===f&&(a.globalAlpha=m?e.typeSeriesOptions[h].opacity*this.reverseFade:this.reverseFade);var n=void 0,i=void 0;for(n=0;n<j.length;n++)i=j[n],0===n%2?(k=i.size+g,l=this.fade):(k=i.size+ratio,l=1-this.fade),k=0>k?-k:k,(isNaN(k)||isNaN(i.value))&&(k=0),"fade"===f&&(a.globalAlpha=l),a.drawImage(m.offscreenCanvas,i.x-k,i.y-k,2*k,2*k)}}}},{key:"addColorStop",value:function(a,b,d){if(b){var e=this.options,f=void 0,g=e.series[a];if(g&&Array.isArray(g))for(var h,j=0;j<g.length;j++){h=g[j],f=h.percent,1<f&&(f=1),0>f&&(f=0);var i=this.prefixColor(h,d);b.addColorStop(f,i)}}}},{key:"updateOptions",value:function(a){this.options=j(this.options,a),this.options.minZoom=a.zoomRange[0],this.options.maxZoom=a.zoomRange[1],this.updateTypeSerie(),this.updateColors();for(var b=2*a.defaultStyle.sizeRange[1],c=void 0,d=0;d<this.options.typeSeries.length;d++){c=this.options.typeSeries[d].bubbleType;var e=document.createElement("canvas");e.width=2*b,e.height=2*b;var f=e.getContext("2d");offscreenGradient=f.createRadialGradient(b,b,0,b,b,b),this.addColorStop(c,offscreenGradient,this.fade),f.fillStyle=offscreenGradient,f.beginPath(),f.arc(b,b,b,0,2*Math.PI),f.fill(),this.options.typeSeriesOptions[c]=a.typeSeries[d];var g=l(a.typeSeries[d].fillColor).rgba();this.options.typeSeriesOptions[c].opacity=g[3],this.options.typeSeriesOptions[c].offscreenCanvas=e}this.getFeaturesInBounds()}},{key:"prefixColor",value:function(c,d){var e=c.r,f=c.g,g=c.b,b=c.a*d;return"rgba("+e+","+f+","+g+","+b+")"}},{key:"updateColors",value:function(){var d=this.options,e=d.typeSeries,f=d.series={},h=void 0;if(e.length)for(var k=0;k<e.length;k++){h=e[k].bubbleType,f[h]=[];for(var i=0;i<e[k].colorSeries.length;i++){var j={},m=e[k].colorSeries[i],n=e[k].fillColor,c=l(n).get("rgba.r"),o=l(n).get("rgba.g"),g=l(n).get("rgba.b"),b=m.opacity;j.r=c,j.g=o,j.b=g,j.a=b,j.percent=m.percent,f[h].push(j)}}}},{key:"update",value:function(){var a=this.container,b=a.width,c=a.height;if(this.ctx.clearRect(0,0,b,c),this.data&&0!==this.data.length){var d=this.options,e=d.defaultStyle,f=e.offset,g=e.speed,h=e.opacity,i=e.animationType;switch(this.index<f?(this.ratio+=g,this.index+=g):f<=this.index&&this.index<2*f?(this.ratio-=g,this.index+=g):this.index>=2*f&&(this.ratio=0,this.index=0),this.reverseRatio=f-this.ratio,i){case"breathe":this.fade=h,this.reverseFade=h;break;case"fade":this.fade=h*(this.ratio/f),this.reverseFade=+(h-this.fade);break;default:}this.draw()}}},{key:"onResize",value:function(a,b){var c=this.map.devicePixelRatio||1;this.container.width=a*c,this.container.height=b*c,this.container.style.width=a+"px",this.container.style.height=b+"px",this.ctx.scale(c,c)}},{key:"show",value:function(){this.options.visibility=!0,this.onRender("needUpdata")}},{key:"hide",value:function(){this.options.visibility=!1,this.ctx.clearRect(0,0,this.container.width,this.container.height)}},{key:"destroy",value:function(){this.data=null,this.ratio=null,this.reverseRatio=null,this.index=null,this.fade=null,this.reverseFade=null,delete this.data,this.ratio,this.reverseRatio,this.index,this.fade,this.reverseFade}}]),b}(h);return a.exports=m,a.exports});;
Cube("datav:/com/datavmap-canvas2d-bubbles/2.0.35",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/com/datavmap-canvas2d-bubbles/2.0.35/src/bubblesLayer"),k=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=i({renderer:"canvas",isAnimateLayer:!0},c),f.options.minZoom=c.zoomRange[0],f.options.maxZoom=c.zoomRange[1],f.options.visibility=!0,f}return f(b,a),g(b,[{key:"addTo",value:function(a){this.layer=new j(a,this.options)}},{key:"onRender",value:function(){this.layer&&this.layer.onRender&&this.layer.onRender()}},{key:"onResize",value:function(a,b){this.layer&&this.layer.onResize&&this.layer.onResize(a,b)}},{key:"render",value:function(a){this.layer&&this.layer.render&&this.layer.render(a)}},{key:"updateOptions",value:function(a){this.options=i(this.options,a),this.options.minZoom=a.zoomRange[0],this.options.maxZoom=a.zoomRange[1],this.layer&&this.layer.updateOptions&&this.layer.updateOptions(a)}},{key:"update",value:function(){this.layer&&this.layer.update&&this.layer.update()}},{key:"show",value:function(){this.options.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.options.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"destroy",value:function(){this.layer&&this.layer.destroy&&this.layer.destroy(),this.options=null,this.layer=null,delete this.options,this.layer}}]),b}(h);return a.exports=k,a.exports});