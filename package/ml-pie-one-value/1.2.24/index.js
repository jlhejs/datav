// env=undefined => env=publish 
Cube("datav:/com/ml-pie-one-value/1.2.24/pie",["datav:/com/maliang-utils/0.0.7","datav:/npm/bcore/0.0.22/event","datav:/npm/dchart-pie-crossover-one-value/0.4.6","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.17.11"],function(a,b,c){function d(a){return i.isNumber(a)&&!i.isNaN(a)&&i.isFinite(a)}function e(a,b,c,e){var f=i.cloneDeep(a),g=f.margin,h=g.top,j=g.bottom,k=g.left,l=g.right,m=Math.min(c-k-l,e-h-j);f.width=c,f.height=e,f.xaxis=null,f.yaxis=null,f.arc={},f.arc.radius=m/2,f.arc.innerRadius=m*a.sector.innerRadius/2,f.arc.net=a.arc.net.show,f.arc.netColor=a.arc.net.color;var n=d(i.toNumber(a.angleAxis.angleOffset))?2*Math.PI*i.toNumber(a.angleAxis.angleOffset/360):0;f.arc.startAngle=function(a){return a.startAngle+n},f.arc.endAngle=function(a){return a.endAngle+n},f.progressColor=a.sector.progressColor,f.bgProgressColor=a.sector.bgProgressColor,f.excessColor=a.sector.excessColor,f.innerArc={innerRadius:m*a.innerArc.innerRadius/2,outerRadius:m*a.innerArc.outerRadius/2},f.innerColor=a.innerArc.color,f.series=[];var o=a.animation;return f.animation=o.show,f.animationDuration=o.animationDuration,f.animationEasing=o.animationEasing,f.animationUpdateFromPrevious=o.animationUpdateFromPrevious,f.animationDurationUpdate=o.animationDurationUpdate,f.labelReal=a.label.real,f}var f=c("datav:/npm/bcore/0.0.22/event"),g=c("datav:/npm/dchart-pie-crossover-one-value/0.4.6"),h=c("datav:/npm/jquery/2.1.4"),i=c("datav:/npm/lodash/4.17.11"),j=c("datav:/com/maliang-utils/0.0.7"),k=Math.PI;return a.exports=f.extend(function(a,b){this.config={theme:{},chart:{background:"transparent"},margin:{top:0,bottom:0,left:0,right:0},legend:{},series:[{value:"1",color:"#2F8FBE"}]},this.container=h(a),this._width=this.container.width(),this.config.height=this.container.height(),this.init(b)},{init:function(a){this.apis=a.apis;var b=this.mergeConfig(a);this.chart=new g(this.container[0],b.chart)},isSafeNumber:function(a){return i.isNumber(a)&&!i.isNaN(a)&&i.isFinite(a)?a:null},render:function(a,b){var c=this.mergeConfig(b);if(a=this.data(a),a&&a.length){var d=0;a[0].aims&&(d=a[0].actual/a[0].aims),a&&this.chart.render(d,e(c,a,this._width,c.height)),this.updateStyle()}},updateStyle:function(){var a=this.config,b=this.chart.el;if(b){b.selectAll(".serie-bg").style("stroke","none"),b.select(".con-svg").style("background","transparent"),b.selectAll(".series-pies .serie").style("stroke","none"),b.selectAll(".bg-inner-circle").style("stroke","none");var c=a.label.show||i.isUndefined(a.label.show),d=b.select(".serie-label");d.style("display",c&&"block"||"none"),b.selectAll(".bg-upper-line").style("display",c&&"block"||"none"),b.selectAll(".bg-lower-line").style("display",c&&"block"||"none"),c&&a.label.real&&d.text(this._data&&this._data[0]&&this._data[0].actual||0)}},setColors:function(){},hasS:function(a){var b=0;return i.map(a,function(a){void 0!==a.s&&b++}),b===a.length||0!==b&&!1},data:function(a){return this._data=a?i.map(a,function(a){return a.actual=i.toNumber(a.actual)||0,a.aims=i.toNumber(a.aims)||0,a}):this._data||[{actual:0,aims:0}],this._data},mergeConfig:function(a){return a?(this.config.theme=i.defaultsDeep(a.theme||{},this.config.theme),this.setColors(),a.series&&(this.config.series=a.series),this.config=i.defaultsDeep(a||{},this.config),this.config):this.config},resize:function(a,b){this._width=a,this.config.height=b,this.render()},clear:function(){this.chart&&this.chart.empty()},destroy:function(){this.chart&&this.chart.destroy(),this._data=this.__data=null}}),a.exports});;
Cube("datav:/com/ml-pie-one-value/1.2.24",["datav:/com/legend/0.1.2","datav:/npm/bcore/0.0.22/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.17.11"],function(a,b,c){var d=c("datav:/npm/bcore/0.0.22/event"),e=c("datav:/npm/jquery/2.1.4"),f=c("datav:/npm/lodash/4.17.11"),g=c("datav:/com/ml-pie-one-value/1.2.24/pie"),h=c("datav:/com/legend/0.1.2");return a.exports=d.extend(function(a,b){this.config={theme:{},chart:{background:"transparent"},legend:{innerStyle:{"line-height":1.3}},series:[{value:"1",color:"#2F8FBE"}],animation:{show:!0,animationDuration:1e3,animationEasing:"cubicInOut",animationDurationUpdate:300,animationUpdateFromPrevious:!0}},this.container=e(a).css("padding","10px 0"),this.chart=null,this.legend=null,this.init(b)},{init:function(a){this.apis=a.apis;var b=this.mergeConfig(a),c=b.legend,d=c.layout.loc.split("-")[0];this.chartDom=e("<div class=\"dchart-pie-basic\" style=\"width: 100%;\"></div>"),this.legendDom=e("<div class=\"dchart-legend\" style=\"left: 0;width: 100%;\"></div>"),"bottom"===d?(this.container.append(this.chartDom),this.container.append(this.legendDom)):(this.container.append(this.legendDom),this.container.append(this.chartDom)),this.legend=new h(this.legendDom[0],b.legend),this.chartDom.height(this.container.height()-(b.legend.show&&this.legendDom.height()||0)),this.chart=new g(this.chartDom[0],f.cloneDeep(b)),this.legendDom.css("display",c.show&&"block"||"none")},render:function(a,b){var c=this.mergeConfig(b);if(a=this.data(a),a&&a.length){var d=[{showName:a[0].actualText||c.sector.title,color:c.sector.progressColor}];this.legend.render(d,c.legend);var e=this.container.height()-(c.legend.show&&this.legendDom.height()||0);this.chartDom.height(e),this.config.height=e,a&&this.chart.render(a,c),this._cfg=c}},updateStyle:function(){},setColors:function(){},data:function(a){return a&&(this._data=f.clone(a),this._data.length&&this._data.forEach(function(a){a.y=f.toNumber(a.y)})),this._data},mergeConfig:function(a){return a?(this.config.theme=f.defaultsDeep(a.theme||{},this.config.theme),this.setColors(),a.series&&(this.config.series=a.series),this.config=f.defaultsDeep(a||{},this.config),this.config.legend.textarea.fontFamily=this.config.fontFamily,this.config):this.config},resize:function(a,b){this.chart.resize(a,b-(this.config.legend.show&&this.legendDom.outerHeight()||0)-20)},updateLegendLayout:function(a){var b=this.config.legend;if(b.show!==a.show&&(this.legendDom.css("display",a.show&&"block"||"none"),this.config.chart.height=this.container.height()-(a.show&&this.legendDom.height()||0)),b.textarea.fontSize!==a.textarea.fontSize&&(this.legendDom.find(".legend-item").css("fontSize",a.textarea.fontSize),this.config.chart.height=this.container.height()-(a.show&&this.legendDom.height()||0)),JSON.stringify(b.layout.margin)!==JSON.stringify(a.layout.margin)){var c=a.layout.margin;this.legendDom.find(".legend-item").css("margin",c.vertiInterval+"px "+c.horiInterval+"px"),this.config.chart.height=this.container.height()-(a.show&&this.legendDom.height()||0)}var d=b.layout.loc.split("-")[0],e=a.layout.loc.split("-")[0];d!==e&&("top"===e?this.container[0].appendChild(this.chartDom[0]):"bottom"===e&&this.container[0].appendChild(this.legendDom[0])),this.render(null,{legend:a})},clear:function(){this.chart&&this.chart.clear(),this.legend&&f.isFunction(this.legend.clear)&&this.legend.clear()},destroy:function(){this.chart&&this.chart.destroy(),this.chart=null,this.legend&&this.legend.destroy(),this.legend=null,this.chartDom=null,this.legendDom=null,this.container&&this.container.empty(),this._data=null},startAnimate:function(){if(!(this.chart&&this.chart.chart))return!1;if(this._cfg){this.chart.chart.clearAllAnimation();var a=this._cfg.animation,b=a.animationUpdateFromPrevious;a.animationUpdateFromPrevious=!1;var c=a.animationDurationUpdate;a.animationDurationUpdate=a.animationDuration,this.chart.render(),a.animationDurationUpdate=c,a.animationUpdateFromPrevious=b}},clearAnimate:function(){this.chart&&this.chart.chart&&this.chart.chart.resumeToAnimationEnd()}}),a.exports});