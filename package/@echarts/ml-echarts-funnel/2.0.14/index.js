// env=undefined => env=publish 
Cube("datav:/com/@echarts/ml-echarts-funnel/2.0.14",["datav:/com/maliang-echarts-utils/0.0.18","datav:/npm/bcore/0.0.18/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.6.1","datav:/npm/echarts/4.1.0"],function(a,b,c){var d=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},e=c("datav:/npm/bcore/0.0.18/event"),f=c("datav:/npm/jquery/2.1.4"),g=c("datav:/npm/lodash/4.6.1"),h=c("datav:/npm/echarts/4.1.0"),i=c("datav:/com/maliang-echarts-utils/0.0.18");return a.exports=e.extend(function(a,b){this.config={tooltip:{formatter:"{a} <br/>{b} : {c}%"},series:{type:"funnel"},_series:{label:{normal:{formatterSuite:{show:!1,format:"{b}:{c}"},normalBreakLabel:{show:!1,rich:{normalName:{height:16},normalNum:{height:16},normalPercent:{height:16}}},normalSeparatingChart:!1,normalNumSuffix:""},emphasis:{formatterSuite:{show:!1,format:"{b}:{c}"},emphasisBreakLabel:{show:!1,rich:{emphasisName:{height:16},emphasisNum:{height:16},emphasisPercent:{height:16}}},emphasisSeparatingChart:!1,emphasisNumSuffix:""}}}},this.container=f(a),this.apis=b.apis,this._data=null,this.chart=null,this.init(b)},{init:function(a){var b=this;a=this.mergeConfig(a),this.chart=h.init(this.container[0]),a.series=[a.series],this.chart.setOption(i.config2echartsOptions(a)),this.updateStyle(),this.chart.off(),this.chart.on("click",function(a){var c=a.data;delete c.itemStyle,b.emit("click",c)}),this.chart.on("legendselectchanged",function(a){var c=[];c=g.filter(g.keys(a.selected),function(b){return a.selected[b]}),b.emit("legend-select-changed",{selected:c,name:a.name})})},showTip:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};a=g.merge(a,{type:"showTip"}),this.chart.dispatchAction(a)},hideTip:function(){this.chart.dispatchAction({type:"hideTip"})},legendAction:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=a.type,c=void 0===b?"legendToggleSelect":b,d=a.name;c&&-1!==["legendSelect","legendUnSelect","legendToggleSelect"].indexOf(c)&&this.chart.dispatchAction({type:c,name:d})},render:function(a){a=this.data(a);var b=i.config2echartsOptions(this.mergeConfig(i.data2echartsFunnel(a,this.config)));this.chart.setOption(b),this.updateStyle()},resize:function(a,b){this.chart.resize({width:a,height:b})},data:function(a){if(a){this._data=g.clone(a);var b=this.config.color;this._data.length&&this._data.forEach(function(a,c){a.itemStyle={normal:{color:b[c]},emphasis:{color:b[c]}}})}return this._data},mergeConfig:function(a){if(!a)return this.config;a.series&&(a.series[0].data&&(this.config.series[0].data=a.series[0].data),this.config.series[0]=g.defaultsDeep(a.series[0]||{},this.config.series[0])),this.config=g.defaultsDeep(a||{},this.config),this.config.series[0]=g.defaultsDeep(this.config._series,this.config.series[0]),this.config.series[0]&&this.config.series[0].data&&(this.config.legend.data=g.map(this.config.series[0].data,"name")),this.config.tooltip.axisPointer.type=this.config.tooltip.axisPointer.atype,this.config.tooltip.showContent=this.config.tooltip.show;var b=g.get(this.config,"series[0]")||{},c=b.label,e=b.label,f=e.normal,h=f.formatterSuite,i=h.format,j=h.show,k=f.normalBreakLabel,l=k.show,m=k.rich,n=m.normalName,o=m.normalNum,p=m.normalPercent,q=f.normalSeparatingChart,r=f.textStyle,s=f.normalNumSuffix,t=e.emphasis,u=t.formatterSuite,v=u.format,w=u.show,x=t.emphasisBreakLabel,y=x.show,z=x.rich,A=z.emphasisName,B=z.emphasisNum,C=z.emphasisPercent,D=t.emphasisSeparatingChart,E=t.textStyle,F=t.emphasisNumSuffix,G=void 0;j&&l?(G=g.includes(i,"{b}:{c}")?["{normalName|{b}}","{normalNum|{c}"+s+"}"].join("\n"):"{normalName|{b}}\n{normalPercent|{d}%}",g.set(c,"normal.rich",{normalName:d({},n,r),normalNum:d({},o,r),normalPercent:d({},p,r)})):g.includes(i,"{b}:{c}")?G=i+s:G=i;var H;w&&y?(H=g.includes(v,"{b}:{c}")?["{emphasisName|{b}}","{emphasisNum|{c}"+F+"}"].join("\n"):"{emphasisName|{b}}\n{emphasisPercent|{d}%}",g.set(c,"emphasis.rich",{emphasisName:d({},A,E),emphasisNum:d({},B,E),emphasisPercent:d({},C,E)})):g.includes(v,"{b}:{c}")?H=v+F:H=v,g.set(c,"normal.formatter",j?G:"{b}"),g.set(c,"emphasis.formatter",w?H:"{b}"),g.set(this.config,"series[0].label",c);var I=this;return j&&g.includes(i,"{b}:{c}")&&q&&(l?this.config.series[0].label.normal.formatter=function(a){var b=I.formatData(a.value);return["{normalName|"+a.name+"}","{normalNum|"+b+s+"}"].join("\n")}:this.config.series[0].label.normal.formatter=function(a){return a.name+":"+I.formatData(a.value)+s}),w&&g.includes(v,"{b}:{c}")&&D&&(y?this.config.series[0].label.emphasis.formatter=function(a){var b=I.formatData(a.value);return["{emphasisName|"+a.name+"}","{emphasisNum|"+b+F+"}"].join("\n")}:this.config.series[0].label.emphasis.formatter=function(a){return a.name+":"+I.formatData(a.value)+F}),this.config},formatData:function(a){return a+="",g.includes(a,".")||(a+="."),g.replace(g.replace(a,/(\d)(?=(\d{3})+\.)/g,"$1,"),/\.$/,"")},updateStyle:function(){this.config},updateOptions:function(a){this.mergeConfig(a),this.render(this._data)},getThemableConfig:function(a){if(!a)return{};var b={},c=a.palette,d=a.textColor,e=this.mergeConfig(),f=g.get(e,"color");return c&&f&&f.forEach(function(a,d){g.set(b,"color."+d,c[d%c.length])}),g.set(b,"_series.label.normal.textStyle",d),b},clear:function(){this.chart&&this.chart.clear&&this.chart.clear()},destroy:function(){this.chart&&this.chart.dispose&&this.chart.dispose()}}),a.exports});