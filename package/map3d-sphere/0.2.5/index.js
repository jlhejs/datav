Cube('datav:/com/map3d-sphere/0.2.5',['datav:/npm/dmap/0.1.53','datav:/npm/bcore/0.0.21/utils','datav:/npm/bcore/0.0.21/event'],function(e,k,c,i,j,h){function a(c,d){this.container=b.getContainer(c),this.options=b.deepMerge(a.options,d),this.init(),this.subcoms={},this.loopIndex=0,this.playIndex=0}var f=c('datav:/npm/dmap/0.1.53'),g=f.Map,b=c('datav:/npm/bcore/0.0.21/utils'),d=c('datav:/npm/bcore/0.0.21/event');return a.options={projection:'sphere',distance:17843979,rotation:{x:1.5192036732051035,y:.45},center:{x:0,y:0,z:0},autoRotateSpeed:0,clearAlpha:0,background:'transparent'},a=d.extend(a,{init:function(){this._map=new g(this.container,this.options)},getOptions:function(){var a=this.options;return a},checkIsPlay:function(){var b=this.options,a=b.autoPlay,c=a.isPlay,d=a.playSpeed;if(c&&this.ds){if(!this.loopId)return this.loop()}else{if(!this.loopId)return;window.cancelAnimationFrame(this.loopId),this.loopId=null,this.location=null}},stayPlayed:function(){if(this.location){var a={lat:this.location.lat||0,lng:this.location.lng||0};this._map&&this._map.sphereFlying(a)}},updateOptions:function(a){a&&(this.options=b.deepMerge(this.options,a)),this._map&&this._map.updateOptions(this.getOptions()),this.stayPlayed(),this.checkIsPlay()},get:function(a){return this.subcoms[a]},add:function(a,b){if(!a)return console.log('layer 没有定义');a.addTo&&a.addTo(this._map),this.subcoms[b]=a,this.updateAllOptions()},updateAllOptions:function(){var b,a=this.subcoms;for(var c in a)b=a[c],b.updateOptions()},remove:function(a,b){a.remove&&a.remove(),delete this.subcoms[b]},render:function(a,b){if(!a)return console.log('无位置轮播数据......');this.ds=a,this.checkIsPlay()},loop:function(){var b=this.options,c=b.autoPlay.playSpeed;if(this.loopIndex++,this.loopIndex%=c*60,this.playIndex%=this.ds.length,this.loopIndex===0&&this.ds.length!==0){var a=this.location=this.ds[this.playIndex],d={lat:a.lat||0,lng:a.lng||0};this._map&&this._map.sphereFlying(d),this.playIndex++}this.loopId=window.requestAnimationFrame(this.loop.bind(this))}}),e.exports=a,e.exports})