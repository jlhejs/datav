// env=undefined => env=publish 
Cube("datav:/com/map3d-spere/1.3.6",["datav:/npm/dmap/0.2.9","datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1","datav:/npm/async/2.1.4"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/dmap/0.2.9"),i=h.Map,j=c("datav:/npm/eventemitter3/3.0.0"),k=c("datav:/npm/safely-merge/1.0.1"),l=c("datav:/npm/async/2.1.4"),m=Math.PI,n=m/180,o=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.container="string"===typeof a?document.querySelector(a):a,f.options=k({projection:"sphere",distance:17843979,rotation:{x:1.5192036732051035,y:0.45},center:{x:0,y:0,z:0},autoRotateSpeed:0,clearAlpha:0,background:"transparent",autoPlay:{isPlay:!1,keepTime:1,playSpeed:1}},c.mapOptions),f.init(),f.subcoms={},f.loopIndex=0,f.playIndex=0,f}return f(b,a),g(b,[{key:"init",value:function(){this._map=new i(this.container,this.getOptions()),this.container.style.pointerEvents=this.options.isInteractive?"auto":"none",this._map.three3D.canvas.style.pointerEvents=this.options.isInteractive?"auto":"none",this.loop()}},{key:"getOptions",value:function(){var a=this.options;return a.distance*=1e5,a.rotation.x*=n,a.rotation.y*=n,a.center.x*=1e5,a.center.y*=1e5,a.center.z*=1e5,a.autoRotateSpeed=a.autoPlay.isPlay?0:2*a.autoRotateSpeed*n,a}},{key:"checkIsPlay",value:function(){var a=this.options,b=a.autoPlay,c=b.isPlay,d=b.playSpeed;if(!(c&&this.ds)){if(!this.loopId)return;window.cancelAnimationFrame(this.loopId),this.loopId=null,this.location=null}else if(!this.loopId)return this.loop()}},{key:"stayPlayed",value:function(){if(this.location){var a={lat:this.location.lat||0,lng:this.location.lng||0};this._map&&this._map.sphereFlying(a)}}},{key:"updateOptions",value:function(a){a&&(this.options=k(this.options,a.mapOptions)),this._map&&this._map.updateOptions(this.getOptions()),this.container.style.pointerEvents=this.options.isInteractive?"auto":"none",this._map.three3D.canvas.style.pointerEvents=this.options.isInteractive?"auto":"none",this.stayPlayed();var b=this;if(this.ds=this.ds.map(function(a){return a.duration=b.options.autoPlay.playSpeed,a.delay=b.options.autoPlay.keepTime,a}),!1===b.options.autoPlay.isPlay){var c=this._map.interaction&&this._map.interaction.currentTween;c&&c.stop(),b.isEnd=!0}}},{key:"get",value:function(a){return this.subcoms[a]}},{key:"add",value:function(a,b){return a?void(a.addTo&&a.addTo(this._map),this.subcoms[b]=a,this.updateAllOptions()):console.log("layer \u6CA1\u6709\u5B9A\u4E49")}},{key:"updateAllOptions",value:function(){var a,b=this.subcoms;for(var c in b)a=b[c],a.updateOptions()}},{key:"remove",value:function(a,b){a.remove&&a.remove(),delete this.subcoms[b]}},{key:"render",value:function(a){if(!a)return console.log("\u65E0\u4F4D\u7F6E\u8F6E\u64AD\u6570\u636E......");var b=this,c=b.options.autoPlay.isPlay;b.options.autoPlay.isPlay=!1;var d=this._map.interaction&&this._map.interaction.currentTween;d&&d.stop();var e=-Infinity,f=Infinity;setTimeout(function(){b.ds=a.map(function(a){return e=a.lng>e?a.lng:e,f=a.lng>f?f:a.lng,a.onComplete=function(){b.emit("sphere-fly",a)},a.duration=b.options.autoPlay.playSpeed,a.delay=b.options.autoPlay.keepTime,a}),b.clockwise=80<e-f,b.options.autoPlay.isPlay=c,b.isEnd=b.isEnd||!0},0)}},{key:"doSceneSwitch",value:function(){var a=this;a.isEnd=!1,l.eachSeries(this.ds,this.doTween.bind(this),function(){a.isEnd=!0,a.options.autoPlay.isPlay&&(a.clockwise&&(a.ds=a.ds.map(function(a){return a.lng+=360,a})),a.doSceneSwitch())})}},{key:"doTween",value:function(a,b){var c=this;c.options.autoPlay.isPlay?c._map.tweenFly(a,b):(c.isEnd=!0,b("stop"))}},{key:"resize",value:function(){this._map.three3D&&this._map.three3D.onWindowResize()}},{key:"loop",value:function(){this.isEnd&&this.options.autoPlay.isPlay&&this.doSceneSwitch(),this.loopId=window.requestAnimationFrame(this.loop.bind(this))}}]),b}(j);return a.exports=o,a.exports});