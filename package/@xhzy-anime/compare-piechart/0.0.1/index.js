// env=undefined => env=publish 
Cube("datav:/com/@xhzy-anime/compare-piechart/0.0.1",["datav:/npm/bcore/0.0.18/event","datav:/npm/jquery/3.4.1","datav:/npm/lodash/4.17.15","datav:/npm/vizz/0.2.30"],function(a,b,c){var d=c("datav:/npm/bcore/0.0.18/event"),e=c("datav:/npm/jquery/3.4.1"),f=c("datav:/npm/lodash/4.17.15"),g=c("datav:/npm/vizz/0.2.30");return a.exports=d.extend(function(a,b){var c=this;this.config={theme:{}},this.container=e(a),this.apis=b.apis,this._data=null,this.chart=null,this.option=null,this.animation=null,this.interval=null,this.pieData=null,this.duration=null,this.init(b),this.finish=function(a){var b=a.data,d=a.duration,e=new Date().getTime();c.myReq=requestAnimationFrame(function a(){var f=new Date().getTime();f-e<d?c.myReq=requestAnimationFrame(a):(c.emit("finish",{data:b}),cancelAnimationFrame(c.myReq))})}},{init:function(a){this.mergeConfig(a),this.updateLayout(),this.updateStyle()},render:function(a,b){a=this.data(a);var c=this.mergeConfig(b);this.chart=g.init(this.container[0]),this.pieData=a.map(function(a){return[{name:c.options.series.series1.label,value:a.value1},{name:c.options.series.series2.label,value:a.value2}]});var d=this.chart.getHeight(),e=this.chart.getWidth();this.option={series:[{type:"comparePie",center:[e/2,d/2],radius:[c.options.series.series1.radius+"%",c.options.series.series2.radius+"%"],color:[c.options.series.series1.color,c.options.series.series2.color],label:{style:{fontSize:c.options.chart.label.text.fontSize,fontWeight:c.options.chart.label.text.fontWeight,fontFamily:c.options.chart.label.text.fontFamily}},value:{style:{fill:c.options.chart.number.text.color,fontSize:c.options.chart.number.text.fontSize,fontWeight:c.options.chart.number.text.fontWeight,fontFamily:c.options.chart.number.text.fontFamily}}}]},this.animation=function(a,b,c){this.interval&&clearInterval(this.interval),b.series[0].data=c[0],this.chart.setOption(b);var d=0;this.interval=setInterval(function(){d+=1,this.chart.getModel("series",0).set("data",c[d])}.bind(this),a)}.bind(this);var f=1e3*c.options.others.animation.animationDuration;this.duration=f/this.pieData.length,this.animation(this.duration,this.option,this.pieData);var h=1e3*c.options.others.animation.animationDelay+1e3*c.options.others.animation.animationDuration;this.finish({data:a,duration:h}),this.updateStyle()},resize:function(a,b){this.updateLayout(a,b),this.option.series[0].center=[a/2,b/2],this.animation(this.duration,this.option,this.pieData),this.chart.resize(),this.chart.setOption(this.option)},setColors:function(){},data:function(a){return a&&(this._data=a),this._data},mergeConfig:function(a){return a?(this.config.theme=f.defaultsDeep(a.theme||{},this.config.theme),this.setColors(),this.config=f.defaultsDeep(a||{},this.config),this.config):this.config},updateLayout:function(){},updateStyle:function(){},updateOptions:function(a){this.pieData=this.pieData.map(function(b){return[{name:a.options.series.series1.label,value:b[0].value},{name:a.options.series.series2.label,value:b[1].value}]}),this.option.series[0].value.style={fill:a.options.chart.number.text.color,fontSize:a.options.chart.number.text.fontSize,fontWeight:a.options.chart.number.text.fontWeight,fontFamily:a.options.chart.number.text.fontFamily},this.option.series[0].label.style={fontSize:a.options.chart.label.text.fontSize,fontWeight:a.options.chart.label.text.fontWeight,fontFamily:a.options.chart.label.text.fontFamily},this.option.series[0].color=[a.options.series.series1.color,a.options.series.series2.color],this.option.series[0].radius=[a.options.series.series1.radius+"%",a.options.series.series2.radius+"%"];var b=1e3*a.options.others.animation.animationDuration;this.duration=b/this.pieData.length,this.animation(this.duration,this.option,this.pieData);var c=1e3*a.options.others.animation.animationDelay+1e3*a.options.others.animation.animationDuration,d=this.data();this.finish({data:d,duration:c})},destroy:function(){this.chart.clear()},getThemableConfig:function(a){if(!a)return null;var b={options:{chart:{number:{text:{color:a.textColor}}},series:{series1:{color:a.palette[0]},series2:{color:a.palette[1]}}}};return b}}),a.exports});