// env=undefined => env=publish 
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Material/Shader/meshphysical_frag.glsl",[],function(n,e,t,a,i,r){return n.exports="#define GLSLIFY 1\n#define STANDARD\n\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef IOR\n\tuniform float ior;\n#endif\n\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifdef USE_INSTANCING\t\n\tflat varying int vInstanceVisible;\n\tvarying float vInstanceOpacity;\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\t#ifdef USE_INSTANCING\t\n\t\tif(vInstanceVisible == 0) discard;\n\t#endif\n  \n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\n\t#include <transmission_fragment>\n\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\n\t#ifdef USE_SHEEN\n\n\t\t// Sheen energy compensation approximation calculation can be found at the end of\n\t\t// https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT\n\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\n\t#endif\n\t\n\t#ifdef USE_INSTANCING\n\t\tgl_FragColor.a *= vInstanceOpacity;\n\t#endif\n\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}",n.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Material/Shader/meshphysical_vert.glsl",[],function(n,e,t,i,r,l){return n.exports="#define GLSLIFY 1\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifdef USE_TRANSMISSION\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n#ifdef USE_INSTANCING\n\tattribute int instanceVisible;\n\tattribute float instanceOpacity;\n\n\tflat varying int vInstanceVisible;\n\tvarying float vInstanceOpacity;\n\n#endif\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n  #ifdef USE_INSTANCING\n\t\tvInstanceVisible = instanceVisible;\n\t\tvInstanceOpacity = instanceOpacity;\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n#ifdef USE_TRANSMISSION\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif\n}",n.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Material",[],function(e,t,i,n,a,r){function o(t,e){var n,a=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,n)),a}function s(a){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach(function(e){var t,n;t=a,n=r[e=e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(r,e))})}return a}function p(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return e.exports=function(t){var e,n,a;function r(e){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");this._material=new t.MeshStandardMaterial(s(s({side:t.DoubleSide},e),{},{transparent:!0})),this._material.onBeforeCompile=function(e){e.vertexShader=i("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Material/Shader/meshphysical_vert.glsl"),e.fragmentShader=i("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Material/Shader/meshphysical_frag.glsl")},this._material.needsUpdate=!0,this._envMap=null,this._envMapIntensity=0,this._envMapIntensityFactor=1}return e=r,(n=[{key:"envMap",set:function(e){this._envMap=e,this._material.envMap=this._envMap}},{key:"envMapIntensityFactor",set:function(e){this._envMapIntensityFactor=e,this.updateEnvMapIntensity()}},{key:"envMapIntensity",set:function(e){this._envMapIntensity=void 0===e?0:e,this.updateEnvMapIntensity()}},{key:"needsUpdate",set:function(e){this._material.needsUpdate=e}},{key:"material",get:function(){return this._material}},{key:"updateEnvMapIntensity",value:function(){this._material.envMapIntensity=this._envMapIntensity*this._envMapIntensityFactor}}])&&p(e.prototype,n),a&&p(e,a),Object.defineProperty(e,"prototype",{writable:!1}),r},e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/BVH/Node",[],function(e,t,n,i,a,r){function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}o=u,(c=[{key:"enable",get:function(){return this._enable},set:function(e){this._enable=e}},{key:"clear",value:function(){this.left=null,this.right=null,this.isLeaf=!1,this.depth=0,this.bbox=[],this.center=[],this._enable=!0}}])&&l(o.prototype,c),s&&l(o,s),Object.defineProperty(o,"prototype",{writable:!1});var o,s,c=u;function u(){if(!(this instanceof u))throw new TypeError("Cannot call a class as a function");this.id=null,this.clear(),this._enable=!0}return e.exports=c,e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Tree/Action",[],function(e,t,i,r,o,a){function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,o,a=[],n=!0,s=!1;try{for(i=i.call(e);!(n=(r=i.next()).done)&&(a.push(r.value),!t||a.length!==t);n=!0);}catch(e){s=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(s)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(i="Object"===i&&e.constructor?e.constructor.name:i)||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function l(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h,c,u=null,d=(h=y,(d=[{key:"getHighlightColor",value:function(){var e=this.options.interactiveColor,e=n(u.Chroma(e).gl(),3);this.highlightColor.r=e[0],this.highlightColor.g=e[1],this.highlightColor.b=e[2]}},{key:"traversePrimitive",value:function(e,t){var i=this;e&&(e=e.getAllElements()).length&&e.forEach(function(e){i.meta.orm.getMeshByEleId(e,function(){t.apply(void 0,arguments)})})}},{key:"setNodeVisible",value:function(e,r,o){var a=this;e&&this.traversePrimitive(e,function(e,t,i){e=e.geometry.attributes.instanceVisible;e.array[t]=!0===r?1:0,o?e.needsUpdate=!0:a.visibleNeedsUpdate.add(i)})}},{key:"setNodeVisibleByName",value:function(e,t,i){e=this.tree.getNodeByName(e);this.setNodeVisible(e,t,i)}},{key:"setNodeVisibleById",value:function(e,t,i){e=this.tree.getNodeById(e);this.setNodeVisible(e,t,i)}},{key:"unhighlightNode",value:function(e,o){var a=this;e&&this.traversePrimitive(e,function(e,t,i,r){t*=3,e=e.instanceColor;r.preColor&&(e.array[t]=r.preColor.r,e.array[1+t]=r.preColor.g,e.array[2+t]=r.preColor.b,o?e.needsUpdate=!0:a.colorNeedsUpdate.add(i))})}},{key:"highlightNode",value:function(e,o){var a=this;e&&(this.activeNodes.push(e),this.traversePrimitive(e,function(e,t,i,r){t*=3,e=e.instanceColor;r.preColor.r=e.array[t],r.preColor.g=e.array[1+t],r.preColor.b=e.array[2+t],e.array[t]=a.highlightColor.r,e.array[1+t]=a.highlightColor.g,e.array[2+t]=a.highlightColor.b,o?e.needsUpdate=!0:a.colorNeedsUpdate.add(i)}))}},{key:"highlightByName",value:function(e,t){e=this.tree.getNodeByName(e);this.highlightNode(e,t)}},{key:"highlightById",value:function(e,t){e=this.tree.getNodeById(e);this.highlightNode(e,t)}},{key:"unhighlight",value:function(){var t=this;this.clearColorUpdate(),this.activeNodes.forEach(function(e){t.unhighlightNode(e,!1)}),this.updateColor(),this.activeNodes=[]}},{key:"_transformOpacity",value:function(e,t,i,r,o){e=e.geometry.attributes.instanceOpacity;e.array[t]=r,o?e.needsUpdate=!0:this.opacityNeedsUpdate.add(i)}},{key:"transformOpacityNode",value:function(e,r){var o=this;e&&(this.traversePrimitive(this.tree.rootNode,function(e,t,i){o._transformOpacity(e,t,i,.3,r)}),this.traversePrimitive(e,function(e,t,i){o._transformOpacity(e,t,i,1,r)}))}},{key:"transformOpacityByName",value:function(e,t){e=this.tree.getNodeByName(e);this.transformOpacityNode(e,t)}},{key:"transformOpacityById",value:function(e,t){e=this.tree.getNodeById(e);this.transformOpacityNode(e,t)}},{key:"updateVisible",value:function(){var t=this;this.visibleNeedsUpdate.forEach(function(e){t.meta.orm.getMeshByPrimId(e,function(e){e.geometry.attributes.instanceVisible.needsUpdate=!0})})}},{key:"updateColor",value:function(){var t=this;this.colorNeedsUpdate.forEach(function(e){t.meta.orm.getMeshByPrimId(e,function(e){e.instanceColor.needsUpdate=!0})})}},{key:"updateOpacity",value:function(){var t=this;this.opacityNeedsUpdate.forEach(function(e){t.meta.orm.getMeshByPrimId(e,function(e){e.geometry.attributes.instanceOpacity.needsUpdate=!0})})}},{key:"clearColorUpdate",value:function(){this.colorNeedsUpdate.clear()}},{key:"clearVisibleUpdate",value:function(){this.visibleNeedsUpdate.clear()}},{key:"clearOpacityUpdate",value:function(){this.opacityNeedsUpdate.clear()}},{key:"updateOptions",value:function(e){this.options=Object.assign(this.options,e||{}),this.getHighlightColor()}}])&&l(h.prototype,d),c&&l(h,c),Object.defineProperty(h,"prototype",{writable:!1}),y);function y(e,t,i,r){if(!(this instanceof y))throw new TypeError("Cannot call a class as a function");u=t.Utils,this.tree=e,this.meta=i,this.options=r,this.activeNodes=[],this.colorNeedsUpdate=new Set,this.visibleNeedsUpdate=new Set,this.opacityNeedsUpdate=new Set,this.highlightColor={r:0,g:0,b:0},this.getHighlightColor()}return e.exports=d,e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Tree/Node",[],function(e,t,n,r,i,o){function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}l=c,(h=[{key:"add",value:function(e){if(e===this)return console.error("node can't be added as a child of itself.",e),this;null!==e.parent&&e.parent.remove(e),(e.parent=this).children.push(e)}},{key:"remove",value:function(e){var t=this.children.indexOf(e);-1!==t&&(e.parent=null,this.children.splice(t,1))}},{key:"traverse",value:function(t){t(this),this.children.forEach(function(e){e.traverse(t)})}},{key:"traverseAncestors",value:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}},{key:"getNodeByProperty",value:function(e,t){if(this[e]===t)return this;for(var n=this.children,r=0,i=n.length;r<i;r++){var o=n[r].getNodeByProperty(e,t);if(void 0!==o)return o}}},{key:"getAllElements",value:function(){var t=[];return this.traverse(function(e){e.children.length||t.push(e.id)}),t}},{key:"highlight",value:function(e,t,n){this.entity?this.entity.highlight(e,t,n):console.log("当前节点 ".concat(this.id," 无实体"))}},{key:"restore",value:function(){}},{key:"clear",value:function(){var t=this;this.children.forEach(function(e){t.remove(e)})}}])&&a(l.prototype,h),s&&a(l,s),Object.defineProperty(l,"prototype",{writable:!1});var l,s,h=c;function c(){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this.type="node",this.id=void 0,this.name=void 0,this.parent=null,this.children=[]}return e.exports=h,e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Meta/Materials",[],function(e,a,t,n,r,i){function o(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s,p=null,u=null,l=null,c=null,v=t("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Material"),h={color:[1,1,1],opacity:1},m=(t=f,(m=[{key:"get",value:function(e){return this.mmap.has(e)?this.mmap.get(e).material:null}},{key:"set",value:function(e,a){this.createTexture(a),this.createMaterial(e)}},{key:"createTexture",value:function(e){var t=this;Array.isArray(e)&&e.forEach(function(e){var a=e.id,e=e.url;t.texMap.has(a)||((e=c.load(e)).anisotropy=32,e.encoding=u.sRGBEncoding,e.wrapS=u.RepeatWrapping,e.wrapT=u.RepeatWrapping,t.texMap.set(a,e))})}},{key:"createMaterial",value:function(e){var o=this;Array.isArray(e)&&e.forEach(function(e){var a=e.id,t=e.color,n=e.texture_id,r=e.transparency,i=e.metalness,e=e.roughness,r=1-r;o.omap.has(a)||o.omap.set(a,{color:o.getColor(t),opacity:r}),o.mmap.has(a)||(t=o.texMap.get(n),(n=new l({opacity:r,metalness:i,roughness:e,map:t||null})).envMap=o._envMap,n.envMapIntensity=o._envMapIntensity,n.needsUpdate=!0,o.mmap.set(a,n))})}},{key:"convertArrayBufferToCanvas",value:function(e,a,t){if(a&&t){var n=document.createElement("canvas"),r=n.getContext("2d");if(n.width=a,n.height=t,e.length%4==0){var i=new ImageData(new Uint8ClampedArray(e),a,t);r.putImageData(i,0,0)}else{if(e.length%3!=0)return null;for(var i=new ArrayBuffer(a*t*4),o=new Uint8ClampedArray(i),s=0;s<t;s++)for(var p=0;p<a;p++){var u=4*(s*a+p),l=3*(s*a+p);o[0+u]=e[0+l],o[1+u]=e[1+l],o[2+u]=e[2+l],o[3+u]=255}i=new ImageData(o,a,t);r.putImageData(i,0,0)}return n}}},{key:"getColor",value:function(e){for(var e=e.toString(16),a=6-e.length,t="",n=0;n<a;n++)t+="0";t="#".concat(t+=e),e=p.Chroma(t).gl();return[e[0],e[1],e[2]]}},{key:"getMaterial",value:function(e){return this.mmap.get(e)?this.mmap.get(e).material:null}},{key:"getOptions",value:function(e){return this.omap.has(e)?this.omap.get(e):h}},{key:"setEnvMap",value:function(e){var a=e.properties,e=e.value;this._envMap=e,this._envMapIntensity=a,this.updateEnvMap()}},{key:"setEnvMapIntensityFactor",value:function(a){this.mmap.forEach(function(e){e.envMapIntensityFactor=a})}},{key:"updateEnvMap",value:function(){var a=this;this.mmap.forEach(function(e){e.envMap=a._envMap,e.envMapIntensity=a._envMapIntensity,e.needsUpdate=!0})}},{key:"destroy",value:function(){this.mmap.forEach(function(e){return e&&e.dispose&&e.dispose()}),this.texMap.forEach(function(e){return e&&e.dispose&&e.dispose()}),this.clear()}},{key:"clear",value:function(){this.omap.clear(),this.mmap.clear(),this.texMap.clear()}}])&&o(t.prototype,m),s&&o(t,s),Object.defineProperty(t,"prototype",{writable:!1}),f);function f(e){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");u=e.THREE,p=e.Utils,l=v(u),c=(new u.TextureLoader).setCrossOrigin("*"),this.mmap=new Map,this.texMap=new Map,this.omap=new Map,this._envMap=null,this._envMapIntensity=0}return e.exports=m,e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Meta/Transform",[],function(t,r,e,n,o,i){function a(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var n,o,i=[],a=!0,s=!1;try{for(e=e.call(t);!(a=(n=e.next()).done)&&(i.push(n.value),!r||i.length!==r);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==e.return||e.return()}finally{if(s)throw o}}return i}}(t,r)||function(t,r){if(t){if("string"==typeof t)return s(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(e="Object"===e&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?s(t,r):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function l(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var c,u,y=null,f=null,h=(c=p,(h=[{key:"set",value:function(t){var r=a(1<arguments.length&&void 0!==arguments[1]?arguments[1]:[0,0,0],2)[1],e=a(t,3),n=e[0],o=e[1],e=e[2],r=(this.setRotation(r),this._centerCoord.setFromValues(n,o,e),this._centerRotMatrix4.premultiply(this._centerCoord.transfrom),this._centerCoord.toXYZ(this._centerPos),new y.Matrix4),n=(new y.Quaternion).setFromRotationMatrix((new y.Matrix4).multiply(this._centerCoord.transfrom).multiply(this._yRotMatrix).multiply(this._yUpMatrix4));r.compose(this._centerPos,n,{x:1,y:1,z:1}),this._w2lTransform.copy((new y.Matrix4).getInverse(r))}},{key:"setRotation",value:function(t){t=y.MathUtils.degToRad(t);this._yRotMatrix.makeRotationY(t),this._centerRotMatrix4.makeRotationY(t)}},{key:"centerPos",get:function(){return this._centerPos}},{key:"centerRotMatrix4",get:function(){return this._centerRotMatrix4}},{key:"yUpMatrix4",get:function(){return this._yUpMatrix4}},{key:"localMatrix4",get:function(){return this._w2lTransform}}])&&l(c.prototype,h),u&&l(c,u),Object.defineProperty(c,"prototype",{writable:!1}),p);function p(t){if(!(this instanceof p))throw new TypeError("Cannot call a class as a function");y=t.THREE,f=t.VG,this._centerPos=new y.Vector3,this._centerRotMatrix4=new y.Matrix4,this._w2lTransform=new y.Matrix4,this._yRotMatrix=new y.Matrix4,this._yUpMatrix4=(new y.Matrix4).fromArray([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]).transpose(),this._centerCoord=new f.Coordinates(0,0,0),this._centerCoord.crs=f.EPSG4978}return t.exports=h,t.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Meta/ORM",[],function(e,t,i,r,n,s){function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}o=p,(m=[{key:"setElement2Node",value:function(e,t){this._node2ele.set(t,e),this.ele2prim.has(e)||this.ele2prim.set(e,{prims:[],status:{preColor:{r:0,g:0,b:0}}})}},{key:"setPrimitive2Node",value:function(i,r,e){var n=this;this._prim2node.set(i,e),e.forEach(function(e,t){e=n._node2ele.get(e);void 0!==e&&n.ele2prim.has(e)&&n.ele2prim.get(e).prims.push({primId:i,meshIndex:r,nodeIndex:t})})}},{key:"setPrimitive2Mesh",value:function(e,t){this.prim2mesh.has(e)||this.prim2mesh.set(e,[]),this.prim2mesh.get(e).push(t)}},{key:"getMeshByPrimId",value:function(e,t){e=this.prim2mesh.get(e);e&&e.forEach(function(e){t(e)})}},{key:"getMeshByEleId",value:function(e,r){var t,n,s=this;this.ele2prim.has(e)&&(t=(e=this.ele2prim.get(e)).prims,n=e.status,t&&t.forEach(function(e){var t=e.primId,i=e.meshIndex,e=e.nodeIndex,i=s.prim2mesh.get(t)[i];r(i,e,t,n)}))}},{key:"clear",value:function(){this._node2ele.clear(),this._prim2node.clear(),this.ele2prim.clear(),this.prim2mesh.clear()}}])&&a(o.prototype,m),h&&a(o,h),Object.defineProperty(o,"prototype",{writable:!1});var o,h,m=p;function p(){if(!(this instanceof p))throw new TypeError("Cannot call a class as a function");this._node2ele=new Map,this._prim2node=new Map,this.ele2prim=new Map,this.prim2mesh=new Map}return e.exports=m,e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Progress",[],function(t,e,n,r,i,o){function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}u=l,(c=[{key:"total",get:function(){return this._total},set:function(t){this._total=t}},{key:"number",get:function(){return this._number},set:function(t){this._number=t}},{key:"rate",get:function(){return 0===this._total?0:this._number/this._total}},{key:"addNumber",value:function(t){this._number+=t}},{key:"reset",value:function(){this._total=0,this._number=0}}])&&a(u.prototype,c),s&&a(u,s),Object.defineProperty(u,"prototype",{writable:!1});var u,s,c=l;function l(){if(!(this instanceof l))throw new TypeError("Cannot call a class as a function");this.reset()}return t.exports=c,t.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Instance",[],function(e,t,r,a,n,i){function o(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var s,c,m=null,v=null,y=null,u=(s=l,(u=[{key:"addData",value:function(e){Array.isArray(e)&&(this.createBatch(e),this.createIntance(e))}},{key:"createBatch",value:function(e){var i=this;e.forEach(function(e){var n={};e.geomNodes.forEach(function(e){var t=e.id,r=e.owner_id,a=e.material_id;i.meta.orm.setElement2Node(r,t),void 0===n[a]&&(n[a]=[]),n[a].push(e)}),e.batch=n,delete e.geomNodes,delete e.texCoords})}},{key:"createIntance",value:function(e){var d=this;e.forEach(function(e){var s=e.vertices,c=e.vertex_indices,u=e.tex_coords,l=e.id,f=e.batch;Object.keys(f).forEach(function(e,t){var r=f[e],a=new m.InstancedBufferGeometry,n=(d.setAttribute(a,"index","Uint16BufferAttribute",c,1),d.setAttribute(a,"position","Float32BufferAttribute",s,3),d.setAttribute(a,"uv","Float32BufferAttribute",u,2),a.computeVertexNormals(),new m.InstancedMesh(a,d.meta.materials.getMaterial(+e),r.length)),e=d.meta.materials.getOptions(+e).opacity,i=(n.renderOrder=1===e?999:1e4,d.layer.add(n),d.meta.orm.setPrimitive2Mesh(l,n),d.meta.orm.setPrimitive2Node(l,t,r.map(function(e){return e.id})),[]),o=[];r.forEach(function(e,t){var r=e.transform,e=e.material_id;y.fromArray(r),n.setMatrixAt(t,y.premultiply(d.meta.transform.yUpMatrix4));r=d.meta.materials.getOptions(e).color;v.fromArray(r),n.setColorAt(t,v),i.push(1),o.push(1)}),d.setAttribute(a,"instanceVisible","InstancedBufferAttribute",new Int32Array(i),1),d.setAttribute(a,"instanceOpacity","InstancedBufferAttribute",new Float32Array(o),1)})})}},{key:"setAttribute",value:function(e,t,r,a,n){e&&("index"===t?e.setIndex(new m[r](a,n)):e.setAttribute(t,new m[r](a,n)))}},{key:"clear",value:function(){}}])&&o(s.prototype,u),c&&o(s,c),Object.defineProperty(s,"prototype",{writable:!1}),l);function l(e,t,r){if(!(this instanceof l))throw new TypeError("Cannot call a class as a function");m=e.THREE,v=new m.Color,y=new m.Matrix4,this.layer=t,this.meta=r}return e.exports=u,e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Meta",[],function(t,a,e,n,r,i){function o(t,a){for(var e=0;e<a.length;e++){var n=a[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s,v=e("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Meta/ORM"),c=e("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Meta/Transform"),m=e("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Meta/Materials"),l=(e=u,(l=[{key:"orm",get:function(){return this._orm}},{key:"transform",get:function(){return this._transform}},{key:"materials",get:function(){return this._materials}},{key:"clear",value:function(){this._orm.clear(),this._materials.clear()}},{key:"setEnvMap",value:function(t){this._materials&&this._materials.setEnvMap(t)}},{key:"setEnvMapIntensityFactor",value:function(t){this._materials&&this._materials.setEnvMapIntensityFactor(t)}}])&&o(e.prototype,l),s&&o(e,s),Object.defineProperty(e,"prototype",{writable:!1}),u);function u(t){if(!(this instanceof u))throw new TypeError("Cannot call a class as a function");this._orm=new v,this._transform=new c(t),this._materials=new m(t)}return t.exports=l,t.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Raycaster",["datav:/npm/eventemitter3/3.0.0"],function(t,e,r,n,o,i){function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=f(r),e=(t=n?(t=f(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(t&&("object"===a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=null,y=r("datav:/npm/eventemitter3/3.0.0"),r=function(){var t=o,e=y;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e);var r,n=s(o);function o(t){var e;if(this instanceof o)return(e=n.call(this)).container=t.container,e.camera=t.engine.camera,l=t.THREE,e.ray=new l.Ray,e.raycaster=new l.Raycaster,e.mouse=new l.Vector2,e.origin=new l.Vector3,e.target=new l.Vector3,e._enable=!1,e._inCurrentScene=!0,e.init(),e;throw new TypeError("Cannot call a class as a function")}return t=o,(e=[{key:"enable",set:function(t){this._enable=t}},{key:"inCurrentScene",set:function(t){this._inCurrentScene=t}},{key:"set",value:function(t,e,r){this.bvh=t,this.tree=e,this.meta=r,this._enable=!0}},{key:"resetRay",value:function(){this.origin.set(0,0,0),this.target.set(0,0,0),this.origin.setFromMatrixPosition(this.camera.matrixWorld),this.target.set(this.mouse.x,this.mouse.y,.5).unproject(this.camera),this.origin.applyMatrix4(this.meta.transform.localMatrix4),this.target.applyMatrix4(this.meta.transform.localMatrix4),this.ray.origin.copy(this.origin),this.ray.direction.copy(this.target.sub(this.origin).normalize())}},{key:"init",value:function(){var i=this;this.container.addEventListener("click",function(t){if(i._enable&&i._inCurrentScene){t.preventDefault(),i.mouse.x=t.offsetX/i.container.clientWidth*2-1,i.mouse.y=2*-(t.offsetY/i.container.clientHeight)+1,i.resetRay(),i.raycaster.setFromCamera(i.mouse,i.camera),i.tree.action.unhighlight();var n=[],o=(i.bvh.raycaster(i.ray,i.bvh.rootNode,n),[]);if(n.length)for(var e=0;e<n.length;e++)!function(t){var e=[],r=n[t].id;i.meta.orm.getMeshByEleId(r,function(t){t.raycast(i.raycaster,e)}),e.forEach(function(t){return t.eleId=r}),o.push.apply(o,e)}(e);o.sort(function(t,e){return t.distance-e.distance}),o.length&&(i.tree.action.clearColorUpdate(),t=o[0].eleId,console.log(t),void 0!==t&&(i.emit("interactive",t),i.tree.action.highlightById(t,!1),i.tree.action.updateColor()))}})}}])&&c(t.prototype,e),r&&c(t,r),Object.defineProperty(t,"prototype",{writable:!1}),o}();return t.exports=r,t.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/BVH",[],function(t,e,r,n,i,o){function a(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||u(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,o=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(o.push(n.value),!e||o.length!==e);a=!0);}catch(t){u=!0,i=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw i}}return o}}(t,e)||u(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){if(t){if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(r="Object"===r&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,e):void 0}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l,f=r("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/BVH/Node"),h=(r=b,(h=[{key:"rootNode",get:function(){return this._root}},{key:"prepare",value:function(){var n=this;this.bboxsMap.clear(),this._bboxs.forEach(function(t){var e=t.id,t=t.bbox,r=n.getCenter(t);n.bboxsMap.set(e,{center:r,bbox:t,id:e})})}},{key:"getBounds",value:function(t,c){var l=1/0,f=1/0,h=1/0,b=-1/0,y=-1/0,v=-1/0,d=1/0,p=1/0,g=1/0,x=-1/0,m=-1/0,N=-1/0,t=(t.forEach(function(t){var e=t.bbox,t=t.center,e=k(e,6),r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],e=e[5],t=k(t,3),u=t[0],s=t[1],t=t[2];r<l&&(l=r),b<o&&(b=o),n<f&&(f=n),y<a&&(y=a),i<h&&(h=i),v<e&&(v=e),c&&(x<u&&(x=u),u<d&&(d=u),m<s&&(m=s),s<p&&(p=s),N<t&&(N=t),t<g&&(g=t))}),[l,f,h,b,y,v]);return{center:this.getCenter(t),bbox:t,centerRange:c?[d,p,g,x,m,N]:null}}},{key:"getSize",value:function(t){var t=k(t,6),e=t[0],r=t[1],n=t[2];return[t[3]-e,t[4]-r,t[5]-n]}},{key:"longestAsix",value:function(t){var t=t.bbox,t=this.getSize(t),e=Math.max.apply(Math,a(t)),t=t.findIndex(function(t){return t===e});return-1===t?0:t}},{key:"getCenter",value:function(t){return[(t[0]+t[3])/2,(t[1]+t[4])/2,(t[2]+t[5])/2]}},{key:"build",value:function(t){this._bboxs=t,this.prepare();var t=this.getBounds(this.bboxsMap,!0),e=this.longestAsix(t),r=t.bbox,n=t.center,t=t.centerRange;this._root.bbox=r,this._root.center=n,this._root.depth=0,this.split(this._root,this.bboxsMap,this._root.center[e],e,t[e],t[e+3],1)}},{key:"split",value:function(e,t,r,n,i,o,a){var u=this,s=[],c=[];t.forEach(function(t){var e=t.center;e[n]>=i&&e[n]<r&&s.push(t),e[n]<=o&&e[n]>=r&&c.push(t)}),s.length&&(a>=this.options.maxDepth||1===s.length?s.forEach(function(t){u.createNode(e,!0,[t],a,!0)}):(t=this.createNode(e,!0,s,a,!1),this.split(t,s,(r+i)/2,n,i,r,a+1))),c.length&&(a>=this.options.maxDepth||1===c.length?c.forEach(function(t){u.createNode(e,!1,[t],a,!0)}):(t=this.createNode(e,!1,c,a,!1),this.split(t,c,(r+o)/2,n,r,o,a+1)))}},{key:"createNode",value:function(t,e,r,n,i){var o=new f,a=this.getBounds(r);return o.bbox=a.bbox,o.center=a.center,o.depth=n,(o.isLeaf=i)&&(a=r[0].id,o.id=a),e?(t.left||(t.left=[]),t.left.push(o)):(t.right||(t.right=[]),t.right.push(o)),o}},{key:"traverseLeaves",value:function(e){this.traverse(this._root,function(t){t.isLeaf&&e(t)})}},{key:"traverse",value:function(t,e){var r=this;t.isLeaf||(t.left&&t.left.forEach(function(t){return e(t)}),t.right&&t.right.forEach(function(t){return e(t)}),t.left&&t.left.forEach(function(t){return r.traverse(t,e)}),t.right&&t.right.forEach(function(t){return r.traverse(t,e)}))}},{key:"intersectBBox",value:function(t,e){var r,n,i,e=k(e,6),o=e[0],a=e[1],u=e[2],s=e[3],c=e[4],e=e[5],l=t.origin,t=t.direction,f=1/t.x,h=1/t.y,t=1/t.z,s=0<=f?(r=(o-l.x)*f,(s-l.x)*f):(r=(s-l.x)*f,(o-l.x)*f),o=0<=h?(n=(a-l.y)*h,(c-l.y)*h):(n=(c-l.y)*h,(a-l.y)*h);return o<r||s<n?-1:((r<n||Number.isNaN(r))&&(r=n),(o<s||Number.isNaN(s))&&(s=o),(f=0<=t?(i=(u-l.z)*t,(e-l.z)*t):(i=(e-l.z)*t,(u-l.z)*t))<r||s<i?-1:((r<i||Number.isNaN(r))&&(r=i),(s=f<s||Number.isNaN(s)?f:s)<0?-1:0<=r?r:s))}},{key:"distance",value:function(t,e){var r=t.x,n=t.y,t=t.z,e=k(e,3),r=r-e[0],n=n-e[1],t=t-e[2];return Math.sqrt(r*r+n*n+t*t)}},{key:"getPointAt",value:function(t,e){var r=t.origin,t=t.direction,n=r.x,i=r.y,r=r.z;return[n+t.x*e,i+t.y*e,r+t.z*e]}},{key:"_raycaster",value:function(e,t,r){var n=this,i=t.bbox,o=t.enable,i=this.intersectBBox(e,i);-1!==i&&o&&(t.isLeaf&&(o=this.getPointAt(e,i),r.push({id:t.id,distance:this.distance(e.origin,o)})),t.left&&t.left.forEach(function(t){return n._raycaster(e,t,r)}),t.right&&t.right.forEach(function(t){return n._raycaster(e,t,r)}))}},{key:"raycaster",value:function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return this._raycaster(t,e,r),r.sort(function(t,e){return t.distance-e.distance}),r}},{key:"updateNodeEnable",value:function(r,n){Array.isArray(r)&&this.traverseLeaves(function(t){var e=t.id;r.includes(e)&&(t.enable=n)})}},{key:"clear",value:function(){this.bboxsMap.clear(),this._root&&this._root.clear()}}])&&c(r.prototype,h),l&&c(r,l),Object.defineProperty(r,"prototype",{writable:!1}),b);function b(t){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.options=Object.assign({maxDepth:10},t),this._root=new f,this.bboxsMap=new Map}return t.exports=h,t.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Tree",[],function(e,t,o,a,r,n){function i(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var c,s=o("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Tree/Node"),d=o("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Tree/Action"),p=(o=u,(p=[{key:"rootNode",get:function(){return this.projectNode}},{key:"setData",value:function(e){this._treeData=e}},{key:"parse",value:function(){this.projectNode.clear();var e=this._treeData.tree;e&&this.parseNode(this.projectNode,e)}},{key:"parseSpatialTree",value:function(e){var t=this;e.nodes.forEach(function(e){t.parseNode(t.projectNode,e)})}},{key:"parseNode",value:function(e,t){var o=this,a=t.name,r=t.id,t=t.children,n=new s;n.name=a,n.id=r,e.add(n),Array.isArray(t)&&t.length&&t.forEach(function(e){o.parseNode(n,e)})}},{key:"getNodeByProperty",value:function(e,t){return this.projectNode.getNodeByProperty(e,t)}},{key:"getNodeByName",value:function(e){return this.getNodeByProperty("name",e)}},{key:"getNodeById",value:function(e){return this.getNodeByProperty("id",e)}},{key:"updateOptions",value:function(e){this.options=Object.assign(this.options,e||{}),this.action&&this.action.updateOptions(this.options)}},{key:"clear",value:function(){this.projectNode.clear()}}])&&i(o.prototype,p),c&&i(o,c),Object.defineProperty(o,"prototype",{writable:!1}),u);function u(e,t,o){if(!(this instanceof u))throw new TypeError("Cannot call a class as a function");this._treeData=null,this.options=o,this.projectNode=new s,this.action=new d(this,e,t,o)}return e.exports=p,e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/fetcher",[],function(t,e,n,r,o,i){function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t){function c(t){postMessage(t)}function l(){postMessage("finish")}fetch(t).then(function(t){var e=t.body.getReader(),a="";!function i(){e.read().then(function(t){var e=t.done,n=t.value;if(n){for(var r,o=0;o<n.length;o++)a+=String.fromCharCode(n[o]);-1<(t=a.lastIndexOf(", \n"))&&(r=a.substring(0,t),c(JSON.parse("[".concat(r,"]"))),a=a.substr(t+3))}if(e)return c(JSON.parse("[".concat(a,"]"))),void l();i()}).catch(function(t){l()})}()})}l=f,(u=[{key:"getMeta",value:function(t,e){this.controller=new AbortController;var n=this.controller.signal;fetch(t,{signal:n}).then(function(t){return t.json()}).then(function(t){e(t)}).catch(function(t){})}},{key:"getPrimitives",value:function(t){var e,n=this,r=t.url,o=t.primitiveHandler,i=t.finishCallback,a=t.timeoutCallback,t=t.timeout;this.terminate();e=0,r=new Blob(["const fn = ".concat(c.toString(),"; fn('").concat(r,"', ").concat(t,");")],{type:"text/javascript"}),(r=n.worker=new Worker(URL.createObjectURL(r))).onmessage=function(t){"finish"===t.data?(console.log("primitiveCount: ",e),i(),n.terminate()):"timeout"===t.data?(a(),n.terminate()):(e+=t.data.length,o(t.data))},r.onerror=function(t){i(t),n.terminate()},r.onmessageerror=function(t){i(t),n.terminate()}}},{key:"terminate",value:function(){this.worker&&this.worker.terminate(),this.controller&&(this.controller.abort(),this.controller=null)}}])&&a(l.prototype,u),s&&a(l,s),Object.defineProperty(l,"prototype",{writable:!1});var l,s,u=f;function f(){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");this.worker=null,this.controller=null}return t.exports=u,t.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/BIMLayer",[],function(t,e,v,i,n,r){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function y(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function d(){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=w(t)););return t}(t,e);if(n)return n=Object.getOwnPropertyDescriptor(n,e),n.get?n.get.call(arguments.length<3?t:i):n.value}).apply(this,arguments)}function m(t,e){return(m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function b(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=w(i),e=(t=n?(t=w(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}}function g(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function w(t){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}return t.exports=function(e){var i=null,i=e.Utils,t=e.VG,n=v("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/fetcher"),r=v("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Tree"),o=v("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/BVH"),a=v("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Raycaster"),s=v("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Meta"),c=v("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Instance"),u=v("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/Progress"),t=t.Layer,h=f;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(t&&t.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),t&&m(h,t);var l,p=b(f);function f(t){var e;if(this instanceof f)return(e=p.call(this)).options=Object.assign({visible:!0,px:120.13352394104005,py:30.26614700786203,pz:0,tx:0,ty:0,tz:0,envMapIntensityFactor:1},t||{}),e.testScene=e.testScene.bind(g(e)),e.propUrl=null,e.fetcher=new n,e.progress=new u,e;throw new TypeError("Cannot call a class as a function")}return h=f,(t=[{key:"addTo",value:function(t){d(w(f.prototype),"addTo",this).call(this,t),this.meta=new s(e),this.bvh=new o,this.tree=new r(e,this.meta,this.options),this.instance=new c(e,this,this.meta),this.onSceneChanged(),this.init(),this.updateSceneId(),this.testScene()}},{key:"onSceneChanged",value:function(){this.viewer.engine.on("sceneChanged",this.testScene)}},{key:"testScene",value:function(){this.raycaster.inCurrentScene=this.group.layers.test(this.viewer.engine.camera.layers)}},{key:"setData",value:function(t){var c,u=this;this.clear(),Array.isArray(t)&&t[0]&&t[0].primitive&&t[0].meta&&(t=t[0],c=t.primitive,t=t.meta,this.fetcher.getMeta(t,function(t){var e=t.materials,i=t.textures,n=t.elements,r=t.location,o=t.rotation,a=t.tree,s=t.properties,t=t.geomStatistic;u.setTransform(r,o),u.initTree(a),u.initBVH(n),u.initORM(e,i),t&&t.geomPrimitiveCount&&(u.progress.total=t.geomPrimitiveCount),u.propUrl=s,u.raycaster.set(u.bvh,u.tree,u.meta),u.emit("tree_data",a),u.fetcher.getPrimitives({url:c,primitiveHandler:function(t){u.instance.addData(t),u.progress.addNumber(t.length),u.emit("progress",u.progress.rate)},finishCallback:function(t){console.log("finish with error",t),u.emit("loaded")},timeoutCallback:function(){}})}))}},{key:"init",value:function(){this.initRaycaster(),this.checkVisible()}},{key:"initRaycaster",value:function(){this.raycaster=new a(e,this)}},{key:"initTree",value:function(t){this.tree.setData(t),this.tree.parse()}},{key:"initORM",value:function(t,e){this.meta.materials.set(t,e),this.meta.setEnvMapIntensityFactor(this.options.envMapIntensityFactor)}},{key:"initBVH",value:function(t){console.time("build bvh tree");t=t.map(function(t){return{id:t.id,bbox:t.bounding_box}});this.bvh.build(t),console.timeEnd("build bvh tree")}},{key:"checkVisible",value:function(){this.options.visible?this.show():this.hide()}},{key:"setTransform",value:function(t,e){var i,n;this.group&&(n=i=null,i=void 0!==t?t:[this.options.px,this.options.py,this.options.pz],n=void 0!==e?e:[this.options.tx,this.options.ty,this.options.tz],this.meta.transform.set(i,n),this.group.position.copy(this.meta.transform.centerPos),this.group.setRotationFromMatrix(this.meta.transform.centerRotMatrix4),this.updateMatrixNeedsUpdate())}},{key:"updateOptions",value:function(t){var e=i.deepClone(this.options);this.options=i.mergeOptions(this.options,t||{}),i.easyDiff(e.interactiveColor,t.interactiveColor)||this.tree&&this.tree.updateOptions(this.options),i.easyDiff(e.envMapIntensityFactor,t.envMapIntensityFactor)||this.meta&&this.meta.setEnvMapIntensityFactor(t.envMapIntensityFactor),i.easyDiff(e.sceneId.length,t.sceneId.length)&&i.deepDiff(e.sceneId,t.sceneId)||this.updateSceneId(),this.checkVisible()}},{key:"setEnvMap",value:function(t){this.meta&&this.meta.setEnvMap(t)}},{key:"show",value:function(){this.options.visible=!0,d(w(f.prototype),"show",this).call(this)}},{key:"hide",value:function(){this.options.visible=!1,d(w(f.prototype),"hide",this).call(this)}},{key:"clear",value:function(){d(w(f.prototype),"clear",this).call(this),this.propUrl=null,this.fetcher&&this.fetcher.terminate(),this.progress&&this.progress.reset(),this.meta&&this.meta.clear(),this.bvh&&this.bvh.clear(),this.tree&&this.tree.clear(),this.instance&&this.instance.clear(),this.raycaster.enable=!1}},{key:"remove",value:function(){this.clear(),d(w(f.prototype),"remove",this).call(this),this.viewer.engine.off("sceneChanged",this.testScene)}}])&&y(h.prototype,t),l&&y(h,l),Object.defineProperty(h,"prototype",{writable:!1}),f},t.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1",["datav:/npm/eventemitter3/3.0.0"],function(e,t,r,i,n,o){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(r){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=y(r),t=(e=i?(e=y(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u=r("datav:/npm/eventemitter3/3.0.0"),f=r("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/BIMLayer"),h=r("datav:/com/@datav-city-pro-v2/datav-engine-bim-v2/2.1.1/fetcher"),r=function(){var e=n,t=u;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t);var r,i=s(n);function n(e,t){var r;if(this instanceof n)return(r=i.call(this)).options=Object.assign({clickType:"click",enableInteractive:!0,interactiveColor:"RGBA(79, 240, 252, 0.2)",sceneId:["scene1"]},t),r.fetcher=new h,r;throw new TypeError("Cannot call a class as a function")}return e=n,(t=[{key:"addTo",value:function(e,t){this.cityproCore=e,this.viewer=e.viewer,this.initLayer(t)}},{key:"initLayer",value:function(e){var t=this,r=f(this.cityproCore);this.layer=new r(this.options),this.viewer.addLayer(e,this.layer),this.layer.on("tree_data",function(e){t.emit("tree_data",[{treeData:e}])}),this.layer.raycaster.on("interactive",function(e){t.emit("interactive",e),t.layer.propUrl&&t.fetcher.getMeta("".concat(t.layer.propUrl,"&elementId=").concat(e),function(e){t.emit("prop_data",e)})}),this.layer.on("loaded",function(){t.emit("loaded")}),this.layer.on("progress",function(e){t.emit("progress",e)})}},{key:"onCheck",value:function(e){var e=e.e,t=e.node,e=e.checked,t=t.key;this.layer&&this.layer.tree.action.clearVisibleUpdate(),this.layer&&this.layer.tree.action.setNodeVisibleById(t,e,!1),this.layer&&this.layer.tree.action.updateVisible(),this.updateBVH(t,e)}},{key:"setVisibility",value:function(e){var r=this;Array.isArray(e)&&e.length&&(this.layer&&this.layer.tree.action.clearVisibleUpdate(),e.forEach(function(e){var t=e.key,e=e.checked;r.layer&&r.layer.tree.action.setNodeVisibleById(t,e,!1),r.updateBVH(t,e)}),this.layer&&this.layer.tree.action.updateVisible())}},{key:"updateBVH",value:function(e,t){this.layer&&(e=this.layer.tree.getNodeById(e).getAllElements(),this.layer.bvh.updateNodeEnable(e,t))}},{key:"setEnvMap",value:function(e){this.layer&&this.layer.setEnvMap(e)}},{key:"setData",value:function(e){this.layer&&this.layer.setData(e)}},{key:"updateOptions",value:function(e){this.layer&&this.layer.updateOptions&&this.layer.updateOptions(e)}},{key:"show",value:function(){this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.layer&&this.layer.hide&&this.layer.hide()}},{key:"remove",value:function(){this.layer&&this.layer.remove&&this.layer.remove()}},{key:"destroy",value:function(){this.remove(),this.layer=null,this.fetcher&&(this.fetcher.terminate(),this.fetcher=null)}}])&&c(e.prototype,t),r&&c(e,r),Object.defineProperty(e,"prototype",{writable:!1}),n}();return e.exports=r,e.exports});