// env=undefined => env=publish 
Cube("datav:/com/datavmap-2d-layer-heatmap/0.2.16/heatmapLayer.js",["datav:/npm/simpleheat/0.4.0"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();return a.exports=function(a){var b=a.datavUtils,h=a.CanvasLayer,i=c("datav:/npm/simpleheat/0.4.0"),j={minOpacity:0.6,maxZoom:18,radius:15,blur:15,max:1,pane:"fillPane",visibility:!1};return function(c){function h(a){d(this,h);var c=e(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));return a=b.mergeOptions(j,a),c.options=b.mergeOptions(c.options,a),c.type="fill",c._latlngs=[],c}return f(h,c),g(h,[{key:"onInit",value:function(){this.heat=i(this.canvas),this.updateOptions()}},{key:"setData",value:function(a){a&&a.length&&(this._latlngs=a.map(function(a){return[a.lat,a.lng,a.value||1]}),this.redraw())}},{key:"onUpdateOptions",value:function(a){this.options.visibility=a.visibility,this.heat.radius(a.radius||this.heat.defaultRadius,a.blur),a.gradient&&this.heat.gradient(a.gradient),a.max&&this.heat.max(a.max),this.canvas.style.opacity=a.opacity,this.redraw()}},{key:"redraw",value:function(){this.heat&&this.map&&!this.map._animating&&this.onRender()}},{key:"onRender",value:function(){if(!this.options||this.options.visibility){this.heat.resize();var b,c,d,e,f,g,h,i,j,k=[],l=this.heat._r,m=this.map.getSize(),n=new a.Bounds(a.point([-l,-l]),m.add([l,l])),o=void 0===this.options.max?1:this.options.max,p=void 0===this.options.maxZoom?this.map.getMaxZoom():this.options.maxZoom,q=1/Math.pow(2,Math.max(0,Math.min(p-this.map.getZoom(),12))),s=l/2,t=[],u=this.map._getMapPanePos(),v=u.x%s,w=u.y%s;for(b=0,c=this._latlngs.length;b<c;b++)if(d=this.map.latLngToContainerPoint(this._latlngs[b]),n.contains(d)){f=~~((d.x-v)/s)+2,g=~~((d.y-w)/s)+2;var x=void 0===this._latlngs[b].alt?void 0===this._latlngs[b][2]?1:+this._latlngs[b][2]:this._latlngs[b].alt;j=x*q,t[g]=t[g]||[],e=t[g][f],e?(e[0]=(e[0]*e[2]+d.x*j)/(e[2]+j),e[1]=(e[1]*e[2]+d.y*j)/(e[2]+j),e[2]+=j):t[g][f]=[d.x,d.y,j]}for(b=0,c=t.length;b<c;b++)if(t[b])for(h=0,i=t[b].length;h<i;h++)e=t[b][h],e&&k.push([~~(e[0]+0.5),~~(e[1]+0.5),Math.min(e[2],o)]);this.heat.data(k).draw(this.options.minOpacity)}}},{key:"onRemove",value:function(){this._latlngs=[]}}]),h}(h)},a.exports});;
Cube("datav:/com/datavmap-2d-layer-heatmap/0.2.16",["datav:/npm/bcore/0.0.21/event"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/bcore/0.0.21/event"),i=c("datav:/com/datavmap-2d-layer-heatmap/0.2.16/heatmapLayer.js"),j=void 0,k={},l=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.container="string"===typeof a?document.querySelector(a):a,f.apis=c.apis,f.map=null,f._data=null,f.config=c,f.config.visibility=!0,f}return f(b,a),g(b,[{key:"init",value:function(){var a=this.getOptions(),b=i(this.map.L);this.layer=new b(a),this.layer.addTo(this.map)}},{key:"addTo",value:function(a){this.map=a,j=a.L.datavUtils,this.init()}},{key:"getOptions",value:function(){var a=this.config=j&&j.mergeOptions(k,this.config);return a}},{key:"show",value:function(){this.config.visibility=!0;this.layer&&this.layer.updateOptions({visibility:!0}),this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.config.visibility=!0;this.layer&&this.layer.updateOptions({visibility:!1}),this.layer&&this.layer.hide&&this.layer.hide()}},{key:"remove",value:function(){this.layer&&this.layer.remove&&this.layer.remove(),this.layer=null,this._data=null}},{key:"setData",value:function(a){this.layer&&this.layer.setData(a)}},{key:"updateOptions",value:function(a){this.config=j.mergeOptions(this.config,a),a=this.getOptions(),a.visibility=this.config.visibility,this.layer&&this.layer.updateOptions(a)}}]),b}(h);return a.exports=l,a.exports});