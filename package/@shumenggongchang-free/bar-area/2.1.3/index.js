// env=undefined => env=publish 
Cube("datav:/com/@shumenggongchang-free/bar-area/2.1.3",["datav:/npm/bcore/0.0.18/event","datav:/npm/d3/3.5.17","datav:/npm/lodash/4.6.1"],function(a,b,c){var d=c("datav:/npm/bcore/0.0.18/event"),e=c("datav:/npm/d3/3.5.17"),f=c("datav:/npm/lodash/4.6.1"),g=f.cloneDeep;return a.exports=d.extend(function(a,b){this.container=e.select(a),this.apis=b.apis,this._data=null,this.init(b)},{init:function(a){var b=this.getContainerSize();this.mergeConfig(Object.assign(a,b))},getContainerSize:function(){var a=this.container[0][0],b=getComputedStyle(a),c=b.width,d=b.height;return{width:parseFloat(c),height:parseFloat(d)}},render:function(a){this.data(a),this.drawComponent()},drawComponent:function(){this.container.select("svg").remove();var a=this._data,b=this.config,c=b.width,d=b.height,f=this.config.size,g=f.arrange,h=f.row,j=f.col,i=f.innerXPadding,k=f.outerXPadding,l=f.innerYPadding,m=f.outerYPadding,n=f.areaLineNum,o=f.areaPadding,p=f.unit,q=this.config.color.colorArr,r=this.config.font,s=r.textSize,t=r.fontFamily,u={top:10,right:10,bottom:10,left:10},v=c-u.left-u.right,w=d-u.top-u.bottom,x=e.scale.ordinal().domain(e.range(a.length)).range(q);a.forEach(function(a,b){"horizontal"===g?(a.row=Math.floor(b/j),a.col=b%j):(a.row=b%h,a.col=Math.floor(b/h))});var y=this.container.append("svg").attr({width:c,height:d}).append("g").attr({class:"char-container",transform:"translate("+u.left+", "+u.top+")"}).style({"font-family":t}),z=e.scale.ordinal().domain(e.range(j)).rangeBands([0,v],i,k),A=e.scale.ordinal().domain(e.range(h)).rangeBands([0,w],l,m),B=z.rangeBand(),C=A.rangeBand(),D=Math.min(Math.max(0.1*C,12),30),E=y.selectAll("g.data-container").data(a).enter().append("g").attr({class:"data-container",transform:function(a){return"translate("+z(a.col)+","+A(a.row)+")"},fill:function(a,b){return x(b)},stroke:function(a,b){return x(b)}});E.append("text").attr({y:D}).style("font-size",s||D+"px").text(function(a){return a.name+" ("+p+")"}).each(function(a){a.textLength=this.getBBox().width}),E.append("text").attr({y:D,x:B,dx:"-1em","text-anchor":"end"}).style("font-size",s||D+"px").text(function(a){return a.value}),E.append("line").attr({x1:0,y1:1.4*D,x2:B,y2:1.4*D,"stroke-width":D/8}),E.append("line").attr({x1:0,y1:1.65*D,x2:function(a){return a.textLength},y2:1.65*D,"stroke-width":D/15});var F=e.scale.ordinal().domain(e.range(n)).rangeBands([0,C-1.8*D],o),G=F.rangeBand(),H=e.scale.linear().domain([0,e.max(a,function(a){return a.value})]).range([0,B*n]);a.forEach(function(a){var b=H(a.value),c=b%B,d=e.range(b/B).map(function(){return B});0<c&&(d[d.length-1]=c),a.lines=d}),E.selectAll("line.area-line").data(function(a){return a.lines}).enter().append("line").attr({class:"area-line",x1:0,y1:function(a,b){return 1.8*D+F(b)+G/2},x2:function(a){return a},y2:function(a,b){return 1.8*D+F(b)+G/2},"stroke-width":G,"stroke-dasharray":"3 2.5"})},resize:function(a,b){this.mergeConfig({width:a,height:b}),this.drawComponent()},data:function(a){return a=g(a),a&&(this._data=Array.isArray(a)?a.every(function(a){return a.value=Number.parseFloat(a.value),"string"===typeof a.name&&"number"===typeof a.value&&!isNaN(a.value)})?a:[]:[]),this._data},mergeConfig:function(a){return a?(this.config=Object.assign(this.config||{},a),this.config):this.config},updateSize:function(a){this.mergeConfig({size:a}),this.drawComponent()},updateColor:function(a){this.mergeConfig({color:a}),this.drawComponent()},updateFont:function(a){this.mergeConfig({font:a}),this.drawComponent()},updateOptions:function(){}}),a.exports});