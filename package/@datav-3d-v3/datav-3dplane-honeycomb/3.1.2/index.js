// env=undefined => env=publish 
Cube("datav:/com/@datav-3d-v3/datav-3dplane-honeycomb/3.1.2/src/shader/frag.glsl",[],function(n,e,t,i,a,r){return n.exports="#define GLSLIFY 1\n#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n#endif\n// uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float emissiveIntensity;\nuniform vec2 uvOffset;\n\n#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform vec3 attenuationColor;\n\tuniform float attenuationDistance;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\nvarying vec3 vInstanceColor;\nvarying float vInstanceOpacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4(vInstanceColor, vInstanceOpacity);\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = vInstanceColor;\n\t#ifdef USE_TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t\tfloat thicknessFactor = thickness;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#ifdef USE_EMISSIVEMAP\n\t\tvec2 _vUv = vUv;\n\t\t_vUv.x += uvOffset.x;\n\t\t_vUv.y += uvOffset.y;\n\n\t \tvec4 emissiveColor = vec4(vInstanceColor, vInstanceOpacity) * texture2D( emissiveMap, _vUv );\n\t \temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\t \ttotalEmissiveRadiance *= emissiveColor.rgb;\n\t#endif\n\ttotalEmissiveRadiance *= emissiveIntensity;\n\tvec3 rawDiffuseColor = diffuseColor.rgb;\n\t#include <transmission_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",n.exports});;
Cube("datav:/com/@datav-3d-v3/datav-3dplane-honeycomb/3.1.2/src/shader/vert.glsl",[],function(n,e,t,i,r,a){return n.exports="#define GLSLIFY 1\n#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#ifdef USE_TRANSMISSION\n\tvarying vec4 vWorldPosition;\n#endif\nattribute vec3 instanceColor;\nattribute float instanceOpacity;\nvarying vec3 vInstanceColor;\nvarying float vInstanceOpacity;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t\t#ifdef USE_TANGENT\n\t\t\tvTangent = normalize( transformedTangent );\n\t\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t\t#endif\n\t#endif\n\t#include <begin_vertex>\n\tvInstanceColor = instanceColor;\n\tvInstanceOpacity = instanceOpacity;\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\t#ifdef USE_TRANSMISSION\n\t\tvWorldPosition = worldPosition;\n\t#endif\n}",n.exports});;
Cube("datav:/com/@datav-3d-v3/datav-3dplane-honeycomb/3.1.2/src/layer.js",["datav:/npm/d3-hexbin/0.2.2"],function(e,t,f,r,n,i){function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(){"use strict";M=function(){return a};var a={},e=Object.prototype,u=e.hasOwnProperty,t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",i=t.toStringTag||"@@toStringTag";function o(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(e){o=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var i,o,a,s,t=t&&t.prototype instanceof h?t:h,t=Object.create(t.prototype),n=new b(n||[]);return t._invoke=(i=e,o=r,a=n,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return O()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=t.iterator[r.method];if(void 0===n){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method))return c;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}n=l(n,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,c;n=n.arg;return n?n.done?(r[t.resultName]=n.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,c):n:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,c)}(r,a);if(r){if(r===c)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";r=l(i,o,a);if("normal"===r.type){if(s=a.done?"completed":"suspendedYield",r.arg===c)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(s="completed",a.method="throw",a.arg=r.arg)}}),t}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=s;var c={};function h(){}function p(){}function f(){}var t={},d=(o(t,n,function(){return this}),Object.getPrototypeOf),d=d&&d(d(x([]))),v=(d&&d!==e&&u.call(d,n)&&(t=d),f.prototype=h.prototype=Object.create(t));function y(e){["next","throw","return"].forEach(function(t){o(e,t,function(e){return this._invoke(t,e)})})}function g(a,s){var t;this._invoke=function(r,n){function e(){return new s(function(e,t){!function t(e,r,n,i){var o,e=l(a[e],a,r);if("throw"!==e.type)return(r=(o=e.arg).value)&&"object"==S(r)&&u.call(r,"__await")?s.resolve(r.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):s.resolve(r).then(function(e){o.value=e,n(o)},function(e){return t("throw",e,n,i)});i(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}}function m(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function b(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(m,this),this.reset(!0)}function x(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:O}}function O(){return{value:void 0,done:!0}}return o(v,"constructor",p.prototype=f),o(f,"constructor",p),p.displayName=o(f,i,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,o(e,i,"GeneratorFunction")),e.prototype=Object.create(v),e},a.awrap=function(e){return{__await:e}},y(g.prototype),o(g.prototype,r,function(){return this}),a.AsyncIterator=g,a.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var o=new g(s(e,t,r,n),i);return a.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},y(v),o(v,i,"Generator"),o(v,n,function(){return this}),o(v,"toString",function(){return"[object Generator]"}),a.keys=function(r){var e,n=[];for(e in r)n.push(e);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=x,b.prototype={constructor:b,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=u.call(i,"catchLoc"),s=u.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}var o=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,c):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),c}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(r=i.completion).type&&(n=r.arg,w(i)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:x(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),c}},a}function d(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=x(e)););return e}(e,t);if(n)return(n=Object.getOwnPropertyDescriptor(n,t)).get?n.get.call(arguments.length<3?e:r):n.value}).apply(this,arguments)}function m(e,t){return(m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function w(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=x(r),t=(e=n?(e=x(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===S(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return b(t)}}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}return e.exports=function(_){var T=_.THREE,e=_.Utils,A=_.GuiUtils,C=e._,i=e.mergeOptions,I=e.deepClone,F=e.BASE_HEIGHT_SCALE,r=e.geojsonDissolve,n=e.geojsonFlatten,o=e.geojsonBBox,R=e.Chroma,a=(new T.TextureLoader).setCrossOrigin("*");function s(t,r,e){e?a.load(e,function(e){e.wrapS=e.wrapT=T.MirroredRepeatWrapping,e.repeat.set(1,1),e.anisotropy=12,t[r]=e,t.needsUpdate=!0}):(t[r]=null,t.needsUpdate=!0)}var g=f("datav:/npm/d3-hexbin/0.2.2").hexbin,e=_.Layer,t=p;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&m(t,e);var u,l,c,h=w(p);function p(e){var t,r;if(this instanceof p)return(t=h.call(this)).options=i(t.options,{visible:!0,barStyle:{edges:6},minHeight:5,maxHeight:10,heightScale:10,speed:.5,textureUrl:'https://img.alicdn.com/tfs/TB1uBGvSpXXXXcCXpXXXXXXXXXX-170-170.png"',defaulColor:"#F286C4",renderOrder:383}),t.options=i(t.options,e||{}),t.renderQueue=_.VOGO.Transparent,t.needsAutoUpdate=!0,t.data=[],t.clipArea=null,t.timeIndex=0,t.timeStep=.1,t.initMaterial=t.initMaterial.bind(b(t)),t.updateMaterial=t.updateMaterial.bind(b(t)),t.updateOptions=t.updateOptions.bind(b(t)),r=(e=e.graph).topTexture,e=e.sideTexture,t.materialTop=t.initMaterial(r),t.materialSide=t.initMaterial(e),t.genData=t.genData.bind(b(t)),t.draw=t.draw.bind(b(t)),t;throw new TypeError("Cannot call a class as a function")}return t=p,(e=[{key:"initMaterial",value:function(e){var t=e.metalness,r=e.map,n=e.emissive,e=new T.MeshStandardMaterial({metalness:.01*t,map:a.load(r),emissive:new T.Color("#fff"),emissiveMap:a.load(n.emissiveMap),emissiveIntensity:n.show?.01*n.emissiveIntensity:0,transparent:!0,depthWrite:!0,depthTest:!0,flatShading:T.FlatShading});return s(e,"map",r),s(e,"emissiveMap",n.emissiveMap),e.onBeforeCompile=function(e){e.uniforms.uvOffset={value:{x:0,y:0}},e.uniforms.emissiveIntensity={value:n.show?.01*n.emissiveIntensity:0},e.vertexShader=f("datav:/com/@datav-3d-v3/datav-3dplane-honeycomb/3.1.2/src/shader/vert.glsl"),e.fragmentShader=f("datav:/com/@datav-3d-v3/datav-3dplane-honeycomb/3.1.2/src/shader/frag.glsl"),this.userData.shader=e},e.needsUpdate=!0,e}},{key:"traverse",value:function(t){this.group&&this.group.traverse&&this.group.traverse(function(e){(e instanceof T.Mesh||e instanceof T.InstancedMesh||e instanceof T.LineSegments||e instanceof T.Sprite)&&t&&t(e)})}},{key:"autoUpdate",value:function(){var i=this;if(this.options){var e=this.options,t=e.visible,r=e.graph,e=e.animation;if(t){var n=r.topTexture,o=r.sideTexture;if(this.traverse(function(e){var t=e.material[0].userData.shader,r=o.emissive;t&&(r.show?(1e4<t.uniforms.uvOffset.value.x||t.uniforms.uvOffset.value.x<-1e4?t.uniforms.uvOffset.value.x=0:t.uniforms.uvOffset.value.x-=.01*r.uvSpeedX*.01,1e4<t.uniforms.uvOffset.value.y||t.uniforms.uvOffset.value.y<-1e4?t.uniforms.uvOffset.value.y=0:t.uniforms.uvOffset.value.y-=.01*r.uvSpeedY*.01,t.uniforms.emissiveIntensity.value=.01*r.emissiveIntensity):t.uniforms.emissiveIntensity.value=0),t=e.material[1].userData.shader,r=n.emissive,t&&(t.uniforms.emissiveIntensity.value=r.show?.01*r.emissiveIntensity:0)}),e.scaleAnimation.show){var t=.01*e.scaleAnimation.speed,a=(1<=this.timeIndex?this.timeStep=-t:this.timeIndex<=0&&(this.timeStep=t),this.timeIndex+=t,r.honeyRadius*_.drawScale*1e4),a=Math.round(a),t=e.scaleAnimation.scaleRange,e=(t[1]-t[0])/200,s=+(t[0]/100+e+e*Math.sin(3*this.timeIndex)).toFixed(2),u=r.honeyHeightRange[0]*_.drawScale*1e5,t=r.honeyHeightRange[1]*_.drawScale*1e5,l=1/0,c=-1/0;if(this.hexgons){for(var h=0;h<this.hexgons.features.length;h++){var p=this.hexgons.features[h];null!=p.properties.value&&(p=+p.properties.value,isNaN(p)||(c<p&&(c=p),p<l&&(l=p)))}var f=(t-u)/(c-l),d=1-.01*r.honeyPadding,v=.1*_.drawScale*1e5,e=new T.Vector3,y=new T.Matrix4;e.set(s,s,s),this.traverse(function(e){if(e.geometry.attributes.instanceOpacity){for(var t=0;t<i.hexgons.features.length;t++){var r=i.hexgons.features[t],n=v;null!=r.properties.value&&(n=(r.properties.value-l)*f+u),y.makeScale(a*d*s,a*d*s,n*s*2),y.setPosition(+r.properties.x,+r.properties.y,n*s),e.setMatrixAt(t,y)}e.instanceMatrix.needsUpdate=!0}})}}}}}},{key:"updateArea",value:function(){_.mainTerrainData&&_.mainTerrainData.geojson_main&&this.setClipArea(_.mainTerrainData.geojson_main)}},{key:"render",value:function(e){var t=this;this.data=e||[],this.data.map(function(e){var t=_.proj.proj([+e.lng,+e.lat,0]);return e.x=t[0],e.y=t[1],e.z=t[2],e}),this.data&&0<this.data.length&&this.clipArea&&this.bbox&&this.genData().then(function(){t.draw()})}},{key:"setClipArea",value:function(e){var t=this;this.clipArea=null,e&&e.features&&0!=e.features.length&&(e=Object.assign({},e),n(e),this.clipArea={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:r(e.features)}]},this.bbox=o(this.clipArea),this.data&&0<this.data.length&&this.clipArea&&this.bbox&&this.genData().then(function(){t.draw()}))}},{key:"hexgonProcess",value:function(e,t){for(var t=g().radius(t).extent([[0,0],[Math.abs(e[2]-e[0]),Math.abs(e[3]-e[1])]]),r=t.centers(),n=[],i=0;i<this._data.features.length;i++){var o=this._data.features[i].properties;n.push([o.x-e[0],o.y-e[1],+o.value])}for(var a=t(n),s={type:"FeatureCollection",features:[]},u=0;u<r.length;u++){for(var l=r[u][0],c=r[u][1],h=0,p=!1,f=0;f<a.length;f++){var d=a[f];if(Math.floor(d.x)===Math.floor(l)&&Math.floor(d.y)===Math.floor(c))for(var v=0;v<d.length;v++)h+=d[v][2],p=!0}var y=_.proj.inverseProj([r[u][0]+e[0],r[u][1]+e[1],0]),y={type:"Feature",properties:{lng:y[0],lat:y[1],x:r[u][0]+e[0],y:r[u][1]+e[1],z:0,value:p?h:void 0},geometry:{type:"Point",coordinates:[y[0],y[1]]}};s.features.push(y)}return s}},{key:"genData",value:(l=M().mark(function e(){var t,r,n,i,o,a,s,u,l;return M().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=this.options.graph,o=_.drawScale,t=t.honeyRadius*o*1e4,t=Math.round(t),r={type:"FeatureCollection",features:[]},n=0;n<this.data.length;n++)i=this.data[n],i={type:"Feature",properties:i||{},geometry:{type:"Point",coordinates:[i.lng,i.lat]}},r.features.push(i);for(this._data=r,o=this.bbox,a=_.proj.proj([o[0],o[1],0]),o=_.proj.proj([o[2],o[3],0]),a=[a[0],a[1],o[0],o[1]],s=this.hexgonProcess(a,t),this.hexgons={type:"FeatureCollection",features:[]},u=0;u<s.features.length;u++)l=s.features[u],this.isFeatureContainsLatLng(this.clipArea.features[0],l.properties)&&this.hexgons.features.push(l);case 14:case"end":return e.stop()}},e,this)}),c=function(){var e=this,a=arguments;return new Promise(function(t,r){var n=l.apply(e,a);function i(e){d(n,t,r,i,o,"next",e)}function o(e){d(n,t,r,i,o,"throw",e)}i(void 0)})},function(){return c.apply(this,arguments)})},{key:"isFeatureContainsLatLng",value:function(e,t){var r,n=!1,i=e.geometry.coordinates;switch(e.geometry.type){case"Polygon":n=this.isPolygonContainsPoint(i,[t.lng,t.lat]);break;case"MultiPolygon":for(r=0;r<i.length&&!(n=this.isPolygonContainsPoint(i[r],[t.lng,t.lat]));r++);}return n}},{key:"isPolygonContainsPoint",value:function(e,t){for(var r,n,i,o,a,s,u=!1,l=0,c=e.length;l<c;l++)for(o=0,a=(s=(r=e[l]).length)-1;o<s;a=o++)n=r[o],i=r[a],n[1]>t[1]!=i[1]>t[1]&&t[0]<(i[0]-n[0])*(t[1]-n[1])/(i[1]-n[1])+n[0]&&(u=!u);return u}},{key:"draw",value:function(){var e=this.options,t=e.general,e=e.graph,r=_.baseHeightScale,n=_.drawScale,i=(this.group.position.z=n*F*r,e.honeyRadius*n*1e4),i=Math.round(i);if(this.clear(),0!==e.honeyRadius&&100!==e.honeyPadding){for(var o=I(this.hexgons),a=e.honeyHeightRange[0]*n*1e5,r=e.honeyHeightRange[1]*n*1e5,s=1/0,u=-1/0,l=0;l<o.features.length;l++){var c=o.features[l];null!=c.properties.value&&(c=+c.properties.value,isNaN(c)||(u<c&&(u=c),c<s&&(s=c)))}for(var h=u-s,p=new T.CylinderBufferGeometry(1,1,1,6,1,!1),f=(p.rotateX(Math.PI/2),new T.InstancedBufferGeometry),d=(T.BufferGeometry.prototype.copy.call(f,p),o.features.length),v=[],y=0;y<o.features.length;y++)null!=o.features[y].properties.value&&v.push(o.features[y].properties);for(var g=C.get(A,"scale.color")({config:C.get(this.options,"graph.colorMapping"),data:v,field:"value"}),m=[],w=[],b=0;b<d;b++){var x=g(o.features[b].properties.value),x=R(x).gl();m.push(x[0],x[1],x[2]),w.push(+(x[3]*t.opacity*.01).toFixed(2))}f.setAttribute("instanceColor",new T.InstancedBufferAttribute(new Float32Array(m),3)),f.setAttribute("instanceOpacity",new T.InstancedBufferAttribute(new Float32Array(w),1)),f.computeVertexNormals();for(var O=new T.InstancedMesh(f,[this.materialSide,this.materialTop],d),S=(O.position.z=n*F*.05,O.frustumCulled=!1,(r-a)/h),M=new T.Matrix4,j=1-.01*e.honeyPadding,P=.1*n*1e5,L=0;L<o.features.length;L++){var k=o.features[L],E=P;null!=k.properties.value&&(E=(k.properties.value-s)*S+a),M.makeScale(i*j,i*j,E),M.setPosition(+k.properties.x,+k.properties.y,E/2),O.setMatrixAt(L,M)}this.add(O),O.renderOrder=this.options.renderOrder,this.checkVisible()}}},{key:"updateOptions",value:function(e){var t=this,r=I(this.options),e=(this.options=i(this.options,e||{}),this.options.graph),n=e.topTexture,e=e.sideTexture;this.updateMaterial(this.materialSide,r.graph.sideTexture,e),this.updateMaterial(this.materialTop,r.graph.topTexture,n),this.genData().then(function(){t.draw()})}},{key:"updateBaseHeight",value:function(){var e=_.baseHeightScale,t=_.drawScale;this.group.position.z=~~(t*F*e)}},{key:"updateMaterial",value:function(e,t,r){var n=r.metalness,i=r.map,r=r.emissive;t.metalness!=n&&(e.metalness=.01*n),t.map!=i&&s(e,"map",i),t.emissive.emissiveMap!=r.emissiveMap&&s(e,"emissiveMap",r.emissiveMap),e.needsUpdate=!0}},{key:"checkVisible",value:function(){(this.options.visible?y(x(p.prototype),"show",this):y(x(p.prototype),"hide",this)).call(this)}},{key:"show",value:function(){this.options.visible=!0,y(x(p.prototype),"show",this).call(this)}},{key:"hide",value:function(){this.options.visible=!1,y(x(p.prototype),"hide",this).call(this)}},{key:"destroy",value:function(){y(x(p.prototype),"remove",this).call(this),this.clear(),this.needsAutoUpdate=!1,this.data=null,this.options=null}}])&&v(t.prototype,e),u&&v(t,u),Object.defineProperty(t,"prototype",{writable:!1}),p},e.exports});;
Cube("datav:/com/@datav-3d-v3/datav-3dplane-honeycomb/3.1.2",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(e,t,r,n,o,i){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function s(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=c(r),t=(e=n?(e=c(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return y(t)}}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=r("datav:/npm/eventemitter3/3.0.0"),f=r("datav:/npm/safely-merge/1.0.1"),h=r("datav:/com/@datav-3d-v3/datav-3dplane-honeycomb/3.1.2/src/layer.js"),r=function(){var e=o,t=p;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t);var r,n=s(o);function o(e,t){var r;if(this instanceof o)return(r=n.call(this)).options=f({},t.options||{}),r.classNameAlias="HoneycombLayer",r.updateArea=r.updateArea.bind(y(r)),r.visible=!0,r;throw new TypeError("Cannot call a class as a function")}return e=o,(t=[{key:"addTo",value:function(e,t){this.layerId=t;t=h(e);this.layer=new t(this.options),e.addLayer(this.layerId+"_layer",this.layer),this.updateArea(),this.visible?this.layer.show():this.layer.hide()}},{key:"updateArea",value:function(){this.layer&&this.layer.updateArea&&this.layer.updateArea()}},{key:"render",value:function(e){var t,r=this;e&&this.layer&&("api"===e.type&&e.api||e.url?(t=e.api||e.url,fetch(t).then(function(e){return e.json()}).then(function(e){r.layer&&r.layer.render(e)})):e&&e.length&&this.layer&&this.layer.render(e))}},{key:"setClipArea",value:function(e){var t,r=this;e&&this.layer&&("api"===e.type&&e.api||e.url?(t=e.api||e.url,fetch(t).then(function(e){return e.json()}).then(function(e){r.layer.setClipArea(e,!1)})):e&&e.type&&("FeatureCollection"===e.type||"GeometryCollection"===e.type)&&this.layer.setClipArea(e))}},{key:"updateOptions",value:function(e){this.options=f(this.options,e.options),this.layer&&this.layer.updateOptions&&this.layer.updateOptions(this.options)}},{key:"updateBaseHeight",value:function(){this.layer&&this.layer.updateBaseHeight&&this.layer.updateBaseHeight()}},{key:"show",value:function(){this.visible=!0,this.layer&&this.layer.show()}},{key:"hide",value:function(){this.visible=!1,this.layer&&this.layer.hide()}},{key:"destroy",value:function(){this.layer&&(this.layer.off("rendered"),this.layer.destroy(),this.layer=null)}}])&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),o}();return e.exports=r,e.exports});