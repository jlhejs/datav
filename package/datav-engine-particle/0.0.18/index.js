// env=undefined => env=publish 
Cube("datav:/com/datav-engine-particle/0.0.18/src/particle",["datav:/npm/eventemitter3/3.0.0"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0");return a.exports=function(a,b){var c={blending:"NormalBlending"},i=new a.TextureLoader;return i.setCrossOrigin("anonymous"),function(h){function j(a){d(this,j);var f=e(this,(j.__proto__||Object.getPrototypeOf(j)).call(this));return f.options=b.mergeOptions(c,a),f.init(),f}return f(j,h),g(j,[{key:"init",value:function(){this.group=new a.Group,this.group.position.copy(this.options.offset);var b=new a.PointsMaterial({alphaTest:this.options.alphaTest,color:new a.Color(this.options.color),opacity:this.options.opacity,transparent:!0,depthTest:this.options.depthTest,blending:a[this.options.blending],size:this.options.size,sizeAttenuation:this.options.sizeAttenuation});if(""!==this.options.imageUrl){var c=i.load(this.options.imageUrl);c.anisotropy=this.options.anisotropy,b.map=c}var d=new a.BufferGeometry;d.addAttribute("position",new a.BufferAttribute(new Float32Array(),3)),this.points=new a.Points(d,b),this.points.visible=!1,this.points.renderOrder=this.options.depthTest?0:-10,this.group.add(this.points)}},{key:"setData",value:function(a){if(this.points){var c=[];a.forEach(function(a){var d=b.narrowedMercator([a.x,a.y,a.z]);c.push(d[0],d[1],d[2])}),this.points.geometry.attributes.position.setArray(new Float32Array(c)),this.points.geometry.attributes.position.needsUpdate=!0,this.points.com,this.points.visible=!0}}},{key:"updateOptions",value:function(c){if(this.points){this.options=b.mergeOptions(this.options,c||{}),this.group.position.copy(this.options.offset);var d=this.points.material;if(d.alphaTest=this.options.alphaTest,d.depthTest=this.options.depthTest,d.size=this.options.size,d.sizeAttenuation=this.options.sizeAttenuation,d.color=new a.Color(this.options.color),d.opacity=this.options.opacity,d.blending=a[this.options.blending],d.map&&d.map.dispose(),this.points.renderOrder=this.options.depthTest?0:-10,""!==this.options.imageUrl){var e=i.load(this.options.imageUrl);e.anisotropy=this.options.anisotropy,d.map=i.load(this.options.imageUrl)}else d.map=null;d.needsUpdate=!0}}},{key:"remove",value:function(){this.points&&(this.group.remove(this.points),this.points.geometry.dispose(),this.points.material.map&&this.points.material.map.dispose(),this.points.material.dispose(),this.points=null)}}]),j}(h)},a.exports});;
Cube("datav:/com/datav-engine-particle/0.0.18/layer",["datav:/npm/eventemitter3/3.0.0"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=function(a){function b(){d(this,b);var a=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return a.preSceneName="main",a.usingSceneName="main",a}return f(b,a),g(b,[{key:"addTo",value:function(a){return a?void(this.viewer=a,this.Utils=a.Utils,this.controller=a.controller,this.scene=this.getAssignedScene(),this.viewer.on("projChanged",this.updatePostions.bind(this))):console.log("Layer needs viewer layer")}},{key:"getProjPos",value:function(a,b,c){return this.viewer&&this.viewer.Projection([a,b,c])}},{key:"updatePostions",value:function(){}},{key:"getAssignedScene",value:function(){var a=this.options;return a.isSceneGroup&&a.sceneName?a.sceneName?this.controller.getScene(a.sceneName)?this.controller.getScene(a.sceneName):this.controller.createScene(a.sceneName):void 0:this.controller.getScene("main")}},{key:"toggleScene",value:function(a,b,c){var d=this;this.controller.switchScene(a,b,c).then(function(){d.preSceneName=b,d.usingSceneName=c})}},{key:"updateOptions",value:function(){}}]),b}(h);return a.exports=i,a.exports});;
Cube("datav:/com/datav-engine-particle/0.0.18",[],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;return void 0===g?void 0:g.call(d)},i=c("datav:/com/datav-engine-particle/0.0.18/layer"),j=null,k=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=Object.assign({isSceneGroup:!1,sceneName:""},c||{}),f}return f(b,a),g(b,[{key:"addTo",value:function(a){h(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"addTo",this).call(this,a),j=a.three,this.init()}},{key:"init",value:function(){var a=c("datav:/com/datav-engine-particle/0.0.18/src/particle")(j,this.Utils);this.options.anisotropy=this.viewer.renderer.getMaxAnisotropy(),this.layer=new a(this.options),this.options.visible?this.show():this.hide(),this.scene.add(this.layer.group)}},{key:"show",value:function(){this.options.visible=!0,this.layer&&(this.layer.group.visible=!0)}},{key:"hide",value:function(){this.options.visible=!1,this.layer&&(this.layer.group.visible=!1)}},{key:"setData",value:function(a){a&&Array.isArray(a)&&this.layer&&this.layer.setData(a)}},{key:"updateOptions",value:function(a){var b=this.Utils.deepClone(this.options);this.options=this.Utils.mergeOptions(this.options,a||{}),this.options.visible?this.show():this.hide(),this.layer&&(this.layer.updateOptions(this.options),!this.Utils.easyDiff(b.sceneName,a.sceneName)&&(this.scene=this.getAssignedScene(),this.toggleScene(this.layer.group,this.usingSceneName,a.sceneName)))}},{key:"remove",value:function(){this.layer&&(this.scene.remove(this.layer.group),this.layer.remove(),this.layer=null)}}]),b}(i);return a.exports=k,a.exports});