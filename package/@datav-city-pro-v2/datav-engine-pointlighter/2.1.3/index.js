// env=undefined => env=publish 
Cube("datav:/com/@datav-city-pro-v2/datav-engine-pointlighter/2.1.3/Lensflare",[],function(e,n,t,r,i,o){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,n,t){return n&&l(e.prototype,n),t&&l(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function U(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function m(e,n){return(m=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function d(t){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,n=s(t),n=(e=r?(e=s(this).constructor,Reflect.construct(n,arguments,e)):n.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==n)return n;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}return e.exports=function(e){var n,o=e.AdditiveBlending,a=e.Box2,t=e.BufferGeometry,l=e.ClampToEdgeWrapping,s=e.Color,c=e.DataTexture,r=e.InterleavedBuffer,i=e.InterleavedBufferAttribute,u=e.Mesh,v=e.MeshBasicMaterial,p=e.NearestFilter,f=e.RGBFormat,F=e.RawShaderMaterial,O=e.Vector2,B=e.Vector3,T=e.Vector4,e=function(){var e=i,n=u;if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&m(e,n);var r=d(i);function i(){U(this,i),(e=r.call(this,i.Geometry,new v({opacity:0,transparent:!0}))).type="Lensflare",e.frustumCulled=!1,e.renderOrder=1/0,e.visible=!0;var e,y=new B,m=new B,d=new c(new Uint8Array(768),16,16,f),b=(d.minFilter=p,d.magFilter=p,d.wrapS=l,d.wrapT=l,new c(new Uint8Array(768),16,16,f)),n=(b.minFilter=p,b.magFilter=p,b.wrapS=l,b.wrapT=l,i.Geometry),h=(e.geometry=n,new F({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:"\n  \n          precision highp float;\n  \n          uniform vec3 screenPosition;\n          uniform vec2 scale;\n  \n          attribute vec3 position;\n  \n          void main() {\n  \n            gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );\n  \n          }",fragmentShader:"\n  \n          precision highp float;\n          uniform vec4 color;\n  \n          void main() {\n  \n            gl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );\n  \n          }",depthTest:!0,depthWrite:!1,transparent:!1})),x=new F({uniforms:{map:{value:d},scale:{value:null},screenPosition:{value:null}},vertexShader:"\n  \n          precision highp float;\n  \n          uniform vec3 screenPosition;\n          uniform vec2 scale;\n  \n          attribute vec3 position;\n          attribute vec2 uv;\n  \n          varying vec2 vUV;\n  \n          void main() {\n  \n            vUV = uv;\n  \n            gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );\n  \n          }",fragmentShader:"\n  \n          precision highp float;\n  \n          uniform sampler2D map;\n  \n          varying vec2 vUV;\n  \n          void main() {\n  \n            gl_FragColor = texture2D( map, vUV );\n  \n          }",depthTest:!1,depthWrite:!1,transparent:!1}),g=new u(n,h),w=[],t=(e.elements=w,j.Shader),P=new F({uniforms:{map:{value:null},occlusionMap:{value:b},color:{value:new s(16777215)},scale:{value:new O},screenPosition:{value:new B}},vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,blending:o,transparent:!0,depthWrite:!1}),S=new u(n,P),M=(e.addElement=function(e){w.push(e)},new O),D=new O,V=new a,_=new T;return e.onBeforeRender=function(e,n,t,r){if(r.visible){e.getCurrentViewport(_);var i=_.w/_.z,o=_.z/2,a=_.w/2,l=16/_.w;if(M.set(l*i,l),V.min.set(_.x,_.y),V.max.set(_.x+(_.z-16),_.y+(_.w-16)),m.setFromMatrixPosition(this.matrixWorld),m.applyMatrix4(t.matrixWorldInverse),!(0<m.z)&&(y.copy(m).applyMatrix4(t.projectionMatrix),D.x=_.x+y.x*o+o-8,D.y=_.y+y.y*a+a-8,V.containsPoint(D))){e.copyFramebufferToTexture(D,d);for(var i=h.uniforms,o=(i.scale.value=M,i.screenPosition.value=y,e.renderBufferDirect(t,null,r,h,g,null),e.copyFramebufferToTexture(D,b),x.uniforms),s=(o.scale.value=M,o.screenPosition.value=y,e.renderBufferDirect(t,null,r,x,g,null),2*-y.x),c=2*-y.y,u=0,v=w.length;u<v;u++){var p=w[u],f=P.uniforms,p=(f.color.value.copy(p.color),f.map.value=p.texture,f.screenPosition.value.x=y.x+s*p.distance,f.screenPosition.value.y=y.y+c*p.distance,l=p.size/_.w,_.w/_.z);f.scale.value.set(l*p,l),P.uniformsNeedUpdate=!0,e.renderBufferDirect(t,null,r,P,S,null)}}}},e.dispose=function(){h.dispose(),x.dispose(),P.dispose(),d.dispose(),b.dispose();for(var e=0,n=w.length;e<n;e++)w[e].texture.dispose();w.length=0},e}return y(i)}(),j=(e.prototype.isLensflare=!0,y(function e(n){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new s(16777215);U(this,e),this.texture=n,this.size=t,this.distance=r,this.color=i}));return j.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:"\n  \n      precision highp float;\n  \n      uniform vec3 screenPosition;\n      uniform vec2 scale;\n  \n      uniform sampler2D occlusionMap;\n  \n      attribute vec3 position;\n      attribute vec2 uv;\n  \n      varying vec2 vUV;\n      varying float vVisibility;\n  \n      void main() {\n  \n        vUV = uv;\n  \n        vec2 pos = position.xy;\n  \n        vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\n        visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\n        visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\n        visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\n        visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\n        visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\n        visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\n        visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\n        visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\n  \n        vVisibility =        visibility.r / 9.0;\n        vVisibility *= 1.0 - visibility.g / 9.0;\n        vVisibility *=       visibility.b / 9.0;\n  \n        gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n  \n      }",fragmentShader:"\n  \n      precision highp float;\n  \n      uniform sampler2D map;\n      uniform vec3 color;\n  \n      varying vec2 vUV;\n      varying float vVisibility;\n  \n      void main() {\n  \n        vec4 texture = texture2D( map, vUV );\n        texture.a *= vVisibility;\n        gl_FragColor = texture;\n        gl_FragColor.rgb *= color;\n  \n      }"},e.Geometry=(t=new t,n=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),n=new r(n,5),t.setIndex([0,1,2,0,2,3]),t.setAttribute("position",new i(n,3,0,!1)),t.setAttribute("uv",new i(n,2,3,!1)),t),{Lensflare:e,LensflareElement:j}},e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-pointlighter/2.1.3/pointlighter",[],function(e,t,c,i,n,o){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=g(e)););return e}(e,t);if(n)return n=Object.getOwnPropertyDescriptor(n,t),n.get?n.get.call(arguments.length<3?e:i):n.value}).apply(this,arguments)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=g(i),t=(e=n?(e=g(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}return e.exports=function(e){var l=e.THREE,a=e.Utils,i=e.VG,n=e.coordHelper,e=i.Layer,t=c("datav:/com/@datav-city-pro-v2/datav-engine-pointlighter/2.1.3/Lensflare")(l),o=(t.Lensflare,t.LensflareElement),r=new l.Vector3,t=p;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&d(t,e);var s,h=y(p);function p(e){var t;if(this instanceof p)return(t=h.call(this)).classNameAlias="PointlighterLayer",t.layerName=t.classNameAlias,t.renderQueue=i.Transparent,t.needsAutoUpdate=!1,t.options=Object.assign({visible:!0},e||{}),t.options.options.graph.isLensflare=!1,t.initialized=!1,t;throw new TypeError("Cannot call a class as a function")}return t=p,(e=[{key:"addTo",value:function(e){u(g(p.prototype),"addTo",this).call(this,e),this.init()}},{key:"init",value:function(){var e,t,i,n,o,r,s;this.initialized||(this.initialized=!0,e=void 0!==(e=(r=this.options.options.graph).lightHelperVisibility)&&e,t=void 0===(t=r.lightHelperScale)?300:t,i=void 0!==(i=r.castShadow)&&i,s=r.color,n=void 0===(n=r.decay)?1:n,o=r.distance,r=r.intensity,s=new l.Color(a.Chroma(s).hex()),this.light=new l.PointLight(s,r,o,n),this.light.castShadow=i,this.add(this.light),this.lightHelper=new l.PointLightHelper(this.light,t),this.lightHelper.visible=e,this.add(this.lightHelper),this.updateLight(),this.checkVisible())}},{key:"addLensflareElements",value:function(){var e,t=this.options.options.graph.lensflareScale,i=this.light.color;this.lensflare&&(e=0,this.lensflare.addElement(new o(this.textureFlare0,this.lensflaresSizeArr[e++]*t,0,i)),this.lensflare.addElement(new o(this.textureFlare3,this.lensflaresSizeArr[e++]*t,.6)),this.lensflare.addElement(new o(this.textureFlare3,this.lensflaresSizeArr[e++]*t,.7)),this.lensflare.addElement(new o(this.textureFlare3,this.lensflaresSizeArr[e++]*t,.9)),this.lensflare.addElement(new o(this.textureFlare3,this.lensflaresSizeArr[4]*t,1)))}},{key:"updateLensflareScale",value:function(){var i=this,n=this.options.options.graph.lensflareScale;this.lensflare&&this.lensflare.elements.forEach(function(e,t){return e.size=i.lensflaresSizeArr[t]*n})}},{key:"useLensflare",value:function(){var e=this.options.options.graph.isLensflare;(this.lensflare.geometry.visible=e)?this.light.add(this.lensflare):this.light.remove(this.lensflare)}},{key:"updatePostions",value:function(){var e=this.options.options.general.position,t=e.posX,i=e.posY,e=e.posZ;n.setFromValues(t,i,e),n.toXYZ(r),this.light.position.copy(r),this.lightHelper.update(),this.lightHelper.setRotationFromMatrix(n.transform),this.lightHelper.matrixNeedsUpdate=!0}},{key:"updateLight",value:function(){var e=this.options.options.graph,t=e.lightHelperVisibility,i=e.lightHelperScale,i=void 0===i?300:i,n=e.castShadow,o=e.color,r=e.decay,r=void 0===r?1:r,s=e.distance,e=e.intensity,o=a.Chroma(o).hex(),o=new l.Color(o);this.light.castShadow=n,this.light.decay=r,this.light.distance=s,this.light.intensity=e,this.light.color.setRGB(o.r,o.g,o.b),this.lightHelper.updateSize(i),this.lightHelper.visible=t,this.updatePostions()}},{key:"updateOptions",value:function(e){var t=a.deepClone(this.options);this.options=a.mergeOptions(this.options,e||{}),this.updateLight(),a.easyDiff(t.options.graph.isLensflare,e.options.graph.isLensflare),a.easyDiff(t.options.graph.lensflareScale,e.options.graph.lensflareScale),a.easyDiff(t.sceneId.length,e.sceneId.length)&&a.deepDiff(t.sceneId,e.sceneId)||this.updateSceneId(),this.checkVisible()}},{key:"checkVisible",value:function(){this.options.visible?this.show():this.hide()}},{key:"show",value:function(){this.options.visible=!0,u(g(p.prototype),"show",this).call(this)}},{key:"hide",value:function(){this.options.visible=!1,u(g(p.prototype),"hide",this).call(this)}},{key:"clear",value:function(){u(g(p.prototype),"clear",this).call(this),this.light&&this.light.shadow&&this.light.shadow.map&&this.light.shadow.map.dispose&&this.light.shadow.map.dispose(),this.light=null}},{key:"destroy",value:function(){this.clear(),u(g(p.prototype),"destroy",this).call(this)}}])&&f(t.prototype,e),s&&f(t,s),Object.defineProperty(t,"prototype",{writable:!1}),p},e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-pointlighter/2.1.3",["datav:/npm/eventemitter3/3.0.0"],function(t,e,r,o,n,i){function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(r){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=s(r),e=(t=o?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(t&&("object"===a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var y=r("datav:/npm/eventemitter3/3.0.0"),f=r("datav:/com/@datav-city-pro-v2/datav-engine-pointlighter/2.1.3/pointlighter"),r=function(){var t=n,e=y;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e);var r,o=l(n);function n(t,e){var r;if(this instanceof n)return(r=o.call(this)).options=e,r.comId="",r;throw new TypeError("Cannot call a class as a function")}return t=n,(e=[{key:"addTo",value:function(t,e){this.cityproCore=t,this.comId=e,this.initLayer()}},{key:"initLayer",value:function(){var t=f(this.cityproCore);this.layer=new t(this.options),this.cityproCore.viewer.addLayer(this.comId,this.layer)}},{key:"setData",value:function(t){this.layer&&this.layer.setData(t)}},{key:"updateOptions",value:function(t){this.layer&&this.layer.updateOptions&&this.layer.updateOptions(t)}},{key:"show",value:function(){this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.layer&&this.layer.hide&&this.layer.hide()}},{key:"remove",value:function(){console.log("remove is duplicate, please use clear instead.",this),this.clear()}},{key:"clear",value:function(){this.layer&&this.layer.clear&&this.layer.clear()}},{key:"destroy",value:function(){this.layer&&(this.layer.destroy&&this.layer.destroy(),this.layer=null)}}])&&c(t.prototype,e),r&&c(t,r),Object.defineProperty(t,"prototype",{writable:!1}),n}();return t.exports=r,t.exports});