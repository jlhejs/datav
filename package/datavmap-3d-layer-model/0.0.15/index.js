// env=undefined => env=publish 
Cube("datav:/com/datavmap-3d-layer-model/0.0.15/loader/GLTFLoader",[],function(a){return a.exports=function(a){a.GLTFLoader=function(){function b(b){this.manager=void 0===b?a.DefaultLoadingManager:b,this.dracoLoader=null}function c(){var a={};return{get:function(b){return a[b]},add:function(b,c){a[b]=c},remove:function(b){delete a[b]},removeAll:function(){a={}}}}function d(){if(!a.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=s.MSFT_TEXTURE_DDS,this.ddsLoader=new a.DDSLoader}function e(b){this.name=s.KHR_LIGHTS,this.lights={};var c=b.extensions&&b.extensions[s.KHR_LIGHTS]||{},d=c.lights||{};for(var e in d){var f,g=d[e],h=new a.Color().fromArray(g.color);switch(g.type){case"directional":f=new a.DirectionalLight(h),f.target.position.set(0,0,1),f.add(f.target);break;case"point":f=new a.PointLight(h);break;case"spot":f=new a.SpotLight(h),g.spot=g.spot||{},g.spot.innerConeAngle=void 0===g.spot.innerConeAngle?0:g.spot.innerConeAngle,g.spot.outerConeAngle=void 0===g.spot.outerConeAngle?Math.PI/4:g.spot.outerConeAngle,f.angle=g.spot.outerConeAngle,f.penumbra=1-g.spot.innerConeAngle/g.spot.outerConeAngle,f.target.position.set(0,0,1),f.add(f.target);break;case"ambient":f=new a.AmbientLight(h);}f&&(f.decay=2,void 0!==g.intensity&&(f.intensity=g.intensity),f.name=g.name||"light_"+e,this.lights[e]=f)}}function f(){this.name=s.KHR_MATERIALS_UNLIT}function g(b){this.name=s.KHR_BINARY_GLTF,this.content=null,this.body=null;var c=new DataView(b,0,u);if(this.header={magic:a.LoaderUtils.decodeText(new Uint8Array(b.slice(0,4))),version:c.getUint32(4,!0),length:c.getUint32(8,!0)},this.header.magic!==t)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");else if(2>this.header.version)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var d,e=new DataView(b,u),f=0;f<e.byteLength;){d=e.getUint32(f,!0),f+=4;var g=e.getUint32(f,!0);if(f+=4,g===v.JSON){var h=new Uint8Array(b,u+f,d);this.content=a.LoaderUtils.decodeText(h)}else if(g===v.BIN){var i=u+f;this.body=b.slice(i,i+d)}f+=d}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function h(a){if(!a)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=s.KHR_DRACO_MESH_COMPRESSION,this.dracoLoader=a}function i(){return{name:s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return a.ShaderMaterial},extendParams:function(b,c,d){var e=c.extensions[this.name],f=a.ShaderLib.standard,g=a.UniformsUtils.clone(f.uniforms),h=f.fragmentShader.replace("#include <specularmap_fragment>","").replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>","#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif").replace("#include <metalnessmap_pars_fragment>","#ifdef USE_GLOSSINESSMAP\n\tuniform sampler2D glossinessMap;\n#endif").replace("#include <roughnessmap_fragment>","vec3 specularFactor = specular;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\ttexelSpecular = sRGBToLinear( texelSpecular );\n\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture\n\tspecularFactor *= texelSpecular.rgb;\n#endif").replace("#include <metalnessmap_fragment>","float glossinessFactor = glossiness;\n#ifdef USE_GLOSSINESSMAP\n\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );\n\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture\n\tglossinessFactor *= texelGlossiness.a;\n#endif").replace("#include <lights_physical_fragment>","PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );\nmaterial.specularColor = specularFactor.rgb;");delete g.roughness,delete g.metalness,delete g.roughnessMap,delete g.metalnessMap,g.specular={value:new a.Color().setHex(1118481)},g.glossiness={value:0.5},g.specularMap={value:null},g.glossinessMap={value:null},b.vertexShader=f.vertexShader,b.fragmentShader=h,b.uniforms=g,b.defines={STANDARD:""},b.color=new a.Color(1,1,1),b.opacity=1;var i=[];if(Array.isArray(e.diffuseFactor)){var j=e.diffuseFactor;b.color.fromArray(j),b.opacity=j[3]}if(void 0!==e.diffuseTexture&&i.push(d.assignTexture(b,"map",e.diffuseTexture.index)),b.emissive=new a.Color(0,0,0),b.glossiness=void 0===e.glossinessFactor?1:e.glossinessFactor,b.specular=new a.Color(1,1,1),Array.isArray(e.specularFactor)&&b.specular.fromArray(e.specularFactor),void 0!==e.specularGlossinessTexture){var k=e.specularGlossinessTexture.index;i.push(d.assignTexture(b,"glossinessMap",k)),i.push(d.assignTexture(b,"specularMap",k))}return Promise.all(i)},createMaterial:function(b){var c=new a.ShaderMaterial({defines:b.defines,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader,uniforms:b.uniforms,fog:!0,lights:!0,opacity:b.opacity,transparent:b.transparent});return c.isGLTFSpecularGlossinessMaterial=!0,c.color=b.color,c.map=void 0===b.map?null:b.map,c.lightMap=null,c.lightMapIntensity=1,c.aoMap=void 0===b.aoMap?null:b.aoMap,c.aoMapIntensity=1,c.emissive=b.emissive,c.emissiveIntensity=1,c.emissiveMap=void 0===b.emissiveMap?null:b.emissiveMap,c.bumpMap=void 0===b.bumpMap?null:b.bumpMap,c.bumpScale=1,c.normalMap=void 0===b.normalMap?null:b.normalMap,b.normalScale&&(c.normalScale=b.normalScale),c.displacementMap=null,c.displacementScale=1,c.displacementBias=0,c.specularMap=void 0===b.specularMap?null:b.specularMap,c.specular=b.specular,c.glossinessMap=void 0===b.glossinessMap?null:b.glossinessMap,c.glossiness=b.glossiness,c.alphaMap=null,c.envMap=void 0===b.envMap?null:b.envMap,c.envMapIntensity=1,c.refractionRatio=0.98,c.extensions.derivatives=!0,c},cloneMaterial:function(a){var b=a.clone();b.isGLTFSpecularGlossinessMaterial=!0;for(var c=this.specularGlossinessParams,d=0,e=c.length;d<e;d++)b[c[d]]=a[c[d]];return b},refreshUniforms:function(a,b,c,d,e){if(!0===e.isGLTFSpecularGlossinessMaterial){var f=e.uniforms,g=e.defines;f.opacity.value=e.opacity,f.diffuse.value.copy(e.color),f.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),f.map.value=e.map,f.specularMap.value=e.specularMap,f.alphaMap.value=e.alphaMap,f.lightMap.value=e.lightMap,f.lightMapIntensity.value=e.lightMapIntensity,f.aoMap.value=e.aoMap,f.aoMapIntensity.value=e.aoMapIntensity;var h;if(e.map?h=e.map:e.specularMap?h=e.specularMap:e.displacementMap?h=e.displacementMap:e.normalMap?h=e.normalMap:e.bumpMap?h=e.bumpMap:e.glossinessMap?h=e.glossinessMap:e.alphaMap?h=e.alphaMap:e.emissiveMap&&(h=e.emissiveMap),void 0!==h){h.isWebGLRenderTarget&&(h=h.texture);var i,j;if(void 0!==h.matrix){if(!0===h.matrixAutoUpdate){i=h.offset,j=h.repeat;var k=h.rotation,l=h.center;h.matrix.setUvTransform(i.x,i.y,j.x,j.y,k,l.x,l.y)}f.uvTransform.value.copy(h.matrix)}else i=h.offset,j=h.repeat,f.offsetRepeat.value.set(i.x,i.y,j.x,j.y)}f.envMap.value=e.envMap,f.envMapIntensity.value=e.envMapIntensity,f.flipEnvMap.value=e.envMap&&e.envMap.isCubeTexture?-1:1,f.refractionRatio.value=e.refractionRatio,f.specular.value.copy(e.specular),f.glossiness.value=e.glossiness,f.glossinessMap.value=e.glossinessMap,f.emissiveMap.value=e.emissiveMap,f.bumpMap.value=e.bumpMap,f.normalMap.value=e.normalMap,f.displacementMap.value=e.displacementMap,f.displacementScale.value=e.displacementScale,f.displacementBias.value=e.displacementBias,null!==f.glossinessMap.value&&void 0===g.USE_GLOSSINESSMAP&&(g.USE_GLOSSINESSMAP="",g.USE_ROUGHNESSMAP=""),null===f.glossinessMap.value&&void 0!==g.USE_GLOSSINESSMAP&&(delete g.USE_GLOSSINESSMAP,delete g.USE_ROUGHNESSMAP)}}}}function j(b,c,d,e){a.Interpolant.call(this,b,c,d,e)}function k(a,b){return"string"!==typeof a||""===a?"":/^(https?:)?\/\//i.test(a)?a:/^data:.*,.*$/i.test(a)?a:/^blob:.*$/i.test(a)?a:b+a}function l(){return new a.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:a.FrontSide})}function m(a,b,c,d){for(var e,f=a.geometry,g=c.targets,h=!1,k=!1,l=0,i=g.length;l<i&&(e=g[l],void 0!==e.POSITION&&(h=!0),void 0!==e.NORMAL&&(k=!0),!(h&&k));l++);if(h||k){for(var m=[],n=[],l=0,i=g.length;l<i;l++){var e=g[l],o="morphTarget"+l;if(h){if(void 0!==e.POSITION){var q=p(d[e.POSITION]);q.name=o;for(var r=f.attributes.position,s=0,j=q.count;s<j;s++)q.setXYZ(s,q.getX(s)+r.getX(s),q.getY(s)+r.getY(s),q.getZ(s)+r.getZ(s))}else q=f.attributes.position;m.push(q)}if(k){var t;if(void 0!==e.NORMAL){var t=p(d[e.NORMAL]);t.name=o;for(var u=f.attributes.normal,s=0,j=t.count;s<j;s++)t.setXYZ(s,t.getX(s)+u.getX(s),t.getY(s)+u.getY(s),t.getZ(s)+u.getZ(s))}else t=f.attributes.normal;n.push(t)}}if(h&&(f.morphAttributes.position=m),k&&(f.morphAttributes.normal=n),a.updateMorphTargets(),void 0!==b.weights)for(var l=0,i=b.weights.length;l<i;l++)a.morphTargetInfluences[l]=b.weights[l];if(b.extras&&Array.isArray(b.extras.targetNames)){var v=b.extras.targetNames;if(a.morphTargetInfluences.length===v.length){a.morphTargetDictionary={};for(var l=0,i=v.length;l<i;l++)a.morphTargetDictionary[v[l]]=l}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}}function n(c,a){if(c.indices!==a.indices)return!1;var b=c.attributes||{},d=a.attributes||{},e=Object.keys(b),f=Object.keys(d);if(e.length!==f.length)return!1;for(var g,h=0,i=e.length;h<i;h++)if(g=e[h],b[g]!==d[g])return!1;return!0}function o(a,b){for(var c,d=0,e=a.length;d<e;d++)if(c=a[d],n(c.primitive,b))return c.promise;return null}function p(b){if(b.isInterleavedBufferAttribute){for(var c=b.count,d=b.itemSize,e=b.array.slice(0,c*d),f=0;f<c;++f)e[f]=b.getX(f),2<=d&&(e[f+1]=b.getY(f)),3<=d&&(e[f+2]=b.getZ(f)),4<=d&&(e[f+3]=b.getW(f));return new a.BufferAttribute(e,d,b.normalized)}return b.clone()}function q(b,d,e){this.json=b||{},this.extensions=d||{},this.options=e||{},this.cache=new c,this.primitiveCache=[],this.textureLoader=new a.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new a.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function r(a,b,c){var d=b.attributes;for(var e in d){var f=I[e],g=c[d[e]];f&&!(f in a.attributes)&&a.addAttribute(f,g)}void 0===b.indices||a.index||a.setIndex(c[b.indices])}b.prototype={constructor:b,crossOrigin:"Anonymous",load:function(b,c,d,f){var e=this,g=void 0===this.path?a.LoaderUtils.extractUrlBase(b):this.path,h=new a.FileLoader(e.manager);h.setResponseType("arraybuffer"),h.load(b,function(a){try{e.parse(a,g,c,f)}catch(a){if(void 0!==f)f(a);else throw a}},d,f)},setCrossOrigin:function(a){return this.crossOrigin=a,this},setPath:function(a){return this.path=a,this},setDRACOLoader:function(a){return this.dracoLoader=a,this},parse:function(b,c,j,k){var l,m={};if("string"===typeof b)l=b;else{var n=a.LoaderUtils.decodeText(new Uint8Array(b,0,4));if(n===t){try{m[s.KHR_BINARY_GLTF]=new g(b)}catch(a){return void(k&&k(a))}l=m[s.KHR_BINARY_GLTF].content}else l=a.LoaderUtils.decodeText(new Uint8Array(b))}var o=JSON.parse(l);if(void 0===o.asset||2>o.asset.version[0])return void(k&&k(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead.")));o.extensionsUsed&&(0<=o.extensionsUsed.indexOf(s.KHR_LIGHTS)&&(m[s.KHR_LIGHTS]=new e(o)),0<=o.extensionsUsed.indexOf(s.KHR_MATERIALS_UNLIT)&&(m[s.KHR_MATERIALS_UNLIT]=new f(o)),0<=o.extensionsUsed.indexOf(s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS)&&(m[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]=new i),0<=o.extensionsUsed.indexOf(s.KHR_DRACO_MESH_COMPRESSION)&&(m[s.KHR_DRACO_MESH_COMPRESSION]=new h(this.dracoLoader)),0<=o.extensionsUsed.indexOf(s.MSFT_TEXTURE_DDS)&&(m[s.MSFT_TEXTURE_DDS]=new d));var p=new q(o,m,{path:c||this.path||"",crossOrigin:this.crossOrigin,manager:this.manager});p.parse(function(a,b,c,d,e){j({scene:a,scenes:b,cameras:c,animations:d,asset:e})},k)}};var s={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS:"KHR_lights",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};f.prototype.getMaterialType=function(){return a.MeshBasicMaterial},f.prototype.extendParams=function(b,c,d){var e=[];b.color=new a.Color(1,1,1),b.opacity=1;var f=c.pbrMetallicRoughness;if(f){if(Array.isArray(f.baseColorFactor)){var g=f.baseColorFactor;b.color.fromArray(g),b.opacity=g[3]}void 0!==f.baseColorTexture&&e.push(d.assignTexture(b,"map",f.baseColorTexture.index))}return Promise.all(e)};var t="glTF",u=12,v={JSON:1313821514,BIN:5130562};h.prototype.decodePrimitive=function(a,b){var c=this.dracoLoader,d=a.extensions[this.name].bufferView,e=a.extensions[this.name].attributes,f={};for(var g in e)g in I&&(f[I[g]]=e[g]);return b.getDependency("bufferView",d).then(function(a){return new Promise(function(b){c.decodeDracoFile(a,b,f)})})},j.prototype=Object.create(a.Interpolant.prototype),j.prototype.constructor=j,j.prototype.interpolate_=function(a,b,c,d){for(var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize,h=3*g,j=d-b,k=(c-b)/j,l=k*k,m=l*k,n=a*h,o=n-h,p=0;p!==g;p++){var i=f[o+p+g],q=f[o+p+2*g]*j,r=f[n+p+g],s=f[n+p]*j;e[p]=(2*m-3*l+1)*i+(m-2*l+k)*q+(-2*m+3*l)*r+(m-l)*s}return e};var w={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},x={5126:Number,35675:a.Matrix3,35676:a.Matrix4,35664:a.Vector2,35665:a.Vector3,35666:a.Vector4,35678:a.Texture},y={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},z={9728:a.NearestFilter,9729:a.LinearFilter,9984:a.NearestMipMapNearestFilter,9985:a.LinearMipMapNearestFilter,9986:a.NearestMipMapLinearFilter,9987:a.LinearMipMapLinearFilter},A={33071:a.ClampToEdgeWrapping,33648:a.MirroredRepeatWrapping,10497:a.RepeatWrapping},B={6406:a.AlphaFormat,6407:a.RGBFormat,6408:a.RGBAFormat,6409:a.LuminanceFormat,6410:a.LuminanceAlphaFormat},C={5121:a.UnsignedByteType,32819:a.UnsignedShort4444Type,32820:a.UnsignedShort5551Type,33635:a.UnsignedShort565Type},D={1028:a.BackSide,1029:a.FrontSide},E={512:a.NeverDepth,513:a.LessDepth,514:a.EqualDepth,515:a.LessEqualDepth,516:a.GreaterEqualDepth,517:a.NotEqualDepth,518:a.GreaterEqualDepth,519:a.AlwaysDepth},F={32774:a.AddEquation,32778:a.SubtractEquation,32779:a.ReverseSubtractEquation},G={0:a.ZeroFactor,1:a.OneFactor,768:a.SrcColorFactor,769:a.OneMinusSrcColorFactor,770:a.SrcAlphaFactor,771:a.OneMinusSrcAlphaFactor,772:a.DstAlphaFactor,773:a.OneMinusDstAlphaFactor,774:a.DstColorFactor,775:a.OneMinusDstColorFactor,776:a.SrcAlphaSaturateFactor},H={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},I={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD0:"uv",TEXCOORD:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",COLOR0:"color",COLOR:"color",WEIGHTS_0:"skinWeight",WEIGHT:"skinWeight",JOINTS_0:"skinIndex",JOINT:"skinIndex"},J={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},K={CUBICSPLINE:a.InterpolateSmooth,LINEAR:a.InterpolateLinear,STEP:a.InterpolateDiscrete},L={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};return q.prototype.parse=function(a,b){var c=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(b){var d=b.scenes||[],e=d[c.scene||0],f=b.animations||[],g=c.asset,h=b.cameras||[];a(e,d,h,f,g)}).catch(b)},q.prototype.markDefs=function(){for(var a,b=this.json.nodes||[],c=this.json.skins||[],d=this.json.meshes||[],e={},f={},g=0,h=c.length;g<h;g++){a=c[g].joints;for(var j=0,i=a.length;j<i;j++)b[a[j]].isBone=!0}for(var k,l=0,m=b.length;l<m;l++)k=b[l],void 0!==k.mesh&&(void 0===e[k.mesh]&&(e[k.mesh]=f[k.mesh]=0),e[k.mesh]++,void 0!==k.skin&&(d[k.mesh].isSkinnedMesh=!0));this.json.meshReferences=e,this.json.meshUses=f},q.prototype.getDependency=function(a,b){var c=a+":"+b,d=this.cache.get(c);if(!d){switch(a){case"scene":d=this.loadScene(b);break;case"node":d=this.loadNode(b);break;case"mesh":d=this.loadMesh(b);break;case"accessor":d=this.loadAccessor(b);break;case"bufferView":d=this.loadBufferView(b);break;case"buffer":d=this.loadBuffer(b);break;case"material":d=this.loadMaterial(b);break;case"texture":d=this.loadTexture(b);break;case"skin":d=this.loadSkin(b);break;case"animation":d=this.loadAnimation(b);break;case"camera":d=this.loadCamera(b);break;default:throw new Error("Unknown type: "+a);}this.cache.add(c,d)}return d},q.prototype.getDependencies=function(a){var b=this.cache.get(a);if(!b){var c=this,d=this.json[a+("mesh"===a?"es":"s")]||[];b=Promise.all(d.map(function(b,d){return c.getDependency(a,d)})),this.cache.add(a,b)}return b},q.prototype.getMultiDependencies=function(a){for(var b={},c=[],d=0,e=a.length;d<e;d++){var f=a[d],g=this.getDependencies(f);g=g.then(function(a,c){b[a]=c}.bind(this,f+("mesh"===f?"es":"s"))),c.push(g)}return Promise.all(c).then(function(){return b})},q.prototype.loadBuffer=function(a){var b=this.json.buffers[a],c=this.fileLoader;if(b.type&&"arraybuffer"!==b.type)throw new Error("THREE.GLTFLoader: "+b.type+" buffer type is not supported.");if(void 0===b.uri&&0===a)return Promise.resolve(this.extensions[s.KHR_BINARY_GLTF].body);var d=this.options;return new Promise(function(a,e){c.load(k(b.uri,d.path),a,void 0,function(){e(new Error("THREE.GLTFLoader: Failed to load buffer \""+b.uri+"\"."))})})},q.prototype.loadBufferView=function(a){var b=this.json.bufferViews[a];return this.getDependency("buffer",b.buffer).then(function(a){var c=b.byteLength||0,d=b.byteOffset||0;return a.slice(d,d+c)})},q.prototype.loadAccessor=function(b){var c=this,d=this.json,e=this.json.accessors[b];if(void 0===e.bufferView&&void 0===e.sparse)return null;var f=[];return void 0===e.bufferView?f.push(null):f.push(this.getDependency("bufferView",e.bufferView)),void 0!==e.sparse&&(f.push(this.getDependency("bufferView",e.sparse.indices.bufferView)),f.push(this.getDependency("bufferView",e.sparse.values.bufferView))),Promise.all(f).then(function(b){var f,g,h=b[0],j=H[e.type],k=y[e.componentType],l=k.BYTES_PER_ELEMENT,m=e.byteOffset||0,n=d.bufferViews[e.bufferView].byteStride,o=!0===e.normalized;if(n&&n!==l*j){var p="InterleavedBuffer:"+e.bufferView+":"+e.componentType,q=c.cache.get(p);q||(f=new k(h),q=new a.InterleavedBuffer(f,n/l),c.cache.add(p,q)),g=new a.InterleavedBufferAttribute(q,j,m/l,o)}else f=null===h?new k(e.count*j):new k(h,m,e.count*j),g=new a.BufferAttribute(f,j,o);if(void 0!==e.sparse){var r=H.SCALAR,s=y[e.sparse.indices.componentType],t=e.sparse.indices.byteOffset||0,u=e.sparse.values.byteOffset||0,v=new s(b[1],t,e.sparse.count*r),w=new k(b[2],u,e.sparse.count*j);null!==h&&g.setArray(g.array.slice());for(var x,z=0,i=v.length;z<i;z++)if(x=v[z],g.setX(x,w[z*j]),2<=j&&g.setY(x,w[z*j+1]),3<=j&&g.setZ(x,w[z*j+2]),4<=j&&g.setW(x,w[z*j+3]),5<=j)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}return g})},q.prototype.loadTexture=function(b){var c,d=this,e=this.json,f=this.options,g=this.textureLoader,h=window.URL||window.webkitURL,i=e.textures[b],j=i.extensions||{};c=j[s.MSFT_TEXTURE_DDS]?e.images[j[s.MSFT_TEXTURE_DDS].source]:e.images[i.source];var l=c.uri,m=!1;return void 0!==c.bufferView&&(l=d.getDependency("bufferView",c.bufferView).then(function(a){m=!0;var b=new Blob([a],{type:c.mimeType});return l=h.createObjectURL(b),l})),Promise.resolve(l).then(function(b){var c=a.Loader.Handlers.get(b);return c||(c=j[s.MSFT_TEXTURE_DDS]?d.extensions[s.MSFT_TEXTURE_DDS].ddsLoader:g),new Promise(function(a,d){c.load(k(b,f.path),a,void 0,d)})}).then(function(b){!0===m&&h.revokeObjectURL(l),b.flipY=!1,void 0!==i.name&&(b.name=i.name),j[s.MSFT_TEXTURE_DDS]||(b.format=void 0===i.format?a.RGBAFormat:B[i.format]),void 0!==i.internalFormat&&b.format!==B[i.internalFormat]&&console.warn("THREE.GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),b.type=void 0===i.type?a.UnsignedByteType:C[i.type];var c=e.samplers||{},d=c[i.sampler]||{};return b.magFilter=z[d.magFilter]||a.LinearFilter,b.minFilter=z[d.minFilter]||a.LinearMipMapLinearFilter,b.wrapS=A[d.wrapS]||a.RepeatWrapping,b.wrapT=A[d.wrapT]||a.RepeatWrapping,b})},q.prototype.assignTexture=function(a,b,c){return this.getDependency("texture",c).then(function(c){a[b]=c})},q.prototype.loadMaterial=function(b){var c,d=this,e=this.json,f=this.extensions,g=this.json.materials[b],h={},i=g.extensions||{},j=[];if(i[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var k=f[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];c=k.getMaterialType(g),j.push(k.extendParams(h,g,d))}else if(i[s.KHR_MATERIALS_UNLIT]){var l=f[s.KHR_MATERIALS_UNLIT];c=l.getMaterialType(g),j.push(l.extendParams(h,g,d))}else{c=a.MeshStandardMaterial;var m=g.pbrMetallicRoughness||{};if(h.color=new a.Color(1,1,1),h.opacity=1,Array.isArray(m.baseColorFactor)){var n=m.baseColorFactor;h.color.fromArray(n),h.opacity=n[3]}if(void 0!==m.baseColorTexture&&j.push(d.assignTexture(h,"map",m.baseColorTexture.index)),h.metalness=void 0===m.metallicFactor?1:m.metallicFactor,h.roughness=void 0===m.roughnessFactor?1:m.roughnessFactor,void 0!==m.metallicRoughnessTexture){var o=m.metallicRoughnessTexture.index;j.push(d.assignTexture(h,"metalnessMap",o)),j.push(d.assignTexture(h,"roughnessMap",o))}}!0===g.doubleSided&&(h.side=a.DoubleSide);var p=g.alphaMode||L.OPAQUE;return p===L.BLEND?h.transparent=!0:(h.transparent=!1,p===L.MASK&&(h.alphaTest=void 0===g.alphaCutoff?0.5:g.alphaCutoff)),void 0!==g.normalTexture&&c!==a.MeshBasicMaterial&&(j.push(d.assignTexture(h,"normalMap",g.normalTexture.index)),h.normalScale=new a.Vector2(1,1),void 0!==g.normalTexture.scale&&h.normalScale.set(g.normalTexture.scale,g.normalTexture.scale)),void 0!==g.occlusionTexture&&c!==a.MeshBasicMaterial&&(j.push(d.assignTexture(h,"aoMap",g.occlusionTexture.index)),void 0!==g.occlusionTexture.strength&&(h.aoMapIntensity=g.occlusionTexture.strength)),void 0!==g.emissiveFactor&&c!==a.MeshBasicMaterial&&(h.emissive=new a.Color().fromArray(g.emissiveFactor)),void 0!==g.emissiveTexture&&c!==a.MeshBasicMaterial&&j.push(d.assignTexture(h,"emissiveMap",g.emissiveTexture.index)),Promise.all(j).then(function(){var b;return b=c===a.ShaderMaterial?f[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(h):new c(h),void 0!==g.name&&(b.name=g.name),b.normalScale&&(b.normalScale.y=-b.normalScale.y),b.map&&(b.map.encoding=a.sRGBEncoding),b.emissiveMap&&(b.emissiveMap.encoding=a.sRGBEncoding),g.extras&&(b.userData=g.extras),b})},q.prototype.loadGeometries=function(b){var c=this,d=this.extensions,e=this.primitiveCache;return this.getDependencies("accessor").then(function(f){for(var g=[],h=0,i=b.length;h<i;h++){var j=b[h],k=o(e,j);if(k)g.push(k);else if(j.extensions&&j.extensions[s.KHR_DRACO_MESH_COMPRESSION]){var l=d[s.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(j,c).then(function(a){return r(a,j,f),a});e.push({primitive:j,promise:l}),g.push(l)}else{var m=new a.BufferGeometry;r(m,j,f);var l=Promise.resolve(m);e.push({primitive:j,promise:l}),g.push(l)}}return Promise.all(g)})},q.prototype.loadMesh=function(b){var c=this,d=this.json,e=this.extensions,f=this.json.meshes[b];return this.getMultiDependencies(["accessor","material"]).then(function(d){var g=new a.Group,h=f.primitives;return c.loadGeometries(h).then(function(j){for(var k=0,i=h.length;k<i;k++){var n=h[k],o=j[k],p=void 0===n.material?l():d.materials[n.material];p.aoMap&&void 0===o.attributes.uv2&&void 0!==o.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),o.addAttribute("uv2",new a.BufferAttribute(o.attributes.uv.array,2)));var q=void 0!==o.attributes.color,r=void 0===o.attributes.normal,t=!0===f.isSkinnedMesh,u=void 0!==n.targets;if(q||r||t||u)if(p.isGLTFSpecularGlossinessMaterial){var v=e[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];p=v.cloneMaterial(p)}else p=p.clone();q&&(p.vertexColors=a.VertexColors,p.needsUpdate=!0),r&&(p.flatShading=!0);var x;if(n.mode===w.TRIANGLES||n.mode===w.TRIANGLE_STRIP||n.mode===w.TRIANGLE_FAN||void 0===n.mode)t?(x=new a.SkinnedMesh(o,p),p.skinning=!0):x=new a.Mesh(o,p),n.mode===w.TRIANGLE_STRIP?x.drawMode=a.TriangleStripDrawMode:n.mode===w.TRIANGLE_FAN&&(x.drawMode=a.TriangleFanDrawMode);else if(n.mode===w.LINES||n.mode===w.LINE_STRIP||n.mode===w.LINE_LOOP){var y="LineBasicMaterial:"+p.uuid,z=c.cache.get(y);z||(z=new a.LineBasicMaterial,a.Material.prototype.copy.call(z,p),z.color.copy(p.color),z.lights=!1,c.cache.add(y,z)),p=z,x=n.mode===w.LINES?new a.LineSegments(o,p):n.mode===w.LINE_STRIP?new a.Line(o,p):new a.LineLoop(o,p)}else if(n.mode===w.POINTS){var y="PointsMaterial:"+p.uuid,A=c.cache.get(y);A||(A=new a.PointsMaterial,a.Material.prototype.copy.call(A,p),A.color.copy(p.color),A.map=p.map,A.lights=!1,c.cache.add(y,A)),p=A,x=new a.Points(o,p)}else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+n.mode);if(x.name=f.name||"mesh_"+b,u&&(m(x,f,n,d.accessors),p.morphTargets=!0,void 0!==x.geometry.morphAttributes.normal&&(p.morphNormals=!0)),void 0!==f.extras&&(x.userData=f.extras),void 0!==n.extras&&(x.geometry.userData=n.extras),!0===p.isGLTFSpecularGlossinessMaterial&&(x.onBeforeRender=e[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),1<h.length)x.name+="_"+k,g.add(x);else return x}return g})})},q.prototype.loadCamera=function(b){var c,d=this.json.cameras[b],e=d[d.type];return e?("perspective"===d.type?c=new a.PerspectiveCamera(a.Math.radToDeg(e.yfov),e.aspectRatio||1,e.znear||1,e.zfar||2e6):"orthographic"===d.type&&(c=new a.OrthographicCamera(e.xmag/-2,e.xmag/2,e.ymag/2,e.ymag/-2,e.znear,e.zfar)),void 0!==d.name&&(c.name=d.name),d.extras&&(c.userData=d.extras),Promise.resolve(c)):void console.warn("THREE.GLTFLoader: Missing camera parameters.")},q.prototype.loadSkin=function(a){var b=this.json.skins[a],c={joints:b.joints};return void 0===b.inverseBindMatrices?Promise.resolve(c):this.getDependency("accessor",b.inverseBindMatrices).then(function(a){return c.inverseBindMatrices=a,c})},q.prototype.loadAnimation=function(b){var c=this.json,d=this.json.animations[b];return this.getMultiDependencies(["accessor","node"]).then(function(c){for(var e=[],f=0,g=d.channels.length;f<g;f++){var h=d.channels[f],i=d.samplers[h.sampler];if(i){var k=h.target,l=void 0===k.node?k.id:k.node,m=void 0===d.parameters?i.input:d.parameters[i.input],n=void 0===d.parameters?i.output:d.parameters[i.output],o=c.accessors[m],p=c.accessors[n],q=c.nodes[l];if(q){q.updateMatrix(),q.matrixAutoUpdate=!0;var r;switch(J[k.path]){case J.weights:r=a.NumberKeyframeTrack;break;case J.rotation:r=a.QuaternionKeyframeTrack;break;case J.position:case J.scale:default:r=a.VectorKeyframeTrack;}var s=q.name?q.name:q.uuid,t=void 0===i.interpolation?a.InterpolateLinear:K[i.interpolation],u=[];J[k.path]===J.weights?q.traverse(function(a){!0===a.isMesh&&!0===a.material.morphTargets&&u.push(a.name?a.name:a.uuid)}):u.push(s);for(var v,w=0,x=u.length;w<x;w++)v=new r(u[w]+"."+J[k.path],a.AnimationUtils.arraySlice(o.array,0),a.AnimationUtils.arraySlice(p.array,0),t),"CUBICSPLINE"===i.interpolation&&(v.createInterpolant=function(a){return new j(this.times,this.values,this.getValueSize()/3,a)},v.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),e.push(v)}}}var l=void 0===d.name?"animation_"+b:d.name;return new a.AnimationClip(l,void 0,e)})},q.prototype.loadNode=function(b){var c=this.json,d=this.extensions,e=this.json.meshReferences,f=this.json.meshUses,g=this.json.nodes[b];return this.getMultiDependencies(["mesh","skin","camera","light"]).then(function(b){var c;if(!0===g.isBone)c=new a.Bone;else if(void 0!==g.mesh){var h=b.meshes[g.mesh];if(c=h.clone(),!0===h.isGroup)for(var j,k=0,i=h.children.length;k<i;k++)j=h.children[k],j.material&&!0===j.material.isGLTFSpecularGlossinessMaterial&&(c.children[k].onBeforeRender=j.onBeforeRender);else h.material&&!0===h.material.isGLTFSpecularGlossinessMaterial&&(c.onBeforeRender=h.onBeforeRender);1<e[g.mesh]&&(c.name+="_instance_"+f[g.mesh]++)}else if(void 0!==g.camera)c=b.cameras[g.camera];else if(g.extensions&&g.extensions[s.KHR_LIGHTS]&&void 0!==g.extensions[s.KHR_LIGHTS].light){var l=d[s.KHR_LIGHTS].lights;c=l[g.extensions[s.KHR_LIGHTS].light]}else c=new a.Object3D;if(void 0!==g.name&&(c.name=a.PropertyBinding.sanitizeNodeName(g.name)),g.extras&&(c.userData=g.extras),void 0!==g.matrix){var m=new a.Matrix4;m.fromArray(g.matrix),c.applyMatrix(m)}else void 0!==g.translation&&c.position.fromArray(g.translation),void 0!==g.rotation&&c.quaternion.fromArray(g.rotation),void 0!==g.scale&&c.scale.fromArray(g.scale);return c})},q.prototype.loadScene=function(){function b(c,d,e,f,g){var h=f[c],k=e.nodes[c];if(void 0!==k.skin)for(var l=!0===h.isGroup?h.children:[h],m=0,i=l.length;m<i;m++){for(var n=l[m],o=g[k.skin],p=[],q=[],r=0,j=o.joints.length;r<j;r++){var s=o.joints[r],t=f[s];if(t){p.push(t);var u=new a.Matrix4;void 0!==o.inverseBindMatrices&&u.fromArray(o.inverseBindMatrices.array,16*r),q.push(u)}else console.warn("THREE.GLTFLoader: Joint \"%s\" could not be found.",s)}n.bind(new a.Skeleton(p,q),n.matrixWorld)}if(d.add(h),k.children)for(var v,w=k.children,m=0,i=w.length;m<i;m++)v=w[m],b(v,h,e,f,g)}return function(c){var d=this.json,e=this.extensions,f=this.json.scenes[c];return this.getMultiDependencies(["node","skin"]).then(function(c){var g=new a.Scene;void 0!==f.name&&(g.name=f.name),f.extras&&(g.userData=f.extras);for(var h=f.nodes||[],j=0,i=h.length;j<i;j++)b(h[j],g,d,c.nodes,c.skins);if(f.extensions&&f.extensions[s.KHR_LIGHTS]&&void 0!==f.extensions[s.KHR_LIGHTS].light){var k=e[s.KHR_LIGHTS].lights;g.add(k[f.extensions[s.KHR_LIGHTS].light])}return g})}}(),b}()},a.exports});;
Cube("datav:/com/datavmap-3d-layer-model/0.0.15/loader/OBJLoader",[],function(a){return a.exports=function(a){a.OBJLoader=function(){function b(){var a={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(a,b){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=a,void(this.object.fromDeclaration=!1!==b);var c=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0),this.object={name:a||"",fromDeclaration:!1!==b,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(a,b){var c=this._finalize(!1);c&&(c.inherited||0>=c.groupCount)&&this.materials.splice(c.index,1);var d={index:this.materials.length,name:a||"",mtllib:Array.isArray(b)&&0<b.length?b[b.length-1]:"",smooth:void 0===c?this.smooth:c.smooth,groupStart:void 0===c?0:c.groupEnd,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(a){var b={index:"number"===typeof a?a:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return b.clone=this.clone.bind(b),b}};return this.materials.push(d),d},currentMaterial:function(){return 0<this.materials.length?this.materials[this.materials.length-1]:void 0},_finalize:function(a){var b=this.currentMaterial();if(b&&-1===b.groupEnd&&(b.groupEnd=this.geometry.vertices.length/3,b.groupCount=b.groupEnd-b.groupStart,b.inherited=!1),a&&1<this.materials.length)for(var c=this.materials.length-1;0<=c;c--)0>=this.materials[c].groupCount&&this.materials.splice(c,1);return a&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),b}},c&&c.name&&"function"===typeof c.clone){var d=c.clone(0);d.inherited=!0,this.object.materials.push(d)}this.objects.push(this.object)},finalize:function(){this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(a,b){var c=parseInt(a,10);return 3*(0<=c?c-1:c+b/3)},parseNormalIndex:function(a,b){var c=parseInt(a,10);return 3*(0<=c?c-1:c+b/3)},parseUVIndex:function(a,b){var c=parseInt(a,10);return 2*(0<=c?c-1:c+b/2)},addVertex:function(d,a,b){var c=this.vertices,e=this.object.geometry.vertices;e.push(c[d+0],c[d+1],c[d+2]),e.push(c[a+0],c[a+1],c[a+2]),e.push(c[b+0],c[b+1],c[b+2])},addVertexLine:function(b){var a=this.vertices,c=this.object.geometry.vertices;c.push(a[b+0],a[b+1],a[b+2])},addNormal:function(d,a,b){var c=this.normals,e=this.object.geometry.normals;e.push(c[d+0],c[d+1],c[d+2]),e.push(c[a+0],c[a+1],c[a+2]),e.push(c[b+0],c[b+1],c[b+2])},addUV:function(d,a,b){var c=this.uvs,e=this.object.geometry.uvs;e.push(c[d+0],c[d+1]),e.push(c[a+0],c[a+1]),e.push(c[b+0],c[b+1])},addUVLine:function(b){var a=this.uvs,c=this.object.geometry.uvs;c.push(a[b+0],a[b+1])},addFace:function(d,a,b,c,e,f,g,h,i){var j=this.vertices.length,k=this.parseVertexIndex(d,j),l=this.parseVertexIndex(a,j),m=this.parseVertexIndex(b,j);if(this.addVertex(k,l,m),void 0!==c){var n=this.uvs.length;k=this.parseUVIndex(c,n),l=this.parseUVIndex(e,n),m=this.parseUVIndex(f,n),this.addUV(k,l,m)}if(void 0!==g){var o=this.normals.length;k=this.parseNormalIndex(g,o),l=g===h?k:this.parseNormalIndex(h,o),m=g===i?k:this.parseNormalIndex(i,o),this.addNormal(k,l,m)}},addLineGeometry:function(a,b){this.object.geometry.type="Line";for(var c=this.vertices.length,d=this.uvs.length,e=0,f=a.length;e<f;e++)this.addVertexLine(this.parseVertexIndex(a[e],c));for(var g=0,f=b.length;g<f;g++)this.addUVLine(this.parseUVIndex(b[g],d))}};return a.startObject("",!1),a}function c(b){this.manager=void 0===b?a.DefaultLoadingManager:b,this.materials=null}var d=/^[og]\s*(.+)?/,e=/^mtllib /,f=/^usemtl /;return c.prototype={constructor:c,load:function(b,c,d,e){var f=this,g=new a.FileLoader(f.manager);g.setPath(this.path),g.load(b,function(a){c(f.parse(a))},d,e)},setPath:function(a){this.path=a},setMaterials:function(a){return this.materials=a,this},parse:function(c){console.time("OBJLoader");var g=new b;-1!==c.indexOf("\r\n")&&(c=c.replace(/\r\n/g,"\n")),-1!==c.indexOf("\\\n")&&(c=c.replace(/\\\n/g,""));for(var h=c.split("\n"),k="",m="",n=0,o=[],p="function"===typeof"".trimLeft,q=0,i=h.length;q<i;q++)if(k=h[q],k=k.trimLeft(),n=k.length,0!==n&&(m=k.charAt(0),"#"!==m))if("v"===m){var l=k.split(/\s+/);switch(l[0]){case"v":g.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));break;case"vn":g.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));break;case"vt":g.uvs.push(parseFloat(l[1]),parseFloat(l[2]));}}else if("f"===m){for(var r,s=k.substr(1).trim(),t=s.split(/\s+/),u=[],v=0,j=t.length;v<j;v++)if(r=t[v],0<r.length){var w=r.split("/");u.push(w)}for(var x=u[0],v=1,j=u.length-1;v<j;v++){var y=u[v],z=u[v+1];g.addFace(x[0],y[0],z[0],x[1],y[1],z[1],x[2],y[2],z[2])}}else if("l"===m){var A=k.substring(1).trim().split(" "),B=[],C=[];if(-1===k.indexOf("/"))B=A;else for(var D,E=0,F=A.length;E<F;E++)D=A[E].split("/"),""!==D[0]&&B.push(D[0]),""!==D[1]&&C.push(D[1]);g.addLineGeometry(B,C)}else if(null!==(o=d.exec(k))){var G=(" "+o[0].substr(1).trim()).substr(1);g.startObject(G)}else if(f.test(k))g.object.startMaterial(k.substring(7).trim(),g.materialLibraries);else if(e.test(k))g.materialLibraries.push(k.substring(7).trim());else if("s"===m){if(o=k.split(" "),1<o.length){var H=o[1].trim().toLowerCase();g.object.smooth="0"!==H&&"off"!==H}else g.object.smooth=!0;var I=g.object.currentMaterial();I&&(I.smooth=g.object.smooth)}else{if("\0"===k)continue;throw new Error("Unexpected line: '"+k+"'")}g.finalize();var J=new a.Group;J.materialLibraries=[].concat(g.materialLibraries);for(var q=0,i=g.objects.length;q<i;q++){var K=g.objects[q],L=K.geometry,M=K.materials,N="Line"===L.type;if(0!==L.vertices.length){var O=new a.BufferGeometry;O.addAttribute("position",new a.BufferAttribute(new Float32Array(L.vertices),3)),0<L.normals.length?O.addAttribute("normal",new a.BufferAttribute(new Float32Array(L.normals),3)):O.computeVertexNormals(),0<L.uvs.length&&O.addAttribute("uv",new a.BufferAttribute(new Float32Array(L.uvs),2));for(var P=[],Q=0,R=M.length;Q<R;Q++){var S=M[Q],I=void 0;if(null!==this.materials&&(I=this.materials.create(S.name),N&&I&&!(I instanceof a.LineBasicMaterial))){var T=new a.LineBasicMaterial;T.copy(I),I=T}I||(I=N?new a.LineBasicMaterial:new a.MeshPhongMaterial,I.name=S.name),I.flatShading=!S.smooth,P.push(I)}var U;if(1<P.length){for(var S,Q=0,R=M.length;Q<R;Q++)S=M[Q],O.addGroup(S.groupStart,S.groupCount,Q);U=N?new a.LineSegments(O,P):new a.Mesh(O,P)}else U=N?new a.LineSegments(O,P[0]):new a.Mesh(O,P[0]);U.name=K.name,J.add(U)}}return console.timeEnd("OBJLoader"),J}},c}()},a.exports});;
Cube("datav:/com/datavmap-3d-layer-model/0.0.15/loader/MTLLoader",[],function(a){return a.exports=function(a){a.MTLLoader=function(b){this.manager=void 0===b?a.DefaultLoadingManager:b},a.MTLLoader.prototype={constructor:a.MTLLoader,load:function(b,c,d,e){var f=this,g=new a.FileLoader(this.manager);g.setPath(this.path),g.load(b,function(a){c(f.parse(a))},d,e)},setPath:function(a){this.path=a},setTexturePath:function(a){this.texturePath=a},setBaseUrl:function(a){console.warn("THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead."),this.setTexturePath(a)},setCrossOrigin:function(a){this.crossOrigin=a},setMaterialOptions:function(a){this.materialOptions=a},parse:function(b){for(var c,d=b.split("\n"),e={},f=/\s+/,g={},h=0;h<d.length;h++)if(c=d[h],c=c.trim(),0!==c.length&&"#"!==c.charAt(0)){var i=c.indexOf(" "),j=0<=i?c.substring(0,i):c;j=j.toLowerCase();var k=0<=i?c.substring(i+1):"";if(k=k.trim(),"newmtl"===j)e={name:k},g[k]=e;else if(e)if("ka"===j||"kd"===j||"ks"===j){var l=k.split(f,3);e[j]=[parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2])]}else e[j]=k}var m=new a.MTLLoader.MaterialCreator(this.texturePath||this.path,this.materialOptions);return m.setCrossOrigin(this.crossOrigin),m.setManager(this.manager),m.setMaterials(g),m}},a.MTLLoader.MaterialCreator=function(b,c){this.baseUrl=b||"",this.options=c,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:a.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:a.RepeatWrapping},a.MTLLoader.MaterialCreator.prototype={constructor:a.MTLLoader.MaterialCreator,crossOrigin:"Anonymous",setCrossOrigin:function(a){this.crossOrigin=a},setManager:function(a){this.manager=a},setMaterials:function(a){this.materialsInfo=this.convert(a),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(a){if(!this.options)return a;var b={};for(var c in a){var d=a[c],e={};for(var f in b[c]=e,d){var g=!0,h=d[f],i=f.toLowerCase();switch(i){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(h=[h[0]/255,h[1]/255,h[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===h[0]&&0===h[1]&&0===h[2]&&(g=!1);break;default:}g&&(e[i]=h)}}return b},preload:function(){for(var a in this.materialsInfo)this.create(a)},getIndex:function(a){return this.nameLookup[a]},getAsArray:function(){var a=0;for(var b in this.materialsInfo)this.materialsArray[a]=this.create(b),this.nameLookup[b]=a,a++;return this.materialsArray},create:function(a){return void 0===this.materials[a]&&this.createMaterial_(a),this.materials[a]},createMaterial_:function(b){function c(a,b){return"string"!==typeof b||""===b?"":/^https?:\/\//i.test(b)?b:a+b}function d(a,b){if(!g[a]){var d=e.getTextureParams(b,g),f=e.loadTexture(c(e.baseUrl,d.url));f.repeat.copy(d.scale),f.offset.copy(d.offset),f.wrapS=e.wrap,f.wrapT=e.wrap,g[a]=f}}var e=this,f=this.materialsInfo[b],g={name:b,side:this.side};for(var h in f){var i,j=f[h];if(""!==j)switch(h.toLowerCase()){case"kd":g.color=new a.Color().fromArray(j);break;case"ks":g.specular=new a.Color().fromArray(j);break;case"map_kd":d("map",j);break;case"map_ks":d("specularMap",j);break;case"norm":d("normalMap",j);break;case"map_bump":case"bump":d("bumpMap",j);break;case"ns":g.shininess=parseFloat(j);break;case"d":i=parseFloat(j),1>i&&(g.opacity=i,g.transparent=!0);break;case"tr":i=parseFloat(j),0<i&&(g.opacity=1-i,g.transparent=!0);break;default:}}return this.materials[b]=new a.MeshPhongMaterial(g),this.materials[b]},getTextureParams:function(b,c){var d,e={scale:new a.Vector2(1,1),offset:new a.Vector2(0,0)},f=b.split(/\s+/);return d=f.indexOf("-bm"),0<=d&&(c.bumpScale=parseFloat(f[d+1]),f.splice(d,2)),d=f.indexOf("-s"),0<=d&&(e.scale.set(parseFloat(f[d+1]),parseFloat(f[d+2])),f.splice(d,4)),d=f.indexOf("-o"),0<=d&&(e.offset.set(parseFloat(f[d+1]),parseFloat(f[d+2])),f.splice(d,4)),e.url=f.join(" ").trim(),e},loadTexture:function(b,c,d,e,f){var g,h=a.Loader.Handlers.get(b),i=void 0===this.manager?a.DefaultLoadingManager:this.manager;return null===h&&(h=new a.TextureLoader(i)),h.setCrossOrigin&&h.setCrossOrigin(this.crossOrigin),g=h.load(b,d,e,f),void 0!==c&&(g.mapping=c),g}}},a.exports});;
Cube("datav:/com/datavmap-3d-layer-model/0.0.15/loader/ColladaLoader2",[],function(a){return a.exports=function(e){e.ColladaLoader=function(a){this.manager=void 0===a?e.DefaultLoadingManager:a},e.ColladaLoader.prototype={constructor:e.ColladaLoader,load:function(a,b,c,d){var f=this,g=new e.FileLoader(f.manager);g.load(a,function(a){b(f.parse(a))},c,d)},options:{set convertUpAxis(a){console.log("ColladaLoder.options.convertUpAxis: TODO")}},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a){function b(a,b){for(var c,d=[],e=a.childNodes,f=0,g=e.length;f<g;f++)c=e[f],c.nodeName===b&&d.push(c);return d}function c(a){if(0===a.length)return[];for(var b=a.trim().split(/\s+/),c=Array(b.length),d=0,e=b.length;d<e;d++)c[d]=parseFloat(b[d]);return c}function d(a){if(0===a.length)return[];for(var b=a.trim().split(/\s+/),c=Array(b.length),d=0,e=b.length;d<e;d++)c[d]=parseInt(b[d]);return c}function f(a){return a.substring(1)}function g(a){return void 0===a?1:parseFloat(a.getAttribute("meter"))}function h(a){return void 0===a?"Y_UP":a.textContent}function i(a,c,d,e){var f=b(a,c)[0];if(void 0!==f)for(var g=b(f,d),h=0;h<g.length;h++)e(g[h])}function j(a,b){for(var c in a){var d=a[c];d.build=b(a[c])}}function k(a,b){return void 0===a.build?(a.build=b(a),a.build):a.build}function l(a){return void 0===a.build?new Image:a.build}function m(a){return k(ca.images[a],l)}function n(a){for(var b,c={surfaces:{},samplers:{}},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"newparam":o(b,c);break;case"technique":c.technique=r(b);}return c}function o(a,b){for(var c,d=a.getAttribute("sid"),e=0,f=a.childNodes.length;e<f;e++)if(c=a.childNodes[e],1===c.nodeType)switch(c.nodeName){case"surface":b.surfaces[d]=p(c);break;case"sampler2D":b.samplers[d]=q(c);}}function p(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"init_from":c.init_from=b.textContent;}return c}function q(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"source":c.source=b.textContent;}return c}function r(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"constant":case"lambert":case"blinn":case"phong":c.type=b.nodeName,c.parameters=s(b);}return c}function s(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"emission":case"diffuse":case"specular":case"shininess":case"transparent":case"transparency":c[b.nodeName]=t(b);}return c}function t(a){for(var b,d={},e=0,f=a.childNodes.length;e<f;e++)if(b=a.childNodes[e],1===b.nodeType)switch(b.nodeName){case"color":d[b.nodeName]=c(b.textContent);break;case"float":d[b.nodeName]=parseFloat(b.textContent);break;case"texture":d[b.nodeName]={id:b.getAttribute("texture"),extra:u(b)};}return d}function u(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"extra":c=v(b);}return c}function v(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"technique":c[b.nodeName]=w(b);}return c}function w(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":c[b.nodeName]=parseFloat(b.textContent);break;case"wrapU":case"wrapV":c[b.nodeName]=parseInt(b.textContent);}return c}function x(a){return a}function y(a){return k(ca.effects[a],x)}function z(a){function b(a){var b=d.profile.samplers[a.id];if(void 0!==b){var c=d.profile.surfaces[b.source],f=new e.Texture(m(c.init_from)),g=a.extra;if(void 0!==g&&void 0!==g.technique){var h=g.technique;f.wrapS=h.wrapU?e.RepeatWrapping:e.ClampToEdgeWrapping,f.wrapT=h.wrapV?e.RepeatWrapping:e.ClampToEdgeWrapping,f.offset.set(h.offsetU,h.offsetV),f.repeat.set(h.repeatU,h.repeatV)}else f.wrapS=e.RepeatWrapping,f.wrapT=e.RepeatWrapping;return f.needsUpdate=!0,f}return console.error("ColladaLoder: Undefined sampler",a.id),null}var c,d=y(a.url),f=d.profile.technique;switch(f.type){case"phong":case"blinn":c=new e.MeshPhongMaterial;break;case"lambert":c=new e.MeshLambertMaterial;break;default:c=new e.MeshBasicMaterial;}c.name=a.name;var g=f.parameters;for(var h in g){var i=g[h];"diffuse"===h?(i.color&&c.color.fromArray(i.color),i.texture&&(c.map=b(i.texture))):"specular"===h?i.color&&c.specular&&c.specular.fromArray(i.color):"shininess"===h?i.float&&c.shininess&&(c.shininess=i.float):"emission"===h?i.color&&c.emissive&&c.emissive.fromArray(i.color):"transparent"===h?c.transparent=!0:"transparency"===h?(void 0!==i.float&&(c.opacity=i.float),c.transparent=!0):void 0}return c}function A(a){return k(ca.materials[a],z)}function B(a){for(var b,c=0;c<a.childNodes.length;c++)switch(b=a.childNodes[c],b.nodeName){case"technique_common":return C(b);}return{}}function C(a){for(var b,c={},d=0;d<a.childNodes.length;d++)switch(b=a.childNodes[d],b.nodeName){case"perspective":case"orthographic":c.technique=b.nodeName,c.parameters=D(b);}return c}function D(a){for(var b,c={},d=0;d<a.childNodes.length;d++)switch(b=a.childNodes[d],b.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":c[b.nodeName]=parseFloat(b.textContent);}return c}function E(a){var b;switch(a.optics.technique){case"perspective":b=new e.PerspectiveCamera(a.optics.parameters.yfov,a.optics.parameters.aspect_ratio,a.optics.parameters.znear,a.optics.parameters.zfar);break;case"orthographic":b=new e.OrthographicCamera;break;default:b=new e.PerspectiveCamera;}return b.name=a.name,b}function F(a){return k(ca.cameras[a],E)}function G(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"directional":case"point":case"spot":case"ambient":c.technique=b.nodeName,c.parameters=H(b);}return c}function H(a){for(var b,d={},g=0,h=a.childNodes.length;g<h;g++)if(b=a.childNodes[g],1===b.nodeType)switch(b.nodeName){case"color":var i=c(b.textContent);d.color=new e.Color().fromArray(i);break;case"falloff_angle":d.falloffAngle=parseFloat(b.textContent);break;case"quadratic_attenuation":var j=parseFloat(b.textContent);d.distance=j?Math.sqrt(1/j):0;}return d}function I(a){var b;switch(a.technique){case"directional":b=new e.DirectionalLight;break;case"point":b=new e.PointLight;break;case"spot":b=new e.SpotLight;break;case"ambient":b=new e.AmbientLight;}return a.parameters.color&&b.color.copy(a.parameters.color),a.parameters.distance&&(b.distance=a.parameters.distance),b}function J(a){return k(ca.lights[a],I)}function K(a){for(var d,e={array:[],stride:3},f=0;f<a.childNodes.length;f++)if(d=a.childNodes[f],1===d.nodeType)switch(d.nodeName){case"float_array":e.array=c(d.textContent);break;case"technique_common":var g=b(d,"accessor")[0];void 0!==g&&(e.stride=parseInt(g.getAttribute("stride")));break;default:console.log(d);}return e}function L(a){for(var b,c={},d=0;d<a.childNodes.length;d++)b=a.childNodes[d],1===b.nodeType&&(c[b.getAttribute("semantic")]=f(b.getAttribute("source")));return c}function M(a){for(var b,c={type:a.nodeName,material:a.getAttribute("material"),inputs:{},stride:0},e=0,g=a.childNodes.length;e<g;e++)if(b=a.childNodes[e],1===b.nodeType)switch(b.nodeName){case"input":var h=f(b.getAttribute("source")),i=b.getAttribute("semantic"),j=parseInt(b.getAttribute("offset"));c.inputs[i]={id:h,offset:j},c.stride=Math.max(c.stride,j+1);break;case"vcount":c.vcount=d(b.textContent);break;case"p":c.p=d(b.textContent);}return c}function N(a){var b={},c=a.sources,d=a.vertices,f=a.primitives;if(0===f.length)return b;for(var g=0;g<f.length;g++){var h=f[g],i=h.inputs,j=new e.BufferGeometry;for(var k in a.name&&(j.name=a.name),i){var l=i[k];switch(k){case"VERTEX":for(var m in d)j.addAttribute(m.toLowerCase(),O(h,c[d[m]],l.offset));break;case"NORMAL":j.addAttribute("normal",O(h,c[l.id],l.offset));break;case"COLOR":j.addAttribute("color",O(h,c[l.id],l.offset));break;case"TEXCOORD":j.addAttribute("uv",O(h,c[l.id],l.offset));}}var n;switch(h.type){case"lines":n=new e.LineSegments(j,W);break;case"linestrips":n=new e.Line(j,W);break;case"triangles":case"polylist":n=new e.Mesh(j,X);}b[h.material]=n}return b}function O(f,g,h){function j(a){for(var b=k[a+h]*q,c=b+q;b<c;b++)r.push(p[b])}var k=f.p,m=f.stride,n=f.vcount,o=0,p=g.array,q=g.stride,r=[];if(void 0!==f.vcount){for(var s,t=0,u=0,i=n.length;u<i;u++){if(s=n[u],4===s){var l=t+0*m,a=t+1*m,b=t+2*m,c=t+3*m;j(l),j(a),j(c),j(a),j(b),j(c)}else if(3===s){var l=t+0*m,a=t+1*m,b=t+2*m;j(l),j(a),j(b)}else o=Math.max(o,s);t+=m*s}0<o&&console.log("ColladaLoader: Geometry has faces with more than 4 vertices.")}else for(var u=0,i=k.length;u<i;u+=m)j(u);return new e.Float32BufferAttribute(r,q)}function P(a){return k(ca.geometries[a],N)}function Q(a){for(var b,d={name:a.getAttribute("name"),matrix:new e.Matrix4,nodes:[],instanceCameras:[],instanceLights:[],instanceGeometries:[],instanceNodes:[]},g=0;g<a.childNodes.length;g++)if(b=a.childNodes[g],1===b.nodeType)switch(b.nodeName){case"node":b.hasAttribute("id")&&(d.nodes.push(b.getAttribute("id")),Q(b));break;case"instance_camera":d.instanceCameras.push(f(b.getAttribute("url")));break;case"instance_light":d.instanceLights.push(f(b.getAttribute("url")));break;case"instance_geometry":d.instanceGeometries.push(R(b));break;case"instance_node":d.instanceNodes.push(f(b.getAttribute("url")));break;case"matrix":var h=c(b.textContent);d.matrix.multiply(Y.fromArray(h).transpose());break;case"translate":var h=c(b.textContent);Z.fromArray(h),d.matrix.multiply(Y.makeTranslation(Z.x,Z.y,Z.z));break;case"rotate":var h=c(b.textContent),i=e.Math.degToRad(h[3]);d.matrix.multiply(Y.makeRotationAxis(Z.fromArray(h),i));break;case"scale":var h=c(b.textContent);d.matrix.scale(Z.fromArray(h));break;case"extra":break;default:console.log(b);}return a.hasAttribute("id")&&(ca.nodes[a.getAttribute("id")]=d),d}function R(a){for(var b,c={id:f(a.getAttribute("url")),materials:{}},d=0;d<a.childNodes.length;d++)if(b=a.childNodes[d],"bind_material"===b.nodeName){for(var e=b.getElementsByTagName("instance_material"),g=0;g<e.length;g++){var h=e[g],i=h.getAttribute("symbol"),j=h.getAttribute("target");c.materials[i]=f(j)}break}return c}function S(a){for(var b=[],c=a.matrix,d=a.nodes,f=a.instanceCameras,g=a.instanceLights,h=a.instanceGeometries,j=a.instanceNodes,k=0,i=d.length;k<i;k++)b.push(T(d[k]).clone());for(var k=0,i=f.length;k<i;k++)b.push(F(f[k]).clone());for(var k=0,i=g.length;k<i;k++)b.push(J(g[k]).clone());for(var k=0,i=h.length;k<i;k++){var l=h[k],m=P(l.id);for(var n in m){var o=m[n].clone();void 0!==l.materials[n]&&(o.material=A(l.materials[n])),b.push(o)}}for(var k=0,i=j.length;k<i;k++)b.push(T(j[k]).clone());var o;if(0===d.length&&1===b.length)o=b[0];else{o=new e.Group;for(var k=0;k<b.length;k++)o.add(b[k])}return o.name=a.name,c.decompose(o.position,o.quaternion,o.scale),o}function T(a){return k(ca.nodes[a],S)}function U(a){var b=new e.Group;b.name=a.name;for(var c=a.children,d=0;d<c.length;d++)b.add(S(c[d]));return b}function V(a){return k(ca.visualScenes[a],U)}var W=new e.LineBasicMaterial,X=new e.MeshPhongMaterial,Y=new e.Matrix4,Z=new e.Vector3;if(console.time("ColladaLoader"),0===a.length)return{scene:new e.Scene};console.time("ColladaLoader: DOMParser");var $=new DOMParser().parseFromString(a,"application/xml");console.timeEnd("ColladaLoader: DOMParser");var _=b($,"COLLADA")[0],aa=_.getAttribute("version");console.log("ColladaLoader: File version",aa);var ba=function(a){return{unit:g(b(a,"unit")[0]),upAxis:h(b(a,"up_axis")[0])}}(b(_,"asset")[0]),ca={images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{}};console.time("ColladaLoader: Parse"),i(_,"library_images","image",function(a){var c={init_from:b(a,"init_from")[0].textContent};ca.images[a.getAttribute("id")]=c}),i(_,"library_effects","effect",function(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"profile_COMMON":c.profile=n(b);}ca.effects[a.getAttribute("id")]=c}),i(_,"library_materials","material",function(a){for(var b,c={name:a.getAttribute("name")},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"instance_effect":c.url=f(b.getAttribute("url"));}ca.materials[a.getAttribute("id")]=c}),i(_,"library_cameras","camera",function(a){for(var b,c={name:a.getAttribute("name")},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"optics":c.optics=B(b);}ca.cameras[a.getAttribute("id")]=c}),i(_,"library_lights","light",function(a){for(var b,c={},d=0,e=a.childNodes.length;d<e;d++)if(b=a.childNodes[d],1===b.nodeType)switch(b.nodeName){case"technique_common":c=G(b);}ca.lights[a.getAttribute("id")]=c}),i(_,"library_geometries","geometry",function(a){for(var c,d={name:a.getAttribute("name"),sources:{},vertices:{},primitives:[]},e=b(a,"mesh")[0],f=0;f<e.childNodes.length;f++)if(c=e.childNodes[f],1===c.nodeType){var g=c.getAttribute("id");switch(c.nodeName){case"source":d.sources[g]=K(c);break;case"vertices":d.vertices=L(c);break;case"polygons":console.warn("ColladaLoader: Unsupported primitive type: ",c.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":d.primitives.push(M(c));break;default:console.log(c);}}ca.geometries[a.getAttribute("id")]=d}),i(_,"library_nodes","node",Q),i(_,"library_visual_scenes","visual_scene",function(a){for(var c={name:a.getAttribute("name"),children:[]},d=b(a,"node"),e=0;e<d.length;e++)c.children.push(Q(d[e]));ca.visualScenes[a.getAttribute("id")]=c}),console.timeEnd("ColladaLoader: Parse"),console.time("ColladaLoader: Build"),j(ca.images,l),j(ca.effects,x),j(ca.materials,z),j(ca.cameras,E),j(ca.lights,I),j(ca.geometries,N),j(ca.visualScenes,U),console.timeEnd("ColladaLoader: Build");var da=function(a){var c=b(a,"instance_visual_scene")[0];return V(f(c.getAttribute("url")))}(b(_,"scene")[0]);return"Z_UP"===ba.upAxis&&(da.rotation.x=-Math.PI/2),da.scale.multiplyScalar(ba.unit),console.timeEnd("ColladaLoader"),{animations:[],kinematics:{joints:[]},library:ca,scene:da}}}},a.exports});;
Cube("datav:/com/datavmap-3d-layer-model/0.0.15/file-loader.js",[],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=null,g=function(){function a(b){d(this,a),f=b,c("datav:/com/datavmap-3d-layer-model/0.0.15/loader/ColladaLoader2")(f),c("datav:/com/datavmap-3d-layer-model/0.0.15/loader/MTLLoader")(f),c("datav:/com/datavmap-3d-layer-model/0.0.15/loader/OBJLoader")(f),c("datav:/com/datavmap-3d-layer-model/0.0.15/loader/GLTFLoader")(f)}return e(a,[{key:"fetchModel",value:function(a,b){var c=this.getType(a);"dae"===c?this.fetchDAE(a,b):"obj"===c||"mtl"===c?this.fetchOBJ(a,b):"gltf"===c||"glb"===c?this.fetchGLTF(a,b):b&&b(null)}},{key:"fetchGLTF",value:function(a,b){var c=new f.GLTFLoader;c.load(a,function(a){var c={};c.scene=a.scene,c.animations=a.animations,b&&b(c)},this.onProgress,this.onError)}},{key:"fetchOBJ",value:function(a,b){var c=this,d=new f.MTLLoader,e=new f.OBJLoader;d.setCrossOrigin("*"),d.setMaterialOptions({side:f.DoubleSide});var g=a.lastIndexOf("/"),h=a.substr(0,g)+"/",i=a.substr(0,g)+"/";d.setPath(h),e.setPath(i);var j=a.lastIndexOf("."),k=a.substring(g+1,j),l=k+".obj";d.load(k+".mtl",function(a){a.preload(),e.setMaterials(a),e.load(l,function(a){var c={};c.scene=a,b&&b(c)},c.onProgress,c.onError)},this.onProgress,function(){e.load(l,function(a){var c={};c.scene=a,b&&b(c)})})}},{key:"fetchDAE",value:function(a,b){var c=new f.ColladaLoader;c.options.convertUpAxis=!0,c.load(a,function(a){b&&b(a)},this.onProgress,this.onError)}},{key:"onProgress",value:function(a){console.log("\u6A21\u578B\u52A0\u8F7D\u4E2D\uFF1A "+Math.round(100*(a.loaded/a.total),2)+"% loaded")}},{key:"onError",value:function(a){console.error(a)}},{key:"getType",value:function(a){var b=a.lastIndexOf("."),c=a.substr(b+1).toLowerCase();return c}}]),a}();return a.exports=g,a.exports});;
Cube("datav:/com/datavmap-3d-layer-model/0.0.15/model-loader.js",["datav:/npm/eventemitter3/2.0.3","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/2.0.3"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/com/datavmap-3d-layer-model/0.0.15/file-loader.js"),k=Math.PI/180;return a.exports=function(a){var b=a.datavgl,c=b.THREE,l=a.glLayer||a,m=new j(c),n={clickOption:{highlightColor:"#f00"}};return function(h){function j(a){d(this,j);var b=e(this,(j.__proto__||Object.getPrototypeOf(j)).call(this));return a=i(n,a),b.options=i(b.options,a),b.object=new c.Group,b.raycaster=new c.Raycaster,b.mouse=new c.Vector2,b.onMouseEventCallback=b.onMouseEventCallback.bind(b),b.init(),b.initPickHelper(),b}return f(j,h),g(j,[{key:"init",value:function(){this.loadModel()}},{key:"loadModel",value:function(){var a=this;this.remove(),m.fetchModel(this.options.modelUrl,function(d){if(d){var e=a.object=d.scene,f=a.pos=b.DataVProject([a.options.center.lng,a.options.center.lat]);e.traverse(function(a){a.material&&a.material.side&&(a.material.side=c.DoubleSide)});var g=new c.Box3().setFromObject(e),h=a.diameter=2*g.getSize().length();a.object=e,e.rotation.set(a.options.rotation.rx*k,a.options.rotation.ry*k,a.options.rotation.rz*k);var i=512/(6378137*(2*Math.PI)*Math.abs(Math.cos(a.options.center.lat*k)));e.position.copy(new c.Vector3(f[0]+a.options.positionOffset.px*i,f[1]+a.options.positionOffset.py*i,8+a.options.positionOffset.pz)),e.scale.set(500*i*a.options.scale.sx/h,a.options.scale.sy,500*i*a.options.scale.sz/h),l.offsetNode.add(e)}})}},{key:"initPickHelper",value:function(){a.on("mousemove",this.onMouseEventCallback),a.on("mouseup",this.onMouseEventCallback)}},{key:"onMouseEventCallback",value:function(b){if(!a.isEasing()){this.mouse.x=2*(b.point.x/a.transform.width)-1,this.mouse.y=2*-(b.point.y/a.transform.height)+1,this.raycaster.setFromCamera(this.mouse,l.camera);var d=this.raycaster.intersectObjects(this.object.children,!0);d.length?"mousemove"===b.type?a.getCanvasContainer().style.cursor="crosshair":(this.pickedObject&&(this.pickedObject.object.material=this.pickedObjectMat||new c.MeshStandardMaterial({color:new c.Color("#fff")})),this.pickedObject=d[0],this.pickedObjectMat=this.pickedObject.object.material,this.pickedObject.object.material=new c.MeshStandardMaterial({color:new c.Color(this.options.clickOption.highlightColor||"#f00"),transparent:!0,opacity:this.pickedObjectMat.opacity||0.7}),this.emit("model-click",d[0].object)):"mousemove"===b.type?a.getCanvasContainer().style.cursor="":this.pickedObject&&(this.pickedObject.object.material=this.pickedObjectMat||new c.MeshStandardMaterial({color:new c.Color("#fff")})),b.originalEvent.preventDefault()}}},{key:"updateModel",value:function(){if(this.object){var a=this.pos=b.DataVProject([this.options.center.lng,this.options.center.lat]),d=this.object,e=this.diameter,f=512/(6378137*(2*Math.PI)*Math.abs(Math.cos(this.options.center.lat*k)));d.rotation.set(this.options.rotation.rx*k,this.options.rotation.ry*k,this.options.rotation.rz*k),d.position.copy(new c.Vector3(a[0]+this.options.positionOffset.px*f,a[1]+this.options.positionOffset.py*f,8+this.options.positionOffset.pz)),d.scale.set(500*f*this.options.scale.sx/e,this.options.scale.sy,500*f*this.options.scale.sz/e)}}},{key:"setData",value:function(){}},{key:"updateOptions",value:function(a){var b=this.options.modelUrl!==a.modelUrl;this.options=i(this.options,a),b&&this.loadModel(),this.updateModel()}},{key:"show",value:function(){this.options.visibility=!0,this.object&&(this.object.visible=!0)}},{key:"hide",value:function(){this.options.visibility=!1,this.object&&(this.object.visible=!1)}},{key:"remove",value:function(){a.off("mousemove",this.onMouseEventCallback),a.off("mouseup",this.onMouseEventCallback),this.pickedObject=null,this.pickedObjectMat=null,this.object&&l.offsetNode.remove(this.object),this.object&&l.disposeNode(this.object)}}]),j}(h)},a.exports});;
Cube("datav:/com/datavmap-3d-layer-model/0.0.15",["datav:/npm/eventemitter3/2.0.3","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/2.0.3"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/com/datavmap-3d-layer-model/0.0.15/model-loader.js"),k={},l=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.container="string"===typeof a?document.querySelector(a):a,f.apis=c.apis,f.map=null,f._data=null,f.config=c,f}return f(b,a),g(b,[{key:"initLayer",value:function(){var a=this,b=this.getOptions(),c=j(this.map);this.layer=new c(b),this.layer.on("model-click",function(b){a.emit("model-click",b)})}},{key:"addTo",value:function(a){var b=this;this.map=a,this.resetID&&clearTimeout(this.resetID),this.init(),this.endID=setTimeout(function(){b.resetID&&clearTimeout(b.resetID)},100000)}},{key:"init",value:function(){var a=this;this.map.loaded()&&this.map.isStyleLoaded()?(this.resetID&&clearTimeout(this.resetID),this.initLayer(),this.data&&this.render(this.data)):(this.resetID&&clearTimeout(this.resetID),this.resetID=setTimeout(function(){a.init()},100))}},{key:"getOptions",value:function(){return this.config=i(k,this.config),this.config}},{key:"show",value:function(){this.config.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.config.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"remove",value:function(){this.endID&&clearTimeout(this.endID),this.resetID&&clearTimeout(this.resetID),this.layer&&this.layer.remove&&this.layer.remove(),this.layer=null,this._data=null}},{key:"render",value:function(a){a&&(this.data=a,this.layer&&this.layer.setData(a))}},{key:"updateOptions",value:function(a){this.config=i(this.config,a),a=this.getOptions(),this.layer&&this.layer.updateOptions(a)}}]),b}(h);return a.exports=l,a.exports});