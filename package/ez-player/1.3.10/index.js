// env=undefined => env=publish 
Cube("datav:/com/ez-player/1.3.10/lib/ezuikit",[],function(O,e,t,o,n,r){var T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};return function(e,t){"use strict";"object"===(void 0===O?"undefined":T(O))&&"object"===T(O.exports)?O.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("EZUIPlayer requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:void 0,function(h,e){var o;!function(e,a){function c(){var e=f.elements;return"string"==typeof e?e.split(" "):e}function l(e){var t=p[e[o]];return t||(t={},s++,e[o]=s,p[s]=t),t}function d(e,t,o){return t=t||a,u?t.createElement(e):!(t=(o=o||l(t)).cache[e]?o.cache[e].cloneNode():r.test(e)?(o.cache[e]=o.createElem(e)).cloneNode():o.createElem(e)).canHaveChildren||n.test(e)||t.tagUrn?t:o.frag.appendChild(t)}function i(e){var t,o,i,n,r,s=l(e=e||a);return!f.shivCSS||h||s.hasCSS||(s.hasCSS=(n="article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}",r=(i=e).createElement("p"),i=i.getElementsByTagName("head")[0]||i.documentElement,r.innerHTML="x<style>"+n+"</style>",!!i.insertBefore(r.lastChild,i.firstChild))),u||(t=e,(o=s).cache||(o.cache={},o.createElem=t.createElement,o.createFrag=t.createDocumentFragment,o.frag=o.createFrag()),t.createElement=function(e){return f.shivMethods?d(e,t,o):o.createElem(e)},t.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+c().join().replace(/[\w\-:]+/g,function(e){return o.createElem(e),o.frag.createElement(e),'c("'+e+'")'})+");return n}")(f,o.frag)),e}var h,u,t=e.html5||{},n=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,r=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,o="_html5shiv",s=0,p={};!function(){try{var e=a.createElement("a");e.innerHTML="<xyz></xyz>",h="hidden"in e,u=1==e.childNodes.length||function(){a.createElement("a");var e=a.createDocumentFragment();return void 0===e.cloneNode||void 0===e.createDocumentFragment||void 0===e.createElement}()}catch(e){u=h=!0}}();var f={elements:t.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output picture progress section summary template time video",version:"3.7.3",shivCSS:!1!==t.shivCSS,supportsUnknownElements:u,shivMethods:!1!==t.shivMethods,type:"default",shivDocument:i,createElement:d,createDocumentFragment:function(e,t){if(e=e||a,u)return e.createDocumentFragment();for(var o=(t=t||l(e)).frag.cloneNode(),i=0,n=c(),r=n.length;i<r;i++)o.createElement(n[i]);return o},addElements:function(e,t){var o=f.elements;"string"!=typeof o&&(o=o.join(" ")),"string"!=typeof e&&(e=e.join(" ")),f.elements=o+" "+e,i(t)}};e.html5=f,i(a),"object"==(void 0===O?"undefined":T(O))&&O.exports&&(O.exports=f)}(void 0!==h?h:this,document),"document"in self&&("classList"in document.createElement("_")?((r=document.createElement("_")).classList.add("c1","c2"),r.classList.contains("c2")||((t=function(e){var i=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){for(var t=arguments.length,o=0;o<t;o++)e=arguments[o],i.call(this,e)}})("add"),t("remove")),r.classList.toggle("c3",!1),r.classList.contains("c3")&&(o=DOMTokenList.prototype.toggle,DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:o.call(this,e)})):function(e){"use strict";if("Element"in e){var t="classList",o="prototype",i=e.Element[o],n=Object,r=String[o].trim||function(){return this.replace(/^\s+|\s+$/g,"")},s=Array[o].indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1},a=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},c=function(e,t){if(""===t)throw new a("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new a("INVALID_CHARACTER_ERR","String contains an invalid character");return s.call(e,t)},l=function(e){for(var t=r.call(e.getAttribute("class")||""),o=t?t.split(/\s+/):[],i=0,n=o.length;i<n;i++)this.push(o[i]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},d=l[o]=[],e=function(){return new l(this)};if(a[o]=Error[o],d.item=function(e){return this[e]||null},d.contains=function(e){return-1!==c(this,e+="")},d.add=function(){for(var e,t=arguments,o=0,i=t.length,n=!1;-1===c(this,e=t[o]+"")&&(this.push(e),n=!0),++o<i;);n&&this._updateClassName()},d.remove=function(){var e,t,o=arguments,i=0,n=o.length,r=!1;do{for(t=c(this,e=o[i]+"");-1!==t;)this.splice(t,1),r=!0,t=c(this,e)}while(++i<n);r&&this._updateClassName()},d.toggle=function(e,t){var o=this.contains(e+=""),i=o?!0!==t&&"remove":!1!==t&&"add";return i&&this[i](e),!0===t||!1===t?t:!o},d.toString=function(){return this.join(" ")},n.defineProperty){d={get:e,enumerable:!0,configurable:!0};try{n.defineProperty(i,t,d)}catch(e){-2146823252===e.number&&(d.enumerable=!1,n.defineProperty(i,t,d))}}else n[o].__defineGetter__&&i.__defineGetter__(t,e)}}(self)),Date.prototype.Format=function(e){var t,o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(t in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?o[t]:("00"+o[t]).substr((""+o[t]).length)));return e};var t="https://open.ys7.com",s="https://log.ys7.com/statistics.do",l=t+"/sdk/js/2.0/js/ckplayer/ckplayer.js",d=t+"/sdk/js/2.0/js/ckplayer/ckplayer.swf",u=t+"/sdk/js/2.0/js/ckplayer/m3u8.swf",p=t+"/sdk/js/2.0/js/flv.min.js",f=t+"/sdk/js/2.0/js/hls.min.js",g=t+"/sdk/js/2.0/js/jsmpeg.min.js",m=t+"/sdk/js/2.0/js/wav-audio-encoder.js",n="https:"===h.location.protocol,v=!!navigator.userAgent.match(/(iPhone|iPod|iPad|Android|ios|SymbianOS)/i),r=document.createElement("video"),y=!!r.canPlayType&&!!h.addEventListener,a=y&&r.canPlayType("application/vnd.apple.mpegURL"),S="open_netstream_play_main";function E(e){var t,o={Ver:"v.2.4.5",PlatAddr:h.location.protocol+"//"+h.location.host,ExterVer:"Ez.2.4.5",CltType:102,StartTime:(new Date).Format("yyyy-MM-dd hh:mm:ss.S"),OS:navigator.platform};for(t in e)o[t]=e[t];var i,n=[];for(i in o)n.push(i+"="+o[i]);var r="?"+n.join("&");(new Image).src=s+r}E({systemName:"open_netstream_localinfo"});var w=/^rtmp/;function b(e,t){var o=document.createElement("script");o.setAttribute("src",e),o.onload=t,document.getElementsByTagName("head")[0].appendChild(o)}function P(e,t,o,n,r){var e=e,s=new XMLHttpRequest;s.onreadystatechange=function(){var e;4==s.readyState&&200==s.status&&(e=JSON.parse(s.responseText),r(e))},s.open(t,e,!0);var a=new FormData;for(i in o)a.append(i,o[i]);s.send(a)}function k(e,t){e=new RegExp("(\\?|#|&)"+e+"=(.*?)(#|&|$)"),e=(t||location.href).match(e);return decodeURIComponent(e?e[2]:"")}function j(e){return e&&("object"===(void 0===e?"undefined":T(e))||"function"==typeof e)&&"function"==typeof e.then}t=function(o,e){if(this.config=e,!y)throw new Error("不支持ie8等低版本浏览器");if(this.config.jqueryJS,l=this.config.ckplayerJS,d=this.config.ckplayerSWF,u=this.config.m3u8SWF,p=this.config.flv_js,f=this.config.hlsJS,g=this.config.mpegJS,m=this.config.wav,this.opt={},this.opt.sources=[],this.handlers={},"object"===(void 0===o?"undefined":T(o))&&o.hasOwnProperty("decoderPath")){if("string"!=typeof o.decoderPath||void 0===o.decoderPath)throw new Error("EZUIDecoder requires the path of decoder");if("string"!=typeof o.id||void 0===o.id)throw new Error("EZUIDecoder requires parameter id");if("string"!=typeof o.url||void 0===o.url)throw new Error("EZUIDecoder requires parameter url");this.opt.sources.push(o.url),this.opt.currentSource=this.opt.sources[0];o.env&&o.env.domain,this.jSPlugin={};var i=this,t=this.getRealUrl(o);j(t)&&t.then(function(e){var t=i.initDecoder(o);j(t)&&!1!==o.autoplay&&t.then(function(e){i.play({handleError:o.handleError,handleSuccess:o.handleSuccess})})}).catch(function(e){var t=i.initDecoder(o);j(t)&&!1!==o.autoplay&&t.then(function(){})})}else{var n="";if("string"==typeof o?n=o:"object"===(void 0===o?"undefined":T(o))&&(n=o.id),this.videoId=n,this.video=document.getElementById(n),!this.video)throw new Error("EZUIPlayer requires parameter videoId");var r=this.video.getElementsByTagName("source"),r=Array.prototype.slice.call(r,0);this.video.src&&(v&&w.test(this.video.src)?(this.video.removeAttribute("src"),this.video.load()):this.opt.sources.push(this.video.src));var s=r.length;if(0<s)for(var a=0;a<s;a++)v&&w.test(r[a].src)?this.video.removeChild(r[a]):this.opt.sources.push(r[a].src);if(this.opt.sources.length<1)throw new Error("no source found in video tag.");this.opt.cur=0,this.opt.poster=this.video.poster;e=(c=this.video,h.getComputedStyle?h.getComputedStyle(c,null):c.currentStyle),t=this.video.width,c=this.video.height;t?(this.opt.width=t,this.opt.height=c||"auto",this.log("video width:"+this.opt.width+" height:"+this.opt.height)):(this.opt.width=e.width,this.opt.height=e.height,this.log("videoStyle.width:"+e.width+" wideoStyle.height:"+e.height)),this.opt.parentId=n,this.opt.autoplay=!!this.video.autoplay,this.log("autoplay:"+this.video.autoplay),this.opt.currentSource=this.opt.sources[this.opt.cur],this.getRealUrl(o)}var c;this.handlers={},this.initTime=(new Date).getTime(),this.on("play",function(){E({systemName:S,playurl:this.opt.currentSource,Time:(new Date).Format("yyyy-MM-dd hh:mm:ss.S"),Enc:0,PlTp:1,Via:2,ErrCd:0,Cost:(new Date).getTime()-this.initTime})}),this.retry=2,this.on("error",function(){E({systemName:S,playurl:this.opt.currentSource,cost:-1,ErrCd:-1})})};t.prototype.on=function(e,t){"string"==typeof e&&"function"==typeof t&&(void 0===this.handlers[e]&&(this.handlers[e]=[]),this.handlers[e].push(t))},t.prototype.emit=function(){if(this.handlers[arguments[0]]instanceof Array)for(var e=this.handlers[arguments[0]],t=e.length,o=0;o<t;o++)e[o].apply(this,Array.prototype.slice.call(arguments,1))},t.prototype.log=function(e,t){this.emit("log",e,t)},t.prototype.getRealUrl=function(c){var t=this,l="https://open.ys7.com";if(c&&c.env&&(l=c.env.domain),c&&c.hasOwnProperty("decoderPath")){var i=function(t,o,e){var i,n,r,s,a="";/^ezopen:\/\//.test(e)?(i=l+"/jssdk/ezopen/getStreamToken?accessToken="+c.accessToken+"&num=10&type="+(-1!==c.url.indexOf("live")?"live":"playback"),n=function(e){if(0!==e.retcode)throw c&&c.handleError&&c.handleError(e),o(JSON.stringify(e)),new Error("获取播放token失败");a=a+e.data.params+"&ssn="+e.data.tokens[0],t(a)},r=l+"/api/lapp/live/url/ezopen",s="false",s=c&&c.env&&c.env.domain?-1!==c.env.domain.indexOf("https")?"false":"true":-1!==h.location.href.indexOf("https")?"false":"true",P(r,"POST",{ezopen:e,userAgent:h.navigator.userAgent,isFlv:!1,addressTypes:null,isHttp:s,accessToken:c.accessToken},0,function(e){var t;200==e.code||0==e.retcode?(a+=e.data,-1!==e.data.indexOf("playback")&&(a=k("begin",e.data)?a.replace("&begin="+k("begin",e.data),"&begin="+d(k("begin",e.data),"000000")):(t=new Date,a+"&begin="+t.Format("yyyyMMdd")+"T000000Z"),a=k("end",e.data)?a.replace("&end="+k("end",e.data),"&end="+d(k("end",e.data),"235959")):(t=new Date,a+"&end="+t.Format("yyyyMMdd")+"T235959Z"),k("stream",e.data)||(a=a.replace("stream","&stream"))),P(i,"GET","",0,n)):(c&&c.handleError&&c.handleError(e),o(JSON.stringify(e),"error"))})):t(e)},e=c.url.split(","),n=[];return e.map(function(e,t){var o;n.push((o=e,new Promise(function(e,t){return i(e,t,o)})))}),Promise.all(n).then(function(e){t.opt.sources=e,t.opt.currentSource=e[0]}).catch(function(e){t.log("获取真实地址错误"+JSON.stringify(e),"error")})}if(this.opt.currentSource)if(/^ezopen:\/\//.test(this.opt.currentSource)){if(!/^ezopen:\/\//.test(this.opt.currentSource))throw new Error("EZOPEN地址必须要以ezopen://开头");if(-1===this.opt.currentSource.indexOf(".com/"))throw new Error("EZOPEN地址格式不正确");if(!/[a-z\d]{32}(\.hd)?\.live/.test(this.opt.currentSource))throw new Error("EZOPEN地址格式uuid格式不正确");if(/(.*.hls.*|.*.m3u8.*|.*.wss.*|.*.flv.*|.*.rtmp.*){2,}/.test(this.opt.currentSource))throw new Error("EZOPEN地址多于两个播放协议");if(-1!==this.opt.currentSource.search(/(.hls|.m3u8|.wss|.flv|.rtmp)/)&&!/.live(.hls|.m3u8|.wss|.flv|.rtmp)/.test(this.opt.currentSource))throw new Error("请指定正确的播放协议");if(-1===this.opt.currentSource.search(/(.hls|.m3u8|.wss|.flv|.rtmp)/)&&!/[a-z\d]{32}(\.hd)?\.live$/.test(this.opt.currentSource))throw new Error("EZOPEN地址结尾不正确");var o=this;b(p,function(){var e={ezopen:o.opt.currentSource,userAgent:h.navigator.userAgent,isFlv:!(!flvjs||!flvjs.isSupported())&&flvjs.isSupported(),addressTypes:"HLS,RTMP,WS,FLV",isHttp:!(0<h.location.protocol.indexOf("s"))};E({ezopen:o.opt.currentSource,userAgent:h.navigator.userAgent,isFlv:!(!flvjs||!flvjs.isSupported())&&flvjs.isSupported(),addressTypes:"HLS,RTMP,WS,FLV",isHttp:!(0<h.location.protocol.indexOf("s")),systemName:"EZOPEN"}),o.log("---------------------------------------"),o.log("入参(ezopen)是：   "+e.ezopen),o.log("---------------------------------------"),o.log("入参(userAgent)是：   "+e.userAgent),o.log("---------------------------------------"),o.log("入参(isFlv)是：   "+e.isFlv),o.log("---------------------------------------"),o.log("入参(addressTypes)是：   "+e.addressTypes),o.log("---------------------------------------"),o.log("入参(isHttp)是：   "+e.isHttp),o.log("---------------------------------------");P(l+"/api/lapp/live/url/ezopen","POST",e,0,function(e){if(200!=e.code)throw o.log("data：   "+JSON.stringify(e)),new Error(e.msg);o.log("播放地址是：   "+e.data),o.video.src=e.data,o.video.load(),o.tryPlay(e.data)})})}else this.tryPlay(this.opt.currentSource);else this.log("未找到合适的播放URL","error");function d(e,t){if(/^[0-9]{8}T[0-9]{6}Z$/.test(e))return e;if(/[0-9]{8,14}/.test(e)){var o=6-(14-e.length),i=t.length,i=e+t.substring(o,i);return i.slice(0,8)+"T"+i.slice(8)+"Z"}throw new Error("回放时间格式有误，请确认")}},t.prototype.tryPlay=function(e){this.log("开始尝试播放，播放配置参数为："),this.log(e);var t,o;e&&"object"===(void 0===e?"undefined":T(e))&&e.decoderPath||(this.opt.currentSource=e,t=this,/\.m3u8/.test(e)?v||a?(this.log("使用原生video"),this.video.style.heght=this.opt.height=9*Number(this.opt.width.replace(/px$/g,""))/16+"px",this.initVideoEvent()):(o=-1!==e.indexOf("https"),n&&!o?b(l,function(){t.initCKPlayer()}):b(f,function(){Hls.isSupported()?(t.log("使用hls.js"),t.initHLS(e)):(t.log("2 使用flash"),b(l,function(){t.initCKPlayer()}))})):/^rtmp:/.test(e)?v?(this.opt.cur++,this.tryPlay(e)):b(l,function(){t.initCKPlayer(e)}):/^wss:|^ws:/.test(e)?-1<(o=navigator.userAgent).indexOf("compatible")&&-1<o.indexOf("MSIE")?alert("WS协议不支持Ie11以下的浏览器！请使用IE11，或者更高版本的浏览器"):b(g,function(){t.initJSmpeg(e)}):/\.flv/.test(this.opt.currentSource)&&b(p,function(){t.log("使用flv.js播放"),t.initflv()}))},t.prototype.initHLS=function(e){var t=this,o=new Hls({defaultAudioCodec:"mp4a.40.2"});o.loadSource(e),o.attachMedia(this.video),o.on(Hls.Events.MANIFEST_PARSED,function(){t.opt.autoplay&&t.video.play(),t.initVideoEvent()}),o.on(Hls.Events.ERROR,function(e,t){if(t.fatal)switch(t.type){case Hls.ErrorTypes.NETWORK_ERROR:console.log("fatal network error encountered, try to recover"),o.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:console.log("fatal media error encountered, try to recover"),o.recoverMediaError();break;default:o.destroy()}}),this.hls=o},t.prototype.initCKPlayer=function(e){this.log("ckplayer初始化");var t=this,o={play:function(){t.emit("play")},pause:function(){t.emit("pause")},error:function(){t.emit("error")}};h.ckplayer_status=function(){t.log(arguments),o[arguments[0]]&&o[arguments[0]]()},this.videoFlash=document.createElement("DIV"),this.video.parentNode.replaceChild(this.videoFlash,this.video),this.video=this.videoFlash,this.videoFlash.id=this.opt.parentId;var i=null,i=/^rtmp/.test(this.opt.currentSource)?{f:this.opt.currentSource,c:0,p:this.opt.autoplay?1:0,i:this.opt.poster,lv:1,loaded:"loadHandler"}:/\.m3u8/.test(this.opt.currentSource)?{s:4,f:u,a:this.opt.currentSource,c:0,lv:1,p:this.opt.autoplay?1:0,i:this.opt.poster,loaded:"loadHandler"}:{f:this.opt.currentSource,c:0,p:1,loaded:"loadHandler"};this.flashId=this.opt.parentId+"flashId",h.CKobject.embedSWF(d,this.opt.parentId,this.flashId,this.opt.width,this.opt.height,i,{bgcolor:"#FFF",allowFullScreen:!0,allowScriptAccess:"always",wmode:"transparent"})},t.prototype.initVideoEvent=function(){var e,t,o,i,n,r=this,s={loadstart:function(e){r.log("loadstart...当浏览器开始查找音频/视频时..."),r.emit("loadstart",e)},durationchange:function(e){r.log("durationchange...当音频/视频的时长已更改时..."),r.emit("durationchange",e)},loadedmetadata:function(e){r.log("loadedmetadata...当浏览器已加载音频/视频的元数据时..."),r.emit("loadedmetadata",e)},loadeddata:function(e){r.log("loadeddata...当浏览器已加载音频/视频的当前帧时..."),r.emit("loadeddata",e)},progress:function(e){r.log("progress...当浏览器正在下载音频/视频时..."),r.emit("progress",e)},canplay:function(e){r.log("canplay...当浏览器可以播放音频/视频时..."),r.emit("canplay",e)},canplaythrough:function(e){r.log("canplaythrough...当浏览器可在不因缓冲而停顿的情况下进行播放时..."),r.emit("canplaythrough",e)},abort:function(e){r.log("abort...当音频/视频的加载已放弃时..."),r.emit("abort",e)},emptied:function(e){r.log("emptied...当目前的播放列表为空时..."),r.emit("emptied",e)},ended:function(e){r.log("ended...当目前的播放列表已结束时..."),r.emit("ended",e)},pause:function(e){r.log("pause...当音频/视频已暂停时..."),r.emit("pause",e)},play:function(e){r.log("play...当音频/视频已开始或不再暂停时..."),r.emit("play",e)},playing:function(e){r.log("playing...当音频/视频在已因缓冲而暂停或停止后已就绪时..."),r.emit("playing",e)},ratechange:function(e){r.log("ratechange...当音频/视频的播放速度已更改时..."),r.emit("ratechange",e)},seeked:function(e){r.log("seeked...当用户已移动/跳跃到音频/视频中的新位置时..."),r.emit("seeked",e)},seeking:function(e){r.log("seeking...当用户开始移动/跳跃到音频/视频中的新位置时..."),r.emit("seeking",e)},stalled:function(e){r.log("stalled...当浏览器尝试获取媒体数据，但数据不可用时..."),r.emit("stalled",e)},suspend:function(e){r.log("suspend...当浏览器刻意不获取媒体数据时..."),r.emit("suspend",e),r.opt.autoplay&&r.video.play()},timeupdate:function(e){r.emit("timeupdate",e)},volumechange:function(e){r.log("volumechange...当音量已更改时..."),r.emit("volumechange",e)},waiting:function(e){r.log("waiting...当视频由于需要缓冲下一帧而停止..."),r.emit("waiting",e)},error:function(e){r.log("error...当在音频/视频加载期间发生错误时..."),r.emit("error",e)}};for(e in s)this.video.addEventListener(e,s[e],!1);t=this.video,i=o=!1,n=0,t.addEventListener("loadeddata",function(){o=!0},!1),t.addEventListener("stalled",function(){n++,i||2<=n&&!o&&(t.load(),t.play(),i=o=!1,n=0)},!1),t.addEventListener("playing",function(){i=!0})},t.prototype.initJSmpeg=function(e){var t;this.canvasEle=document.createElement("canvas"),this.canvasEle.style.width=this.opt.width,this.canvasEle.style.height=this.opt.height,this.video.parentNode.replaceChild(this.canvasEle,this.video),this.canvasEle.id=this.opt.parentId,t&&t.destroy&&t.destroy(),t=new JSMpeg.Player(e,{canvas:this.canvasEle}),this.JSmpeg=t},t.prototype.initflv=function(){if(!flvjs.isSupported())throw this.log("浏览器不支持flv播放"),new Error("浏览器不支持flv播放");var e=this.video;e.getAttribute("controls")||e.setAttribute("controls",!0);var t=flvjs.createPlayer({type:"flv",url:this.opt.currentSource,isLive:!0},{enableStashBuffer:!0,stashInitialSize:128,enableWorker:!0});t.attachMediaElement(e),t.load(),t.play(),this.flv=t},t.prototype.play=function(i){var n,r;h.CKobject?(this.opt.autoplay=!0,this.initCKPlayer()):this.video?this.hls?(this.opt.autoplay=!0,this.hls.startLoad(),this.video.play()):this.JSmpeg?this.JSmpeg.play():(this.opt.autoplay=!0,this.video.play()):this.jSPlugin&&(n=function(e){return{websocketConnectUrl:e.split("?")[0].replace("/live","").replace("/playback",""),websocketStreamingParam:(-1===e.indexOf("/live")?"/playback?":"/live?")+e.split("?")[1]}},r=this,i&&void 0!==i.index?i.index.forEach(function(e,t){r.jSPlugin.JS_Play(n(r.opt.sources[e]).websocketConnectUrl,{playURL:n(r.opt.sources[e]).websocketStreamingParam},e).then(function(){r.log("播放成功，当前播放第"+(t+1)+"路"),0===t&&(r.log("默认开启第一路声音"),setTimeout(function(){r.jSPlugin.JS_OpenSound(0)},100)),i&&i.handleSuccess&&i.handleSuccess()},function(e){r.log("播放失败"+JSON.stringify(e),"error"),i&&i.handleError&&(e=e.oError,i.handleError(e))})}):r.opt.sources.forEach(function(o,e){r.log("开始播放, 第"+(e+1)+"路，地址："+o);var t=k("checkCode",o);t&&(r.log("设置秘钥，视频路数："+(e+1)+"验证码："+t),r.jSPlugin.JS_SetSecretKey(e,t)),r.jSPlugin.JS_Play(n(o).websocketConnectUrl,{playURL:n(o).websocketStreamingParam},e).then(function(){r.log("播放成功，当前播放第"+(e+1)+"路"),0===e&&(r.log("默认开启第1路声音"),setTimeout(function(){r.jSPlugin.JS_OpenSound(0)},100)),i&&i.handleSuccess&&i.handleSuccess(),E({systemName:S,playurl:encodeURIComponent(o),Time:(new Date).Format("yyyy-MM-dd hh:mm:ss.S"),Enc:0,PlTp:1,Via:2,ErrCd:0,Cost:(new Date).getTime()-r.initTime,Serial:k("dev",o),Channel:k("chn",o)})},function(t){var e;r.log("播放失败"+JSON.stringify(t),"error"),E({systemName:S,playurl:encodeURIComponent(o),cost:-1,ErrCd:-1,Serial:k("dev",o),Channel:k("chn",o)}),i&&i.handleError&&(e=JSON.parse(r.errorCode).find(function(e){return e.detailCode.substr(-4)==t.oError.errorCode}),i.handleError({retcode:t.oError.errorCode,msg:e?e.description:"其他错误"}))})}))},t.prototype.initDecoder=function(n){this.opt.id=n.id,this.log("初始化解码器---开始");var r=this;return new Promise(function(e,t){var o;function i(e){if(200==e.code){if(!h.localStorage)return!1;var t=h.localStorage;t.errorCode=JSON.stringify(e.data),r.errorCode=t.errorCode}}b(n.decoderPath+"/js/jsPlugin-1.2.0_test.js",function(){r.log("下载解码器完成，开始初始化"),r.jSPlugin=new JSPlugin({szId:n.id,iType:1,iWidth:n.width||600,iHeight:n.height||400,iMaxSplit:Math.ceil(Math.sqrt(n.url.split(",").length)),iCurrentSplit:n.splitBasis||Math.ceil(Math.sqrt(n.url.split(",").length)),szBasePath:n.decoderPath+"/js"}),h.onresize=function(){r.jSPlugin.JS_Resize(n.width||600,n.height||400)},r.log("初始化解码器----完成"),e("200 OK")}),h.localStorage&&(o=h.localStorage).errorCode?r.errorCode=o.errorCode:P(n.decoderPath+"/js/errorCode.json","get",{language:1,time:(new Date).getTime(),appKey:"26810f3acd794862b608b6cfbc32a6b8"},0,i)})},t.prototype.stop=function(e){if(this.log("停止播放"+this.opt.currentSource),this.opt.autoplay=!1,h.CKobject)this.video.src="";else if(this.video)this.hls?(this.video.pause(),this.video.src="",this.hls.stopLoad()):this.flv?(this.flv.pause(),this.flv.unload(),this.flv.detachMediaElement(),this.flv.destroy(),this.flv=null):this.JSmpeg&&this.JSmpeg.stop();else if(this.jSPlugin){function t(e){for(var t=document.getElementById(n.opt.id).childNodes[0].childNodes[e],o=t.childNodes,i=o.length-1;0<=i;i--)t.removeChild(o[i])}var n=this;if(void 0===e){var o=this.opt.sources.length;for(index=0;index<o;index++)this.jSPlugin.JS_Stop(index).then(function(){n.log("停止播放成功"+n.opt.currentSource),console.log("stop success")},function(){n.log("停止播放失败"+n.opt.currentSource),console.log("stop failed")}),t(index)}else this.jSPlugin.JS_Stop(e).then(function(){n.log("停止播放成功"+n.opt.currentSource),console.log("stop success")},function(){n.log("停止播放失败"+n.opt.currentSource),console.log("stop failed")}),t(e)}},t.prototype.getOSDTime=function(t,e){if(!this.jSPlugin)throw new Error("Method  not support");this.jSPlugin.JS_GetOSDTime(e||0).then(function(e){t(1e3*e)},function(e){console.log("get OSD Time error",e)})},t.prototype.openSound=function(e){if(!this.jSPlugin)throw new Error("Method  not support");this.jSPlugin.JS_OpenSound(e||0)},t.prototype.capturePicture=function(e,t){if(!this.jSPlugin)throw new Error("Method  not support");this.jSPlugin.JS_CapturePicture(e,t)},t.prototype.startSave=function(e,t){if(!this.jSPlugin)throw new Error("Method  not support");this.log("开始录制录像"),this.jSPlugin.JS_StartSave(e,t)},t.prototype.stopSave=function(e){if(!this.jSPlugin)throw new Error("Method  not support");this.jSPlugin.JS_StopSave(e),this.log("结束录制录像")},t.prototype.pause=function(){this.opt.autoplay=!1,h.CKobject?CKobject.getObjectById(this.flashId).videoPause():this.video?(this.JSmpeg||this.video).pause():this.jSPlugin&&this.jSPlugin.JS_Pause(0).then(function(){},function(){})},t.prototype.load=function(){h.CKobject||this.video&&this.video.load()};var c={init:function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,h.AudioContext=h.AudioContext||h.webkitAudioContext},log:function(e){console.log.apply(console,arguments)}},r=function(e){if(e&&"object"!==(void 0===e?"undefined":T(e)))throw new Error("EZUITalk requires parameter it doesn't right");var t=e.id,o=e.token,i=e.uuid;if("string"!=typeof t||void 0===t)throw new Error("EZUITalk requires parameter audioId");if(this.audio=document.getElementById(t),!this.audio)throw new Error("EZUITalk requires parameter audioElement");if(!o)throw new Error("EZUITalk requires parameter accessToken");if(!i)throw new Error("EZUITalk requires parameter uuid");if(c.init(),!navigator.getUserMedia)throw new Error("当前浏览器不支持录音功能");if(!{trident:-1<(t=h.navigator.userAgent).indexOf("Trident"),presto:-1<t.indexOf("Presto"),webKit:-1<t.indexOf("AppleWebKit"),gecko:-1<t.indexOf("Gecko")&&-1===t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:-1<t.indexOf("Android")||-1<t.indexOf("Adr"),iPhone:-1<t.indexOf("iPhone"),iPad:-1<t.indexOf("iPad"),webApp:-1==t.indexOf("Safari"),weixin:-1<t.indexOf("MicroMessenger"),qq:" qq"==t.match(/\sQQ/i),ie:-1<t.indexOf("Trident")||-1<t.indexOf("MSIE")||-1<t.indexOf("compatible")}.mobile)throw new Error("对讲功能仅在手机中支持进行对讲");this.handlers={};var r=this;this.BUFFER=[],this.encoder=void 0,this.isEnded=!0,this.LENGTH=20,this.audio.addEventListener("ended",function(){r.isEnded=!0}),this.audioPlay=function(){if(this.isEnded){this.isEnded=!1,this.BUFFER.length>this.LENGTH&&(this.BUFFER=this.BUFFER.slice(0,this.LENGTH)),this.encoder=new WavAudioEncoder(16e3,1);for(var e=this.BUFFER.shift();e;)this.encoder.encode(e),e=this.BUFFER.shift();this.audio.src=URL.createObjectURL(this.encoder.finish())}},this.start=function(){this.wsUrl="wss://test2.ys7.com:20007/opentalk/"+i,this.socket=new WebSocket(this.wsUrl),this.talk()},this.talk=function(){b(m,function(){r.socket.onopen=function(){r.log("websocket已连接");var e=JSON.stringify({accessToken:o,uuid:i});r.socket.send(e),r.log("websocket 发送文本数据"),r.startRecord()},r.socket.onclose=function(){r.log("websocket已关闭")},r.socket.onerror=function(e){r.log("websocket出错->"+JSON.stringify(e))},r.socket.onmessage=function(e){r.log("websocket 接收数据"),r.BUFFER.push(e.data),r.audioPlay()},r.audio.setAttribute("autoplay",!0),r.audio.play()})},this.startRecord=function(){navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){var t=new AudioContext,o=t.createMediaStreamSource(e),i=t.createScriptProcessor(16384,1,1);r.log("当前浏览器采样率为： "+t.sampleRate),i.onaudioprocess=function(e){e=e.inputBuffer.getChannelData(0);n.postMessage({cmd:"encode",buf:e})};var n=new Worker("../js/worker.js");n.onmessage=function(e){"pcm"===e.data.cmd?(r.socket.send(e.data.buf),console.log(e.data.buf),r.log("websocket 发送数据")):r.log("未知信息："+e.data)},i&&o&&(o.connect(i),i.connect(t.destination)),r.log("开始对讲"),r.stop=function(){i&&o&&(o.disconnect(),i.disconnect()),r.socket.close(),r.log("结束对讲")}}).catch(function(e){var t;switch(e.code||e.name){case"PermissionDeniedError":case"PERMISSION_DENIED":case"NotAllowedError":t="用户拒绝访问麦克风";break;case"NOT_SUPPORTED_ERROR":case"NotSupportedError":t="浏览器不支持麦克风";break;case"MANDATORY_UNSATISFIED_ERROR":case"MandatoryUnsatisfiedError":t="找不到麦克风设备";break;default:t="无法打开麦克风，异常信息:"+(e.code||e.name)}r.log(t),alert(t)})}};r.prototype.on=function(e,t){"string"==typeof e&&"function"==typeof t&&(void 0===this.handlers[e]&&(this.handlers[e]=[]),this.handlers[e].push(t))},r.prototype.emit=function(){if(this.handlers[arguments[0]]instanceof Array)for(var e=this.handlers[arguments[0]],t=e.length,o=0;o<t;o++)e[o].apply(this,Array.prototype.slice.call(arguments,1))},r.prototype.log=function(e){this.emit("log",e)};r={EZUIPlayer:t,EZUITalk:r};return e||(h.EZUIKit=r,h.EZUIPlayer=t),r}),O.exports});;
Cube("datav:/com/ez-player/1.3.10",["datav:/npm/bcore/0.0.18/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.6.1"],function(t,e,i,n,r,o){var a=i("datav:/npm/bcore/0.0.18/event"),s=i("datav:/npm/jquery/2.1.4"),h=i("datav:/npm/lodash/4.6.1"),c=i("datav:/com/ez-player/1.3.10/lib/ezuikit"),u=h.template('<video id="<%= id %>"  poster="" controls playsInline webkit-playsinline autoplay style="width: 100%;height: 100%;">\n<source src="<%= source %>" type="<%= type %>" />\n</video>');return t.exports=a.extend(function(t,e){this.config={hideControl:!1,isLoop:!1,isMuted:!1},this.container=s(t),this.apis=e.apis,this._data=null,this.chart=null,this.init(e)},{init:function(t){this.mergeConfig(t),this.updateLayout(),this.observeStyle()},clearSource:function(){this.container.find("video").attr("src",""),this.container.find("video source").attr("src","")},observeStyle:function(){var e=this;new MutationObserver(function(t){t.forEach(function(t){"attributes"==t.type&&"block"===h.get(t.target,"style.display")&&e.render(null,e.config)})}).observe(s(this.container).parent()[0],{attributes:!0,attributeFilter:["style"]})},render:function(t,e){var e=this.mergeConfig(e),i=((t=this.data(t))&&t[0]&&t[0].source?t[0]:e).source,t=e.sourceType;if(i){switch(t){case"rtmp":0;break;case"hls":0}t=function(t,e,i){var n="",r=e,o=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];t&&(r=Math.round(Math.random()*(i-e))+e);for(var a=0;a<r;a++){var s=Math.round(Math.random()*(o.length-1));n+=o[s]}return n}(!1,5);this.container.html(u({width:this.container.width(),height:this.container.height(),type:e.type,source:i,id:t})),this.container.find("video").attr({controls:!e.hideControl,loop:e.isLoop}),this.container.find("video")[0].muted=this.config.isMuted;e=new c.EZUIPlayer(t,{jqueryJS:e.jqueryJS,flv_js:e.flv_js,mpegJS:e.mpegJS,wav:e.wav,ckplayerSWF:e.swf,m3u8SWF:e.m3u8,ckplayerJS:e.ckplayerJS,hlsJS:e.hlsJS});e.on("error",function(){}),e.on("play",function(){}),e.on("pause",function(){}),this.player=e}},resize:function(t,e){this.render()},data:function(t){return t&&(this._data=t),this._data},mergeConfig:function(t){return t&&(this.config.theme=h.defaultsDeep(t.theme||{},this.config.theme),this.config=h.defaultsDeep(t||{},this.config)),this.config},updateLayout:function(){},clear:function(){this.destroy()},destroy:function(){this.player&&this.player.stop&&this.player.stop(),this.container.empty(),this._data=null,this.player=null}}),t.exports});