// env=undefined => env=publish 
Cube("datav:/com/datavmap-3d-layer-flashpoint/0.0.12/texture/point-texture.js",[],function(a){return a.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAADqUlEQVR4nO3bzWtcVRjH8c+9iy6k6YsoKL5EfG0VROzGYLsvunBju2iV1mKpG013/RMUTBGLm4JUi5iFWblQu5fiShcFTRNSoRVRSGgb01VcXBdnxplOZjIz9965ZzLTL2SRyc25v+fhnDPnPC9JlmUGzCOYwl7swbN4CDsxUXtmDav4G4u4inn8hD8HKS4ZkAP24QheE4wuwlV8j1n8XHCsDZTpgAmcwjt4vqxBW/gNX+C8MGsKU4YDdmEaH+D+wop64ybO4VPcLjRSlmV5f5Isy45nWbacxWO5piHJctqRdwY8jS/xaiHvl8dlHMO1fv8xzfGyQ8JmNCzGE7T8Imjri34ckGAG32BHvy+qgB2CthlBa0/0ugS2CbvvkVzSqmdW+DZa7/ZgLw7Yhm9xsLiuSrmEN3RxQrclkOCCrWc8QfMFXZZDNwd8iKNlKYrAUXy02QObLYE3MVe2okgc1sGWTg54Uvha2TlAUVWyipfxe+sf2i2BBBeNjvEEWy5qsx+0c8Ax7B+0ogjsx/HWD1uXwC7hPv5gNZoqZ1mIR/x/gWqdAdNG13iCbdPNHzTPgO24rrorbSxu4gm1eELzDHjP6BtPsPFU/Zf6DEiwgGciiaqaJWEvyOozYMr4GE+IZ0zRWAJ936NHgMM0HLAVLztFOUjYAx7FH5HFxOLxFK/EVhGRqRQvxVYRkRdTIWU1ruxNMRlbRUQmUzwcW0VEHkg1MrTjyPYky5kaGhHW82SGRopUSWnmLcrauDvgToq/YquIyEoqRIHGleupUIw0rsynuBJbRUSuJFmWPYYbsZVEYjIVYgELsZVEYBE36gehSzGVROIHGiGxUckC98Mcd4fFF4Vo6TiwISyeCdWX48J5wea7UmMTwqFodyRRVXFLCAJtSI2tCaWno845TfefcUyP7xESpNiYHr+NM1UqqpgzmoynfY1Qgh8NVylsGVzGAbXNr06nIqmnhHrgUakTWhWaODYUU3cKiV3DyUEqqpiTOlSSbxYTnMPHA5FTLTM2Oel2qxVO8JWtWy36Nd7Wsu6buVcs3cNA67WBZksQVRWzejCe3hsm1vEWzhYQVRVnBa1djSdf19ghfG74ukb+wbv6vNrfa5rK+cIl4VR1Ais5xyiDlZqGA3IYT3mNk6fxvmobJz/DJwo2Tg6idfaEwVWdzAttMEPVOtuOfcIB5HXFw2xL+E44kA1183Qn6u3zL+A5jfb53bgP/+KOEKm5JcQjFvCrCtrn/wNSOM9t2Kc08QAAAABJRU5ErkJggg==",a.exports});;
Cube("datav:/com/datavmap-3d-layer-flashpoint/0.0.12/flashPointLayer.js",["datav:/npm/eventemitter3/2.0.3","datav:/npm/safely-merge/1.0.0","datav:/npm/chroma-js/1.3.7"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/2.0.3"),i=c("datav:/npm/safely-merge/1.0.0"),j=c("datav:/npm/chroma-js/1.3.7");return a.exports=function(a){var b=a.datavgl,k=b.THREE,l=a.glLayer||a,m=b.DataVModelTools.point2buffer,n=a.worldsize,o={blending:"AdditiveBlending",pointZ:0,pointTextureUrl:"",visibility:!0,minColor:"RGBA(43,185,255,0.86)",maxColor:"RGBA(235,25,251,0.82)",minSize:3.4,maxSize:10.4,maxLength:5e3,minTime:500,rangeTime:1,renderOrder:300};return function(a){function b(a){d(this,b);var c=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return a=i(o,a),c.options=i(c.options,a),c.min=-Infinity,c.max=Infinity,c.update=c.update.bind(c),c.data=[],c.init(),c}return f(b,a),g(b,[{key:"init",value:function(){this.initGeometry(),this.initMaterial(),this.points=new k.Points(this.geometry,this.material),this.points.name="points layer",this.points.position.setZ(this.options.pointZ),this.points.renderOrder=this.options.renderOrder,this.points.frustumCulled=!1,this.points.visibility=this.options.visibility,l.offsetNode.add(this.points),l.on("runAnimation",this.update)}},{key:"initGeometry",value:function(){return this.geometry=new k.BufferGeometry,this.geometry.addAttribute("position",new k.BufferAttribute(new Float32Array(3*this.options.maxLength),3)),this.geometry.addAttribute("size",new k.BufferAttribute(new Float32Array(this.options.maxLength),1)),this.geometry.addAttribute("color",new k.BufferAttribute(new Float32Array(4*this.options.maxLength),4)),this.geometry.setDrawRange(0,0),this.geometry.needsOffset=!0,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this.geometry.computeVertexNormals(),this.geometry}},{key:"initMaterial",value:function(){var a=c("datav:/com/datavmap-3d-layer-flashpoint/0.0.12/texture/point-texture.js");this.options.pointTextureUrl&&(a=this.options.pointTextureUrl),this.uniforms={sizeFactor:{value:window.devicePixelRatio||1},texture:{value:new k.TextureLoader().setCrossOrigin("*").load(a)}},this.material=new k.ShaderMaterial({uniforms:this.uniforms,transparent:!0,depthTest:!1,blending:k[this.options.blending],vertexShader:"\n            uniform float sizeFactor;\n            attribute float size;\n            attribute vec4 color;\n            varying vec4 vColor;\n            void main() {\n              vColor = color;\n              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n              gl_PointSize = size * sizeFactor;\n            }\n          ",fragmentShader:"\n            varying vec4 vColor;\n            uniform sampler2D texture;\n            void main() {\n              vec2 pt = gl_PointCoord;\n              //pt.y = 1.0 - pt.y;\n              gl_FragColor = vColor * texture2D(texture, pt);\n            }\n          "}),this.material.needsUpdate=!0}},{key:"scaleSizeAndColor",value:function(){var a=this,b=this.geometry.attributes.size,c=this.geometry.attributes.color,e=Math.abs(this.options.maxSize-this.options.minSize),f=j.scale([this.options.minColor,this.options.maxColor]).mode("hsl").domain([this.min,Math.pow((this.max-this.min)/(this.max-this.min),0.25)*(this.max-this.min)]);this.data.forEach(function(g,d){g.value=Math.floor(100*Math.random()),g.startTime=+new Date,g.duration=a.scaleTime(),0===a.range?(g.opacity=0.1,g.size=a.options.minSize):(g.opacity=Math.pow((g.value-a.min)/a.range,1/64)+0.1,g.size=Math.pow((g.value-a.min)/a.range,0.25)*e+a.options.minSize),b.setX(d,g.size),g.color=f(Math.pow((g.value-a.min)/(a.max-a.min),0.25)*(a.max-a.min)).gl(),c.setXYZW(d,g.color[0],g.color[1],g.color[2],g.color[3])}),this.geometry.attributes.size.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0}},{key:"scaleTime",value:function(){var a=0.1+1e3*(Math.random()*this.options.rangeTime)+this.options.minTime;return a}},{key:"update",value:function(){if(this.data&&this.geometry&&this.points.visibility){for(var a=this.geometry.attributes.size,b=void 0,c=0;c<this.data.length;c++){var e=this.data[c],d=(+new Date-e.startTime)/e.duration;0>d||2<d?(e.t=1,e.startTime=+new Date):1>=d?e.t=1-d:e.t=d-1,b=e.size*e.t,b||(b=1),a.setX(c,b)}this.geometry.attributes.size.needsUpdate=!0}}},{key:"calcRange",value:function(){var a=this.data;this.min=Math.min.apply(null,a.map(function(a){return a.value||0})),this.max=Math.max.apply(null,a.map(function(a){return a.value||0})),this.range=this.max-this.min}},{key:"setData",value:function(a){if(a.length){this.disposeGeometry();var b=m(a,{worldsize:n});this.geometry.needsOffset=!0;for(var c=this.geometry.attributes.position,d=0;d<b.positions.length;d+=3)c.setXYZ(Math.floor((d+1)/3),b.positions[d],b.positions[d+1],b.positions[d+2]),a[Math.floor((d+1)/3)].value||(a[Math.floor((d+1)/3)].value=20*Math.random()||1),a[Math.floor((d+1)/3)].x=b.positions[d],a[Math.floor((d+1)/3)].y=b.positions[d+1],a[Math.floor((d+1)/3)].z=b.positions[d+2];this.data=a,this.geometry.attributes.position.needsUpdate=!0,this.geometry.setDrawRange(0,Math.min(a.length,this.options.maxLength)),this.calcRange(),this.scaleSizeAndColor()}}},{key:"disposeGeometry",value:function(){this.geometry&&this.geometry.dispose()}},{key:"updateOptions",value:function(a){a.pointTextureUrl?a.pointTextureUrl!=this.options.pointTextureUrl&&(this.material.uniforms.texture.value=new k.TextureLoader().setCrossOrigin("*").load(a.pointTextureUrl),this.material.needsUpdate=!0):(this.material.uniforms.texture.value=new k.TextureLoader().setCrossOrigin("*").load(c("datav:/com/datavmap-3d-layer-flashpoint/0.0.12/texture/point-texture.js")),this.material.needsUpdate=!0),this.options=i(this.options,a),this.material.blending=k[this.options.blending],this.points.visibility=this.options.visibility,this.scaleSizeAndColor()}},{key:"show",value:function(){this.options.visibility=!0,this.points&&(this.points.visible=!0)}},{key:"hide",value:function(){this.options.visibility=!1,this.points&&(this.points.visible=!1)}},{key:"remove",value:function(){l.off("runAnimation",this.update),l.offsetNode.remove(this.points),this.geometry.dispose(),this.material.dispose(),this.points=null}}]),b}(h)},a.exports});;
Cube("datav:/com/datavmap-3d-layer-flashpoint/0.0.12",["datav:/npm/eventemitter3/2.0.3","datav:/npm/safely-merge/1.0.0"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/2.0.3"),i=c("datav:/npm/safely-merge/1.0.0"),j=c("datav:/com/datavmap-3d-layer-flashpoint/0.0.12/flashPointLayer.js"),k={},l=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.container="string"===typeof a?document.querySelector(a):a,f.apis=c.apis,f.map=null,f._data=null,f.config=c,f}return f(b,a),g(b,[{key:"init",value:function(){var a=this;this.map.loaded()&&this.map.isStyleLoaded()?(this.resetID&&clearTimeout(this.resetID),this.initLayer(),this.data&&this.render(this.data)):(this.resetID&&clearTimeout(this.resetID),this.resetID=setTimeout(function(){a.init()},100))}},{key:"initLayer",value:function(){var a=this.getOptions(),b=j(this.map);this.layer=new b(a)}},{key:"addTo",value:function(a){var b=this;this.map=a,this.resetID&&clearTimeout(this.resetID),this.init(),this.endID=setTimeout(function(){b.resetID&&clearTimeout(b.resetID)},100000)}},{key:"getOptions",value:function(){return this.config=i(k,this.config),this.config}},{key:"show",value:function(){this.config.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.config.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"remove",value:function(){this.endID&&clearTimeout(this.endID),this.resetID&&clearTimeout(this.resetID),this.layer&&this.layer.remove&&this.layer.remove(),this.layer=null,this._data=null}},{key:"render",value:function(a){a&&(this.data=a,this.layer&&this.layer.setData&&this.layer.setData(a))}},{key:"updateOptions",value:function(a){this.config=i(this.config,a),a=this.getOptions(),this.layer&&this.layer.updateOptions(a)}}]),b}(h);return a.exports=l,a.exports});