// env=undefined => env=publish 
Cube("datav:/com/datavmap-canvas2d-area/2.0.45/src/libs/geojson-bbox",[],function(a){function b(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function c(a){var d;return"Point"==a.type?d=[a.coordinates]:"LineString"==a.type||"MultiPoint"==a.type?d=a.coordinates:"Polygon"==a.type||"MultiLineString"==a.type?d=a.coordinates.reduce(function(a,c){return a.push.apply(a,b(c)),a},[]):"MultiPolygon"==a.type?d=a.coordinates.reduce(function(a,c){return a.push.apply(a,b(c.reduce(function(a,c){return a.push.apply(a,b(c)),a},[]))),a},[]):"Feature"==a.type?d=c(a.geometry):"GeometryCollection"==a.type?d=a.geometries.reduce(function(a,d){return a.push.apply(a,b(c(d))),a},[]):"FeatureCollection"==a.type&&(d=a.features.reduce(function(a,d){return a.push.apply(a,b(c(d))),a},[])),d}return a.exports=function(a){var b;if(a.hasOwnProperty("type"))return b=c(a),b.reduce(function(a,b){return[Math.min(b[0],a[0]),Math.min(b[1],a[1]),Math.max(b[0],a[2]),Math.max(b[1],a[3])]},[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY])},a.exports});;
Cube("datav:/com/datavmap-canvas2d-area/2.0.45/src/areaLayer",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1","datav:/npm/chroma-js/1.3.3","datav:/npm/polylabel/1.0.2","datav:/npm/rbush/3.0.0"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/npm/chroma-js/1.3.3"),k=c("datav:/npm/polylabel/1.0.2"),l=c("datav:/npm/rbush/3.0.0"),m=c("datav:/com/datavmap-canvas2d-area/2.0.45/src/libs/geojson-bbox"),n=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=i({tolerance:0,smoothFactor:1,bounds:null,stroke:!0,weight:5,zoomRange:[0,18],minZoom:0,maxZoom:18,defaultStyle:{fill:{minFillColor:"rgba(5, 96, 125, 0.8)",maxFillColor:"rgba(0, 255, 240, 0.5)",fillColor:"rgba(77, 77, 77, 0.5)"},stroke:{color:"#fff",weight:1,dashArray:""}},labelStyle:{show:!0,fieldName:"name",textStyle:{fontFamily:"Microsoft Yahei",fontSize:12,color:"#FFFFFF",fontWeight:"normal",shadowColor:"black",shadowBlur:5}},popupStyle:{isBorderShadow:!0,show:!0,infoField:!1,eventType:"click",styleType:"parent",textStyle:{fontFamily:"Microsoft Yahei",fontSize:12,color:"#FFFFFF",fontWeight:"normal"},lineHeight:1.4,borderRadius:5,margin:{top:10,bottom:10,left:10,right:10},backgroundColor:"rgba(22,138,214,0.73)",closeBtn:{color:"#fff",size:16,top:0,right:0}},interactive:{isHover:{show:!0,fillColor:"#FEE619",strokeColor:"green",weight:8},clickZoom:{zoomPad:1.5}}},c),f.options.minZoom=c.zoomRange[0],f.options.maxZoom=c.zoomRange[1],f.options.visibility=!0,f.map=a,f.init(),f}return f(b,a),g(b,[{key:"init",value:function(){this.container=document.createElement("canvas");var a=this.padding=this.map.canvasLayer&&this.map.canvasLayer.options&&this.map.canvasLayer.options.padding?this.map.canvasLayer.options.padding:0.1,b=this.map.getSize();this.offset=b.multiplyBy(-a).round();var c=b.x-2*this.offset.x,d=b.y-2*this.offset.y,e=this.map.devicePixelRatio||1;this.container.width=c*e,this.container.height=d*e,this.container.style.width=c+"px",this.container.style.height=d+"px",this.ctx=this.container.getContext("2d"),this.ctx.scale(e,e),this.geojson=null,this.clipGeojson=null,this.mappingData=[],this.rbush=new l,this.rbush.dirty=0,this.rbush.total=0,this.rbushInBounds=new l,this.featuresInBounds=[],this.popups={}}},{key:"onRender",value:function(a){this.ctx.clearRect(0,0,this.container.width,this.container.height),this.geojson&&(a&&"needUpdata"===a&&this.getFeaturesInBounds(),this.draw())}},{key:"onResize",value:function(a,b){var c=this.map.devicePixelRatio||1;this.container.width=a*c,this.container.height=b*c,this.container.style.width=a+"px",this.container.style.height=b+"px",this.ctx.scale(c,c)}},{key:"render",value:function(a){var b=this;a&&"{}"!=JSON.stringify(a)?a&&a.type&&a.api?fetch(a.api).then(function(a){return a.json()}).then(function(a){b.geojson=a,b.genGeojson()}):(this.geojson=a,this.genGeojson()):fetch(this.options.defaultArea).then(function(a){return a.json()}).then(function(a){b.geojson=a,b.genGeojson()})}},{key:"setMappingData",value:function(a){this.mappingData=a||[],this.range=this.getRange(),this.mappingDataMap={};for(var b=void 0,c=0;c<a.length;c++)b=a[c],this.mappingDataMap[b.area_id]=b;this.genGeojson()}},{key:"genGeojson",value:function(){var a=this;if(this.geojson&&this.geojson.features&&this.geojson.features.length){var b=this.options.defaultStyle.fill;this.range&&(this.colorScale=j.scale([b.minFillColor,b.maxFillColor]).domain(this.range));for(var c,d=null,e=JSON.parse(JSON.stringify(this.geojson)),f=[],g=0;g<e.features.length;g++)c=e.features[g],c.geometry&&c.geometry.coordinates&&0<c.geometry.coordinates.length&&f.push(c);e.features=f.map(function(c){d=d||c.properties.ad_code&&"ad_code",d=d||c.properties.adcode&&"adcode",d=d||c.properties.id&&"id",d=d||c.properties.name&&"name";var e=[];return a.mappingData&&(e=a.mappingData.find(function(a){return a.area_id==c.properties[d]})),c.properties=Object.assign(c.properties,e),c.properties._fillColor=c.properties.fillColor?c.properties.fillColor:e&&a.range?c.properties.value===a.range[0]?b.minFillColor:c.properties.value>a.range[0]?a.colorScale(+c.properties.value).css():b.fillColor:b.fillColor,c}),this.initRBush(e),this.getFeaturesInBounds(),this.onRender()}else this.ctx.clearRect(0,0,this.container.width,this.container.height),this.rbush.dirty=0,this.rbush.total=0,this.rbush.clear()}},{key:"getRange",value:function(){if(!this.mappingData.length)return null;var a=this.mappingData.filter(function(a){return void 0!=a.value&&!isNaN(+a.value)&&""!==a.value}),b=a.reduce(function(c,a){return+c.value<=+a.value?c:a},{}),c=a.reduce(function(c,a){return+c.value>=+a.value?c:a},{});return[+b.value,+c.value]}},{key:"initRBush",value:function(a){var b=[],c=void 0,d=void 0;for(c=0,d=a.features.length;c<d;c++){var e=a.features[c],f=m(e);b.push({minX:f[0],minY:f[1],maxX:f[2],maxY:f[3],feature:e})}b.length&&(this.rbush.dirty=b.length,this.rbush.total=b.length,this.rbush.clear(),this.rbush.load(b))}},{key:"getFeaturesInBounds",value:function(){var a=this.map.getBounds(),b=a.pad(this.padding),c={minX:b.getWest(),minY:b.getSouth(),maxX:b.getEast(),maxY:b.getNorth()},d=this.rbush.search(c),e=void 0,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0;for(e=0;h=d.length,e<h;e++){switch(k=d[e].feature,l=k.geometry.coordinates,n=[],k.geometry.type){case"Polygon":for(f=0;i=l.length,f<i;f++)m=this.pointsProject(l[f]),3<=m.length&&n.push(m);break;case"MultiPolygon":for(f=0;i=l.length,f<i;f++)for(g=0;j=l[f].length,g<j;g++)m=this.pointsProject(l[f][g]),3<=m.length&&n.push(m);break;default:}d[e].feature.geometry.coordinatesXY=n}return this.rbushInBounds.clear(),this.rbushInBounds.load(d),this.featuresInBounds=d,d}},{key:"draw",value:function(){if(this.options.visibility&&this.geojson&&this.rbush&&this.rbush.total&&this.mappingData){this.ctx.clearRect(0,0,this.container.width,this.container.height);var a=this.featuresInBounds;this.drawAreas(a),this.drawLabels(a)}}},{key:"drawAreas",value:function(a){this.ctx.shadowColor=null,this.ctx.shadowBlur=null;var b=this.options.defaultStyle,c=void 0,d=a.length;for(c=0;d,c<d;c++){var e=a[c].feature,f=Object.assign({},e.properties),g=f._fillColor,h=f.strokeColor||b.stroke.color,i=f.weight||b.stroke.weight,j=f.dashArray||b.stroke.dashArray,k=this.options.interactive.isHover;k.show&&this.map.featureSelect&&this.map.featureSelect.geometry.coordinates===e.geometry.coordinates&&(g=k.fillColor,h=k.strokeColor,i=k.weight,j=k.dashArray);var l={fill:!0,fillRule:"evenodd",fillColor:g||"rgba(2,111,222,0.3)",fillOpacity:1,stroke:!0,strokeColor:h||"rgba(255,255,255,0.3)",weight:i||1,lineJoin:"round",lineCap:"square",dashArray:j||""};switch(e.geometry.type){case"Polygon":this.drawPolygon(this.ctx,e.geometry.coordinatesXY,l);break;case"MultiPolygon":this.drawPolygon(this.ctx,e.geometry.coordinatesXY,l);break;default:}}}},{key:"drawLabels",value:function(a){if(this.options.labelStyle.show){var b=this.ctx,c=this.options.labelStyle,d=c.textStyle;b.font=""+d.fontWeight+" "+d.fontSize+"px "+d.fontFamily,b.fillStyle=d.color,b.textAlign="center",b.textBaseline="middle",b.shadowColor=d.shadowColor,b.shadowBlur=d.shadowBlur;for(var e=void 0,f=void 0,g=void 0,h=0;h<a.length;h++){e=a[h].feature,f=e.properties,g=f.customLabelPosition?f.customLabelPosition:this.calLabelPos(e,1);var i=this.map.latLngToContainerPoint([g[1],g[0]]);c.fieldName&&f[c.fieldName]&&b.fillText(f[c.fieldName],i.x-this.offset.x,i.y-this.offset.y)}b.save()}}},{key:"area",value:function(a){for(var b,c=0,d=0;d<a.length;d++){b=a[d];for(var e=0,f=b.length,g=f-1;e<f;g=e++)c+=(b[e][0]-b[g][0])*(b[e][1]+b[g][1])*(d?-1:1)}return Math.abs(c)/2}},{key:"calLabelPos",value:function(a,b){var c=this;if(a.geometry&&"Polygon"===a.geometry.type)return k(a.geometry.coordinates,b);if(a.geometry&&"MultiPolygon"===a.geometry.type){var d=a.geometry.coordinates.reduce(function(d,a){return c.area(d)>=c.area(a)?d:a},{});return k(d,b)}}},{key:"pointsProject",value:function(a){var b=[],c=void 0,e=void 0;for(c=0;e=a.length,c<e;c++){var f=a[c];if((f[0]||0==f[0])&&(f[1]||0==f[1])){var d=this.map.latLngToContainerPoint([f[1],f[0]]);b.push({x:d.x-this.offset.x,y:d.y-this.offset.y})}}var g=this.options.smoothFactor,h=b;return b.length&&(h=this.map.L.LineUtil.simplify(b,g)),h}},{key:"drawPolygon",value:function(a,b,c){if(b&&0!==b.length){a.beginPath();var d,e,f;for(d=0;d<b.length;d++){for(e=0;e<b[d].length;e++)f=b[d][e],a[e?"lineTo":"moveTo"](f.x,f.y);a.closePath()}this.fillStroke(a,c)}}},{key:"onClick",value:function(a){var b=a.feature,c=b.properties;if(this.options.interactive.clickZoom.show){var d=c.adcode,e=void 0;if(this.mappingDataMap[d]&&this.mappingDataMap[d].bounds)e=this.mappingDataMap[d].bounds;else{var f=m(b),g=[[f[1],f[0]],[f[3],f[2]]];this.map.isMapMoving=this.options.interactive.clickZoom;var h=this.options.interactive.clickZoom.zoomPad-1;e=[[g[0][0]-(g[1][0]-g[0][0])*h/2,g[0][1]-(g[1][1]-g[0][1])*h/2],[g[1][0]+(g[1][0]-g[0][0])*h/2,g[1][1]+(g[1][1]-g[0][1])*h/2]]}this.map.fitBounds(e,{animate:!0,duration:3,easeLinearity:3,noMoveStart:!0})}this.options.popupStyle.show&&"click"===this.options.popupStyle.eventType&&this.openPopup(a)}},{key:"onMouseOver",value:function(a){this.options.popupStyle.show&&"mouseover"===this.options.popupStyle.eventType&&this.openPopup(a)}},{key:"onMouseOut",value:function(){}},{key:"openPopup",value:function(a){var b=a.feature.properties,c=void 0,d=void 0,e=void 0;"custom"===this.options.popupStyle.styleType?(d=this.options.popupStyle,b.type&&this.popups[b.type]&&(d=i(d,this.popups[b.type].popupStyle))):d=this.map.popupStyle;var f=d.margin,g=f.top+"px "+f.right+"px "+f.bottom+"px "+f.left+"px";if(b.type&&this.popups[b.type]){var h=this.popups[b.type].clientWidth,j=this.popups[b.type].clientHeight;c=this.popups[b.type].popup,e=this.popups[b.type].container,e.style.display="block",e.style.width=h+"px",e.style.height=j+"px",e.style.margin=g}else{if(d.infoField&&void 0===b.info)return;var k="";if(void 0!=b.info)k=""+b.info;else if(void 0!=b.name&&void 0!=b.value)k="\u540D\u79F0\uFF1A"+b.name+"<br/>\u6570\u503C\uFF1A"+b.value;else if(void 0!=b.name)k="\u540D\u79F0\uFF1A"+b.name;else if(void 0!=b.value)k="\u6570\u503C\uFF1A"+b.value;else return;var l=d.textStyle,m=d.lineHeight;e="<div style=\"\n        margin: "+g+";\n        padding: 0px;\n        font-family: "+l.fontFamily+";\n        font-size: "+l.fontSize+"px;\n        color: "+l.color+"; \n        font-weight: "+l.fontWeight+"; \n        line-height: "+m+";\n        white-space: nowrap;\n        display: inline-table;\n        text-align: left;\n      \"> "+k+"</div>",c=this.map.L.popup({maxWidth:1200,maxHeight:1200,isCustomPopup:!0})}var n;n=b.customLabelPosition?b.customLabelPosition:this.calLabelPos(a.feature,1),c.setLatLng([+n[1],+n[0]]),c.setContent(e),c.openOn(this.map),this.map.L.customPopup.updatePopupStyle(c,d),this.map._popup.minZoom=this.options.minZoom,this.map._popup.maxZoom=this.options.maxZoom}},{key:"bindGroup",value:function(a,b,c){var d=+b.clientWidth,e=+b.clientHeight;b.style.transform="",b.style.position="",b.style.display="none";var f=this.map.L.popup({maxWidth:1200,maxHeight:1200,isCustomPopup:!0});this.popups[a]={popup:f,container:b,clientWidth:d,clientHeight:e,popupStyle:c}}},{key:"containsLatLng",value:function(a){var b=void 0,c=void 0,d=void 0,e=void 0,f=!1,g={minX:a.lng,minY:a.lat,maxX:a.lng,maxY:a.lat},h=this.rbushInBounds.search(g);if(0===h.length)return{flag:f,feature:c};for(d=0;e=h.length,d<e;d++)if(b=h[d].feature,f=this.isFeatureContainsLatLng(b,a),f){c=b;break}return{flag:f,feature:c}}},{key:"isFeatureContainsLatLng",value:function(a,b){var c=void 0,d=void 0,e=!1,f=this.map.latLngToContainerPoint([b.lat,b.lng]);f.x-=this.offset.x,f.y-=this.offset.y;var g=a.geometry.coordinates;switch(a.geometry.type){case"Polygon":e=this.isPolygonContainsPoint(g,[b.lng,b.lat]);break;case"MultiPolygon":for(c=0;(d=g.length,c<d)&&(e=this.isPolygonContainsPoint(g[c],[b.lng,b.lat]),!e);c++);break;default:}return e}},{key:"clickTolerance",value:function(){return(this.options.stroke?this.options.weight/2:0)+this.options.tolerance}},{key:"isPolylineContainsPoint",value:function(a,b,c){var d,e,f,g=this.clickTolerance();for(d=0,f=a.length,e=f-1;d<f;e=d++)if((c||0!==d)&&this.map.L.LineUtil.pointToSegmentDistance(b,a[e],a[d])<=g)return!0;return!1}},{key:"isPolygonContainsPoint",value:function(a,b){var c,d,e,f,g,h,i,j,k=!1;for(f=0,i=a.length;f<i;f++)for(c=a[f],g=0,j=c.length,h=j-1;g<j;h=g++)d=c[g],e=c[h],d[1]>b[1]!==e[1]>b[1]&&b[0]<(e[0]-d[0])*(b[1]-d[1])/(e[1]-d[1])+d[0]&&(k=!k);return k}},{key:"fillStroke",value:function(a,b){if(b.fill&&(a.globalAlpha=b.fillOpacity,a.fillStyle=b.fillColor||b.color,a.fill(b.fillRule||"evenodd")),b.stroke&&0!==b.weight){if(a.setLineDash){var c=this.getDashArray(b)||[];a.setLineDash(c)}a.globalAlpha=b.opacity,a.lineWidth=b.weight,a.strokeStyle=b.strokeColor,a.lineCap=b.lineCap,a.lineJoin=b.lineJoin,a.stroke()}}},{key:"getDashArray",value:function(a){if(""===a.dashArray)e=[];else if("string"===typeof a.dashArray){var b,c,d=a.dashArray.split(/[, ]+/),e=[];for(c=0;c<d.length;c++){if(b=+d[c],isNaN(b))return;e.push(b)}}else e=a.dashArray||[];return e}},{key:"updateOptions",value:function(a){this.options=i(this.options,a),this.options.minZoom=a.zoomRange[0],this.options.maxZoom=a.zoomRange[1],this.genGeojson()}},{key:"show",value:function(){this.options.visibility=!0,this.onRender("needUpdata")}},{key:"hide",value:function(){this.options.visibility=!1,this.ctx.clearRect(0,0,this.container.width,this.container.height)}},{key:"destroy",value:function(){this.rbushInBounds.clear(),this.rbushInBounds=null,this.rbush.clear(),this.rbush=null,this.options=null,this.ctx=null,this.container=null,delete this.options,this.ctx,this.container}}]),b}(h);return a.exports=n,a.exports});;
Cube("datav:/com/datavmap-canvas2d-area/2.0.45",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/com/datavmap-canvas2d-area/2.0.45/src/areaLayer"),k=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=i({renderer:"canvas"},c),f.options.minZoom=c.zoomRange[0],f.options.maxZoom=c.zoomRange[1],f.options.visibility=!0,f}return f(b,a),g(b,[{key:"addTo",value:function(a,b){return this.options.id=b,this.layer=new j(a,this.options),this}},{key:"onRender",value:function(){this.layer&&this.layer.onRender&&this.layer.onRender()}},{key:"onResize",value:function(a,b){this.layer&&this.layer.onResize&&this.layer.onResize(a,b)}},{key:"render",value:function(a){this.layer&&this.layer.render&&this.layer.render(a)}},{key:"setMappingData",value:function(a){this.layer&&this.layer.setMappingData&&this.layer.setMappingData(a)}},{key:"updateOptions",value:function(a){this.options=i(this.options,a),this.options.minZoom=a.zoomRange[0],this.options.maxZoom=a.zoomRange[1],this.layer&&this.layer.updateOptions&&this.layer.updateOptions(a)}},{key:"onClick",value:function(a){var b=a.feature;this.emit("click",b.properties),this.layer&&this.layer.onClick&&this.layer.onClick(a)}},{key:"onMouseOver",value:function(a){var b=a.feature;this.emit("mouseover",b.properties),this.layer&&this.layer.onMouseOver&&this.layer.onMouseOver(a)}},{key:"onMouseOut",value:function(a){var b=a.feature;b&&b.properties&&(this.emit("mouseout",b.properties),this.layer&&this.layer.onMouseOut&&this.layer.onMouseOut(a))}},{key:"bindGroup",value:function(a){var b=a.type||"",c=a.container||"<div></div>",d=a.popupStyle||{};this.layer&&this.layer.bindGroup&&this.layer.bindGroup(b,c,d)}},{key:"show",value:function(){this.options.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.options.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"containsLatLng",value:function(a){return this.layer.containsLatLng(a)}},{key:"destroy",value:function(){this.layer&&this.layer.destroy&&this.layer.destroy(),this.layer=null,delete this.layer}}]),b}(h);return a.exports=k,a.exports});