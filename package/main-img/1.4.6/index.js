// env=undefined => env=publish 
Cube("datav:/com/main-img/1.4.6",["datav:/npm/bcore/0.0.18/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.6.1","datav:/npm/xss/0.3.4"],function(e,t,n,i,a,r){function g(e,t,n){return-1<e.indexOf("?")?e+"&"+t+"="+n:e+"?"+t+"="+n}var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},o=n("datav:/npm/bcore/0.0.18/event"),c=n("datav:/npm/jquery/2.1.4"),h=n("datav:/npm/lodash/4.6.1"),f=n("datav:/npm/xss/0.3.4");return e.exports=o.extend(function(e,t){this.container=c(e),this.apis=t.apis,this.config=h.defaultsDeep(t,{imageType:"bitmap","background-image":"",vectorImage:"",vectorFill:"#2483FF",repeat:"no-repeat",radius:0,"inner-style":{"image-rendering":"-webkit-optimize-contrast"},cursor:!0})},{render:function(e,t){var n,i,a,r,s,o,c,u,l;(e=e||this._data)&&(this._data=e,n=this.container,this.config=h.defaultsDeep(t||{},this.config),o=(i=this.config).imageType,a=(c=i.urlConfig).url,r=c.ifBlank,s=i.radius,u=i.cursor,t=i.vectorFill,c=h.get(e,["0","img"]),"bitmap"===o?(o=c||h.get(i,"background-image"),(o=i.refresh?g(o,"date",(new Date).getTime()):o)&&!/url\(/.test(o)&&(o='url("'+o+'")'),i["inner-style"]["background-repeat"]=i.repeat,this.repeatFn("background-size"),i["inner-style"]&&n.css(i["inner-style"]),n.css({backgroundImage:o,maskImage:"none",maskRepeat:"initial",maskSize:"initial",backgroundColor:"initial"})):(c=c||h.get(i,"vectorImage"),(c=i.refresh?g(c,"date",(new Date).getTime()):c)&&!/url\(/.test(c)&&(c='url("'+c+'")'),i["inner-style"]["mask-repeat"]=i.repeat,this.repeatFn("mask-size"),i["inner-style"]&&n.css(i["inner-style"]),n.css({maskImage:c,backgroundImage:"none",background:function(e){if(!e)return"none";if("string"==typeof e)return e;switch(e.type){case"flat":return e.value;case"linearGradient":return"linear-gradient("+e.value.angle+"deg, "+h.map(e.value.stops,function(e){return e.color+" "+e.offset+"%"})+")"}}(t),backgroundRepeat:"initial",backgroundSize:"initial"})),n.css({borderRadius:s+"px",cursor:u?"pointer":"default"}),u=h.get(e,["0","url"])||a,(e[0]&&e[0].url||a)&&(this.container.html(f('<a href="'+u+'" '+(r?'target="_blank"':"")+"></a>")),this.container.find("a").css({display:"block",width:"100%",height:"100%"})),(l=this).container.off("click").on("click",function(){l.eventFn("handleClick")}),this.container.off("mouseenter").on("mouseenter",function(){l.eventFn("mouseEnter")}),this.container.off("mouseleave").on("mouseleave",function(){l.eventFn("mouseLeave")}))},repeatFn:function(e){switch(h.get(this.config,"repeat")){case"no-repeat":this.config["inner-style"][e]="100% 100%";break;case"repeat-x":this.config["inner-style"][e]="auto 100%";break;case"repeat-y":this.config["inner-style"][e]="100% auto";break;case"repeat":this.config["inner-style"][e]="auto auto"}return this.config["inner-style"]},eventFn:function(e){var t;this._data&&this._data.length&&!h.isEmpty(this._data[0].img)?this.eventEmit(e,this._data[0]):this._data&&this._data.length?(t=s({},this._data[0],{img:this.config["background-image"],url:this.config.urlConfig.url}),this.eventEmit(e,t)):this.eventEmit(e,{img:this.config["background-image"],url:this.config.urlConfig.url})},eventEmit:function(e,t){t&&this.emit(e,t)},destroy:function(){this.container.empty(),this.container.css("background",""),this._data=null},refresh:function(){this.render(null,{refresh:!0})}}),e.exports});