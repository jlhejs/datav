// env=undefined => env=publish 
Cube("datav:/com/datavmap-3d-layer-layer-bar3d/0.0.7/worker.packed.js",[],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function e(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var f=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};return!function(c,d){"object"===("undefined"===typeof b?"undefined":g(b))&&"object"===("undefined"===typeof a?"undefined":g(a))?a.exports=d():"function"===typeof define&&define.amd?define([],d):"object"===("undefined"===typeof b?"undefined":g(b))?b.Bar3D=d():c.Bar3D=d()}(window,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{enumerable:!0,get:d})},b.r=function(a){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},b.t=function(a,c){if(1&c&&(a=b(a)),8&c)return a;if(4&c&&"object"===("undefined"===typeof a?"undefined":g(a))&&a&&a.__esModule)return a;var d=Object.create(null);if(b.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:a}),2&c&&"string"!=typeof a)for(var f in a)b.d(d,f,function(b){return a[b]}.bind(null,f));return d},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=0)}([function(a,b,g){var h=g(1),i=g(2);a.exports=function(a){function b(a,e){var f;return c(this,b),f=d(this,(b.__proto__||Object.getPrototypeOf(b)).call(this)),f,f.workerPath=e,f.workerCount=a||Math.max(Math.floor(window.navigator.hardwareConcurrency/2),1),f.workers=[],f.workerQueue=[],f.initWorker(),f}return e(b,a),f(b,[{key:"initWorker",value:function(){for(;this.workers.length<this.workerCount;)this.workers.push(new i)}},{key:"runTask",value:function(a){var b=this;return new Promise(function(c,d){if(0<b.workers.length){var f=b.workers.shift();f.postMessage(a);var g=function a(d){if(c(d.data),f.removeEventListener("message",a),b.workers.push(f),0<b.workerQueue.length){var e=b.workerQueue.shift();b.runTask(e.workData).then(function(a){e.resolve(a)})}};f.addEventListener("message",g)}else b.workerQueue.push({workData:a,resolve:c,reject:d})})}},{key:"releaseWorker",value:function(){this.workers.forEach(function(a){a.terminate()})}}]),b}(h)},function(a){"use strict";function b(){}function c(a,b,c,d,e){if("function"!==typeof c)throw new TypeError("The listener must be a function");var f=new function(a,b,c){this.fn=a,this.context=b,this.once=c||!1}(c,d||a,e),h=g?g+b:b;return a._events[h]?a._events[h].fn?a._events[h]=[a._events[h],f]:a._events[h].push(f):(a._events[h]=f,a._eventsCount++),a}function d(a,c){0===--a._eventsCount?a._events=new b:delete a._events[c]}function e(){this._events=new b,this._eventsCount=0}var f=Object.prototype.hasOwnProperty,g="~";Object.create&&(b.prototype=Object.create(null),new b().__proto__||(g=!1)),e.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)f.call(a,b)&&c.push(g?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},e.prototype.listeners=function(a){var b=g?g+a:a,c=this._events[b];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,e=c.length,f=Array(e);d<e;d++)f[d]=c[d].fn;return f},e.prototype.listenerCount=function(a){var b=g?g+a:a,c=this._events[b];return c?c.fn?1:c.length:0},e.prototype.emit=function(b,d,e,h,j,i){var k=g?g+b:b;if(!this._events[k])return!1;var m,n,f=this._events[k],o=arguments.length;if(f.fn){switch(f.once&&this.removeListener(b,f.fn,void 0,!0),o){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,d),!0;case 3:return f.fn.call(f.context,d,e),!0;case 4:return f.fn.call(f.context,d,e,h),!0;case 5:return f.fn.call(f.context,d,e,h,j),!0;case 6:return f.fn.call(f.context,d,e,h,j,i),!0;}for(n=1,m=Array(o-1);n<o;n++)m[n-1]=arguments[n];f.fn.apply(f.context,m)}else{var a,p=f.length;for(n=0;n<p;n++)switch(f[n].once&&this.removeListener(b,f[n].fn,void 0,!0),o){case 1:f[n].fn.call(f[n].context);break;case 2:f[n].fn.call(f[n].context,d);break;case 3:f[n].fn.call(f[n].context,d,e);break;case 4:f[n].fn.call(f[n].context,d,e,h);break;default:if(!m)for(a=1,m=Array(o-1);a<o;a++)m[a-1]=arguments[a];f[n].fn.apply(f[n].context,m);}}return!0},e.prototype.on=function(a,b,d){return c(this,a,b,d,!1)},e.prototype.once=function(a,b,d){return c(this,a,b,d,!0)},e.prototype.removeListener=function(a,b,c,e){var h=g?g+a:a;if(!this._events[h])return this;if(!b)return d(this,h),this;var i=this._events[h];if(i.fn)i.fn!==b||e&&!i.once||c&&i.context!==c||d(this,h);else{for(var j=0,k=[],f=i.length;j<f;j++)(i[j].fn!==b||e&&!i[j].once||c&&i[j].context!==c)&&k.push(i[j]);k.length?this._events[h]=1===k.length?k[0]:k:d(this,h)}return this},e.prototype.removeAllListeners=function(a){var c;return a?(c=g?g+a:a,this._events[c]&&d(this,c)):(this._events=new b,this._eventsCount=0),this},e.prototype.off=e.prototype.removeListener,e.prototype.addListener=e.prototype.on,e.prefixed=g,e.EventEmitter=e,a.exports=e},function(a,b,c){a.exports=function(){return c(3)("!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=0)}([function(e,t,n){const r=n(1),i=3.141592653589793,o=i/180;self.addEventListener(\"message\",function(e){let t=e.data,n=t.data,u=t.side||6,x=t.rotation||0,s=t.radius||2e4,p={type:\"FeatureCollection\",features:[]};p.features=n.map(e=>{let t=(e=>[81.48733086305042*e[0]*o,81.48733086305042*Math.log(Math.tan(i/4+.5*e[1]*o))])([e.lng,e.lat]),n={type:\"Feature\",properties:{floor:e.value},geometry:{type:\"Polygon\",coordinates:[]}},r=[],p=512/(2*Math.PI*6378137*Math.abs(Math.cos(e.lat*Math.PI/180)));for(let e=0;e<u;e++){let n=2*e*Math.PI/u,i=Math.cos(n)*s*p,o=-Math.sin(n)*s*p;if(x>0){let e=x*Math.PI/180,n=i*Math.cos(e)-o*Math.sin(e),u=o*Math.cos(e)+i*Math.sin(e);r.push([t[0]+n,t[1]+u])}else r.push([t[0]+i,t[1]+o])}return r.push(r[r.length-1]),n.geometry.coordinates.push(r),n});let l=r(p);self.postMessage(l,[l.positions.buffer,l.indices.buffer,l.uvs.buffer,l.values.buffer,l.colors.buffer])})},function(e,t,n){const r=n(2);e.exports=function(e,t){let n={closed:!1,project:e=>[e[0]||0,e[1]||0,e[2]||0],getHeight:function(e,t){return e.properties.floor||e.properties.height||0},getBase:function(e,t){return 0},getKey:function(e,t){return e.properties.id||t},getVertexColor:function(e,t){return[0,0,0,1]}};Object.assign(n,t);let i=[],o=[],u=[],x=[],s=[],p=[],l={},f=e.features||e;for(let e=0,t=f.length;e<t;e++){let t=f[e],a=[],h=n.getHeight(t,e),y=n.getBase(t,e),v=n.project;if(t.geometry){\"MultiPolygon\"===t.geometry.type?[].push.apply(a,t.geometry.coordinates):\"Polygon\"===t.geometry.type&&a.push(t.geometry.coordinates);let f=i.length/3;a.forEach(l=>{let f=i.length/3,a=r(l,{height:h,base:y,project:v});[].push.apply(i,a.positions),[].push.apply(u,a.uvs),[].push.apply(p,a.heights);let c=a.indices.map(function(e){return e+f});[].push.apply(o,c);for(let r=0,i=a.positions.length/3;r<i;r++)[].push.apply(x,n.getVertexColor(t,e));for(let e=0,n=a.positions.length/3;e<n;e++)s.push(t.properties.floor)});let c=i.length/3,g=n.getKey(t,e);g&&(l[g]=[f,c,e])}}return{positions:new Float32Array(i),indices:new Int32Array(o),uvs:new Float32Array(u),values:new Float32Array(s),colors:new Float32Array(x),keyIndex:l}}},function(e,t,n){const r=n(3);e.exports=function(e,t){t=Object.assign({height:1,base:0,project:e=>[e[0]||0,e[1]||0,e[2]||0],closed:!1},t);let n=r.flatten(e),i=n.vertices,o=(i.length,n.dimensions,[]),u=[],x=[],s=[],p=r(n.vertices,n.holes,n.dimensions),l=i.length/n.dimensions;if(t.height===t.base)i.forEach((e,r)=>{if(r%n.dimensions===0){let e=t.project([i[r],i[r+1],t.height]);x.push(r/n.dimensions%2===0?0:1,1),o.push(e[0],e[1],e[2]),s.push(e[2])}}),u=p;else{let e=[],r=[],f=[];i.forEach((u,p)=>{if(p%n.dimensions===0){let u=t.project([i[p],i[p+1],t.height]);o.push(u[0],u[1],u[2]),x.push(p/n.dimensions%2===0?0:1,1),s.push(t.height-t.base),e.push(u[0],u[1],t.base),r.push(p/n.dimensions%2===0?0:1,0),f.push(0)}}),[].push.apply(o,e),[].push.apply(x,r),[].push.apply(s,f);for(let e=0;e<l;e++)e===l-1?u.push(e,l,e+l,e,0,l):u.push(e,e+l+1,e+l,e,e+1,e+l+1);[].push.apply(u,p),t.closed&&p.forEach((e,t)=>{t%3===0&&u.push(p[t+0]+l,p[t+1]+l,p[t+2]+l)})}return{positions:o,indices:u,uvs:x,heights:s}}},function(e,t,n){\"use strict\";function r(e,t,n){n=n||2;var r,x,s,p,l,h,v,c=t&&t.length,g=c?t[0]*n:e.length,d=i(e,0,g,n,!0),b=[];if(!d)return b;if(c&&(d=function(e,t,n,r){var u,x,s,p,l,h=[];for(u=0,x=t.length;u<x;u++)s=t[u]*r,p=u<x-1?t[u+1]*r:e.length,(l=i(e,s,p,r,!1))===l.next&&(l.steiner=!0),h.push(y(l));for(h.sort(f),u=0;u<h.length;u++)a(h[u],n),n=o(n,n.next);return n}(e,t,d,n)),e.length>80*n){r=s=e[0],x=p=e[1];for(var Z=n;Z<g;Z+=n)l=e[Z],h=e[Z+1],l<r&&(r=l),h<x&&(x=h),l>s&&(s=l),h>p&&(p=h);v=0!==(v=Math.max(s-r,p-x))?1/v:0}return u(d,b,n,r,x,v),b}function i(e,t,n,r,i){var o,u;if(i===P(e,t,n,r)>0)for(o=t;o<n;o+=r)u=M(o,e[o],e[o+1],u);else for(o=n-r;o>=t;o-=r)u=M(o,e[o],e[o+1],u);return u&&d(u,u.next)&&(w(u),u=u.next),u}function o(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!d(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(w(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function u(e,t,n,r,i,f,a){if(e){!a&&f&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=h(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,u,x,s,p=1;do{for(n=e,e=null,o=null,u=0;n;){for(u++,r=n,x=0,t=0;t<p&&(x++,r=r.nextZ);t++);for(s=p;x>0||s>0&&r;)0!==x&&(0===s||!r||n.z<=r.z)?(i=n,n=n.nextZ,x--):(i=r,r=r.nextZ,s--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,p*=2}while(u>1)}(i)}(e,r,i,f);for(var y,v,c=e;e.prev!==e.next;)if(y=e.prev,v=e.next,f?s(e,r,i,f):x(e))t.push(y.i/n),t.push(e.i/n),t.push(v.i/n),w(e),e=v.next,c=v.next;else if((e=v)===c){a?1===a?u(e=p(e,t,n),t,n,r,i,f,2):2===a&&l(e,t,n,r,i,f):u(o(e),t,n,r,i,f,1);break}}}function x(e){var t=e.prev,n=e,r=e.next;if(g(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(v(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&g(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function s(e,t,n,r){var i=e.prev,o=e,u=e.next;if(g(i,o,u)>=0)return!1;for(var x=i.x<o.x?i.x<u.x?i.x:u.x:o.x<u.x?o.x:u.x,s=i.y<o.y?i.y<u.y?i.y:u.y:o.y<u.y?o.y:u.y,p=i.x>o.x?i.x>u.x?i.x:u.x:o.x>u.x?o.x:u.x,l=i.y>o.y?i.y>u.y?i.y:u.y:o.y>u.y?o.y:u.y,f=h(x,s,t,n,r),a=h(p,l,t,n,r),y=e.prevZ,c=e.nextZ;y&&y.z>=f&&c&&c.z<=a;){if(y!==e.prev&&y!==e.next&&v(i.x,i.y,o.x,o.y,u.x,u.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,c!==e.prev&&c!==e.next&&v(i.x,i.y,o.x,o.y,u.x,u.y,c.x,c.y)&&g(c.prev,c,c.next)>=0)return!1;c=c.nextZ}for(;y&&y.z>=f;){if(y!==e.prev&&y!==e.next&&v(i.x,i.y,o.x,o.y,u.x,u.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;c&&c.z<=a;){if(c!==e.prev&&c!==e.next&&v(i.x,i.y,o.x,o.y,u.x,u.y,c.x,c.y)&&g(c.prev,c,c.next)>=0)return!1;c=c.nextZ}return!0}function p(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!d(i,o)&&b(i,r,r.next,o)&&Z(i,o)&&Z(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),w(r),w(r.next),r=e=o),r=r.next}while(r!==e);return r}function l(e,t,n,r,i,x){var s=e;do{for(var p=s.next.next;p!==s.prev;){if(s.i!==p.i&&c(s,p)){var l=m(s,p);return s=o(s,s.next),l=o(l,l.next),u(s,t,n,r,i,x),void u(l,t,n,r,i,x)}p=p.next}s=s.next}while(s!==e)}function f(e,t){return e.x-t.x}function a(e,t){if(t=function(e,t){var n,r=t,i=e.x,o=e.y,u=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var x=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(x<=i&&x>u){if(u=x,x===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===u)return n.prev;var s,p=n,l=n.x,f=n.y,a=1/0;r=n.next;for(;r!==p;)i>=r.x&&r.x>=l&&i!==r.x&&v(o<f?i:u,o,l,f,o<f?u:i,o,r.x,r.y)&&((s=Math.abs(o-r.y)/(i-r.x))<a||s===a&&r.x>n.x)&&Z(r,e)&&(n=r,a=s),r=r.next;return n}(e,t)){var n=m(t,e);o(n,n.next)}}function h(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function y(e){var t=e,n=e;do{t.x<n.x&&(n=t),t=t.next}while(t!==e);return n}function v(e,t,n,r,i,o,u,x){return(i-u)*(t-x)-(e-u)*(o-x)>=0&&(e-u)*(r-x)-(n-u)*(t-x)>=0&&(n-u)*(o-x)-(i-u)*(r-x)>=0}function c(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&b(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&Z(e,t)&&Z(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!==n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)}function g(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function d(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,n,r){return!!(d(e,t)&&d(n,r)||d(e,r)&&d(n,t))||g(e,t,n)>0!==g(e,t,r)>0&&g(n,r,e)>0!==g(n,r,t)>0}function Z(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function m(e,t){var n=new j(e.i,e.x,e.y),r=new j(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function M(e,t,n,r){var i=new j(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function w(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function j(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function P(e,t,n,r){for(var i=0,o=t,u=n-r;o<n;o+=r)i+=(e[u]-e[o])*(e[o+1]+e[u+1]),u=o;return i}e.exports=r,e.exports.default=r,r.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,u=Math.abs(P(e,0,o,n));if(i)for(var x=0,s=t.length;x<s;x++){var p=t[x]*n,l=x<s-1?t[x+1]*n:e.length;u-=Math.abs(P(e,p,l,n))}var f=0;for(x=0;x<r.length;x+=3){var a=r[x]*n,h=r[x+1]*n,y=r[x+2]*n;f+=Math.abs((e[a]-e[y])*(e[h+1]-e[a+1])-(e[a]-e[h])*(e[y+1]-e[a+1]))}return 0===u&&0===f?0:Math.abs((f-u)/u)},r.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var u=0;u<t;u++)n.vertices.push(e[i][o][u]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n}}]);",null)}},function(a){"use strict";var b=window.URL||window.webkitURL;a.exports=function(a,c){try{try{var d;try{(d=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(a),d=d.getBlob()}catch(b){d=new Blob([a])}return new Worker(b.createObjectURL(d))}catch(b){return new Worker("data:application/javascript,"+encodeURIComponent(a))}}catch(a){if(!c)throw Error("Inline worker is not supported");return new Worker(c)}}}])}),a.exports});;
Cube("datav:/com/datavmap-3d-layer-layer-bar3d/0.0.7/bar3d-layer.js",["datav:/npm/safely-merge/1.0.1","datav:/npm/chroma-js/1.3.4","datav:/npm/eventemitter3/2.0.3"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/safely-merge/1.0.1"),i=c("datav:/npm/chroma-js/1.3.4"),j=c("datav:/npm/eventemitter3/2.0.3"),k=c("datav:/com/datavmap-3d-layer-layer-bar3d/0.0.7/worker.packed.js");return a.exports=function(a){var b=a.datavgl,c=b.THREE,l=a.glLayer||a,m=a.worldsize,n={};return function(a){function b(a){d(this,b);var c=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return a=h(n,a),c.options=h(c.options,a),c.data=[],c.init(),c.visibility=!0,c.worker=new k(1),c}return f(b,a),g(b,[{key:"init",value:function(){this.initMaterial()}},{key:"initMaterial",value:function(){this.material=new c.MeshPhongMaterial({flatShading:!0,side:c.DoubleSide,transparent:!0,vertexColors:!0,opacity:this.options.opacity}),this.material.needsUpdate=!0}},{key:"setData",value:function(a){var b=this;if(a&&a.length){this.data=a,this.min=Math.min.apply(null,a.map(function(a){return a.value})),this.max=Math.max.apply(null,a.map(function(a){return a.value}));var d=this.options.colors.sort(function(c,a){return c.stopValue-a.stopValue});this.colorScale=i.scale(d.map(function(a){return a.color})).domain(d.map(function(a){return b.min+(b.max-b.min)*a.stopValue})),this.worker.runTask({data:a,side:this.options.side,radius:this.options.radius,rotation:this.options.rotation}).then(function(a){b.mesh&&l.offsetNode.remove(b.mesh),b.geometry&&b.geometry.dispose(),b.geometry=b.genGeometry(a),b.updataColor(),b.mesh=new c.Mesh(b.geometry,b.material),b.mesh.scale.z=b.options.scaleZ,b.mesh.visible=b.visibility,b.mesh.position.z=b.options.verticlePosition,l.offsetNode.add(b.mesh),l.emit("init-offset")})}}},{key:"updataColor",value:function(){for(var a,b=this.geometry.attributes.color,c=this.geometry.attributes.value,d=0,e=c.count;d<e;d++)a=this.colorScale(c.getX(d)).gl(),b.setXYZW(d,a[0],a[1],a[2],a[3]);b.needsUpdate=!0}},{key:"genGeometry",value:function(a){var b=new c.BufferGeometry;return b.setIndex(new c.BufferAttribute(new Uint32Array(a.indices),1)),b.addAttribute("position",new c.BufferAttribute(new Float32Array(a.positions),3)),b.addAttribute("color",new c.BufferAttribute(new Float32Array(a.colors),4)),b.addAttribute("uv",new c.BufferAttribute(a.uvs,2)),b.addAttribute("value",new c.BufferAttribute(a.values,1)),b.computeVertexNormals(),b.computeBoundingSphere(),b.computeBoundingBox(),b.needsOffset=!0,b}},{key:"updateOptions",value:function(a){var b=this;if(a.radius==this.options.radius&&a.rotation==this.options.rotation&&a.side==this.options.side){var c=this.options.colors.sort(function(c,a){return c.stopValue-a.stopValue});this.colorScale=i.scale(c.map(function(a){return a.color})).domain(c.map(function(a){return b.min+(b.max-b.min)*a.stopValue})),this.updataColor(),this.mesh.scale.z=a.scaleZ,this.mesh.position.z=a.verticlePosition,this.material.opacity=a.opacity,this.options=h(this.options,a)}else this.options=h(this.options,a),this.setData(this.data)}},{key:"remove",value:function(){this.mesh&&l.remove(this.mesh),this.geometry&&this.geometry.dispose(),this.material.dispose()}},{key:"show",value:function(){this.visibility=!0,this.mesh.visible=this.visibility}},{key:"hide",value:function(){this.visibility=!1,this.mesh.visible=this.visibility}}]),b}(j)},a.exports});;
Cube("datav:/com/datavmap-3d-layer-layer-bar3d/0.0.7",["datav:/npm/eventemitter3/2.0.3","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/2.0.3"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/com/datavmap-3d-layer-layer-bar3d/0.0.7/bar3d-layer.js"),k={};return a.exports=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.container="string"===typeof a?document.querySelector(a):a,f.apis=c.apis,f.map=null,f._data=null,f.config=c,f}return f(b,a),g(b,[{key:"initLayer",value:function(){var a=this.getOptions(),b=j(this.map);this.layer=new b(a),this.updateData(this.data)}},{key:"init",value:function(){var a=this;this.resetID&&clearTimeout(this.resetID),this.resetID=setTimeout(function(){a.map.glLayer.loaded?(a.resetID&&clearTimeout(a.resetID),a.initLayer()):a.init()},100)}},{key:"addTo",value:function(a){var b=this;this.map=a,this.init(),this.endID=setTimeout(function(){b.resetID&&clearTimeout(b.resetID)},300000)}},{key:"getOptions",value:function(){return this.config=i(k,this.config),this.config}},{key:"show",value:function(){this.config.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.config.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"remove",value:function(){this.endID&&clearTimeout(this.endID),this.resetID&&clearTimeout(this.resetID),this.layer&&this.layer.remove&&this.layer.remove(),this.layer=null,this._data=null,this.data=null}},{key:"updateData",value:function(a){this.data=a,this.layer&&this.layer.setData(a)}},{key:"updateOptions",value:function(a){this.config=i(this.config,a),a=this.getOptions(),this.layer&&this.layer.updateOptions(a)}}]),b}(h),a.exports});