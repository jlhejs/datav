// env=undefined => env=publish 
Cube("datav:/com/datav-engine-skybox/0.0.9/layer.js",["datav:/npm/eventemitter3/2.0.3"],function(a,b,c){const d=c("datav:/npm/eventemitter3/2.0.3");return a.exports=class extends d{constructor(){super(),this.preSceneName="main",this.usingSceneName="main"}addTo(a){return a?void(this.viewer=a,this.Utils=a.Utils,this.controller=a.controller,this.scene=this.getAssignedScene(),this.viewer.on("projChanged",this.updatePostions.bind(this))):console.log("Layer needs viewer layer")}getProjPos(a,b,c){return this.viewer&&this.viewer.Projection([a,b,c])}updatePostions(){}getAssignedScene(){const a=this.options;return a.isSceneGroup&&a.sceneName?a.sceneName?this.controller.getScene(a.sceneName)?this.controller.getScene(a.sceneName):this.controller.createScene(a.sceneName):void 0:this.controller.getScene("main")}toggleScene(a,b,c){this.controller.switchScene(a,b,c).then(()=>{this.preSceneName=b,this.usingSceneName=c})}show(){}hide(){}updateOptions(){}},a.exports});;
Cube("datav:/com/datav-engine-skybox/0.0.9",[],function(a,b,c){let d=null,e=null;const f=c("datav:/com/datav-engine-skybox/0.0.9/layer.js");return a.exports=class extends f{constructor(a,b){super(),this.options=Object.assign({visible:!0,textureType:"equirect",size:1e4,mapEquirect:"https://img.alicdn.com/tfs/TB14Mk.ymzqK1RjSZFjXXblCFXa-1024-512.png",mapPx:"https://img.alicdn.com/tfs/TB1t5DCbvDH8KJjy1XcXXcpdXXa-3840-3840.png",mapNx:"https://img.alicdn.com/tfs/TB1vwhfXnhSXuNjy1XdXXXYvXXa-3840-3840.png",mapPy:"https://img.alicdn.com/tfs/TB1AwhfXnhSXuNjy1XdXXXYvXXa-3840-3840.png",mapNy:"https://img.alicdn.com/tfs/TB1DwhfXnhSXuNjy1XdXXXYvXXa-3840-3840.png",mapPz:"https://img.alicdn.com/tfs/TB1EgrsbBfH8KJjy1XbXXbLdXXa-3840-3840.png",mapNz:"https://img.alicdn.com/tfs/TB1BwrsbBfH8KJjy1XbXXbLdXXa-3840-3840.png"},b||{})}addTo(a){super.addTo(a),d=a.THREE,e=a.Utils,this.initGeometry(),this.initMesh()}initGeometry(){const{size:a}=this.options;this.geometry=new d.BoxBufferGeometry(a,a,a)}initCubeMaterial(){const{mapPx:a,mapNx:b,mapPy:c,mapNy:e,mapPz:f,mapNz:g}=this.options,h=this.textureCube=new d.CubeTextureLoader().load([a,b,c,e,f,g]);h.format=d.RGBFormat,h.mapping=d.CubeReflectionMapping,h.encoding=d.sRGBEncoding;const i=d.ShaderLib.cube,j=this.cubeMaterial=new d.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:i.uniforms,depthWrite:!1,side:d.BackSide});j.uniforms.tCube.value=h,Object.defineProperty(j,"map",{get:function(){return this.uniforms.tCube.value}})}initEquirectMaterial(){const{mapEquirect:a}=this.options,b=this.textureEquirec=new d.TextureLoader().load(a);b.mapping=d.EquirectangularReflectionMapping,b.generateMipmaps=!1,b.magFilter=d.LinearFilter,b.minFilter=d.LinearFilter,b.encoding=d.sRGBEncoding;const c=d.ShaderLib.equirect,e=this.equirectMaterial=new d.ShaderMaterial({fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:c.uniforms,depthWrite:!1,side:d.BackSide});e.uniforms.tEquirect.value=b,Object.defineProperty(e,"map",{get:function(){return this.uniforms.tEquirect.value}})}initMesh(){const a=this.options.textureType;this.initCubeMaterial(),this.initEquirectMaterial(),"cube"===a?this.material=this.cubeMaterial:"equirect"===a?this.material=this.equirectMaterial:void 0,this.skybox=new d.Mesh(this.geometry,this.material),this.scene.add(this.skybox),this.updatePostions(),this.checkVisible()}checkVisible(){let a=this.options;a.visible?this.show():this.hide()}show(){this.options.visible=!0,this.skybox&&(this.skybox.visible=!0)}hide(){this.options.visible=!1,this.skybox&&(this.skybox.visible=!1)}updatePostions(){this.skybox&&this.viewer&&this.skybox.position.copy(this.viewer.controls.target.clone())}updateOptions(a){const b=e.deepClone(this.options);if(this.options=e.mergeOptions(this.options,a||{}),e.easyDiff(b.size,a.size)||(this.skybox.geometry.dispose(),this.geometry=new d.BoxBufferGeometry(a.size,a.size,a.size),this.skybox.geometry=this.geometry),!e.easyDiff(b.textureType,a.textureType)){const b=a.textureType;"cube"===b?this.material=this.cubeMaterial:"equirect"===b?this.material=this.equirectMaterial:void 0,this.skybox.material=this.material}if(!e.easyDiff(b.mapEquirect,a.mapEquirect)){const b=a.mapEquirect,c=new d.TextureLoader().load(b);c.mapping=d.EquirectangularReflectionMapping,c.generateMipmaps=!1,c.magFilter=d.LinearFilter,c.minFilter=d.LinearFilter,c.encoding=d.sRGBEncoding,this.equirectMaterial&&(this.equirectMaterial.uniforms.tEquirect.value=c)}if(!e.easyDiff(b.mapPx,a.mapPx)||!e.easyDiff(b.mapNx,a.mapNx)||!e.easyDiff(b.mapPy,a.mapPy)||!e.easyDiff(b.mapNy,a.mapNy)||!e.easyDiff(b.mapPz,a.mapPz)||!e.easyDiff(b.mapNz,a.mapNz)){const{mapPx:a,mapNx:b,mapPy:c,mapNy:e,mapPz:f,mapNz:g}=this.options,h=new d.CubeTextureLoader().load([a,b,c,e,f,g]);h.format=d.RGBFormat,h.mapping=d.CubeReflectionMapping,h.encoding=d.sRGBEncoding,this.cubeMaterial&&(this.cubeMaterial.uniforms.tCube.value=h)}e.easyDiff(b.sceneName,a.sceneName)||(this.scene=this.getAssignedScene(),this.toggleScene(this.skybox,this.usingSceneName,a.sceneName)),this.checkVisible()}remove(){this.scene.remove(this.skybox),this.skybox&&this.skybox.dispose&&this.skybox.dispose(),this.skybox.geometry&&this.skybox.geometry.dispose&&this.skybox.geometry.dispose(),this.cubeMaterial&&this.cubeMaterial.dispose&&this.cubeMaterial.dispose(),this.equirectMaterial&&this.equirectMaterial.dispose&&this.equirectMaterial.dispose(),this.cubeMaterial=null,this.equirectMaterial=null,this.skybox=null,this.material=null}},a.exports});