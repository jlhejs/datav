// env=undefined => env=publish 
Cube("datav:/com/datav-engine-spotlighter/0.0.10/spotlighthelper",[],function(a){return a.exports=function(a){a.FixedSpotLightHelper=function(b,c){a.Object3D.call(this),this.light=b,this.light.updateMatrixWorld(),this.matrix=b.matrixWorld,this.matrixAutoUpdate=!1,this.color=c;for(var d=new a.BufferGeometry,e=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],f=0,g=1,h=32;f<h;f++,g++){var i=2*(f/h*Math.PI),j=2*(g/h*Math.PI);e.push(Math.cos(i),Math.sin(i),1,Math.cos(j),Math.sin(j),1)}d.addAttribute("position",new a.Float32BufferAttribute(e,3));var k=new a.LineBasicMaterial({fog:!1});this.cone=new a.LineSegments(d,k),this.add(this.cone),this.update()},a.FixedSpotLightHelper.prototype=Object.create(a.Object3D.prototype),a.FixedSpotLightHelper.prototype.constructor=a.FixedSpotLightHelper,a.FixedSpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},a.FixedSpotLightHelper.prototype.update=function(){var b=new a.Vector3;return function(){this.light.updateMatrixWorld();var a=this.light.distance?this.light.distance:1e3,c=a*Math.tan(this.light.angle);this.cone.scale.set(c,c,a),b.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(b),void 0===this.color?this.cone.material.color.copy(this.light.color):this.cone.material.color.set(this.color)}}()},a.exports});;
Cube("datav:/com/datav-engine-spotlighter/0.0.10/layer.js",["datav:/npm/eventemitter3/3.0.0"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/3.0.0"),i=function(a){function b(){d(this,b);var a=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return a.preSceneName="main",a.usingSceneName="main",a}return f(b,a),g(b,[{key:"addTo",value:function(a){return a?void(this.viewer=a,this.Utils=a.Utils,this.controller=a.controller,this.scene=this.getAssignedScene(),this.viewer.on("projChanged",this.updatePostions.bind(this))):console.log("Layer needs viewer layer")}},{key:"getProjPos",value:function(a,b,c){return this.viewer&&this.viewer.Projection([a,b,c])}},{key:"updatePostions",value:function(){}},{key:"getAssignedScene",value:function(){var a=this.options;return a.isSceneGroup&&a.sceneName?a.sceneName?this.controller.getScene(a.sceneName)?this.controller.getScene(a.sceneName):this.controller.createScene(a.sceneName):void 0:this.controller.getScene("main")}},{key:"toggleScene",value:function(a,b,c){var d=this;this.controller.switchScene(a,b,c).then(function(){d.preSceneName=b,d.usingSceneName=c})}},{key:"show",value:function(){}},{key:"hide",value:function(){}},{key:"updateOptions",value:function(){}}]),b}(h);return a.exports=i,a.exports});;
Cube("datav:/com/datav-engine-spotlighter/0.0.10",[],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;return void 0===g?void 0:g.call(d)},i=null,j=null,k=c("datav:/com/datav-engine-spotlighter/0.0.10/layer.js"),l=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.options=Object.assign({visible:!0,indicator:!0,angle:0.3,decay:2,distance:50,penumbra:0.2,intensity:0.8,color:16777215,castShadow:!0,px:100,py:100,pz:100,tx:0,ty:0,tz:0},c||{}),f}return f(b,a),g(b,[{key:"addTo",value:function(a){h(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"addTo",this).call(this,a),i=a.three,j=a.Utils,c("datav:/com/datav-engine-spotlighter/0.0.10/spotlighthelper")(i),this.init()}},{key:"init",value:function(){this.light=new i.SpotLight,this.updatePostions(),this.lightHelper=new i.FixedSpotLightHelper(this.light),this.scene.add(this.light),this.scene.add(this.light.target),this.updateLight(),this.useIndicator(),this.animation=this.animation.bind(this),this.viewer.on("animationFrame",this.animation),this.checkVisible()}},{key:"useIndicator",value:function(){var a=this.options.indicator;a?this.scene.add(this.lightHelper):this.scene.remove(this.lightHelper)}},{key:"updatePostions",value:function(){var a=this.options,b=this.getProjPos(a.px,a.py,a.pz),c=this.getProjPos(a.tx,a.ty,a.tz);this.light.position.set(b[0],b[1],b[2]),this.light.target.position.set(c[0],c[1],c[2])}},{key:"updateLight",value:function(){var a=this.options,b=new i.Color(j.Chroma(a.color).hex());this.light.decay=a.decay,this.light.angle=a.angle,this.light.distance=a.distance,this.light.penumbra=a.penumbra,this.light.intensity=a.intensity,this.light.castShadow=a.castShadow,this.light.color.setRGB(b.r,b.g,b.b),this.light.shadow.mapSize.width=1024,this.light.shadow.mapSize.height=1024,this.lightHelper&&this.lightHelper.update()}},{key:"checkVisible",value:function(){var a=this.options;a.visible?this.show():this.hide()}},{key:"show",value:function(){this.options.visible=!0,this.light&&(this.light.visible=!0),this.lightHelper&&(this.lightHelper.visible=!0)}},{key:"hide",value:function(){this.options.visible=!1,this.light&&(this.light.visible=!1),this.lightHelper&&(this.lightHelper.visible=!1)}},{key:"updateOptions",value:function(a){var b=j.deepClone(this.options);this.options=j.mergeOptions(this.options,a||{}),this.updateLight(),this.updatePostions(),j.easyDiff(b.indicator,a.indicator)||this.useIndicator(),j.easyDiff(b.sceneName,a.sceneName)||(this.scene=this.getAssignedScene(),this.toggleScene(this.groupObj,this.usingSceneName,a.sceneName)),this.checkVisible()}},{key:"animation",value:function(){this.lightHelper&&this.options.indicator&&this.lightHelper.update()}},{key:"remove",value:function(){this.viewer.off("animationFrame",this.animation),this.scene.remove(this.light),this.scene.remove(this.light.target),this.options.indicator&&this.scene.remove(this.lightHelper),this.light&&this.light.shadow&&this.light.shadow.map&&this.light.shadow.map.dispose&&(this.light.shadow.map.dispose(),this.light.dispose()),this.light=null,this.lightHelper.dispose&&this.lightHelper.dispose(),this.lightHelper=null}}]),b}(k);return a.exports=l,a.exports});