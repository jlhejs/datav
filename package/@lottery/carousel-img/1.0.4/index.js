// env=undefined => env=publish 
Cube("datav:/com/@lottery/carousel-img/1.0.4",["datav:/npm/bcore/0.0.18/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.6.1","datav:/npm/animejs/3.1.0"],function(t,e,r,o,s,n){var a=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e,r=arguments[i];for(e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e])}return t},l=r("datav:/npm/bcore/0.0.18/event"),p=r("datav:/npm/jquery/2.1.4"),O=r("datav:/npm/lodash/4.6.1"),D=r("datav:/npm/animejs/3.1.0");return t.exports=l.extend(function(t,i){this.config={theme:{}},this.container=p(t),this.apis=i.apis,this._data=null,this.chart=null,this.swiper=null,this.randomArr=[],this.mayIndex=null,this.containerSize=null,this.cellWidth=null,this.cellHeight=null,this.restoreSpeed=0,this.mouthTimer=null,this.eatArr=[],this.init(i)},{init:function(t){this.mergeConfig(t),this.updateLayout(),this.updateStyle(),this.containerSize={width:this.container.width(),height:this.container.height()},this.container.css({position:"relative",overflow:"hidden"})},render:function(t,i){var e=this;t=this.data(t);var r=this.mergeConfig(i).global,o=r.content,s=o.prize,n=s.layout,a=s.directionHor,l=s.directionVer,h=s.prizeNum,c=s.prizeSize,d=c.sizeW,p=c.sizeH,m=s.prizeContent,f=o.drawArea,u=f.drawMode,g=f.drawSize,v=g.drawSizeW,b=g.drawSizeH,x=f.drawBorderRadius,y=f.drawBgColor,w=f.drawBorder,T=f.customPosition,i=T.show,c=T.horizontalOffset,s=T.verticalOffset,o=f.position,g=r.animation,T=g.speed,f=g.drawAreaAnima,r=f.drawMode,g=f.drawSpeed,f=this.containerSize,A=f.width,z=f.height,f=t&&0<t.length?t:m,t=this.rndArr(h,f);this.cellWidth=O.ceil(A/h),this.cellHeight=O.ceil(z/h);var m={borderRadius:x,backgroundColor:y,border:w.borderWidth+"px "+w.borderStyle+" "+w.borderColor},f="",h="",h="top"===o?f=0:"middle"===o?f="50%":(f=A-v+"px",z-b+"px"),S="";"horizontal"===n?(O.map(t,function(t,i){S+='<li class="swiper-slide" style="float: left; position: relative; width: '+e.cellWidth+"px; height: "+z+'px; text-align: center;"><img style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: '+d+"px; height: "+p+'px;" src='+t.url+" /></li>"}),this.container.html('\n          <div class="mouth" style="opacity: '+("debugMode"===u?1:0)+";position: absolute;left: "+(i?c+"px":f)+"; top: 50%; transform: "+("middle"===o?"translate(-50%, -50%)":"translateY(-50%)")+"; width: "+v+"px; height: "+b+"px; border-radius: "+x+"px; background-color: "+y+"; border: "+w.borderWidth+"px "+w.borderStyle+" "+w.borderColor+';"></div>\n          <div class="scroll-box" style="width: '+A+"px; height: "+z+'px; overflow: hidden;">\n            <ul class="swiper-container" style="margin: 0; padding: 0; list-style: none; height: '+z+'px;">'+S+"</ul>\n          </div>\n        ")):(O.map(t,function(t,i){S+='<li class="swiper-slide" style="position: relative; width: '+A+"px; height: "+e.cellHeight+'px; text-align: center;"><img style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: '+d+"px; height: "+p+'px;" src='+t.url+" /></li>"}),this.container.html('\n          <div class="mouth" style="opacity: '+("debugMode"===u?1:0)+";position: absolute;left: 50%; top: "+(i?s+"px":h)+"; transform: "+("middle"===o?"translate(-50%, -50%)":"translateX(-50%)")+"; width: "+v+"px; height: "+b+"px; "+m+"; border-radius: "+x+"px; background-color: "+y+"; border: "+w.borderWidth+"px "+w.borderStyle+" "+w.borderColor+';"></div>\n          <div class="scroll-box" style="width: '+A+"px; height: "+z+'px; overflow: hidden;">\n            <ul class="swiper-container" style="width: '+A+'px; margin: 0; padding: 0; list-style: none; height: 100px; margin: 0 auto;">'+S+"</ul>\n          </div>\n        ")),this.scrollTime&&clearInterval(this.scrollTime),this.swiper=this.scrollForever({delayTime:10,speed:T,dir:"horizontal"===n?a:l}),"scroll"===r?(this.mouthTimer&&this.clearAnimates(),"horizontal"===n?(this.container.find(".mouth").css({left:0}),this.mouthTimer=D({targets:this.container.find(".mouth")[0],translateX:A-v,easing:"linear",loop:!0,duration:1e3*g,direction:"alternate"})):(this.container.find(".mouth").css({top:0}),this.mouthTimer=D({targets:this.container.find(".mouth")[0],translateY:z-b,easing:"linear",loop:!0,duration:1e3*g,direction:"alternate"}))):this.mouthTimer&&this.clearAnimates(),this.updateStyle()},scrollForever:function(t){var e=this,i=O.defaultsDeep(t,{dir:"left",delayTime:10,speed:1}),r=i.dir,t=i.speed,i=i.delayTime,o=this.container.find(".scroll-box"),s=o.find(".swiper-container"),n=o.find("li"),a=n.length,l=void 0,h=!0,c=void 0,d=void 0;!function(){var t;c=n.outerWidth(),d=n.outerHeight(),"left"==r?(l=c*a,s.css("width",2*l),h&&(n.clone().appendTo(s),h=!1)):"top"==r?(l=d*a,s.css("height",2*l),h&&(n.clone().appendTo(s),h=!1)):"right"==r?(l=c*a,s.css("width",2*l),t=l+(l-o.width()),h&&(n.clone().appendTo(s),o.scrollLeft(t),h=!1)):"bottom"==r&&(l=d*a,s.css("height",2*l),i=l+(l-o.height()),h&&(o.scrollLeft(i),n.clone().appendTo(s),h=!1)),e.getRandomData();var i=e.container.find("li");O.map(i,function(t,i){p(t).find("img").attr("src",e.randomArr[i].url)})}(),e.optsObj={dir:r,obj:o,distance:l,speed:t,delayTime:i}},getRandomData:function(){var t=this.config.global.content.prize,i=t.prizeNum,t=t.prizeContent,t=this._data&&0<this._data.length?this._data:t;this.randomArr=this.rndArr(2*i,t)},rnd:function(t,i){var e=new Uint32Array(1);return window.crypto.getRandomValues(e),e[0]%(i-t+1)+t},rndArr:function(t,e){var r=[];for(i=0;i<t;i++)r.push(e[this.rnd(1,e.length)-1]);return r},resize:function(t,i){this.updateLayout(t,i),this.containerSize=a({},this.containerSize,{width:t,height:i}),this.render(this._data,this.config)},setColors:function(){},data:function(t){return t&&(this._data=t),this._data},mergeConfig:function(t){return t&&(this.config.theme=O.defaultsDeep(t.theme||{},this.config.theme),this.setColors(),O.set(this.config,"global.content.prize.prizeContent",O.get(t,"global.content.prize.prizeContent")),this.config=O.defaultsDeep(t||{},this.config)),this.config},updateLayout:function(){},updateStyle:function(){var t=this.config;this.container.css({"font-size":t.size+"px",color:t.color||"#fff"})},autoScroll:function(t){var i,e,r,o=this,s=t.dir,n=t.obj,a=t.distance,l=t.speed,h=this.config.global.content.prize.prizeNum,c=O.ceil(10*a/(1e3*l*h)),t=O.ceil(10*a/(1e3*l*h*2));"left"===s?(scrollDistance=n.scrollLeft(),scrollDistance>=a?(l=this.randomArr,l=this.randomArr.slice(h,l.length),this.getRandomData(),this.randomArr=O.concat(l,this.randomArr.slice(0,h)),l=this.container.find("li"),O.map(l,function(t,i){p(t).find("img").attr("src",o.randomArr[i].url)}),n.scrollLeft(0),this.resetOptionsPrev(l,h)):(n.scrollLeft(scrollDistance+c+this.restoreSpeed),i=this.container.find(".scroll-box").scrollLeft(),this.resetOptionsNext(i,h,this.cellWidth))):"top"===s?(scrollDistance=n.scrollTop(),scrollDistance>=a?(i=this.randomArr,i=this.randomArr.slice(h,i.length),this.getRandomData(),this.randomArr=O.concat(i,this.randomArr.slice(0,h)),i=this.container.find("li"),O.map(i,function(t,i){p(t).find("img").attr("src",o.randomArr[i].url)}),n.scrollTop(0),this.resetOptionsPrev(i,h)):(n.scrollTop(scrollDistance+c+this.restoreSpeed),e=this.container.find(".scroll-box").scrollTop(),this.resetOptionsNext(e,h,this.cellHeight))):"right"===s?(scrollDistance=n.scrollLeft(),e=a+(a-n.width()),scrollDistance<=0?(r=this.randomArr.slice(0,h),this.getRandomData(),this.randomArr=O.concat(this.randomArr.slice(0,h),r),r=this.container.find("li"),O.map(r,function(t,i){p(t).find("img").attr("src",o.randomArr[i].url)}),n.scrollLeft(e),this.resetOptionsPrevOther(r,h)):(n.scrollLeft(scrollDistance-t-this.restoreSpeed),r=this.container.find(".scroll-box").scrollLeft(),this.resetOptionsNextOther(r,h))):"bottom"===s&&(scrollDistance=n.scrollTop(),s=a+(a-n.height()),scrollDistance<=0?(a=this.randomArr.slice(0,h),this.getRandomData(),this.randomArr=O.concat(this.randomArr.slice(0,h),a),a=this.container.find("li"),O.map(a,function(t,i){p(t).find("img").attr("src",o.randomArr[i].url)}),n.scrollTop(s),this.resetOptionsPrevOther(a,h)):(n.scrollTop(scrollDistance-t-this.restoreSpeed),t=this.container.find(".scroll-box").scrollTop(),this.resetOptionsNextOther(t,h)))},resetOptionsPrev:function(i,e){O.map(i,function(t,i){e<=i&&p(t).css("opacity",1)}),O.map(O.uniq(this.eatArr),function(t){e<=t&&i.eq(t%e).css("opacity",0)}),this.eatArr=[]},resetOptionsNext:function(t,e,i){e*i<=t&&(t=this.container.find("li"),O.map(t,function(t,i){i<e&&p(t).css("opacity",1)}))},resetOptionsPrevOther:function(i,e){O.map(i,function(t,i){i<=e&&p(t).css("opacity",1)}),O.map(O.uniq(this.eatArr),function(t){t<=e&&i.eq(t+e).css("opacity",0)}),this.eatArr=[]},resetOptionsNextOther:function(t,e){t<=0&&(t=this.container.find("li"),O.map(t,function(t,i){e<i&&p(t).css("opacity",1)}))},getThrowValue:function(){var t,i,e,r,o=this.config.global,s=o.content,n=s.prize,a=n.layout,l=n.directionHor,h=n.directionVer,c=n.prizeSize,d=c.sizeW,p=c.sizeH,m=s.drawArea,f=m.position,u=m.drawSize,n=u.drawSizeW,c=u.drawSizeH,s=m.drawBorder.borderWidth,u=o.interaction.trigger,m=o.animation.drawAreaAnima.drawMode,o="horizontal"===a?l:h,a=-1;return"left"===o||"right"===o?(l=this.container.find(".scroll-box").scrollLeft(),i=n,r=this.cellWidth,t=d,h=(l+("scroll"===m?O.toNumber(this.container.find(".mouth").css("transform").split(",")[4]):this.container.find(".mouth")[0].offsetLeft)+i/2)/r,e=O.floor(h),n=this.container.find(".mouth")[0].offsetLeft,d=this.container.find("li")[e].offsetLeft,l="middle"===f?d-l+i/2:d-l,h=h.toFixed(2).split(".")[1][0],"simple"===u?a=h<=5?(r-t)/2+s<=n-l+i?e:-1:n-l<=r-(r-t)/2-s?e:-1:"normal"===u?a=t<=i-2*s?h<=5?(r-t)/2+t/3+s<=n-l+i?e:-1:n-l<=r-(r-t)/2-t/3-s?e:-1:h<=5?(r-t)/2+i/3+s<=n-l+i?e:-1:n-l<=r-(r-t)/2-i/3-s?e:-1:"hard"===u&&(a=t<=i-2*s?h<=5?(r-t)/2+.8*t+s<=n-l+i?e:-1:n-l<=r-(r-t)/2-.8*t-s?e:-1:h<=5?(r-t)/2+.8*i+s<=n-l+i?e:-1:n-l<=r-(r-t)/2-.8*i-s?e:-1)):"top"!==o&&"bottom"!==o||(r=this.container.find(".scroll-box").scrollTop(),t=c,i=this.cellHeight,e=p,o=(r+("scroll"===m?O.toNumber(this.container.find(".mouth").css("transform").split(",")[5].split(")")[0]):this.container.find(".mouth")[0].offsetTop)+t/2)/i,c=O.floor(o),p=this.container.find(".mouth")[0].offsetTop,m=this.container.find("li")[c].offsetTop,r="middle"===f?m-r+t/2:m-r,o=o.toFixed(2).split(".")[1][0],"simple"===u?a=o<=5?(i-e)/2+s<=p-r+t?c:-1:p-r<=i-(i-e)/2-s?c:-1:"normal"===u?a=e<=t-2*s?o<=5?(i-e)/2+e/3+s<=p-r+t?c:-1:p-r<=i-(i-e)/2-e/3-s?c:-1:o<=5?(i-e)/2+t/3+s<=p-r+t?c:-1:p-r<=i-(i-e)/2-t/3-s?c:-1:"hard"===u&&(a=e<=t-2*s?o<=5?(i-e)/2+.8*e+s<=p-r+t?c:-1:p-r<=i-(i-e)/2-.8*e-s?c:-1:o<=5?(i-e)/2+.8*t+s<=p-r+t?c:-1:p-r<=i-(i-e)/2-.8*t-s?c:-1)),a},start:function(){var t=this;this.stop(),this.mouthTimer&&this.mouthTimer.restart();var i=this.optsObj,e=i.dir,r=i.obj,o=i.distance,s=i.speed,i=i.delayTime;this.scrollTime=setInterval(function(){return t.autoScroll({dir:e,obj:r,distance:o,speed:s})},i)},restore:function(){var t=this;clearInterval(this.scrollTime),this.mouthTimer&&this.mouthTimer.play();var i=this.optsObj,e=i.dir,r=i.obj,o=i.distance,s=i.speed,n=i.delayTime,a=O.get(this.config,"global.animation.increaseSpeedSet"),i=a.show,a=a.increaseSpeed;i&&0<=this.mayIndex&&(this.restoreSpeed=this.restoreSpeed+a),this.scrollTime=setInterval(function(){return t.autoScroll({dir:e,obj:r,distance:o,speed:s})},n)},pause:function(){clearInterval(this.scrollTime),this.mouthTimer&&this.mouthTimer.pause()},lottery:function(){O.get(this.config,"global.interaction.isPause")&&(clearInterval(this.scrollTime),this.mouthTimer&&this.mouthTimer.pause());var t=O.get(this.config,"global.content.notPumped");this.mayIndex=this.getThrowValue();var i=null;0<=this.mayIndex?(i=this.randomArr[this.mayIndex],0<this.eatArr.length&&this.eatArr[this.eatArr.length-1]===this.mayIndex&&(i=t),this.container.find("li").eq(this.mayIndex).css("opacity",0),this.eatArr.push(this.mayIndex)):i=t,this.emit("itemSelect",i)},stop:function(){clearInterval(this.scrollTime);var t=this.config.global.content.prize,i=t.layout,e=t.directionHor,r=t.directionVer,o=this.optsObj,t=o.obj,o=o.distance;this.restoreSpeed=0,this.container.find("li").css("opacity",1),this.eatArr=[],"horizontal"===i?"left"===e?t.scrollLeft(0):(e=o+(o-t.width()),t.scrollLeft(e)):"top"===r?t.scrollTop(0):(o=o+(o-t.height()),t.scrollTop(o))},clearAnimates:function(){D.remove(O.get(this.mouthTimer,"animatables[0].target"))},destroy:function(t){clearInterval(this.scrollTime),this.clearAnimates(),this.swiper=null,this.container.empty()}}),t.exports});