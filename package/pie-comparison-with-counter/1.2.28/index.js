// env=undefined => env=publish 
Cube("datav:/com/pie-comparison-with-counter/1.2.28/template.html",[],function(e,l,t,a,i,n){return e.exports=function(){return'<div class="label-1 label"></div>\n<div class="chart"></div>\n<div class="label-2 label"></div>'},e.exports});;
Cube("datav:/com/pie-comparison-with-counter/1.2.28",["datav:/com/counter/1.3.18","datav:/npm/bcore/0.0.22/event","datav:/npm/dchart-pie/0.1.2","datav:/npm/lodash/4.17.11","datav:/npm/jquery/2.1.4"],function(t,e,i,a,n,r){var s=i("datav:/npm/bcore/0.0.22/event"),o=i("datav:/com/counter/1.3.18"),l=i("datav:/npm/dchart-pie/0.1.2"),h=i("datav:/npm/lodash/4.17.11"),c=i("datav:/npm/jquery/2.1.4"),d=i("datav:/com/pie-comparison-with-counter/1.2.28/template.html")();return t.exports=s.extend(function(t,e){this.config={theme:{bg:["#000","transparent"],font:["#eee","#252525"],colors:["#444547","#A0AAB3"]},container:{padding:10},labels:{global:{align:{justifyContent:"center"},textStyle:{fontSize:"12px"}},interaction:{callbackId:""},numbers:{backgroundColor:"rgba(0,0,0,0)",textStyle:{}},prefix:{textStyle:{}},suffix:{textStyle:{}},color:"#D8CAB3","font-size":14,"background-color":"rgba(1, 1, 1, 0)"},chart:{color:"#fff","decorate-color":"#fff","background-color":"rgba(1, 1, 1, 0)",margin:{top:10,bottom:10},"font-size":14,paxis:{},arc:{}},series:{serie1:{"serie-color":"rgba(1,1,1,0)"},serie2:{"serie-color":"#4DD3E2"}},labeled:{separate:!1,"text-align":"center","inner-style":{}},animation:{show:!0,animationDuration:1e3,animationEasing:"cubicInOut",animationDurationUpdate:300,animationUpdateFromPrevious:!0}},this.template=d,this.container=c(t).css("box-sizing","border-box"),this.initTheme(e),this.apis=e.apis,this.container.append(this.template),this.labelsDom=this.container.find(".label"),this.chartDom=this.container.find(".chart"),this.labels=[],this.chart=null,this._data=null,this.init()},{initColors:function(t){t.theme},init:function(){var t=this.config,a=this;this.initLayout(),t.labeled=h.defaultsDeep(t.labels,t.labeled),this.labels[0]=new o(this.labelsDom[0],t.labeled||{}),this.chart=new l(this.chartDom[0],t.chart),this.chart.afterRender=function(){var t=this.options,e=this.svg.select(".bg-inner-circle")[0][0]?this.svg.select(".bg-inner-circle"):this.svg.append("circle").attr({class:"bg-inner-circle",r:6}),i=this.svg.select(".bg-outer-circle")[0][0]?this.svg.select(".bg-outer-circle"):this.svg.append("circle").attr({class:"bg-outer-circle"}).style({fill:"none","stroke-width":"2px"});e.attr({cx:t.innerWidth/2,cy:t.innerHeight/2}).style("fill",a.config.chart.color),i.attr({cx:t.innerWidth/2,cy:t.innerHeight/2,r:t.arc._radius}).style({stroke:a.config.chart.color})},this.chart.updateAfterRender=function(){this.afterRender.call(this)},this.labels[1]=new o(this.labelsDom[1],t.labeled||{}),this.labelsDom.find(".sub-header").css("display","none")},initTheme:function(t){if(!t)return this.config;this.config.theme=h.defaultsDeep(t.theme||{},this.config.theme),this.initColors&&this.initColors(this.config),this.config=h.defaultsDeep(t||{},this.config),this.config.chart.fontFamily=this.config.fontFamily||"Microsoft Yahei"},initLayout:function(){var t=this.config,e=(this.container.css("padding",t.container.padding),this.container.height()||600),i=t.labels.height,a=t.chart.height;i||a?i?a=a||e-2*i:i=(e-a)/2:(i=.1*e,a=.8*e),t.labels.show||h.isUndefined(t.labels.show)||(i=0,a=e),this.container.height(e),this.labelsDom.outerHeight(i),this.chartDom.outerHeight(a),this.labelsDom.css("line-height",i+"px"),t.chart.arc.radius=t.chart.arc._radius=t.chart.radius*Math.min(a-t.chart.margin.top-t.chart.margin.bottom,this.chartDom.width())/2-1},trans:function(t){return t?[{value:t.y||0}]:[{value:0}]},data:function(t){return t&&(this._data=h.map(t,function(t){return t.y=h.toNumber(t.y),t})),this._data},render:function(t,e){var i,a,n,r,s,o,l,c;!(t=this.data(t))||!t.length||t.length<2||(this.initTheme(e),this.initLayout(),(e=this.config).labeled=h.defaultsDeep(e.labels,e.labeled),i=h.sumBy(t,"y"),t.sort(function(t,e){return t.y-e.y}),e.chart.paxis.label=function(t){return(t.y&&(t.y/i*100).toFixed(1)||0)+"%"},a=h.cloneDeep(e.labeled),n=h.cloneDeep(e.labeled),s=t[0].y/(t[0].y+t[1].y)*Math.PI||0,o=2*Math.PI*(e.chart.angleOffset/360),e.chart.arc.startAngle=function(t){return t.startAngle+o-s},e.chart.arc.endAngle=function(t){return t.endAngle+o-s},c=e.animation,(l=e.chart).animation=c.show,l.animationDuration=c.animationDuration,l.animationEasing=c.animationEasing,l.animationDurationUpdate=c.animationDurationUpdate,l.animationUpdateFromPrevious=c.animationUpdateFromPrevious,this.chart.render(t,e.chart),l=t[1].y>t[0].y?(r=t[1],t[0]):(r=t[0],t[1]),c={fontSize:e.labeled.fontSize,color:e.labeled.color,fontWeight:e.labeled.fontWeight},a.numbers=n.numbers={textStyle:c},a.prefix={content:l&&l.x+"："||"",textStyle:c},n.prefix={content:r&&r.x+"："||"",textStyle:c},this.labels[0].render(this.trans(l),a),this.labels[1].render(this.trans(r),n),this.updateStyle())},getThemableConfig:function(t){var e,i;return t?(i="",(e=h.get(t,"palette"))&&0<e.length&&(i=e[h.floor(e.length/2)]),{labels:{color:t.textColor},chart:{color:t.textColor},series:{serie2:{"serie-color":i}}}):null},updateStyle:function(){var t=this.config,e=(this.container.css("font-family",'"'.concat(t.fontFamily,'"')||"Microsoft Yahei"),this.chart.el.select(".con-svg").style("background",t.chart["background-color"]),this.chart.svg),i=(e.selectAll(".serie-label").style({fill:t.chart.color,"font-size":t.chart["font-size"]+"px","font-weight":t.chart.fontWeight}),e.selectAll(".bg-inner-circle").style("fill",t.chart["decorate-color"]),e.selectAll(".bg-outer-circle").style("stroke",t.chart["decorate-color"]),e.selectAll(".series-pies .serie1:first-child").style("fill",t.series.serie1["serie-color"]),e.selectAll(".series-pies .serie1:last-child").style("fill",t.series.serie2["serie-color"]),this.chart.addResumeTween(function(){e.selectAll(".series-pies .serie1:first-child").style("fill",t.series.serie1["serie-color"]),e.selectAll(".series-pies .serie1:last-child").style("fill",t.series.serie2["serie-color"])}),t.labels.show||h.isUndefined(t.labels.show));this.labelsDom.css({display:i?"flex":"none"})},resize:function(t,e){this.initLayout(),this.render()},clear:function(){this.labels&&this.labels.forEach(function(t){t.flip&&t.flip.reset()}),this.legend&&h.isFunction(this.legend.clear)&&this.legend.clear(),this.chart&&h.isFunction(this.chart.empty)&&this.chart.empty()},destroy:function(){this.chart=null,this.labelsDom=null,this.chartDom=null,this.container&&this.container.empty(),this._data=null},startAnimate:function(){if(!this.chart)return!1;var t,e;this._cfg&&(this.chart&&this.chart.clearAllAnimation(),(t=this.config.chart).animationUpdateFromPrevious=!1,e=t.animationDurationUpdate,t.animationDurationUpdate=t.animationDuration,this.chart.render(this.data(),this.config.chart),this.updateStyle(),t.animationDurationUpdate=e)},clearAnimate:function(){this.chart&&this.chart.resumeToAnimationEnd()}}),t.exports});