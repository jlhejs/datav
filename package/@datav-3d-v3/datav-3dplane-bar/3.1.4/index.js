// env=undefined => env=publish 
Cube("datav:/com/@datav-3d-v3/datav-3dplane-bar/3.1.4/src/shader/frag.glsl",[],function(n,e,t,i,a,r){return n.exports="#define GLSLIFY 1\n#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n#endif\n// uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float emissiveIntensity;\nuniform vec2 uvOffset;\n\n#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform vec3 attenuationColor;\n\tuniform float attenuationDistance;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\nvarying vec3 vInstanceColor;\nvarying float vInstanceOpacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\tvec4 diffuseColor = vec4(vInstanceColor, vInstanceOpacity * opacity);\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = vInstanceColor;\n\t#ifdef USE_TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t\tfloat thicknessFactor = thickness;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\n\t#ifdef USE_EMISSIVEMAP\n\t\tvec2 _vUv = vUv;\n\t\t_vUv.x += uvOffset.x;\n\t\t_vUv.y += uvOffset.y;\n\n\t \tvec4 emissiveColor = vec4(vInstanceColor, vInstanceOpacity) * texture2D( emissiveMap, _vUv );\n\t \temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\t \ttotalEmissiveRadiance *= emissiveColor.rgb;\n\t#endif\n\ttotalEmissiveRadiance *= emissiveIntensity;\n\n\tvec3 rawDiffuseColor = diffuseColor.rgb;\n\t#include <transmission_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",n.exports});;
Cube("datav:/com/@datav-3d-v3/datav-3dplane-bar/3.1.4/src/shader/vert.glsl",[],function(n,e,t,i,r,a){return n.exports="#define GLSLIFY 1\n#define STANDARD\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#ifdef USE_TRANSMISSION\n\tvarying vec4 vWorldPosition;\n#endif\n\nattribute vec3 color;\n// attribute float instanceOpacity;\nvarying vec3 vInstanceColor;\nvarying float vInstanceOpacity;\n#include <common>\n\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n    #ifndef FLAT_SHADED\n        vNormal = normalize( transformedNormal );\n        #ifdef USE_TANGENT\n            vTangent = normalize( transformedTangent );\n            vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n        #endif\n    #endif\n\t\n    #include <begin_vertex>\n    vUv = uv;\n\t\t#ifdef USE_INSTANCING_COLOR\n\t\t\tvInstanceColor = instanceColor;\n\t\t#endif\n    vInstanceOpacity = 1.0; //instanceOpacity;\n        \n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n    #ifdef USE_TRANSMISSION\n        vWorldPosition = worldPosition;\n    #endif\n}",n.exports});;
Cube("datav:/com/@datav-3d-v3/datav-3dplane-bar/3.1.4/src/dataprocess/canvasTexture",[],function(t,e,i,o,n,h){function B(t,e,i,o){return a.font="".concat(i," ").concat(o,"px ").concat(e),{width:Math.ceil(a.measureText(t).width),height:o}}var a=document.createElement("canvas").getContext("2d");return t.exports={getLabelTexture:function(t){var e=t.properties,i=t.labelStyle,t=t.imageUrls,o=i.contentStyle,n=i.backgroundStyle,h=o.lineSeries,a=o.fieldWidth,f=o.lineHeight,d=o.textBorder,o=document.createElement("canvas");if(o.width=0,(o.height=0)!=h.length){for(var l=h[0].content,r=h[0].fieldName,g=(Object.assign({},i.offset),e[r],B(e[r]).width,l.fontSize,0),m=0,s=0,c=0;c<h.length;c++){var w,x=w=h[c],p=x.content,y=x.prefix,x=x.suffix,S=B(e[w.fieldName],p.fontFamily,p.fontWeight,p.fontSize).width;switch(a.widthAdapt){case"adapt":S=Math.min(S,a.maxWidth);break;case"fixedWidth":S=a.fixedWidth}m=S,y.show&&(m+=+y.padding+B(y.name,y.fontFamily,y.fontWeight,y.fontSize).width),x.show&&(m+=+x.padding+B(x.name,x.fontFamily,x.fontWeight,x.fontSize).width),g=Math.max(m,g),s+=Math.max(y.fontSize,p.fontSize,x.fontSize)}for(var u={left:0,right:0,top:0,bottom:0},i={width:g+(u=n.show?n.margin:u).left+u.right,height:s*f+u.top+u.bottom},r=n.border,W=("vector"===n.backgroundType?(o.width=2*(i.width+r.weight),o.height=2*(i.height+r.weight),o.style.width=i.width+r.weight+"px",o.style.height=i.height+r.weight+"px"):"image"==n.backgroundType&&(o.width=2*i.width,o.height=2*i.height,o.style.width=i.width+"px",o.style.height=i.height+"px"),o.getContext("2d")),z=(W.imageSmoothingQuality="high",W.scale(2,2),n.show&&("vector"===n.backgroundType?W.roundRect(0,0,i.width,i.height,n):"image"==n.backgroundType&&t[n.imageUrl]&&W.drawImage(t[n.imageUrl],0,0,i.width,i.height)),W.strokeStyle=d.color,W.lineWidth=d.weight,W.textBaseline="bottom",u.top),c=0;c<h.length;c++){var b=w=h[c],v=b.content,T=b.prefix,b=b.suffix,k=(z+=Math.max(T.fontSize,v.fontSize,b.fontSize)*f,B(e[w.fieldName],v.fontFamily,v.fontWeight,v.fontSize).width,T.show&&(W.font=T.fontWeight+" "+T.fontSize+"px "+T.fontFamily,W.fillStyle=T.color,d.show&&W.strokeText(T.name,u.left,z),W.fillText(T.name,u.left,z)),W.font=v.fontWeight+" "+v.fontSize+"px "+v.fontFamily,W.fillStyle=v.color,e[w.fieldName]),F=B(k,v.fontFamily,v.fontWeight,v.fontSize).width,S=0;switch(a.widthAdapt){case"adapt":S=Math.min(F,a.maxWidth);break;case"fixedWidth":S=a.fixedWidth}if(S<F){for(var M=0,N=0,C=W.measureText("...",v.fontFamily,v.fontWeight,v.fontSize).width,U=0;U<k.length;U++)(M+=W.measureText(k[U],v.fontFamily,v.fontWeight,v.fontSize).width)<S-C&&N++;k=k.substring(0,N)+"..."}var A=u.left;T.show&&(A+=T.padding+B(T.name,T.fontFamily,T.fontWeight,T.fontSize).width),d.show&&W.strokeText(k,A,z),W.fillText(k,A,z),b.show&&(W.font=b.fontWeight+" "+b.fontSize+"px "+b.fontFamily,W.fillStyle=b.color,S=Math.min(S,F),d.show&&W.strokeText(b.name,A+S+b.padding,z),W.fillText(b.name,A+S+b.padding,z))}}return o}},t.exports});;
Cube("datav:/com/@datav-3d-v3/datav-3dplane-bar/3.1.4/src/barLayer.js",[],function(e,t,o,a,i,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var a;if(e)return"string"==typeof e?s(e,t):"Map"===(a="Object"===(a=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?s(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function l(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,a){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}(e,t);if(i)return(i=Object.getOwnPropertyDescriptor(i,t)).get?i.get.call(arguments.length<3?e:a):i.value}).apply(this,arguments)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function v(a){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=m(a),t=(e=i?(e=m(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return g(t)}}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}return e.exports=function(b){var w=b.THREE,e=b.Utils,h=b.GuiUtils,p=e._,S=e.mergeOptions,O=(e.deepClone,e.Chroma),x=e.BASE_HEIGHT_SCALE,c=o("datav:/com/@datav-3d-v3/datav-3dplane-bar/3.1.4/src/dataprocess/canvasTexture").getLabelTexture,r=(new w.TextureLoader).setCrossOrigin("*");function n(t,a,e){e?r.load(e,function(e){e.wrapS=e.wrapT=w.MirroredRepeatWrapping,e.repeat.set(1,1),e.anisotropy=12,t[a]=e,t.needsUpdate=!0}):(t[a]=null,t.needsUpdate=!0)}var e=b.Layer,t=s;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e);var a,i=v(s);function s(e){var t,a;if(this instanceof s)return(t=i.call(this)).options=S(t.options,{visible:!0,renderOrder:300}),t.options=S(t.options,e||{}),t.renderQueue=b.VOGO.Transparent,t.needsAutoUpdate=!0,t.eventsType={click:!0},t.selectFeatures=[],t.min=-1/0,t.max=1/0,t.data=[],t.timeIndex=0,t.timeStep=.1,t.imageUrls={},t.mappingData={},t.draw=t.draw.bind(g(t)),t.addLabels=t.addLabels.bind(g(t)),t._addLabels=t._addLabels.bind(g(t)),t.removeLabels=t.removeLabels.bind(g(t)),t.deSelect=t.deSelect.bind(g(t)),t.getMappingData=t.getMappingData.bind(g(t)),t.initMaterial=t.initMaterial.bind(g(t)),t.updateMaterial=t.updateMaterial.bind(g(t)),t.updateOptions=t.updateOptions.bind(g(t)),a=(e=e.graph).topTexture,e=e.sideTexture,t.materialTop=t.initMaterial(a),t.materialSide=t.initMaterial(e),t;throw new TypeError("Cannot call a class as a function")}return t=s,(e=[{key:"onClick",value:function(e){if(this.data&&this.data[e.instanceId]){var e=this.data[e.instanceId],t=this.options.interaction.graph;if(t.multiSelection||this.deSelect(),this.selectFeatures.push(e),this.emit("click",this.selectFeatures),this.addLabels(),t.show&&t.clickStyle.show)for(var a,i,r,e=O(t.clickStyle.fillColor).gl(),n=new w.Color(e[0],e[1],e[2]),s=0;s<this.group.children.length;s++)if((i=this.group.children[s]).userData.isBar){for(a=0;a<this.selectFeatures.length;a++)r=this.selectFeatures[a].data_index,i.setColorAt(r,n);i.instanceColor&&(i.instanceColor.needsUpdate=!0)}}}},{key:"deSelect",value:function(){for(var e,t,a,i,r=0;r<this.group.children.length;r++)if((t=this.group.children[r]).userData.isBar){for(e=0;e<this.selectFeatures.length;e++)a=this.selectFeatures[e].data_index,i=this.mappingData[a],i=O(i.fillColor).gl(),i=new w.Color(i[0],i[1],i[2]),t.setColorAt(a,i);t.instanceColor&&(t.instanceColor.needsUpdate=!0)}this.selectFeatures=[];var n=this.options.label;n.isShow&&"all"==n.eventType||this.removeLabels()}},{key:"removeLabels",value:function(){for(var e,t=0;t<this.group.children.length;t++)"Sprite"==(e=this.group.children[t]).userData.meshType&&(this.group.remove(e),t--)}},{key:"initMaterial",value:function(e){var t=e.metalness,a=e.map,i=e.emissive,e=this.options.general,e=new w.MeshStandardMaterial({opacity:.01*e.opacity,metalness:.01*t,map:r.load(a),emissive:new w.Color("#fff"),emissiveMap:r.load(i.emissiveMap),transparent:!0,depthWrite:!0,depthTest:!0,flatShading:w.FlatShading});return n(e,"map",a),n(e,"emissiveMap",i.emissiveMap),e.onBeforeCompile=function(e){e.uniforms.uvOffset={value:{x:0,y:0}},e.uniforms.emissiveIntensity={value:i.show?.01*i.emissiveIntensity:.01},e.vertexShader=o("datav:/com/@datav-3d-v3/datav-3dplane-bar/3.1.4/src/shader/vert.glsl"),e.fragmentShader=o("datav:/com/@datav-3d-v3/datav-3dplane-bar/3.1.4/src/shader/frag.glsl"),this.userData.shader=e},e.needsUpdate=!0,e}},{key:"autoUpdate",value:function(){var e,t,a;this.options&&(e=(a=this.options).visible,a.general,a=a.graph,e&&(e=a.topTexture,a=a.sideTexture,t=this.materialSide.userData.shader,a=a.emissive,t&&(a.show?(1e4<t.uniforms.uvOffset.value.x||t.uniforms.uvOffset.value.x<-1e4?t.uniforms.uvOffset.value.x=0:t.uniforms.uvOffset.value.x-=.01*a.uvSpeedX*.01,1e4<t.uniforms.uvOffset.value.y||t.uniforms.uvOffset.value.y<-1e4?t.uniforms.uvOffset.value.y=0:t.uniforms.uvOffset.value.y-=.01*a.uvSpeedY*.01,t.uniforms.emissiveIntensity.value=.01*a.emissiveIntensity):t.uniforms.emissiveIntensity.value=0),t=this.materialTop.userData.shader,a=e.emissive,t&&(t.uniforms.emissiveIntensity.value=a.show?.01*a.emissiveIntensity:0)))}},{key:"render",value:function(e){if(this.data=[],e&&0<e.length)for(var t=0;t<e.length;t++){var a,i=e[t];i.hasOwnProperty("lng")&&i.hasOwnProperty("lat")&&(a=b.proj.proj([+i.lng,+i.lat,0]),i.xyz=[~~a[0],~~a[1],0],this.data.push(i))}for(var r=0;r<this.data.length;r++)this.data[r].data_index=r;this.draw()}},{key:"updateArea",value:function(){this.render(this.data)}},{key:"draw",value:function(){if(this.deSelect(),this.clear(),0!==this.data.length){var e=this.getMappingData();if((this.mappingData=e)&&0!==e.length){for(var t,a,e=this.options,i=e.graph,r=e.label,e=e.renderOrder,i=i.barStyle,n=b.baseHeightScale,s=b.drawScale,n=(this.group.position.z=~~(s*x*n),i.radiusTop*s*1e4),o=i.radiusBottom*s*1e4,l=i.edges,i=i.angles,d=~~(s*x*.02),u=new w.CylinderGeometry(n,n,1,l,1,!1),h=(u.rotateX(Math.PI/2),u.rotateZ(i*Math.PI/180),new w.InstancedMesh(u,this.materialTop,this.data.length)),u=(h.position.z=d,h.frustumCulled=!1,h.userData=S(h.userData,{isBar:!0,isClick:!0,meshType:"InstancedMesh"}),this.add(h),h.renderOrder=e,new w.CylinderGeometry(n,o,1,l,1,!0)),p=(u.rotateX(Math.PI/2),u.rotateZ(i*Math.PI/180),new w.InstancedMesh(u,this.materialSide,this.data.length)),c=(p.position.z=d,p.frustumCulled=!1,p.userData=S(p.userData,{isBar:!0,isClick:!0,meshType:"InstancedMesh"}),this.add(p),p.renderOrder=e,r.heightOffset),f=new w.Matrix4,v=new w.Matrix4,g=0;g<this.data.length;g++){t=this.data[g],a=~~((t=S(t,this.mappingData[t.data_index])).barHeight*s*2e5),this.data[g].xyz[2]=~~(d+a+1e4*s*c),m=t.xyz[0],y=t.xyz[1],v.makeScale(1,1,a),v.setPosition(m,y,a/2),p.setMatrixAt(g,v),f.setPosition(m,y,a),h.setMatrixAt(g,f);var m=O(t.fillColor).gl(),y=new w.Color(m[0],m[1],m[2]);p.setColorAt(g,y),h.setColorAt(g,y)}p.instanceColor&&(p.instanceColor.needsUpdate=!0,p.instanceMatrix.needsUpdate=!0,h.instanceColor.needsUpdate=!0,h.instanceMatrix.needsUpdate=!0,h.material.needsUpdate=!0,p.material.needsUpdate=!0),this.addLabels()}}}},{key:"addLabels",value:function(){this.removeLabels();var r,n,e=this.options.label;e.isShow&&("vector"===(r=e.backgroundStyle).backgroundType||this.imageUrls[r.imageUrl]?this._addLabels():"image"!==r.backgroundType||this.imageUrls[r.imageUrl]||(n=this,new Promise(function(a,e){var i=new Image;i.crossOrigin="anonymous",i.onload=function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=i.width,e.height=i.height,t.drawImage(i,0,0,e.width,e.height),n.imageUrls[r.imageUrl]=e,a(!0)},i.onerror=function(){e(new Error("Could not load image at "+url))},i.src=r.imageUrl}).then(function(e){e&&n._addLabels()})))}},{key:"_addLabels",value:function(){for(var e,t,a,i,r,n,s=this.options,o=s.label,l=s.renderOrder,d=!1,u=0;u<this.data.length;u++){if(i=(n=this.data[u]).xyz,t=S(n,this.mappingData[n.data_index]),d=!1,"click"==o.eventType)for(e=0;e<this.selectFeatures.length;e++)if(this.selectFeatures[e].data_index==t.data_index){d=!0;break}"all"!=o.eventType&&!d||(n=c({properties:t,labelStyle:o,imageUrls:this.imageUrls}),a=new w.CanvasTexture(n),a=new w.SpriteMaterial({map:a,transparent:!0,depthWrite:!0,depthTest:!0,sizeAttenuation:!1,opacity:1}),(a=new w.Sprite(a)).center.set(.5,0),(r=a.position).set.apply(r,f(i)),i=.36/(null!=(r=null==(r=b.constants)||null==(i=r.size)?void 0:i.height)?r:b.container.clientHeight),r=n.width/2*i,n=n.height/2*i,a.scale.set(r,n,1),a.userData=S(t,{meshType:"Sprite"}),this.add(a),a.renderOrder=l+1)}this.checkVisible()}},{key:"getMappingData",value:function(){for(var e,t=h.validateCustomStyle,a=p.get(this.options,"condition.condition"),i=p.get(h,"scale.size")({config:p.get(this.options,"graph.sizeMapping"),data:this.data,field:"sizeField"}),r=p.get(h,"scale.color")({config:p.get(this.options,"graph.colorMapping"),data:this.data,field:"colorField"}),n={},s=0;s<this.data.length;s++){var o,l,d={},u=(l=t({config:a,data:o=S({},this.data[s]),ruleKey:"rules"}))&&l[0]?l[0]:null;if(o.fillColor)d.fillColor=o.fillColor;else for(e=l.length-1;0<=e&&(u=l[e]).graph.show;e--)if(u.graph.fillColor.show){d.fillColor=u.graph.fillColor.value;break}for(e=l.length-1;0<=e&&(u=l[e]).graph.show;e--)if(u.graph.barHeight.show&&u.graph.barHeight.show){d.barHeight=u.graph.barHeight.value;break}d.hasOwnProperty("fillColor")||(d.fillColor=r(o.colorField)),d.hasOwnProperty("barHeight")||(d.barHeight=i(o.sizeField)),n[o.data_index]=S(o,d)}return n}},{key:"updateOptions",value:function(e){var t=S({},this.options),e=(this.options=S(this.options,e),this.options),a=e.general,e=e.graph,i=e.topTexture,e=e.sideTexture;this.materialTop.opacity=.01*a.opacity,this.materialSide.opacity=.01*a.opacity,this.updateMaterial(this.materialSide,t.graph.sideTexture,e),this.updateMaterial(this.materialTop,t.graph.topTexture,i),this.draw()}},{key:"updateBaseHeight",value:function(){var e=b.baseHeightScale,t=b.drawScale;this.group.position.z=~~(t*e*x)}},{key:"updateMaterial",value:function(e,t,a){var i=a.metalness,r=a.map,a=a.emissive;t.metalness!=i&&(e.metalness=.01*i),t.map!=r&&n(e,"map",r),t.emissive.emissiveMap!=a.emissiveMap&&n(e,"emissiveMap",a.emissiveMap),e.needsUpdate=!0}},{key:"checkVisible",value:function(){this.options.visible?this.show():this.hide()}},{key:"show",value:function(){this.options.visible=!0,d(m(s.prototype),"show",this).call(this)}},{key:"hide",value:function(){this.options.visible=!1,d(m(s.prototype),"hide",this).call(this)}},{key:"destroy",value:function(){d(m(s.prototype),"remove",this).call(this),this.clear(),this.needsAutoUpdate=!1,this.min=null,this.max=null,this.data=null,this.options=null,this.imageUrls}}])&&l(t.prototype,e),a&&l(t,a),Object.defineProperty(t,"prototype",{writable:!1}),s},e.exports});;
Cube("datav:/com/@datav-3d-v3/datav-3dplane-bar/3.1.4",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(e,t,r,n,o,i){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=c(r),t=(e=n?(e=c(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var y=r("datav:/npm/eventemitter3/3.0.0"),f=r("datav:/npm/safely-merge/1.0.1"),p=r("datav:/com/@datav-3d-v3/datav-3dplane-bar/3.1.4/src/barLayer.js"),r=function(){var e=o,t=y;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t);var r,n=u(o);function o(e,t){var r;if(this instanceof o)return(r=n.call(this)).options=f({},t.options||{}),r.classNameAlias="BarLayer",r.visible=!0,r.data=[],r;throw new TypeError("Cannot call a class as a function")}return e=o,(t=[{key:"addTo",value:function(e,t){var r=this,t=(this.layerId=t,p(e));this.layer=new t(this.options),e.addLayer(this.layerId+"_layer",this.layer),this.visible?this.layer.show():this.layer.hide(),this.layer.on("click",function(e){r.emit("click",e)})}},{key:"updateArea",value:function(){this.layer&&this.layer.updateArea&&this.layer.updateArea()}},{key:"render",value:function(e){var t=[],r=0;if(e&&e.length){for(var n,o=0;o<e.length;o++)n=e[o],Number.isFinite(parseFloat(n.lng))&&Number.isFinite(parseFloat(n.lat))?t.push(n):r++;0<r&&console.log("二维图标层：有 "+r+" 条异常数据。")}this.data=t,this.layer&&this.layer.render&&this.layer.render(t)}},{key:"updateOptions",value:function(e){this.options=f(this.options,e.options),this.layer&&this.layer.updateOptions&&this.layer.updateOptions(this.options)}},{key:"updateBaseHeight",value:function(){this.layer&&this.layer.updateBaseHeight&&this.layer.updateBaseHeight()}},{key:"show",value:function(){this.visible=!0,this.layer&&this.layer.show()}},{key:"hide",value:function(){this.visible=!1,this.layer&&this.layer.hide()}},{key:"destroy",value:function(){this.layer&&(this.layer.off("rendered"),this.layer.destroy(),this.layer=null,this.data=null)}}])&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),o}();return e.exports=r,e.exports});