// env=undefined => env=publish 
Cube("datav:/com/map2d-layer-flyingline-canvas/0.1.0",["datav:/npm/bcore/0.0.21/event","datav:/npm/bcore/0.0.21/utils","datav:/npm/chroma-js/1.3.4","datav:/npm/ldmap/0.1.41/layer/flyingline_canvas/flying_lines_canvas"],function(a,b,c){function d(){var a=arguments[arguments.length-1];this.options=f.deepMerge(d.options,a),this.indexFlying=0,this.indexFlyingN=0,this.dataPool=[],this.loop()}var e=c("datav:/npm/bcore/0.0.21/event"),f=c("datav:/npm/bcore/0.0.21/utils"),g=c("datav:/npm/chroma-js/1.3.4"),h=c("datav:/npm/ldmap/0.1.41/layer/flyingline_canvas/flying_lines_canvas");return d.options={},d=e.extend(d,{addTo:function(a){a._map&&(a=a._map),this._map=a,this.initCom()},getOptions:function(){var a=this.options;return Object.keys(a.style).forEach((b)=>{-1!==b.toLowerCase().indexOf("color")&&(a.style[b]="rgba("+g(a.style[b]).rgba().join(",")+")")}),a},initCom:function(){var a=this.getOptions(this.options),b=this.layer=new h(a);b.addTo(this._map),b.updateOptions(a)},updateOptions:function(a){a&&(a=this.options=f.deepMerge(this.options,a)),this.layer.updateOptions(this.getOptions(a))},remove:function(){this.layer.remove&&this.layer.remove(),window.cancelAnimationFrame(this.loopId),this.indexFlying=0,this.indexFlyingN=0,this.dataPool=null},render:function(a){if(!a)return console.log("\u5730\u56FE\u7EC4\u4EF6Map2dCanvasFlyingLine\u672A\u6536\u5230\u6570\u636E...");var a=a.map(function(a){return{from:{lat:+a.from.lat||+a.from.split(",")[1],lng:+a.from.lng||+a.from.split(",")[0]},to:{lat:+a.to.lat||+a.to.split(",")[1],lng:+a.to.lng||+a.to.split(",")[0]}}});this.dataPool=a,this.layer.render(a)},loop:function(){var a=this.dataPool.length,b=this.options,c=b.outSpeed;if(this.indexFlying++,this.indexFlying%=10-c,0===this.indexFlying&&a){var d=this.dataPool[this.indexFlyingN];this.layer&&this.layer.render([d]),this.indexFlyingN++,this.indexFlyingN%=a}this.loopId=window.requestAnimationFrame(this.loop.bind(this))}}),a.exports=d,a.exports});