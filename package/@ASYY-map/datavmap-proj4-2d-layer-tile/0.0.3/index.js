// env=undefined => env=publish 
Cube("datav:/com/datavmap-proj4-2d-layer-tile/0.0.3/filter.js",["datav:/npm/bcore/0.0.21/event"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=null;return a.exports=function(a){function b(a){return(Math.round(1e4*a)/100).toFixed(2)+"%"}var i=c("datav:/npm/bcore/0.0.21/event"),j=a.datavUtils,k={brightness:1,contrast:1,grayscale:0,hueRotate:0,invert:0,saturate:1,sepia:0,blur:0};return h||(h=function(a){function c(a,b){d(this,c);var f=e(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));return f.container=a,f.options=j.mergeOptions(k,b),f}return f(c,a),g(c,[{key:"setContainer",value:function(a){this.container=a,this.updateOptions({})}},{key:"reset",value:function(){this.updateFilter(k)}},{key:"updateFilter",value:function(a){this.container.style.transition="-webkit-filter .2s",this.container.style["-webkit-filter"]="brightness("+b(a.brightness)+") contrast("+b(a.contrast)+") grayscale("+b(a.grayscale)+") hue-rotate("+a.hueRotate+"deg) invert("+b(a.invert)+") saturate("+b(a.saturate)+") sepia("+b(a.sepia)+") blur("+a.blur+"px)"}},{key:"updateOptions",value:function(a){this.options=j.mergeOptions(this.options,a),this.updateFilter(this.options)}}]),c}(i))},a.exports});;
Cube("datav:/com/datavmap-proj4-2d-layer-tile/0.0.3/tileLayer.js",[],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=null;return a.exports=function(a){function b(a,b){for(var c=(a+"").length,d="",e=0;e<b-c;e++)d+="0";return d+a}var i=a.datavUtils,j=a.BaseLayer,k=c("datav:/com/datavmap-proj4-2d-layer-tile/0.0.3/filter.js")(a),l={opacity:1,maskColor:"rgba(0,0,0,0)",url:"",isFilter:!1,filter:{brightness:1,contrast:1,grayscale:0,hueRotate:0,invert:0,saturate:1,sepia:0,blur:0}};return h||(h=function(c){function h(a){d(this,h);var b=e(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));return a=i.mergeOptions(l,a),b.options=i.mergeOptions(b.options,a),b}return f(h,c),g(h,[{key:"init",value:function(){var c=this,d=Object.assign({},this.options);switch(d.tileType){case"\u676D\u5DDE\u5E02PGIS":a.TileLayer.Proj4=a.TileLayer.extend({minZoom:d.minZoom,maxZoom:d.maxZoom,getTileUrl:function(c){return a.Util.template(d.url,a.extend({s:this._getSubdomain(c),z:"L"+b(c.z,2),x:"C"+b(c.x.toString(16),8),y:"R"+b(c.y.toString(16),8)},d))}});break;case"\u5317\u4EAC54_NewMap":case"\u5317\u4EAC54_\u897F\u57CE\u533A_\u8D85\u56FE":var e=d.zoomOffset.split(",");a.TileLayer.Proj4=a.TileLayer.extend({minZoom:d.minZoom,maxZoom:d.maxZoom,getTileUrl:function(b){var c=void 0,f=d.getUrlArgs;return c=f?f(b):{z:b.z,x:b.x,y:b.y+ +e[b.z]},a.Util.template(d.url,a.extend(c,d,{s:this._getSubdomain(b)}))}});break;default:a.TileLayer.Proj4=a.TileLayer.extend({minZoom:d.minZoom,maxZoom:d.maxZoom,getTileUrl:function(b){return a.Util.template(d.url,a.extend({z:b.z,x:b.x,y:b.y},d,{s:this._getSubdomain(b)}))}});}a.tileLayer.Proj4=function(b,c){return new a.TileLayer.Proj4(b,c)},this.layer=a.tileLayer.Proj4(d.url,{layers:"Proj4"+this.getRandomCode(20),format:"image/png",transparent:!0}).addTo(this.map),this.layer&&this.layer.setOpacity(d.opacity),this.initFilter(),this.updateFilter(d);var f=this.mask=document.createElement("div"),g=this.map.getSize();f.style.width=g.x+"px",f.style.height=g.y+"px",f.style.position="absolute",f.style.top=0,f.style.left=0,f.style.zIndex=1,f.style.pointerEvents="none",f.style.background=d.maskColor||"rgba(0,0,0,0)",f.setAttribute("class","leaflet-mask"),this.map.getPane("tilePane").appendChild(f),this.map.on("move",function(){if(c.mask){var b=c.map.getSize();c.mask.style.width=b.x+"px",c.mask.style.height=b.y+"px";var d=a.DomUtil.getPosition(c.map.getPane("mapPane"));d&&a.DomUtil.setPosition(c.mask,{x:-d.x,y:-d.y})}},this),this.visibility=!0}},{key:"getRandomCode",value:function(a){if(0<a){for(var b,c=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],d="",e=0;e<a;e++)b=parseInt(61*Math.random()),d+=c[b];return d}return!1}},{key:"initFilter",value:function(){this.filter=new k(this.layer.getContainer(),this.options.filter)}},{key:"updateFilter",value:function(a){a.isFilter?this.filter.updateOptions(a.filter):this.resetFilter()}},{key:"updateFilterContainer",value:function(){this.filter&&this.filter.setContainer(this.layer.getContainer())}},{key:"resetFilter",value:function(){this.filter&&this.filter.reset()}},{key:"show",value:function(){this.visibility=!0,this.layer&&this.layer.setOpacity(this.options.opacity)}},{key:"hide",value:function(){this.visibility=!1,this.layer&&this.layer.setOpacity(0)}},{key:"setZIndex",value:function(a){this.layer&&this.layer.setZIndex(a)}},{key:"updateUrl",value:function(a){this.options.url===a.url||(this.layer.setUrl(tileOptions.url),this.layer.options=i.mergeOptions(this.layer.options,this.options),this.updateFilterContainer())}},{key:"onUpdateOptions",value:function(a){this.updateUrl(a),this.mask.style.background=a.maskColor,this.layer&&(this.visibility?this.layer.setOpacity(a.opacity):this.layer.setOpacity(0)),this.updateFilter(a)}},{key:"onRemove",value:function(){this.layer&&this.layer.remove(),this.layer=null}}]),h}(j))},a.exports});;
Cube("datav:/com/datavmap-proj4-2d-layer-tile/0.0.3",["datav:/npm/bcore/0.0.21/event"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/bcore/0.0.21/event"),i=c("datav:/com/datavmap-proj4-2d-layer-tile/0.0.3/tileLayer.js"),j=void 0,k={},l=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.container="string"===typeof a?document.querySelector(a):a,f.apis=c.apis,f.map=null,f._data=null,f.config=c,f}return f(b,a),g(b,[{key:"init",value:function(){var a=this.getOptions(),b=i(this.map.L);this.layer=new b(a),this.layer.addTo(this.map)}},{key:"addTo",value:function(a){this.map=a,j=a.L.datavUtils,this.init()}},{key:"getOptions",value:function(){return this.config=j&&j.mergeOptions(k,this.config),this.config}},{key:"data",value:function(a){return a&&(this._data=a),this._data}},{key:"show",value:function(){this.layer&&this.layer.show()}},{key:"hide",value:function(){this.layer&&this.layer.hide()}},{key:"remove",value:function(){this.layer&&this.layer.remove&&this.layer.remove(),this.layer=null,this._data=null}},{key:"render",value:function(){}},{key:"updateOptions",value:function(a){this.config=j.mergeOptions(this.config,a),a=this.getOptions(),this.layer&&this.layer.updateOptions(a)}}]),b}(h);return a.exports=l,a.exports});