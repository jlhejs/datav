// env=undefined => env=publish 
Cube("datav:/com/datav-2dmap-flyingline/3.0.21/src/lib/BezierCurve",[],function(t,e,n,a,r,o){function i(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var s=(function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}(u,[{key:"data",value:function(t){if(t&&Array.isArray(t)&&!(t.length<2)){this._data=t,this.ptsN=t.length;t=this.path=[];return this.processing(),t}console.log("最少二个控制点")}},{key:"processing",value:function(){for(var t=this.options.outN,e=this._data,n=void 0,a=0;a<t;a++)n=a/t,this.calculate(e,n=a===t-1?1:n)}},{key:"calculate",value:function(t,e){var n=this.path;if(2===t.length)n.push(this.percentCoords(t[0],t[1],e));else if(2<t.length){for(var a,r=[],o=0;o<t.length-1;o++)a=this.percentCoords(t[o],t[o+1],e),r.push(a);this.calculate(r,e)}}},{key:"ptsDistance",value:function(t,e){var n=Math.pow(t[0]-e[0],2),e=Math.pow(t[1]-e[1],2);return Math.pow(n+e,.5)}},{key:"percentCoords",value:function(t,e,n){var a=t[0]+(e[0]-t[0])*n,n=t[1]+(e[1]-t[1])*n;return[Math.floor(100*a)/100,Math.floor(100*n)/100]}}]),u);function u(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u);this.options=Object.assign({outN:200},t||{})}return t.exports=s,t.exports});;
Cube("datav:/com/datav-2dmap-flyingline/3.0.21/src/lib/data-pool",[],function(t,a,e,n,r,i){function s(t,a){for(var e=0;e<a.length;e++){var n=a[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=(function(t,a,e){return a&&s(t.prototype,a),e&&s(t,e),t}(u,[{key:"addData",value:function(t){t&&[].push.apply(this.data,t)}},{key:"clean",value:function(){this.data=[],this.dsIndex=0,this.discardArray=[]}},{key:"getDataLength",value:function(){return this.data?this.data.length:0}},{key:"getAllData",value:function(){var t=this.data;return t||[]}},{key:"check",value:function(){var t,a=this.options.maxN;this.discardArray=[];var e=this.data;return e.length>a&&(t=e.length-a,this.discardArray=e.splice(0,t)),this.discardArray}},{key:"outDataClean",value:function(t){var a=this.data,t=t||this.options.outN;return a?a.splice(0,t):[]}},{key:"outData",value:function(t){var a=this.data,e=[],n=t||this.options.outN,r=a.length,i=this.dsIndex;if(a){if(r<=n)return e=a;if(i+n<=r){for(var s=i;s<n+i;s++){var o=a[s];e.push(o)}this.dsIndex+=n}else{for(var u=i+n-r,h=i;h<r;h++){var d=a[h];e.push(d)}for(var l=0;l<u;l++){var c=a[l];e.push(c)}this.dsIndex=u}return e}}}]),u);function u(t){!function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,u);this.options=Object.assign({maxN:10,outN:3},t||{}),this.data=[],this.dsIndex=0}return t.exports=o,t.exports});;
Cube("datav:/com/datav-2dmap-flyingline/3.0.21/src/lib/flyingLine.js",["datav:/npm/safely-merge/1.0.1"],function(t,i,a,s,e,n){var o=function(t,i,a){return i&&h(t.prototype,i),a&&h(t,a),t};function h(t,i){for(var a=0;a<i.length;a++){var s=i[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var r=a("datav:/npm/safely-merge/1.0.1"),p=a("datav:/com/datav-2dmap-flyingline/3.0.21/src/lib/BezierCurve"),o=(o(u,[{key:"set",value:function(t,i){this.map=t,this.lineIndex=i}},{key:"init",value:function(){var t=this.options.ptsN=~~this.options.ptsN;this.beziercurve=new p({outN:t}),this.reset()}},{key:"reset",value:function(){var t=this.options;this.step=~~t.step,this.ptsStart=0,this.pathLength=~~t.ptsN}},{key:"data",value:function(t){t&&this.processing(t)}},{key:"updateData",value:function(){var t=this._data,i=this.usingData=[];if(t){var a=this.options,s=~~a.step,a=~~a.speed;if(this.ptsStart<s)for(var e=0;e<this.ptsStart;e++)i.push(t[e]);else if(s<=this.ptsStart&&this.ptsStart<this.pathLength)for(e=this.ptsStart-s;e<this.ptsStart;e++)i.push(t[e]);else if(this.ptsStart>=this.pathLength)for(e=this.ptsStart-s;e<this.pathLength;e++)i.push(t[e]);this.ptsStart+=a}}},{key:"updatePath",value:function(){this.usingData.length}},{key:"outData",value:function(){var t=this.usingData;return!t||t.length<2?[]:t}},{key:"latLngToContainerPoint",value:function(t){if(t){var i=this.map.latLngToContainerPoint([t.from.lat,t.from.lng]),t=this.map.latLngToContainerPoint([t.to.lat,t.to.lng]);return[[i.x-this.options.offset.x,i.y-this.options.offset.y],[t.x-this.options.offset.x,t.y-this.options.offset.y]]}}},{key:"processing",value:function(t){this._data={};var i=this.beziercurve,a=this.latLngToContainerPoint(t),s=this.getControlPoint(a),a=[a[0],s,a[1]];i.options.outN=~~this.options.ptsN,this.ds=t,this._data=i.data(a)}},{key:"getControlPoint",value:function(t){var i=this.options.height,a=t[0],s=t[1],e=a[0],n=s[0],o=a[1],t=s[1],a=Math.pow(Math.pow(e-n,2)+Math.pow(o-t,2),.5);a*=i;s=Math.pow((n-e)/(t-o),2),i=Math.pow((t-o)/(n-e),2);return[(e+n)/2+a/Math.pow(s+1,.5),(o+t)/2-a/Math.pow(i+1,.5)]}},{key:"updateOptions",value:function(t){this.options=r(this.options,t)}},{key:"update",value:function(){this.updateData(),this.updatePath()}}]),u);function u(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,u);this.options=r({ptsN:400,step:80,speed:1,height:2.5},t||{}),this.init()}return t.exports=o,t.exports});;
Cube("datav:/com/datav-2dmap-flyingline/3.0.21/config",[],function(e,t,c,p,r,o){return e.exports={DEFAULT_OPTIONS:{renderer:"canvas",isAnimateLayer:!0,visibility:!0,general:{zoomRange:[0,18],minZoom:0,maxZoom:22},graph:{flyinglineStyle:{outSpeed:1,step:80,lineWidth:1,ptsN:20,height:2,lineN:200},flareStyle:{show:!0,color:"rgba(100, 227, 249, 1.0)",size:2},circleStyle:{show:!1,color:"rgba(100, 227, 249, 1.0)",radius:20,speed:5},strokeColor:function(e,t,c,p,r){return"rgba("+~~((t.r-e.r)*c+e.r)+","+~~((t.g-e.g)*c+e.g)+","+~~((t.b-e.b)*c+e.b)+","+r*t.a+")"},strokeColorSeries:{},colorStep:20,lineStyleType:{"线型1":[{percent:0,opacity:1},{percent:1,opacity:0}],"线型2":[{percent:0,opacity:1},{percent:1,opacity:1}],"线型3":[{percent:0,opacity:.1},{percent:.25,opacity:1},{percent:.5,opacity:1},{percent:1,opacity:0}],"线型4":[{percent:0,opacity:1},{percent:.1,opacity:1},{percent:.2,opacity:.25},{percent:.3,opacity:1},{percent:.4,opacity:.25},{percent:.5,opacity:1},{percent:.6,opacity:.25},{percent:.7,opacity:1},{percent:.8,opacity:.25},{percent:.9,opacity:1},{percent:1,opacity:.25}],"线型5":[{percent:0,opacity:1},{percent:.05,opacity:1},{percent:.05,opacity:0},{percent:.1,opacity:0},{percent:.1,opacity:1},{percent:.15,opacity:1},{percent:.15,opacity:0},{percent:.2,opacity:0},{percent:.2,opacity:1},{percent:.25,opacity:1},{percent:.25,opacity:0},{percent:.3,opacity:0},{percent:.3,opacity:1},{percent:.35,opacity:1},{percent:.35,opacity:0},{percent:.4,opacity:0},{percent:.4,opacity:1},{percent:.45,opacity:1},{percent:.45,opacity:0},{percent:.5,opacity:0},{percent:.5,opacity:1},{percent:.55,opacity:1},{percent:.55,opacity:0},{percent:.6,opacity:0},{percent:.6,opacity:1},{percent:.65,opacity:1},{percent:.65,opacity:0},{percent:.7,opacity:0},{percent:.7,opacity:1},{percent:.75,opacity:1},{percent:.75,opacity:0},{percent:.8,opacity:0},{percent:.8,opacity:1},{percent:.85,opacity:1},{percent:.85,opacity:0},{percent:.9,opacity:0},{percent:.9,opacity:1},{percent:.95,opacity:1},{percent:.95,opacity:0},{percent:1,opacity:0}]},circleStyleColorMap:{"样式一":[{percent:0,opacity:1},{percent:.25,opacity:1},{percent:.3,opacity:.25},{percent:1,opacity:.25}],"样式二":[{percent:0,opacity:0},{percent:.4,opacity:0},{percent:.45,opacity:.8},{percent:.5,opacity:.8},{percent:.55,opacity:0},{percent:.75,opacity:0},{percent:.8,opacity:1},{percent:.95,opacity:1},{percent:1,opacity:0}],"样式三":[{percent:0,opacity:1},{percent:.2,opacity:1},{percent:.25,opacity:.35},{percent:.85,opacity:.35},{percent:.95,opacity:1},{percent:1,opacity:.8}],"样式四":[{percent:0,opacity:1},{percent:.3,opacity:1},{percent:.35,opacity:0},{percent:.5,opacity:0},{percent:.525,opacity:1},{percent:.55,opacity:1},{percent:.575,opacity:0},{percent:.65,opacity:0},{percent:.675,opacity:.9},{percent:.7,opacity:.9},{percent:.725,opacity:0},{percent:.8,opacity:0},{percent:.825,opacity:.8},{percent:.85,opacity:.8},{percent:.875,opacity:0},{percent:.95,opacity:0},{percent:.975,opacity:.7},{percent:1,opacity:.7}],"样式五":[{percent:0,opacity:1},{percent:.15,opacity:1},{percent:.2,opacity:0},{percent:.95,opacity:1},{percent:1,opacity:.8}],"样式六":[{percent:0,opacity:0},{percent:.8,opacity:0},{percent:.9,opacity:1},{percent:.95,opacity:1},{percent:1,opacity:.5}],"样式七":[{percent:0,opacity:1},{percent:.1,opacity:1},{percent:.15,opacity:.7},{percent:.55,opacity:.7},{percent:.6,opacity:.35},{percent:1,opacity:.35}],"样式八":[{percent:0,opacity:1},{percent:1,opacity:1}],"样式九":[{percent:0,opacity:1},{percent:.3,opacity:1},{percent:.35,opacity:.5},{percent:.75,opacity:.5},{percent:.8,opacity:.25},{percent:1,opacity:.25}],"样式十":[{percent:0,opacity:1},{percent:.3,opacity:1},{percent:.35,opacity:0},{percent:.75,opacity:0},{percent:.8,opacity:1},{percent:1,opacity:1}]}}}},e.exports});;
Cube("datav:/com/datav-2dmap-flyingline/3.0.21/src/flyinglineLayer",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(e,t,l,i,a,r){var n=function(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e};function o(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var c=l("datav:/npm/eventemitter3/3.0.0"),g=l("datav:/npm/safely-merge/1.0.1");return e.exports=function(e){e.L;var o=e.map,t=e.Utils,m=e.GuiUtils,w=t._,x=t.Chroma,s=o.options.offset,h=l("datav:/com/datav-2dmap-flyingline/3.0.21/src/lib/flyingLine.js"),i=l("datav:/com/datav-2dmap-flyingline/3.0.21/src/lib/data-pool");!function(e){var t,i=document.createElement("canvas"),a=i.getContext("2d"),l=a.createLinearGradient(0,0,256,0);for(t in i.width=256,i.height=1,e)l.addColorStop(t,e[t]);a.fillStyle=l,a.fillRect(0,0,256,1),a.getImageData(0,0,256,1).data}({0:"#00ff00",.5:"#ffff00",1:"#ff0000"});return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,c),n(a,[{key:"init",value:function(){this.circleList=[],this.indexFlying=0,this.indexCount=0,this.dataPool=new i({maxN:500,outN:3}),this.mappingStyle={},this.getMappingStyle=this.getMappingStyle.bind(this),this.draw=this.draw.bind(this),this.drawLine=this.drawLine.bind(this),this.drawFlare=this.drawFlare.bind(this),this.drawCircleFlash=this.drawCircleFlash.bind(this),this.imageUrls={},this.cirleStyleCache={},this.initLines()}},{key:"onRender",value:function(){this.clean()}},{key:"render",value:function(e){if(this.data=[],e&&0<e.length){for(var t=void 0,t=0;t<e.length;t++){var i,a,l=e[t];!l.geometry||"LineString"!=l.geometry.type||l.geometry.coordinates.length<2||(a=l.geometry.coordinates,l.data_index=t+1,i=a[0],a=a[1],delete l.geometry,l.from={lng:+i[0].toFixed(6),lat:+i[1].toFixed(6)},l.to={lng:+a[0].toFixed(6),lat:+a[1].toFixed(6)},this.data.push(l))}this.mappingStyle=this.getMappingStyle()}this.dataPool.clean(),this.dataPool.addData(this.data)}},{key:"renderFlyingline",value:function(e){this.unusing.length&&e&&this.dataProcess(e)}},{key:"dataProcess",value:function(e){for(var t=this.using,i=this.unusing,a=0;a<e.length;a++){var l,r=e[a];i.length&&r&&((l=i.pop()).data(r),l.od=r,this.initStartEvents(l),t[l.lineIndex]=l)}}},{key:"initStartEvents",value:function(e){this.emit("start",{location:e.od.from,data_index:e.lineIndex})}},{key:"initEndEvents",value:function(e){this.emit("end",{location:e.od.to,data_index:e.lineIndex})}},{key:"clean",value:function(){var e,t=this.using,i=this.unusing,a=void 0;if(t){for(var l in t)e=(a=t[l]).lineIndex,a.reset(),i.push(a),delete t[e];this.circleList=[]}}},{key:"initLines",value:function(){for(var e=this.options,t=e.graph,i=e.animation,a=t.flyinglineStyle.lineN,l=(this.using={},this.unusing=[]),r=0;r<a;r++){var n=new h({ptsN:t.flyinglineStyle.ptsN,step:t.flyinglineStyle.step,height:t.flyinglineStyle.height,speed:i.flyingline.speed,style:t.flyinglineStyle,offset:s});n.set(o,r),l.push(n)}this.updateOptions(this.options)}},{key:"cleanUsedPath",value:function(){var e=this.using,t=this.unusing,i=void 0;if(e)for(var a in e){var l=(i=e[a]).lineIndex;i.ptsStart===i.pathLength&&(a={ds:i.ds,lineIndex:i.lineIndex,xy:i._data[i._data.length-1],r:5},this.circleList.push(a)),i.ptsStart>=i.step+i.pathLength&&(i.reset(),this.initEndEvents(i),t.push(i),delete e[l])}}},{key:"draw",value:function(e){if(this.cleanUsedPath(),this.data&&0!==this.data.length){var t=this.options,i=t.general,a=t.graph,l=t.animation;e.globalAlpha=.01*i.opacity,this.dataPool&&this.dataPool.getDataLength()&&a.flyinglineStyle&&(i=t=~~(a.flyinglineStyle.ptsN/l.flyingline.speed),i=(l=this.dataPool.getDataLength())<5?t:l<20?6:3,this.indexFlying++,this.indexFlying%=i,0===this.indexFlying&&(i=this.dataPool.outData(~~a.flyinglineStyle.outSpeed),this.renderFlyingline(i)));var r=this.using;if(r){for(var n in this.ds=[],r){var o=r[n];o.update();n=o.outData();n&&n[0]&&this.ds.push({lineIndex:o.lineIndex,properties:o.ds,outData:o.outData(),_data:o._data})}0<a.flyinglineStyle.lineWidth&&this.drawLine(e),this.drawFlare(e),this.drawCircleFlash(e)}}}},{key:"drawLine",value:function(e){e.lineCap="round";for(var t=this.options.graph,i=void 0,a=void 0,l=void 0,r=void 0,i=0;i<this.ds.length;i++){var n,o=this.ds[i].properties,s=((r=this.ds[i].outData).length,[]);for(a=0;a<r.length;a++)(n=r[a])&&s.push(n);var h=s[0],c=s[s.length-1];if(h[0]&&h[1]&&c[0]&&c[1]&&this.mappingStyle[o.data_index]){var g=this.mappingStyle[o.data_index].flyinglineStyle,y=void 0;this.mappingStyle&&this.mappingStyle[o.data_index]&&g.color_rgba&&(y=g.color_rgba);for(var d,f=e.createLinearGradient(c[0],c[1],h[0],h[1]),p=t.lineStyleType[g.lineShape],a=0;a<p.length;a++)d=p[a],f.addColorStop(d.percent,t.strokeColor(y,y,d.percent,1,d.opacity));for(e.strokeStyle=f,e.lineWidth=g.weight,e.beginPath(),e.moveTo(h[0],h[1]),l=1;l<s.length;l++)c=s[l],e.lineTo(c[0],c[1]);e.stroke()}}}},{key:"drawFlare",value:function(e){for(var t=this.ds,i=void 0,i=0;i<t.length;i++){var a=t[i];if(this.mappingStyle[a.properties.data_index]){var l=this.mappingStyle[a.properties.data_index].flareStyle;if(l.show&&(!a._data||a._data[a._data.length-1][0]!=a.outData[a.outData.length-1][0]||a._data[a._data.length-1][1]!=a.outData[a.outData.length-1][1])){var r,n,o=a.outData.length,s=a.outData[o-1];if(s)switch(l.lineHeadType){case"flare":e.save(),e.translate(s[0],s[1]),2<=a.outData.length&&(r=a.outData[o-2],r=Math.atan2(s[1]-r[1],s[0]-r[0]),e.rotate(r)),"耀斑"==l.flareMarkerSelect&&e.drawImage(l.gradient,-l.flareSize.width/2,-l.flareSize.height/2,l.flareSize.width,l.flareSize.height),e.restore();break;case"image":l.markerSelect&&this.imageUrls[l.markerSelect]&&this.imageUrls[l.markerSelect].canvas&&(e.save(),e.translate(s[0],s[1]),2<=a.outData.length&&"line"==l.iconAngle&&(n=a.outData[o-2],n=Math.atan2(s[1]-n[1],s[0]-n[0]),e.rotate(n+Math.PI/2)),!this.imageUrls[l.markerSelect]||(n=this.imageUrls[l.markerSelect].colorCanvas[l.color])&&e.drawImage(n,-l.iconSize.width/2,-l.iconSize.height/2,l.iconSize.width,l.iconSize.height)),e.restore()}}}}}},{key:"drawCircleFlash",value:function(e){if(this.circleList&&0<this.circleList.length){var t=this.options.animation;if(0<t.circle.speed)for(var i,a=t.circle.speed,l=void 0,r=void 0,n=void 0,l=0;l<this.circleList.length;l++){var o,s=this.circleList[l];this.mappingStyle[s.ds.data_index]&&(r=this.mappingStyle[s.ds.data_index].circleStyle).show&&s.xy&&s.xy[0]&&s.xy[1]&&r.flashCircle&&(n=r.radius,(o=+r.rgbaColor.a||.6)<.6||(s.r>n?o=0:s.r>.9*n?o=.1:s.r>.85*n?o=.2:s.r>.8*n?o=.4:s.r>.75*n?o=.6:s.r>.7*n&&(o=.8)),i=s.r,r.flashCircle[o]&&e.drawImage(r.flashCircle[o],s.xy[0]-i,s.xy[1]-i,2*i,2*i),s.r+=+(a*n/100).toFixed(2),s.r>n?this.circleList.shift():this.circleList[l]=s)}}}},{key:"prefixColor",value:function(e,t){return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]*t+")"}},{key:"getMappingStyle",value:function(){var e=this.data;if(e&&0!=e.length){for(var t,i={},a=m.validateCustomStyle,l=w.get(this.options,"condition.condition"),r=w.get(m,"scale.color"),n=w.get(this.options,"graph.flyinglineStyle.colorMapping"),o=r({config:n,data:e,field:"colorField"}),s=void 0,h=void 0,c=void 0,s=0;s<e.length;s++){var g={flyinglineStyle:{},flareStyle:{},circleStyle:{}},y=e[s];if(y.data_index){for(h=(t=a({config:l,data:y,ruleKey:"rules"})).length-1;0<=h&&(c=t[h]).graph.show;h--)if(c.graph.flyinglineStyle.show){g.flyinglineStyle.lineShape=c.graph.flyinglineStyle.lineShape,g.flyinglineStyle.weight=c.graph.flyinglineStyle.weight,g.flyinglineStyle.color=c.graph.flyinglineStyle.color;break}for(h=t.length-1;0<=h&&(c=t[h]).graph.show;h--)if(c.graph.flareStyle.show){g.flareStyle.show=c.graph.flareStyle.show,g.flareStyle.lineHeadType=c.graph.flareStyle.lineHeadType,g.flareStyle.flareSize=c.graph.flareStyle.flareSize,g.flareStyle.color=c.graph.flareStyle.color,g.flareStyle.markerSelect=c.graph.flareStyle.markerSelect,g.flareStyle.iconSize=c.graph.flareStyle.iconSize,g.flareStyle.iconAngle=c.graph.flareStyle.iconAngle;break}for(h=t.length-1;0<=h&&(c=t[h]).graph.show;h--)if(c.graph.circleStyle.show){g.circleStyle.show=c.graph.circleStyle.show,g.circleStyle.circleMarker=c.graph.circleStyle.circleMarker,g.circleStyle.radius=c.graph.circleStyle.radius,g.circleStyle.color=c.graph.circleStyle.color;break}g.flyinglineStyle.hasOwnProperty("lineShape")||(g.flyinglineStyle.lineShape=this.options.graph.flyinglineStyle.lineShape),g.flyinglineStyle.hasOwnProperty("weight")||(g.flyinglineStyle.weight=this.options.graph.flyinglineStyle.lineWidth),g.flyinglineStyle.hasOwnProperty("color")||(g.flyinglineStyle.color=y.colorField?o(y.colorField):n.fixed);var d=x(g.flyinglineStyle.color).rgba(),d={r:parseInt(d[0]),g:parseInt(d[1]),b:parseInt(d[2]),a:d[3]};g.flyinglineStyle.color_rgba=d,g.flareStyle.hasOwnProperty("show")||(g.flareStyle.show=this.options.graph.flareStyle.show),g.flareStyle.hasOwnProperty("lineHeadType")||(g.flareStyle.lineHeadType=this.options.graph.flareStyle.lineHeadType),g.flareStyle.hasOwnProperty("flareSize")||(g.flareStyle.flareSize=this.options.graph.flareStyle.flareSize),g.flareStyle.hasOwnProperty("color")||(f=g.flyinglineStyle.color,g.flareStyle.color=x(f).brighten().css()),g.flareStyle.hasOwnProperty("flareMarkerSelect")||(g.flareStyle.flareMarkerSelect=this.options.graph.flareStyle.flareMarkerSelect),g.flareStyle.hasOwnProperty("markerSelect")||(g.flareStyle.markerSelect=this.options.graph.flareStyle.markerSelect),g.flareStyle.hasOwnProperty("iconSize")||(g.flareStyle.iconSize=this.options.graph.flareStyle.iconSize),g.flareStyle.hasOwnProperty("iconAngle")||(g.flareStyle.iconAngle=this.options.graph.flareStyle.iconAngle),g.flareStyle=this.getFlareStyle(g.flareStyle),g.circleStyle.hasOwnProperty("show")||(g.circleStyle.show=this.options.graph.circleStyle.show),g.circleStyle.hasOwnProperty("circleMarker")||(g.circleStyle.circleMarker=this.options.graph.circleStyle.circleMarker),g.circleStyle.hasOwnProperty("radius")||(g.circleStyle.radius=this.options.graph.circleStyle.radius),g.circleStyle.hasOwnProperty("color")||(g.circleStyle.color=this.options.graph.circleStyle.color);var f=g.circleStyle.circleMarker+"_"+g.circleStyle.radius+"_"+g.circleStyle.color;this.cirleStyleCache[f]||(this.cirleStyleCache[f]=this.getCircleStyle(g.circleStyle)),g.circleStyle=this.cirleStyleCache[f],i[y.data_index]=g}}var p=this,S=void 0,u=[],v=[];for(S in i)(c=i[S]).flareStyle&&c.flareStyle.show&&(c.flareStyle.markerSelect?(u.push(c.flareStyle.markerSelect),v.push(c.flareStyle.color)):u.push(c.flareStyle.markerSelect));return v=Array.from(new Set(v)),u=Array.from(new Set(u)),new Promise(function(t,i){for(var e,a=void 0,r=[],n=u.length,o=0,a=0;a<n;a++)(function(){var l=u[a];if("耀斑"==l)return;e=new Promise(function(i,e){var a;p.imageUrls[l]&&p.imageUrls[l].canvas?i(!0):((a=new Image).crossOrigin="anonymous",a.onload=function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=a.width,e.height=a.height,t.imageSmoothingQuality="high",t.drawImage(a,0,0),p.imageUrls[l]={canvas:e,colorCanvas:{}},i(!0)},a.onerror=function(){e(new Error("Could not load image at "+l))},a.src=l)}),r.push(e),Promise.all(r).then(function(e){++o==n&&t(!0)}).catch(function(e){++o==n&&i(!1)})})()}).then(function(e){for(var t in p.imageUrls)for(var i=p.imageUrls[t],a=0;a<v.length;a++){var l=i.canvas,r=document.createElement("canvas");r.width=l.width,r.height=l.height;for(var n=r.getContext("2d"),o=l.getContext("2d").getImageData(0,0,l.width,l.height),s=o.data,h=x(v[a]).rgba(),c=0;c<l.width*l.height;c++)(0<s[4*c+0]||0<s[4*c+1]||0<s[4*c+2]||0<s[4*c+3])&&(s[4*c+0]=h[0],s[4*c+1]=h[1],s[4*c+2]=h[2],s[4*c+3]=s[4*c+3]*h[3]);n.putImageData(o,0,0,0,0,l.width,l.height),p.imageUrls[t].colorCanvas[v[a]]=r}}).catch(function(e){}),i}}},{key:"getFlareStyle",value:function(e){var t=e.flareSize,i=Math.max(t.width,t.height),a=document.createElement("canvas");a.width=i,a.height=i;var l=a.getContext("2d"),r=l.createRadialGradient(i/2,i/2,0,i/2,i/2,i/2),n=x(e.color).rgba(),o=this.prefixColor(n,1),s=this.prefixColor(n,.9),t=this.prefixColor(n,.15),n=this.prefixColor(n,0);return r.addColorStop(0,o),r.addColorStop(.5,s),r.addColorStop(.8,t),r.addColorStop(1,n),l.fillStyle=r,l.beginPath(),l.arc(i/2,i/2,i/2,0,2*Math.PI),l.closePath(),l.fill(),e.gradient=a,e}},{key:"getCircleStyle",value:function(e){e.flashCircle={};for(var t=this.options.graph.circleStyleColorMap[e.circleMarker],i=2*e.radius,a=x(e.color).rgba(),l=0,r=0;r<=10;r++){var n=document.createElement("canvas");n.width=i,n.height=i;var o=n.getContext("2d"),s=o.createRadialGradient(l=i/2,l,0,l,l,l);o.beginPath();for(var h=0;h<t.length;h++)s.addColorStop(t[h].percent,this.prefixColor(a,t[h].opacity));o.fillStyle=s,o.beginPath(),o.globalAlpha=r/10,o.arc(i/2,i/2,i/2,0,2*Math.PI),o.fill(),e.flashCircle[r/10]=n}var c=x(e.color).rgba();return e.rgbaColor={r:c[0],g:c[1],b:c[2],a:+c[3].toFixed(1)},e}},{key:"updateOptions",value:function(e){this.options=g(this.options,e),this.options.general.minZoom=e.general.zoomRange[0],this.options.general.maxZoom=e.general.zoomRange[1],this.flareList=[],this.circleList=[];var t,i=this.options,e=i.graph,i=i.animation,a=g(e.flyinglineStyle,i.flyingline),l=this.using;for(t in l)l[t].updateOptions(a);for(var r=this.unusing,n=0;n<r.length;n++)r[n].updateOptions(a);this.mappingStyle=this.getMappingStyle()}},{key:"show",value:function(){this.onRender(),this.options.visibility=!0}},{key:"hide",value:function(){this.options.visibility=!1}},{key:"destroy",value:function(){this.options=null,this.using=null,this.unusing=null,this.data=null,this.ds=null,this.circleList=null,this.cirleStyleCache=null,delete this.options,this.using,this.unusing,this.data,this.ds,this.circleList}}]),a;function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return t.options=g({},e),t.options.general.minZoom=e.general.zoomRange[0],t.options.general.maxZoom=e.general.zoomRange[1],t.options.visibility=!0,t.init(),t}},e.exports});;
Cube("datav:/com/datav-2dmap-flyingline/3.0.21",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(e,t,n,i,o,r){var a=function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e};function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=n("datav:/npm/eventemitter3/3.0.0"),y=n("datav:/npm/safely-merge/1.0.1"),h=n("datav:/com/datav-2dmap-flyingline/3.0.21/src/flyinglineLayer"),p=n("datav:/com/datav-2dmap-flyingline/3.0.21/config").DEFAULT_OPTIONS,a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,l),a(u,[{key:"addTo",value:function(e){e=h(e);this.layer=new e(this.options)}},{key:"onRender",value:function(){this.layer&&this.layer.onRender&&this.layer.onRender()}},{key:"resize",value:function(e,t){this.layer&&this.layer.resize&&this.layer.resize(e,t)}},{key:"render",value:function(e){this.layer&&this.layer.render&&this.layer.render(e)}},{key:"updateOptions",value:function(e){e=e.options;this.options=y(this.options,e),this.options.general.minZoom=e.general.zoomRange[0],this.options.general.maxZoom=e.general.zoomRange[1],this.layer&&this.layer.updateOptions&&this.layer.updateOptions(this.options)}},{key:"draw",value:function(e){this.layer&&this.layer.draw&&this.layer.draw(e)}},{key:"show",value:function(){this.options.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.options.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"destroy",value:function(){this.layer&&this.layer.destroy&&this.layer.destroy(),this.options=null,this.layer=null,delete this.options,this.layer}}]),u);function u(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this)),t=t.options;return n.options=y(p,t),n.options.general.minZoom=t.general.zoomRange[0],n.options.general.maxZoom=t.general.zoomRange[1],n.options.visibility=!0,n}return e.exports=a,e.exports});