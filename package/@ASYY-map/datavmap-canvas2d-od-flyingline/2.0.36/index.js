// env=undefined => env=publish 
Cube("datav:/com/datavmap-canvas2d-od-flyingline/2.0.36/src/BezierCurve",[],function(t,e,n,a,o,r){function i(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var s=(function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}(u,[{key:"data",value:function(t){if(t&&Array.isArray(t)&&!(t.length<2)){this._data=t,this.ptsN=t.length;t=this.path=[];return this.processing(),t}console.log("最少二个控制点")}},{key:"processing",value:function(){for(var t=this.options.outN,e=this._data,n=void 0,a=0;a<t;a++)n=a/t,this.calculate(e,n=a===t-1?1:n)}},{key:"calculate",value:function(t,e){var n=this.path;if(2===t.length)n.push(this.percentCoords(t[0],t[1],e));else if(2<t.length){for(var a,o=[],r=0;r<t.length-1;r++)a=this.percentCoords(t[r],t[r+1],e),o.push(a);this.calculate(o,e)}}},{key:"ptsDistance",value:function(t,e){var n=Math.pow(t[0]-e[0],2),e=Math.pow(t[1]-e[1],2);return Math.pow(n+e,.5)}},{key:"percentCoords",value:function(t,e,n){var a=t[0]+(e[0]-t[0])*n,n=t[1]+(e[1]-t[1])*n;return[Math.floor(100*a)/100,Math.floor(100*n)/100]}}]),u);function u(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u);this.options=Object.assign({outN:200},t||{})}return t.exports=s,t.exports});;
Cube("datav:/com/datavmap-canvas2d-od-flyingline/2.0.36/src/data-pool",[],function(t,a,e,n,r,i){function s(t,a){for(var e=0;e<a.length;e++){var n=a[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=(function(t,a,e){return a&&s(t.prototype,a),e&&s(t,e),t}(u,[{key:"addData",value:function(t){t&&[].push.apply(this.data,t)}},{key:"clean",value:function(){this.data=[],this.dsIndex=0,this.discardArray=[]}},{key:"getDataLength",value:function(){return this.data?this.data.length:0}},{key:"getAllData",value:function(){var t=this.data;return t||[]}},{key:"check",value:function(){var t,a=this.options.maxN;this.discardArray=[];var e=this.data;return e.length>a&&(t=e.length-a,this.discardArray=e.splice(0,t)),this.discardArray}},{key:"outDataClean",value:function(t){var a=this.data,t=t||this.options.outN;return a?a.splice(0,t):[]}},{key:"outData",value:function(t){var a=this.data,e=[],n=t||this.options.outN,r=a.length,i=this.dsIndex;if(a){if(r<=n)return e=a;if(i+n<=r){for(var s=i;s<n+i;s++){var o=a[s];e.push(o)}this.dsIndex+=n}else{for(var u=i+n-r,d=i;d<r;d++){var h=a[d];e.push(h)}for(var c=0;c<u;c++){var l=a[c];e.push(l)}this.dsIndex=u}return e}}}]),u);function u(t){!function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,u);this.options=Object.assign({maxN:10,outN:3},t||{}),this.data=[],this.dsIndex=0}return t.exports=o,t.exports});;
Cube("datav:/com/datavmap-canvas2d-od-flyingline/2.0.36/src/flyingLineCanvas.js",["datav:/npm/safely-merge/1.0.1"],function(t,i,a,s,e,n){var o=function(t,i,a){return i&&h(t.prototype,i),a&&h(t,a),t};function h(t,i){for(var a=0;a<i.length;a++){var s=i[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var r=a("datav:/npm/safely-merge/1.0.1"),p=a("datav:/com/datavmap-canvas2d-od-flyingline/2.0.36/src/BezierCurve"),o=(o(u,[{key:"set",value:function(t,i,a){this.map=t,this.ctx=i,this.lineIndex=a}},{key:"init",value:function(){var t=this.options.ptsN=~~this.options.ptsN;this.beziercurve=new p({outN:t}),this.reset()}},{key:"reset",value:function(){var t=this.options;this.step=~~t.step,this.ptsStart=0,this.pathLength=~~t.ptsN}},{key:"data",value:function(t){t&&this.processing(t)}},{key:"updateData",value:function(){var t=this._data,i=this.usingData=[];if(t){var a=this.options,s=~~a.step,a=~~a.speed;if(this.ptsStart<s)for(var e=0;e<this.ptsStart;e++)i.push(t[e]);else if(s<=this.ptsStart&&this.ptsStart<this.pathLength)for(e=this.ptsStart-s;e<this.ptsStart;e++)i.push(t[e]);else if(this.ptsStart>=this.pathLength)for(e=this.ptsStart-s;e<this.pathLength;e++)i.push(t[e]);this.ptsStart+=a}}},{key:"updatePath",value:function(){this.usingData.length}},{key:"outData",value:function(){var t=this.usingData;return!t||t.length<2?[]:t}},{key:"latLngToContainerPoint",value:function(t){if(t){var i=this.map.latLngToContainerPoint([t.from.lat,t.from.lng]),t=this.map.latLngToContainerPoint([t.to.lat,t.to.lng]);return[[i.x-this.options.offset.x,i.y-this.options.offset.y],[t.x-this.options.offset.x,t.y-this.options.offset.y]]}}},{key:"processing",value:function(t){this._data=[];var i=this.beziercurve,a=this.latLngToContainerPoint(t),t=this.getControlPoint(a),a=[a[0],t,a[1]];i.options.outN=~~this.options.ptsN,this._data=i.data(a)}},{key:"getControlPoint",value:function(t){var i=this.options.height||1,a=t[0],s=t[1],e=a[0],n=s[0],o=a[1],t=s[1],a=Math.pow(Math.pow(e-n,2)+Math.pow(o-t,2),.5);a/=i;s=Math.pow((n-e)/(t-o),2),i=Math.pow((t-o)/(n-e),2);return[(e+n)/2+a/Math.pow(s+1,.5),(o+t)/2-a/Math.pow(i+1,.5)]}},{key:"updateOptions",value:function(t){this.options=r(this.options,t)}},{key:"update",value:function(){this.updateData(),this.updatePath()}}]),u);function u(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,u);this.options=r({ptsN:400,step:80,speed:1,height:2.5,style:{lineWidth:2,fillColor:"RGBA(0, 0, 0, 0.96)"}},t||{}),this.init()}return t.exports=o,t.exports});;
Cube("datav:/com/datavmap-canvas2d-od-flyingline/2.0.36/src/odFlylinglineLayer",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1","datav:/npm/chroma-js/1.3.3"],function(t,i,e,n,o,s){var a=function(t,i,e){return i&&l(t.prototype,i),e&&l(t,e),t};function l(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=e("datav:/npm/eventemitter3/3.0.0"),h=e("datav:/npm/safely-merge/1.0.1"),c=e("datav:/npm/chroma-js/1.3.3"),p=e("datav:/com/datavmap-canvas2d-od-flyingline/2.0.36/src/flyingLineCanvas.js"),d=e("datav:/com/datavmap-canvas2d-od-flyingline/2.0.36/src/data-pool"),a=(function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(u,r),a(u,[{key:"init",value:function(){this.circleList=[],this.indexFlying=0,this.indexCount=0,this.dataPool=new d({maxN:500,outN:3}),this.setFlare(),this.setFlashCircleStyle(),this.updateStrokeColor(),this.initCanvas(),this.initLines()}},{key:"updateStrokeColor",value:function(){var t=this.options.flylinglineStyle,i=t.fromColor,i=c(i).rgb(),e=t.fromColorRGB={r:parseInt(i[0]),g:parseInt(i[1]),b:parseInt(i[2])},i=t.toColor,i=c(i).rgb(),n=t.toColorRGB={r:parseInt(i[0]),g:parseInt(i[1]),b:parseInt(i[2])},i=this.options,o=i.strokeColor,s=i.colorStep;this.options.strokeColorSeries={};for(var a=0;a<s;a++)this.options.strokeColorSeries[a]=o(e,n,a/s,t.k)}},{key:"initCanvas",value:function(){this.container=document.createElement("canvas");var t=this.padding=this.map.canvasLayer&&this.map.canvasLayer.options&&this.map.canvasLayer.options.padding?this.map.canvasLayer.options.padding:.1,i=this.map.getSize();this.offset=i.multiplyBy(-t).round();var e=i.x-2*this.offset.x,t=i.y-2*this.offset.y,i=this.map.devicePixelRatio||1;this.container.width=e*i,this.container.height=t*i,this.container.style.width=e+"px",this.container.style.height=t+"px",this.ctx=this.container.getContext("2d"),this.ctx.scale(i,i);i=this.options.flylinglineStyle.lineWidth;this.ctx.lineWidth=i,this.ctx.shadowBlur=0}},{key:"update",value:function(){if(this.cleanUsedPath(),this.data&&0!==this.data.length){var t,i,e,n=this.options;this.dataPool&&this.dataPool.getDataLength()&&n.flylinglineStyle&&(e=t=~~(.95*n.flylinglineStyle.ptsN/n.flylinglineStyle.speed),e=(i=this.dataPool.getDataLength())<5?t:i<20?6:3,this.indexFlying++,this.indexFlying%=e,0===this.indexFlying&&(l=this.dataPool.outData(.5*~~n.flylinglineStyle.outSpeed),this.renderFlylingline(l)));var o=this.using;if(o){for(var s in this.ds=[],o){var a=o[s];a.update();s=a.outData();s&&s[0]&&this.ds.push(a.outData())}var n=this.container,l=n.width,n=n.height;this.ctx.clearRect(0,0,l,n),0<this.options.flylinglineStyle.lineWidth&&this.drawLine(),this.options.flareStyle.show&&.5<this.options.flareStyle.size&&this.drawFlare(),this.options.circleStyle.show&&this.drawCircleFlash()}}}},{key:"onRender",value:function(){var t=this.container,i=t.width,t=t.height;this.ctx.clearRect(0,0,i,t),this.clean()}},{key:"onResize",value:function(t,i){var e=this.map.devicePixelRatio||1;this.container.width=t*e,this.container.height=i*e,this.container.style.width=t+"px",this.container.style.height=i+"px",this.ctx.scale(e,e)}},{key:"render",value:function(t){this.data=[],t&&0<t.length&&(this.data=t.map(function(t){return{from:{lat:+t.from.lat||+t.from.split(",")[1],lng:+t.from.lng||+t.from.split(",")[0]},to:{lat:+t.to.lat||+t.to.split(",")[1],lng:+t.to.lng||+t.to.split(",")[0]}}})),this.dataPool.clean(),this.dataPool.addData(this.data)}},{key:"renderFlylingline",value:function(t){this.unusing.length&&t&&this.dataProcess(t)}},{key:"dataProcess",value:function(t){for(var i=this.using,e=this.unusing,n=0;n<t.length;n++){var o,s=t[n];e.length&&s&&((o=e.pop()).data(s),o.od=s,this.initStartEvents(o),i[o.lineIndex]=o)}}},{key:"initStartEvents",value:function(t){this.emit("start",{location:t.od.from,id:t.lineIndex})}},{key:"initEndEvents",value:function(t){this.emit("end",{location:t.od.to,id:t.lineIndex});t={id:t.lineIndex,xy:t.usingData[t.usingData.length-1],r:5};this.circleList.push(t)}},{key:"clean",value:function(){var t,i=this.using,e=this.unusing,n=void 0;if(i){for(var o in i)t=(n=i[o]).lineIndex,n.reset(),e.push(n),delete i[t];this.circleList=[]}}},{key:"initLines",value:function(){for(var t=this.options,i=t.flylinglineStyle.lineN,e=this.map,n=this.ctx,o=(this.using={},this.unusing=[]),s=0;s<i;s++){var a=new p({ptsN:t.flylinglineStyle.ptsN,step:t.flylinglineStyle.step,height:t.flylinglineStyle.height,speed:t.flylinglineStyle.speed,style:t.flylinglineStyle,offset:this.offset});a.set(e,n,s),o.push(a)}this.updateOptions(t)}},{key:"cleanUsedPath",value:function(){var t,i=this.using,e=this.unusing,n=void 0;if(i)for(var o in i)t=(n=i[o]).lineIndex,n.ptsStart>=n.step+n.pathLength&&(n.reset(),this.initEndEvents(n),e.push(n),delete i[t])}},{key:"drawLine",value:function(){for(var t,i,e=this.ctx,n=this.options,o=n.strokeColorSeries,s=n.colorStep,a=void 0,l=void 0,r=void 0,h={},a=0;a<this.ds.length;a++)for(t=(r=this.ds[a]).length,l=0;l<t-1;l++)i=o[parseInt(l/t*s)],h.hasOwnProperty(i)||(h[i]=[]),h[i].push([r[l],r[l+1]]);var c,p,d;for(d in h){r=h[d],e.beginPath(),e.strokeStyle=d;for(var u=0;u<r.length;u++)c=r[u][0],p=r[u][1],void 0!==c&&void 0!==p&&(e.moveTo(c[0],c[1]),e.lineTo(p[0],p[1]));e.stroke()}}},{key:"setFlare",value:function(){var t=this.options.flareStyle,i=2*t.size,e=document.createElement("canvas");e.width=i,e.height=i;var n=e.getContext("2d"),o=n.createRadialGradient(i/2,i/2,0,i/2,i/2,i/2),s=c(t.color).rgba(),a=this.prefixColor(s,1),l=this.prefixColor(s,.9),t=this.prefixColor(s,.15),s=this.prefixColor(s,0);o.addColorStop(0,a),o.addColorStop(.5,l),o.addColorStop(.8,t),o.addColorStop(1,s),n.fillStyle=o,n.beginPath(),n.arc(i/2,i/2,i/2,0,2*Math.PI),n.closePath(),n.fill(),this.options.flareStyleGradient=e}},{key:"drawFlare",value:function(){var t=this.ds,i=this.ctx,e=this.options.flareStyle;i.globalAlpha=1;for(var n=0;n<t.length;n++){var o=t[n],s=o.length,a=o[s-1];a&&(i.save(),i.translate(a[0],a[1]),2<=o.length&&(s=o[s-2],s=Math.atan2(a[1]-s[1],a[0]-s[0]),i.rotate(s)),i.scale(3,1),i.drawImage(this.options.flareStyleGradient,-e.size,-e.size,2*e.size,2*e.size),i.restore())}}},{key:"setFlashCircleStyle",value:function(){this.options.flashCircle={};for(var t=this.options.circleStyle,i=2*t.radius||10,e=c(t.color).rgba(),n=0;n<=10;n++){var o=document.createElement("canvas");o.width=i,o.height=i;var s=o.getContext("2d"),a=s.createRadialGradient(i/2,i/2,0,i/2,i/2,i/2);s.beginPath();for(var l=[{percent:0,opacity:.99},{percent:.1,opacity:.9},{percent:.3,opacity:.9},{percent:.3,opacity:.11},{percent:.7,opacity:.2},{percent:.7,opacity:.2},{percent:.9,opacity:.9},{percent:1,opacity:.1}],r=0;r<l.length;r++)a.addColorStop(l[r].percent,this.prefixColor(e,l[r].opacity));s.fillStyle=a,s.beginPath(),s.globalAlpha=n/10,s.arc(i/2,i/2,i/2,0,2*Math.PI),s.fill(),this.options.flashCircle[+(n/10).toFixed(1)]=o}t=c(t.color).rgba();this.options.circleStyle.rgbaColor={r:t[0],g:t[1],b:t[2],a:t[3]}}},{key:"drawCircleFlash",value:function(){if(this.circleList&&0<this.circleList.length){var t=this.ctx,i=this.options.circleStyle,e=i.radius;if(0<e)for(var n=i.speed,o=i.rgbaColor,s=void 0,a=0;a<this.circleList.length;a++){var l,r=this.circleList[a];r.xy&&r.xy[0]&&r.xy[1]&&((l=o.a||.6)<.6||(r.r>e?l=.1:r.r>e-1?l=.2:r.r>e-2?l=.3:r.r>e-3?l=.4:r.r>e-4?l=.5:r.r>e-5&&(l=.6)),s=r.r,0<(l=+l.toFixed(1))&&t.drawImage(this.options.flashCircle[l],r.xy[0]-s,r.xy[1]-s,2*s,2*s),r.r+=n||1,r.r>e?this.circleList.shift():this.circleList[a]=r)}}}},{key:"prefixColor",value:function(t,i){return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]*i+")"}},{key:"updateOptions",value:function(t){this.options=h(this.options,t),this.options.minZoom=t.zoomRange[0],this.options.maxZoom=t.zoomRange[1],this.circleList=[],this.updateStrokeColor(),this.setFlare(),this.setFlashCircleStyle();t=this.options.flylinglineStyle.lineWidth;this.ctx.lineWidth=t;this.ctx.shadowBlur=0;var i,e=this.using;for(i in e)e[i].updateOptions(this.options.flylinglineStyle);for(var n=this.unusing,o=0;o<n.length;o++)n[o].updateOptions(this.options.flylinglineStyle)}},{key:"show",value:function(){this.options.visibility=!0,this.data&&this.data.length&&this.onRender()}},{key:"hide",value:function(){this.options.visibility=!1,this.ctx.clearRect(0,0,this.container.width,this.container.height)}},{key:"destroy",value:function(){this.options=null,this.ctx=null,this.container=null,this.using=null,this.unusing=null,this.data=null,this.ds=null,this.circleList=null,delete this.options,this.ctx,this.container,this.using,this.unusing,this.data,this.ds,this.circleList}}]),u);function u(t,i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,u);var e=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this));return e.options=h({zoomRange:[0,18],minZoom:0,maxZoom:22,flylinglineStyle:{fromColor:"rgba(255, 0, 0, 1.0)",toColor:"rgba(0, 255, 0, 1.0)",fromColorRGB:{},toColorRGB:{},outSpeed:1,speed:1,k:2,step:80,lineWidth:1,ptsN:20,height:2,lineN:100},flareStyle:{show:!0,color:"rgba(100, 227, 249, 1.0)",size:2},circleStyle:{show:!1,color:"rgba(100, 227, 249, 1.0)",radius:20,speed:5},strokeColor:function(t,i,e,n){return"rgba("+~~((i.r-t.r)*e+t.r)+","+~~((i.g-t.g)*e+t.g)+","+~~((i.b-t.b)*e+t.b)+","+Math.pow(e,n)+")"},strokeColorSeries:{},colorStep:20},i),e.options.minZoom=i.zoomRange[0],e.options.maxZoom=i.zoomRange[1],e.options.visibility=!0,e.map=t,e.init(),e}return t.exports=a,t.exports});;
Cube("datav:/com/datavmap-canvas2d-od-flyingline/2.0.36",["datav:/npm/eventemitter3/3.0.0","datav:/npm/safely-merge/1.0.1"],function(e,t,n,o,i,a){var r=function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e};function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var l=n("datav:/npm/eventemitter3/3.0.0"),y=n("datav:/npm/safely-merge/1.0.1"),u=n("datav:/com/datavmap-canvas2d-od-flyingline/2.0.36/src/odFlylinglineLayer"),r=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(h,l),r(h,[{key:"addTo",value:function(e){this.layer=new u(e,this.options)}},{key:"onRender",value:function(){this.layer&&this.layer.onRender&&this.layer.onRender()}},{key:"onResize",value:function(e,t){this.layer&&this.layer.onResize&&this.layer.onResize(e,t)}},{key:"render",value:function(e){this.layer&&this.layer.render&&this.layer.render(e)}},{key:"updateOptions",value:function(e){this.options=y(this.options,e),this.options.minZoom=e.zoomRange[0],this.options.maxZoom=e.zoomRange[1],this.layer&&this.layer.updateOptions&&this.layer.updateOptions(e)}},{key:"update",value:function(){this.layer&&this.layer.update&&this.layer.update()}},{key:"show",value:function(){this.options.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.options.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"destroy",value:function(){this.layer&&this.layer.destroy&&this.layer.destroy(),this.options=null,this.layer=null,delete this.options,this.layer}}]),h);function h(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));return n.options=y({renderer:"canvas",isAnimateLayer:!0},t),n.options.minZoom=t.zoomRange[0],n.options.maxZoom=t.zoomRange[1],n.options.visibility=!0,n}return e.exports=r,e.exports});