// env=undefined => env=publish 
Cube("datav:/com/datavmap-2d-layer-bubbles/1.1.12/color_config",[],function(a){return a.exports={类型一:[{percent:0,opacity:1},{percent:0.35,opacity:1},{percent:0.35,opacity:0.3},{percent:1,opacity:0.3}],类型二:[{percent:0,opacity:0.99},{percent:0.4,opacity:0.99},{percent:0.4,opacity:0.7},{percent:0.6,opacity:0.7},{percent:0.6,opacity:0.5},{percent:0.8,opacity:0.5},{percent:0.8,opacity:0.2},{percent:1,opacity:0.2}],类型三:[{percent:0,opacity:0.99},{percent:0.65,opacity:0.99},{percent:0.65,opacity:0.7},{percent:0.75,opacity:0.7},{percent:0.75,opacity:0.5},{percent:0.85,opacity:0.5},{percent:0.85,opacity:0.2},{percent:1,opacity:0.2}],类型四:[{percent:0,opacity:0.99},{percent:0.55,opacity:0.99},{percent:0.55,opacity:0},{percent:0.62,opacity:0},{percent:0.63,opacity:0.8},{percent:0.65,opacity:0.8},{percent:0.72,opacity:0},{percent:0.73,opacity:0.7},{percent:0.75,opacity:0.7},{percent:0.82,opacity:0},{percent:0.83,opacity:0.6},{percent:0.85,opacity:0.6},{percent:0.92,opacity:0},{percent:0.93,opacity:0.5},{percent:0.95,opacity:0.5}],类型五:[{percent:0,opacity:1},{percent:1,opacity:1}],类型六:[{percent:0,opacity:0.99},{percent:0.1,opacity:0.9},{percent:0.3,opacity:0.9},{percent:0.3,opacity:0.11},{percent:0.7,opacity:0.2},{percent:0.7,opacity:0.2},{percent:1,opacity:0.7}],类型七:[{percent:0,opacity:0.1},{percent:0.6,opacity:0.1},{percent:0.6,opacity:0.2},{percent:0.75,opacity:0.3},{percent:0.75,opacity:0.99},{percent:0.85,opacity:0.7},{percent:1,opacity:0.3}]},a.exports});;
Cube("datav:/com/datavmap-2d-layer-bubbles/1.1.12/bubbles",["datav:/npm/chroma-js/1.3.3"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=null;return a.exports=function(a){var k=c("datav:/npm/chroma-js/1.3.3"),b=a.datavUtils,i=a.CanvasLayer,j={getLat:function(a){return+a.lat},getLng:function(a){return+a.lng},getValue:function(a){return+a.value},getType:function(a){return a.type||"1"},offset:10,speed:0.2,maxSize:30,minSize:10,opacity:1,animationType:"breathe",size:function(a,b,c){if(c===b)return(this.options.maxSize+this.options.minSize)/2;return(a-b)/(c-b)*(this.options.maxSize-this.options.minSize)+this.options.minSize}};return h||(h=function(c){function h(a){d(this,h);var c=e(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));return a=b.mergeOptions(j,a),c.options=b.mergeOptions(c.options,a),c.ratio=0,c.reverseRatio=0,c.index=0,c.fade=1,c.reverseFade=0,c.options.visibility=!0,c}return f(h,c),g(h,[{key:"onInit",value:function(){this.map.on("move",this.move,this)}},{key:"move",value:function(){this._update(),this.redraw()}},{key:"render",value:function(){this.updateColors(),this._data()}},{key:"_data",value:function(){var a=this.data;if(a&&Array.isArray(a)){for(var b,c,d,e,f=this.options,g=f.getValue,h=0;h<a.length;h++)c=a[h],b=g(c),isNaN(b)||((null===d||void 0===d)&&(d=b),(null===e||void 0===e)&&(e=b),d>b&&(d=b),e<b&&(e=b));this.max=e,this.min=d,this.redraw()}}},{key:"redraw",value:function(){if(this.clear(),!!this.options.visibility){var a,b,c,d,e,f,g,h,j,k,l,m=this.options,n=m.animationType,j=m.ratio,o=m.size.bind(this),p=m.getType,q=m.getValue,r=this.ctx||this.canvas.getContext("2d"),s=this.data,t=this.max,u=this.min;if(s){switch(n){case"breathe":j=this.ratio,k=this.reverseRatio;break;case"fade":j=k=0;break;default:}for(var v=0;v<s.length;v++)a=s[v],b=this.latLngToContainerPoint(a),d=b[0],e=b[1],h=q(a),f=p(a),0===v%2?(g=o(h,u,t)+k,l=this.fade):(g=o(h,u,t)+j,l=this.reverseFade),g=0>g?-g:g,(isNaN(g)||isNaN(h))&&(g=0),c=r.createRadialGradient(d,e,0,d,e,g),this.addColorStop(f,c,l),r.fillStyle=c,r.beginPath(),r.arc(d,e,g,0,2*Math.PI),r.fill()}}}},{key:"addColorStop",value:function(a,b,d){if(b){var e,f=this.options,g=f.series[a];if(g&&Array.isArray(g))for(var h,j=0;j<g.length;j++){h=g[j],e=h.percent,1<e&&(e=1),0>e&&(e=0);var i=this.prefixColor(h,d);b.addColorStop(e,i)}}}},{key:"prefixColor",value:function(c,d){var e=c.r,f=c.g,g=c.b,b=c.a*d;return"rgba("+e+","+f+","+g+","+b+")"}},{key:"latLngToContainerPoint",value:function(b){if(b){var c=this.options,d=c.getLat,e=c.getLng,f=this.map,g=f.latLngToContainerPoint(new a.LatLng(d(b),e(b)));return[g.x,g.y]}}},{key:"updateOptions",value:function(a){a&&(this.options=b.mergeOptions(this.options,a)),this.updateColors()}},{key:"updateColors",value:function(){var d,e,f=this.options,h=f.typeSeries,l=f.series={};if(h.length)for(var m=0;m<h.length;m++){e=h[m].bubbleType,l[e]=[];for(var i=0;i<h[m].colorSeries.length;i++){var d={},j=h[m].colorSeries[i],n=h[m].baseColor,c=k(n).get("rgba.r"),o=k(n).get("rgba.g"),g=k(n).get("rgba.b"),b=j.opacity;d.r=c,d.g=o,d.b=g,d.a=b,d.percent=j.percent,l[e].push(d)}}}},{key:"update",value:function(){var a=this.options,b=a.offset,c=a.speed,d=a.opacity,e=a.animationType;switch(this.index<b?(this.ratio+=c,this.index+=c):b<=this.index&&this.index<2*b?(this.ratio-=c,this.index+=c):this.index>=2*b&&(this.ratio=0,this.index=0),this.reverseRatio=b-this.ratio,e){case"breathe":this.fade=d,this.reverseFade=d;break;case"fade":this.fade=d*(this.ratio/b),this.reverseFade=+(d-this.fade);break;default:}this.redraw()}},{key:"onRemove",value:function(){this.map.off("move",this.move,this),this.data=null,this.ratio=0,this.reverseRatio=0,this.index=0,this.fade=1,this.reverseFade=0}}]),h}(i))},a.exports});;
Cube("datav:/com/datavmap-2d-layer-bubbles/1.1.12",["datav:/npm/bcore/0.0.21/event"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/bcore/0.0.21/event"),i=c("datav:/com/datavmap-2d-layer-bubbles/1.1.12/bubbles"),j=c("datav:/com/datavmap-2d-layer-bubbles/1.1.12/color_config"),k={},l=null,m=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.container="string"===typeof a?document.querySelector(a):a,f.apis=c.apis,f.config=c,f.config.visibility=!0,f.map=null,f}return f(b,a),g(b,[{key:"addTo",value:function(a){this._map=a,l=a.L.datavUtils,this.initCom(),this.loop()}},{key:"initCom",value:function(){this.options=this.getOptions();var a=new i(this._map.L),b=this.layer=new a(this.options);b.addTo(this._map),b.updateOptions(this.options)}},{key:"getOptions",value:function(){var a=this.config=l.mergeOptions(k,this.config);if(a&&a.typeSeries&&a.typeSeries.length)for(var b=0;b<a.typeSeries.length;b++){var c=a.typeSeries[b],d=c.bubbleKey;c.colorSeries=j[d]?j[d]:[]}return a}},{key:"updateOptions",value:function(a){this.config=l.mergeOptions(this.config,a),this.options=this.getOptions(),this.layer&this.layer.updateOptions(this.options),this.config.visibility?this.show():this.hide()}},{key:"show",value:function(){this.config.visibility=!0,this.layer&&this.layer.options&&(this.layer.options.visibility=!0)}},{key:"hide",value:function(){this.config.visibility=!1,this.layer&&this.layer.options&&(this.layer.options.visibility=!1)}},{key:"remove",value:function(){window.cancelAnimationFrame(this.loopId),this.layer&&this.layer.remove&&this.layer.remove()}},{key:"setData",value:function(a){return!a||Array.isArray(a)&&1>a.length?(this.layer&&this.layer.clear(),this.layer&&this.layer.setData(a),console.log("\u5730\u56FE\u7EC4\u4EF6Map2dBubbles\u672A\u6536\u5230\u6570\u636E...")):void(this.layer&&this.layer.setData(a),this.layer&&this.layer.render())}},{key:"loop",value:function(){this.layer&&this.layer.update(),this.loopId=window.requestAnimationFrame(this.loop.bind(this))}}]),b}(h);return a.exports=m,a.exports});