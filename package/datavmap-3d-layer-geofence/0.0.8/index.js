// env=undefined => env=publish 
Cube("datav:/com/datavmap-3d-layer-geofence/0.0.8/coord",["datav:/npm/geojson-bbox/0.0.0"],function(a,b,c){var d=c("datav:/npm/geojson-bbox/0.0.0");return a.exports={project:function(a,b){var c=3.141592653589793,d={worldsize:256/c};Object.assign(d,b);var e=d.worldsize||6378137,f=e*c,g=c/180,h=[e*a[0]*g,e*Math.log(Math.tan(c/4+0.5*a[1]*g))];return h[0]>f&&(h[0]=f),h[0]<-f&&(h[0]=-f),h[1]>f&&(h[1]=f),h[1]<-f&&(h[1]=-f),[h[0]||0,h[1]||0,a[2]||0]},getCenter:function(a){var b=d(a);return[(b[0]+b[2])/2,(b[1]+b[3])/2]}},a.exports});;
Cube("datav:/com/datavmap-3d-layer-geofence/0.0.8/shader/frag.glsl",[],function(a){return a.exports="#define GLSLIFY 1\nuniform vec4 u_color;\n\nvarying vec2 vUv;\nvoid main() {\n  float opacity = pow(1. - vUv.y, 2.);\n  gl_FragColor = vec4(u_color.rgb, opacity * u_color.a);\n}",a.exports});;
Cube("datav:/com/datavmap-3d-layer-geofence/0.0.8/extruder.js",["datav:/npm/earcut/2.1.3"],function(a,b,c){var d=c("datav:/npm/earcut/2.1.3");return a.exports=function(a,b){b=Object.assign({height:1,base:0,project:function(a){return[a[0]||0,a[1]||0,a[2]||0]},closed:!1},b);for(var c=d.flatten(a),e=c.vertices,f=e.length/c.dimensions,g=[],h=[],j=0;j<f;j++)g.push(e[j*c.dimensions+0]),h.push(e[j*c.dimensions+1]);var k=[Math.min.apply(null,g),Math.min.apply(null,h),Math.max.apply(null,g),Math.max.apply(null,h)],l=[],m=[],n=[],o=[],q=d(c.vertices,c.holes,c.dimensions),r=e.length/c.dimensions;if(0===b.height){var p=k[2]-k[0],s=k[3]-k[1];e.forEach(function(a,d){if(0===d%c.dimensions){var f=b.project([e[d],e[d+1],b.base]);n.push((e[d]-k[0])/p,(e[d+1]-k[1])/s),l.push(f[0],f[1],f[2]),o.push(f[2])}}),m=q}else{var t=[],u=[],v=[];e.forEach(function(a,d){if(0===d%c.dimensions){var f=b.project([e[d],e[d+1],b.base+b.height]);l.push(f[0],f[1],f[2]),n.push(0===d%2?0:1,1),o.push(b.height),t.push(f[0],f[1],b.base),u.push(0===d%2?0:1,0),v.push(0)}}),[].push.apply(l,t),[].push.apply(n,u),[].push.apply(o,v);for(var i=0;i<r;i++)i===r-1?m.push(i+r,r,i,0,i,r):m.push(i+r,i+r+1,i,i+1,i,i+r+1);b.closed&&q.forEach(function(a,b){0===b%3&&m.push(q[b+0]+r,q[b+1]+r,q[b+2]+r)})}return{positions:l,indices:m,uvs:n,heights:o}},a.exports});;
Cube("datav:/com/datavmap-3d-layer-geofence/0.0.8/shader/vert.glsl",[],function(a){return a.exports="#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",a.exports});;
Cube("datav:/com/datavmap-3d-layer-geofence/0.0.8/extrude-polygon.js",[],function(a,b,c){var d=c("datav:/com/datavmap-3d-layer-geofence/0.0.8/extruder.js"),e=c("datav:/com/datavmap-3d-layer-geofence/0.0.8/coord").project;return a.exports=function(a,b){var c={closed:!1,project:e,getHeight:function(){return 1e3},getBase:function(){return 0},getKey:function(a,b){return a.properties.id||b},getVertexColor:function(){return[0,0,0,1]}};Object.assign(c,b);for(var f=[],g=[],h=[],i=[],j={},k=a.features||a,l=function(a){var b=k[a],e=[],l=c.getHeight(b,a),m=c.getBase(b,a);console.log(m,l);var n=c.project;if(b.geometry){"MultiPolygon"===b.geometry.type?[].push.apply(e,b.geometry.coordinates):"Polygon"===b.geometry.type&&e.push(b.geometry.coordinates);var o=f.length/3;e.forEach(function(a){var b=f.length/3,c=d(a,{height:l,base:m,project:n});[].push.apply(f,c.positions),[].push.apply(h,c.uvs),[].push.apply(i,c.heights);var e=c.indices,j=e.map(function(a){return a+b});[].push.apply(g,j)});var p=f.length/3,q=c.getKey(b,a);q&&(j[q]=[o,p,a])}},m=0,n=k.length;m<n;m++)l(m,n);var o={positions:new Float32Array(f),indices:new Int32Array(g),uvs:new Float32Array(h),heights:new Float32Array(i),keyIndex:j};return o},a.exports});;
Cube("datav:/com/datavmap-3d-layer-geofence/0.0.8/geofence.js",["datav:/npm/chroma-js/1.3.4","datav:/npm/eventemitter3/2.0.3","datav:/npm/safely-merge/1.0.1"],function(a,b,d){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=d("datav:/npm/chroma-js/1.3.4"),i=d("datav:/npm/eventemitter3/2.0.3"),j=d("datav:/npm/safely-merge/1.0.1"),k=d("datav:/com/datavmap-3d-layer-geofence/0.0.8/extrude-polygon.js"),l=function(a,b){return a.offsetHeight===b.offsetHeight&&a.geofenceHeight===b.geofenceHeight};return a.exports=function(a){var b=a.datavgl,m=b.THREE,n=a.glLayer||a,o={visibility:!0,geofenceHeight:1,offsetHeight:0,depthTest:!0,depthWrite:!1};return function(a){function b(a){c(this,b);var d=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return a=j(o,a),d.options=j(d.options,a),d.animate=d.animate.bind(d),d.init(),d}return f(b,a),g(b,[{key:"init",value:function(){this.meshGroup=new m.Group,n.on("runAnimation",this.animate)}},{key:"setData",value:function(a){this.data=a;var b=this.options;this.dispose();var c=k(a,{getHeight:function(){return 1e3*b.geofenceHeight},getBase:function(){return 1e3*b.offsetHeight}}),d=this.geometryArea=new m.BufferGeometry;d.setIndex(new m.BufferAttribute(new Uint32Array(c.indices),1)),d.addAttribute("position",new m.BufferAttribute(new Float32Array(c.positions),3)),d.addAttribute("uv",new m.BufferAttribute(new Float32Array(c.uvs),2)),d.needsOffset=!0,d.computeBoundingSphere(),d.computeVertexNormals(),d.normalizeNormals(),d.computeBoundingBox();var e=this.mesh=new m.Mesh(d,this.initMaterial());e.renderOrder=2e3,e.visible=this.options.visibility,n.offsetNode.add(e),n.emit("init-offset")}},{key:"initMaterial",value:function(){var a=this.options,b=h(a.color).gl(),c=a.depthTest,e=a.depthWrite;return new m.ShaderMaterial({uniforms:{u_color:{value:new m.Vector4(b[0],b[1],b[2],b[3])}},vertexShader:d("datav:/com/datavmap-3d-layer-geofence/0.0.8/shader/vert.glsl"),fragmentShader:d("datav:/com/datavmap-3d-layer-geofence/0.0.8/shader/frag.glsl"),side:m.DoubleSide,blending:m.AdditiveBlending,depthTest:c,depthWrite:e,transparent:!0})}},{key:"animate",value:function(){}},{key:"dispose",value:function(){this.mesh&&n.offsetNode.remove(this.mesh),this.mesh&&n.disposeNode(this.mesh),this.mesh=null}},{key:"updateMaterials",value:function(){var a=this.options,b=a.depthTest,d=a.depthWrite;if(this.mesh){var e=h(a.color).gl();this.mesh.material.uniforms.u_color.value=new m.Vector4(e[0],e[1],e[2],e[3]),this.mesh.material.depthTest=b,this.mesh.material.depthWrite=d,this.mesh.visible=a.visibility}}},{key:"updateOptions",value:function(a){var b=Object.assign({},this.options);this.options=j(this.options,a||{}),l(b,this.options)||this.setData(this.data),this.updateMaterials()}},{key:"show",value:function(){this.options.visibility=!0,this.mesh&&(this.mesh.visible=!0)}},{key:"hide",value:function(){this.options.visibility=!1,this.mesh&&(this.mesh.visible=!1)}},{key:"remove",value:function(){n.off("runAnimation",this.animate),this.dispose()}}]),b}(i)},a.exports});;
Cube("datav:/com/datavmap-3d-layer-geofence/0.0.8",["datav:/npm/eventemitter3/2.0.3","datav:/npm/safely-merge/1.0.1"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/eventemitter3/2.0.3"),i=c("datav:/npm/safely-merge/1.0.1"),j=c("datav:/com/datavmap-3d-layer-geofence/0.0.8/geofence.js"),k={},l=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.container="string"===typeof a?document.querySelector(a):a,f.apis=c.apis,f.map=null,f._data=null,f.config=c,f}return f(b,a),g(b,[{key:"initLayer",value:function(){var a=this.getOptions(),b=j(this.map);this.layer=new b(a),this.layer.setData(this.data)}},{key:"init",value:function(){var a=this;this.resetID&&clearTimeout(this.resetID),this.resetID=setTimeout(function(){a.map.glLayer.loaded?(a.resetID&&clearTimeout(a.resetID),a.initLayer()):a.init()},100)}},{key:"addTo",value:function(a){var b=this;this.map=a,this.init(),this.endID=setTimeout(function(){b.resetID&&clearTimeout(b.resetID)},300000)}},{key:"getOptions",value:function(){return this.config=i(k,this.config),this.config}},{key:"show",value:function(){this.config.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.config.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"remove",value:function(){this.endID&&clearTimeout(this.endID),this.resetID&&clearTimeout(this.resetID),this.layer&&this.layer.remove&&this.layer.remove(),this.layer=null,this._data=null,this.data=null}},{key:"render",value:function(a){this.data=a&&a.features&&Array.isArray(a.features)&&0<a.features.length?a:{type:"FeatureCollection",features:[]},this.layer&&this.layer.setData(a)}},{key:"updateOptions",value:function(a){this.config=i(this.config,a),a=this.getOptions(),this.layer&&this.layer.updateOptions(a)}}]),b}(h);return a.exports=l,a.exports});