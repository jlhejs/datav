// env=undefined => env=publish 
Cube("datav:/com/slider/1.4.6/template.html",[],function(i,t,e,a,n,l){return i.exports=function(){return'<div class="slide-box" style="position: relative; overflow: hidden; height: 100%;">\n  <ul class="images-wrap" style="position: absolute; width: <%= animate.direction==\'horrible\' ? width * images.length * 2 : width %>px; height: <%= animate.direction==\'horrible\' ? height : height * images.length *2 %>px; padding: 0; margin: 0;">\n    <% _.forEach(images, function(image, i) { %>\n    <li style="width: <%= width %>px; height: <%= height %>px; list-style: none; opacity: <%= (animate.direction === \'horrible\' || animate.direction === \'vertical\') ? 1 : (i === 0 && animate.direction === \'mosaic\' ? 1 : 0) %>; position: <%= (animate.direction==\'horrible\' || animate.direction==\'vertical\') ? \'relative\' : \'absolute\' %>; float: left; text-align: center; overflow: hidden;">\n      <img class="<%- !image.url ? \'no-image\' : \'\' %>" src="<%- !!image.url ? image.url : slideImage.defaultImage %>" alt="<%- image.description %>" style="max-width: <%- width %>px;" />\n      <p class="description" style="text-align: left; position: absolute; left: 0; top: 0; width: 80%; padding: 5px 10px; margin: 0; line-height: 1.2;"><span style="display: table-cell; vertical-align: middle"><%= image.description %></span></p>\n    </li>\n    <% }); %>\n  </ul>\n  <% if(dot.show === true) { %>\n  <ol class="dots-wrap clearfix" style="z-index: 2;position: absolute; left: 50%; -webkit-transform: translate(-50%, 0); -moz-transform: translate(-50%, 0); -ms-transform: translate(-50%, 0); -o-transform: translate(-50%, 0); transform: translate(-50%, 0); padding: 0; margin: 0; bottom: 10px">\n    <% _.forEach(images, function(image, index) { %>\n    <li style="list-style: none; float: left; width: 10px; height: 10px; border-radius: 50%; margin-right: 5px"></li>\n    <% }); %>\n  </ol>\n  <%} %>\n  <div class="pieces" style="position: absolute;width: 100%;height: 100%;"><canvas style="width: 100%; height: 100%;"></canvas></div>\n</div>\n'},i.exports});;
Cube("datav:/com/slider/1.4.6",["datav:/npm/bcore/0.0.18/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.6.1"],function(t,i,e,n,a,s){var r=e("datav:/npm/bcore/0.0.18/event"),h=e("datav:/npm/jquery/2.1.4"),o=e("datav:/npm/lodash/4.6.1"),c=o.template(e("datav:/com/slider/1.4.6/template.html")());return t.exports=r.extend(function(t,i){this.config={},this.container=h(t),this.apis=i.apis,this._data=null,this.currentIndex=0,this.count=0,this.canvasAnimate=null,this.init(i),this.isInit=!0},{init:function(t){var i=this;this.mergeConfig(t),this.updateStyle(),this.animateTime=new Date,this.container.css({cursor:"pointer"}),this.container.off().on("mouseenter",function(){i.clearAnimates()}).on("mouseleave",function(){i.isInit=!0,i.config.animate.isLoop&&i.initInterval()}).on("click",function(){i.eventEmit()})},eventEmit:function(){this._data.length&&this.emit("click-image",this._data[this.currentIndex])},render:function(t,i){t=this.data(t);var e=this,n=this.container,i=this.mergeConfig(i),a=o.assign(i,{images:t}),i=c(a),t=h(i).children(".images-wrap").find("li");this.dots&&this.dots.off(),this.clearAnimates(),n.html(i),"horrible"!==a.animate.direction&&"vertical"!==a.animate.direction||n.find(".images-wrap").append(t[0]).css({left:0,top:0}),h(this.container.find(".images-wrap").find("li")[0]).addClass("current-image");var s=e.config.images;function r(){e.count++,e.count>=s.length&&("opacity"===a.animate.direction&&n.find(".images-wrap li").eq(0).css("opacity",1),e.updateStyle(),e.config.animate.isLoop&&e.initInterval())}this.count=0,this.dots=n.find(".dots-wrap").find("li"),t.each(function(t,i){i=h(i).find("img")[0];i.complete?r():i.onload=r}),this.dots.on("click",function(){var t=h(this).index();t!==e.currentIndex&&e.turnTo({index:t})})},startLoop:function(t){t&&void 0!==this._data[t.index]&&t.index!==this.currentIndex&&(t=t.index-1<0?0:t.index-1,this.setCurrentIndex(t)),this.clearAnimates(),this.runTimer()},stopLoop:function(){this.clearAnimates()},prev:function(){this.clearAnimates();var t=this.container.find(".images-wrap li").length;this.currentIndex=this.currentIndex<1?"horrible"===this.config.animate.direction||"vertical"===this.config.animate.direction?t-2:t-1:this.currentIndex-1,this.updateDot(),this.startAnimate()},next:function(){this.clearAnimates(),this.currentIndex++,this.updateDot(),this.startAnimate()},turnTo:function(t){t&&(t=t.index,this.clearAnimates(),this.currentIndex=t,this.updateDot(),this.startAnimate())},runTimer:function(){var t=this,i=t.config,i=i.animate.speed+(i.animate.interval||16);t.currentIndex++,t.interval&&clearTimeout(t.interval),t.startAnimate(),t.updateDot(),t.interval=setTimeout(this.runTimer.bind(this),i||16)},initInterval:function(){var t=this;clearTimeout(this.firstTimeOut),clearTimeout(this.interval),this.isInit?this.firstTimeOut=setTimeout(function(){t.runTimer(),t.isInit=!1},this.config.animate.interval):this.runTimer()},setCurrentIndex:function(t){this.currentIndex=t},startAnimate:function(){var t=this,i=t.container.find(".images-wrap"),e=t.config.animate.direction,n=t.currentIndex,a=i.find("li");if(a.length<=1)return!1;switch(e){case"opacity":this.moveByOpacity(n,{imagesWrap:i,images:a});break;case"mosaic":this.renderMosaic(a);break;default:"vertical"!==e&&"horrible"!==e||this.moveByDirection(n)}},moveByDirection:function(t){var i=this,e=i.container.find(".images-wrap"),n=e.find("li"),a=i.config,s=a.width,r=a.height,o=a.animate,c=n.length,r="horrible"==o.direction?{left:-i.currentIndex*s+"px"}:{top:-i.currentIndex*r+"px"};e.animate(r,o.speed,"linear",function(){c-2<t&&(i.setCurrentIndex(0),"horrible"==o.direction?e.css("left",0):e.css("top",0)),h(n[i.currentIndex]).addClass("current-image").siblings().removeClass("current-image")})},moveByOpacity:function(t,i){t>=i.images.length&&this.setCurrentIndex(0);var e=i.images.eq(this.currentIndex),t=this.container.find(".current-image"),i=this.config.animate;t.css({"z-index":2}),t.animate({opacity:0},i.speed),e.css({"z-index":1,opacity:1}).addClass("current-image").siblings().removeClass("current-image")},renderMosaic:function(t){var s=window.requestAnimationFrame||window.webkitRequestAnimationFrame,r=(window.cancelAnimationFrame||window.webkitCancelAnimationFrame,this),i=r.currentIndex,e=r.config,n=e.width,a=e.height,o=e.slideImage,c=e.images,h=e.animate;i>=c.length&&this.setCurrentIndex(i=0);var d=r.container.find(".pieces"),l=h.cols>=n?n:h.cols,e=h.rows>=a?a:h.rows,h=h.speed,m=l*e,u=Math.ceil(n/l),f=Math.ceil(a/e),o=(c[i].url||o.defaultImage,o.fillType),g=d.find("canvas")[0],p=g.getContext("2d"),v=t.eq(i),x=r.container.find(".current-image");t.css({zIndex:-1,opacity:0}),x.css({zIndex:0,opacity:1}),g.width=n,g.height=a,p.clearRect(0,0,n,a);for(var I=[],w=0;w<m;w++)I.push(w);var y=v.find("img")[0];this.tempCanvas||(this.tempCanvas=document.createElement("canvas")),this.tempCanvas.width=n,this.tempCanvas.height=a;var b=this.tempCanvas.getContext("2d");b.clearRect(0,0,n,a);var C=y.naturalWidth,T=y.naturalHeight;switch(o){case"cover":b.drawImage(y,0,0,C,T,0,0,n,a);break;case"contain":var A=n*T/C;b.drawImage(y,0,0,C,T,0,(a-A)/2,n,A);break;case"center":var k=(A=a<T?a:T)*C/T;b.drawImage(y,0,0,C,T,(n-k)/2,(a-A)/2,k,A);break;default:b.drawImage(y,0,0,C,T,0,0,C,T)}var o=Math.min(m,10),D=Math.floor(m/o),z=h/o,O=0;this.canvasAnimate=s(function t(i){if(z<=i-O){O=i;for(var e=D;0<e;e--){var n=Math.floor(Math.random()*I.length),n=(a=I.splice(n,1)[0])%l*u,a=parseInt(a/l)*f;if(p.drawImage(r.tempCanvas,n,a,u+2,f+2,n,a,u+2,f+2),!I.length)return x.siblings().css({zIndex:-1,opacity:0}),void v.css({zIndex:2,opacity:1}).addClass("current-image").siblings().removeClass("current-image")}}r.canvasAnimate=s(t,g)},g)},getImageAlignStyle:function(t){switch(t){case"cover":var i={width:"100%",height:"100%"};break;case"contain":i={maxHeight:"none",width:this.config.width+"px",height:"auto",position:"relative",top:"50%",transform:"translateY(-50%)"};break;case"center":i={maxHeight:this.config.height+"px",width:"auto",height:"auto",position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"};break;default:i={width:"auto",height:"auto"}}return{maxHeight:i.maxHeight||"",width:i.width,height:i.height,position:i.position||"",left:i.left||"",top:i.top||"",transform:i.transform||""}},updateSlideImage:function(e){var t=this.container.find(".images-wrap").find("img"),i=t.filter(".no-image");e?(e.defaultImage!==this.config.slideImage.defaultImage&&i.each(function(t,i){i.src=e.defaultImage}),this.config.slideImage=e):e=this.config.slideImage,i=this.getImageAlignStyle(e.fillType),t.css(i)},updateDot:function(t){var i,e,n;t?this.config.dot=t:t=this.config.dot,this.dots&&(e=(i=this.dots).length,n=(n=this.currentIndex)>=i.length?n-e:n,t.show?i.show():i.hide(),i.eq(n).css("background",t.current),i.not(i.eq(n)).css("background",t.color))},updateDescription:function(t){t?this.config.description=t:t=this.config.description;var i,e=t.background,n=this.container.find(".description");t.show?(i="linear-gradient("+e.degree+"deg, "+e.startColor+", "+e.endColor+")","single"==e.style&&(i=e.single),n.css({display:"table",left:t.left,top:t.top,width:t.width+"%",height:t.height+"%",background:i,"text-align":t.align,color:t.color,"font-weight":t.fontWeight})):n.hide()},resize:function(t,i){this.render(null,{width:t,height:i})},data:function(t){return t&&(this._data=t),this._data},mergeConfig:function(t){var i=this.container;return t&&(this.config=o.defaultsDeep(t||{},this.config),Object.assign(this.config,{width:i.width(),height:i.height()})),this.config},updateStyle:function(){this.currentIndex||this.setCurrentIndex(0),this.updateDot(),this.updateDescription(),this.updateSlideImage();var t=this.config;this.container.css({"font-size":t.component.fontSize+"px",fontFamily:'"'+t.component.fontFamily+'"',color:t.color||"#fff"})},clearAnimates:function(){this.interval&&clearTimeout(this.interval),this.firstTimeOut&&clearTimeout(this.firstTimeOut),this.canvasAnimate&&cancelAnimationFrame(this.canvasAnimate);var t=this.container,i=t.find(".images-wrap");i.length&&(i.finish(),(i=i.find("li")).length&&i.finish(),"mosaic"===this.config.animate.direction&&(i=t.find(".current-image"),t.find(".images-wrap li").css({zIndex:-1,opacity:0}),i.css({zIndex:0,opacity:1})))},destroy:function(){this.interval&&clearTimeout(this.interval),this.firstTimeOut&&clearTimeout(this.firstTimeOut),this.interval=null,this.animateTime=null,this.currentIndex=null,this.count=null,this.firstTimeOut=null,this._data=null,this.container.off(),this.container&&this.container.empty()}}),t.exports});