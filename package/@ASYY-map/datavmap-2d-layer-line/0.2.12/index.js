// env=undefined => env=publish 
Cube("datav:/com/datavmap-2d-layer-line/0.2.12/lineLayer.js",["datav:/npm/geojson-flatten/0.2.1","datav:/npm/chroma-js/1.3.3"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();return a.exports=function(a){var b=a.datavUtils,h=a.BaseLayer,i=c("datav:/npm/geojson-flatten/0.2.1"),j=c("datav:/npm/chroma-js/1.3.3"),k={pane:"linePane",opacity:1,"click-key":"",style:{minColor:"rgba(5, 96, 125, 0.8)",maxColor:"rgba(0, 255, 240, 0.5)",color:"#fff",weight:1,dashArray:"1,0",fillOpacity:1},isHover:!0,isPopup:!0,hover:{color:"#FEE619",weight:3},clickZoom:!0,zoomPad:1.5,popup:function(a){return void 0==a.properties.info?void 0!=a.properties.name&&void 0!=a.properties.value?"\u540D\u79F0\uFF1A"+a.properties.name+"<br/>\u6570\u503C\uFF1A"+a.properties.value:void 0==a.properties.name?"\u65E0\u4FE1\u606F":""+a.properties.name:""+a.properties.info}};return function(c){function h(a){d(this,h);var c=e(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));return a=b.mergeOptions(k,a),c.options=b.mergeOptions(c.options,a),c.type="line",c}return f(h,c),g(h,[{key:"init",value:function(){this.data=null,this.geojson=null,this.geojsonLayer=null,this.pane.style.pointerEvents="none",this.renderer=a.canvas({pane:this.options.pane}),this.renderer.addTo(this.map)}},{key:"setData",value:function(a){this.data=a,this.range=this.getRange(),this.genGeojson()}},{key:"setGeojson",value:function(a){this.geojson=i(a),this.genGeojson()}},{key:"genGeojson",value:function(){var a=this;if(this.geojson&&this.geojson.features&&this.geojson.features.length&&this.data&&this.data.length){var b=null,c=JSON.parse(JSON.stringify(this.geojson));this.new_geojson=c.features.map(function(c){b=b||c.properties.link_id&&"link_id",b=b||c.properties.id&&"id",b=b||c.properties.name&&"name";var d=a.data.find(function(a){return a.link_id==c.properties[b]});return Object.assign(c.properties,d),c})}else this.new_geojson=this.geojson}},{key:"getRange",value:function(){if(!this.data.length)return null;var a=this.data.filter(function(a){return void 0!=a.value&&!isNaN(+a.value)&&""!==a.value});if(2>a.length)return null;var b=a.reduce(function(c,a){return+c.value<=+a.value?c:a},{}),c=a.reduce(function(c,a){return+c.value>=+a.value?c:a},{});return[+b.value,+c.value]}},{key:"onUpdateOptions",value:function(){this.render()}},{key:"highlightFeature",value:function(a){if(this.options.isHover){var b=a.target;b.setStyle({color:this.options.hover.color,weight:this.options.hover.weight})}}},{key:"resetHighlight",value:function(a){this.geojsonLayer&&this.geojsonLayer.resetStyle(a.target)}},{key:"zoomToFeatureOrOpenPopup",value:function(a){this.map.isFly=this.options.clickZoom,this.options.clickZoom&&this.map.flyToBounds(a.target.getBounds().pad(this.options.zoomPad-1)),this.emit("click",a.target.feature.properties)}},{key:"render",value:function(){var c=this;this.geojson&&(this.range&&(this.colorScale=j.scale([this.options.style.minColor,this.options.style.maxColor]).domain(this.range)),this.geojsonLayer&&this.geojsonLayer.clearLayers(),this.geojsonLayer&&this.geojsonLayer.remove(),this.geojsonLayer=a.geoJSON(this.new_geojson,{renderer:this.renderer,style:function(a){if(c.range){var d=void 0==a.properties.value?c.options.style.color:c.colorScale(+a.properties.value).css();return b.mergeOptions(c.options.style,{color:a.properties.color||d,weight:a.properties.weight||c.options.style.weight,dashArray:a.properties.dashArray||c.options.style.dashArray})}return b.mergeOptions(c.options.style,{color:a.properties.color||(void 0==a.properties.value?c.options.style.color:c.options.style.maxColor),weight:a.properties.weight||c.options.style.weight,dashArray:a.properties.dashArray||c.options.style.dashArray})},onEachFeature:function(a,b){b.on({mouseover:c.highlightFeature,mouseout:c.resetHighlight,click:c.zoomToFeatureOrOpenPopup},c),c.options.isPopup&&b.bindPopup(c.options.popup(a))},filter:function(a){return a.geometry&&"LineString"===a.geometry.type}}),this.geojsonLayer.addTo(this.map))}},{key:"show",value:function(){this.renderer&&this.renderer._container&&(this.renderer._container.style.opacity=1)}},{key:"hide",value:function(){this.renderer&&this.renderer._container&&(this.renderer._container.style.opacity=0)}},{key:"getIndex",value:function(){var a=this.renderer&&this.renderer._container&&this.renderer._container.style.zIndex;return a}},{key:"setZIndex",value:function(a){this.renderer&&this.renderer._container&&(this.renderer._container.style.zIndex=a)}},{key:"onRemove",value:function(){this.geojsonLayer&&this.geojsonLayer.clearLayers(),this.geojsonLayer&&this.geojsonLayer.remove(),this.renderer.remove(),this.geojsonLayer=null,this.geojson=null,this.new_geojson=null,this.data=null}}]),h}(h)},a.exports});;
Cube("datav:/com/datavmap-2d-layer-line/0.2.12",["datav:/npm/bcore/0.0.21/event"],function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"===typeof b||"function"===typeof b)?b:a}function f(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c("datav:/npm/bcore/0.0.21/event"),i=c("datav:/com/datavmap-2d-layer-line/0.2.12/lineLayer.js"),j={type:"FeatureCollection",features:[]},k=void 0,l={},m=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.container="string"===typeof a?document.querySelector(a):a,f.apis=c.apis,f.map=null,f._data=null,f.config=c,f.config.visibility=!1,f}return f(b,a),g(b,[{key:"init",value:function(){var a=this,b=this.getOptions(),c=i(this.map.L);this.layer=new c(b),this.layer.addTo(this.map),this.layer.on("click",function(b){var c=a.getOptions();a.emit("line-map-click",b),""!==c["click-key"]&&a.emit("global_var",c["click-key"],b[c["click-key"]])})}},{key:"addTo",value:function(a){this.map=a,k=a.L.datavUtils,this.init()}},{key:"getOptions",value:function(){var a=this.config=k&&k.mergeOptions(l,this.config),b={"click-key":a.interactive["click-key"],style:{minColor:a.stroke.color.minColor,maxColor:a.stroke.color.maxColor,color:a.stroke.color.color,weight:a.stroke.weight,dashArray:a.stroke.dashArray},isHover:a.interactive.isHover.show,hover:{color:a.interactive.isHover.color,weight:a.interactive.isHover.weight},isPopup:void 0===a.interactive.isPopup||a.interactive.isPopup,clickZoom:a.interactive.clickZoom,zoomPad:a.interactive.zoomPad};return b}},{key:"setGeojson",value:function(a){var b=null;b=Array.isArray(a)&&a.length?a[0]:a,b&&b.type&&"featurecollection"===b.type.toLowerCase()&&b.features&&0<b.features.length?this.layer&&this.layer.setGeojson(b):(console.log("\u4F7F\u7528\u9ED8\u8BA4\u7684geojson"),this.layer&&this.layer.setGeojson(j)),this.layer&&this.layer.render()}},{key:"show",value:function(){this.config.visibility=!0,this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.config.visibility=!1,this.layer&&this.layer.hide&&this.layer.hide()}},{key:"remove",value:function(){this.layer&&this.layer.remove&&this.layer.remove(),this.layer=null,this._data=null}},{key:"setData",value:function(a){this.layer&&this.layer.setData(a),this.layer&&this.layer.render()}},{key:"updateOptions",value:function(a){this.config=k.mergeOptions(this.config,a),a=this.getOptions(),this.layer&&this.layer.updateOptions(a),this.config.visibility?this.show():this.hide()}}]),b}(h);return a.exports=m,a.exports});