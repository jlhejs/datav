// env=undefined => env=publish 
Cube("datav:/com/ml-bar-with-line/2.5.21/bar",["datav:/com/maliang-utils/0.0.24","datav:/npm/bcore/0.0.22/event","datav:/npm/dchart-bar-with-line/0.6.22","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.17.11","datav:/npm/d3/3.5.12"],function(a,b,c){function d(a){return k.isNumber(a)&&!k.isNaN(a)&&k.isFinite(a)?a:null}function e(a,b){if(a=k.clone(b),null===d(k.toNumber(b.label.max))?"dataMax"===b.label.max?(a.max=null,a.maxNeedNice=!1):(a.max=null,a.maxNeedNice=!0):(a.max=b.label.max,a.maxNeedNice=!1),null===d(k.toNumber(b.label.min))?"dataMin"===b.label.min?(a.min=null,a.minNeedNice=!1):(a.min=0,a.minNeedNice=!0):(a.min=b.label.min,a.minNeedNice=!1),a.ticks=b.label.amount||null,a.tickFormat=b.label.format||function(a){return a},b.label.format&&b.label.format.includes("%")){switch(b.label.format){case"%":a.tickFormat=".0f";break;case".1%":a.tickFormat=".2f";break;case".2%":default:a.tickFormat=".4f";}a.format=b.label.format;l.format(b.label.format)}else a.format=null,a.tickFormat=b.label.format||function(a){return a};return a.fontSize=b.textarea.fontSize||null,a.fontColor=b.textarea.color,a.fontWeight=b.textarea.fontWeight,a.fontStrokeWidth=b.textarea.fontStrokeWidth,a.textShow=b.show&&b.label.show,a.assistLine=b.assistLine.show,a.assistLineColor=b.assistLine.color,a.rotate=k.toNumber(b.label.angle),a.label=b.unit.show&&b.unit.value||null,a.net=b.net.show,a.netColor=b.net.color,a}function f(a,b){var c=k.cloneDeep(a.chart),d=a.xaxis,f=a.yaxis,h=a.zaxis;c.xaxis=k.clone(d),c.yaxis=e(c.yaxis,f),c.zaxis=e(c.zaxis,h),c.series=k.clone(a.series),c.hiddenEmptyData=!0;var j=l.format(c.yaxis.format);c.series.forEach(function(b,d){switch(b.color=a.series[d].bar.color,b.label=a.series[d].bar.label,b.label.format=function(a){return j(a&&a.y&&a.y.value)},b.label.pos){case"center":b.label.dx="0",b.label.dy=".4em";break;case"top":b.label.dx="0",b.label.dy="-1em";break;case"bottom":b.label.dx="0",b.label.dy="-.26em";break;default:}b.show=a.series[d].bar.label.show,b.label.fontSize=b.label.fontSize,b.label.fontWeight=b.label.fontWeight,b.line.point.color=b.line.color,b.line.dashed="4 4",b.line.interpolate=a.series[d].line.interpolate?m.getCustomSmoothSpline:null,!1===b.line.show&&(b.line.point.show=!1),b.line.label.fontSize=b.line.label.fontSize,b.line.label.fontWeight=b.line.label.fontWeight,b.line.label.format=function(a,b){return l.format(c.zaxis.format)(a&&a.z&&a.z[b]&&a.z[b].value)}}),c.label=g({},c.series[0].bar.label),c.xaxis.padding=[a.chart.bar.innerPadding,a.chart.bar.outerPadding],c.xaxis.fontSize=d.textarea.fontSize||null,c.xaxis.fontColor=d.textarea.color,c.xaxis.fontWeight=d.textarea.fontWeight,c.xaxis.fontStrokeWidth=d.textarea.fontStrokeWidth,c.xaxis.textShow=d.show&&d.label.show,c.xaxis.assistLine=d.assistLine.show,c.xaxis.assistLineColor=d.assistLine.color,c.xaxis.rotate=k.toNumber(d.label.angle),c.xaxis.label=null,c.xaxis.net=d.net.show,c.xaxis.netColor=d.net.color,c.xaxis.ticks=d.label.amount&&parseInt(d.label.amount)?parseInt(d.label.amount):b.length||null,c.xaxis.dy=c.xaxis.textShow?0===c.xaxis.rotate?10:5:0,c.bg={color:a.chart.bar.background};var i=a.chart.margin.top;c.margin.top=i||c.yaxis.show&&c.yaxis.textShow&&c.yaxis.label&&3*c.yaxis.fontSize||0||c.zaxis.show&&c.zaxis.textShow&&c.zaxis.label&&3*c.zaxis.fontSize||0;var n=a.animation;if(c.animation=n.show,c.animationDuration=n.animationDuration,c.animationEasing=n.animationEasing,c.animationAfterPreviousSeries=n.animationAfterPreviousSeries,c.animationUpdateFromPrevious=n.animationUpdateFromPrevious,c.animationDurationUpdate=n.animationDurationUpdate,a.tooltip){var p=a.tooltip,q=p.axisPointer,r=p.textStyle,s=p.bgBox;c.tooltip||(c.tooltip={}),void 0!==p.show&&(c.tooltip.show=p.show),p.trigger&&(c.tooltip.trigger=p.trigger),p.triggerMethod&&(c.tooltip.triggerMethod=p.triggerMethod),p.beforeFormat&&(c.tooltip.beforeFormat=p.beforeFormat),c.tooltip.formatter=function(a,d,e){var f="<div class=\"dchart-tooltip\">",g=c.series,h=b.length,i=[];a.x&&i.push("<b>"+a.x.toString()+"</b>");var m=l.format(c.zaxis.format),n="axis"===c.tooltip.trigger;if((n||1>e/h)&&a.y){var p=k.cloneDeep([].concat(a.y));p.forEach(function(a,b){var c=g[n?b:d];c.bar&&c.bar.show&&i.push(o({serie:c&&c.bar,value:a,format:j}))})}if((n||1<=e/h)&&a.z){var q=k.cloneDeep([].concat(a.z));!n&&1<=e/h&&(q=[q[d]]),q.forEach(function(a,b){var c=g[n?b:d];c.line&&c.line.show&&i.push(o({serie:c&&c.line,value:a,format:m}))})}return f+=i.join("")+"</div>",f},void 0!==p.enterFocus&&(c.tooltip.enterFocus=p.enterFocus),void 0!==p.hideDelay&&(c.tooltip.hideDelay=p.hideDelay),q&&q._type&&(c.tooltip.axisPointer=q._type),q&&q.lineStyle&&(c.tooltip.lineStyle=q.lineStyle),r&&(c.tooltip.color=r.color,c.tooltip.fontSize=r.fontSize+"px",c.tooltip.fontFamily=r.fontFamily,c.tooltip.fontWeight=r.fontWeight),s&&(s.color&&(c.tooltip.backgroundColor=s.color),void 0!==s.padding&&(c.tooltip.padding=s.padding),void 0!==s.xOffset&&(c.tooltip.xOffset=s.xOffset),void 0!==s.yOffset&&(c.tooltip.yOffset=s.yOffset),s.customSize&&(c.tooltip.autoSize=!s.customSize.show,c.tooltip.width=s.customSize.width,c.tooltip.height=s.customSize.height),s.borderColor&&(c.tooltip.borderColor=s.borderColor),void 0!==s.borderWidth&&(c.tooltip.borderWidth=s.borderWidth))}return c}var g=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},h=c("datav:/npm/bcore/0.0.22/event"),i=c("datav:/npm/dchart-bar-with-line/0.6.22"),j=c("datav:/npm/jquery/2.1.4"),k=c("datav:/npm/lodash/4.17.11"),l=c("datav:/npm/d3/3.5.12"),m=c("datav:/com/maliang-utils/0.0.24"),n=Symbol(),o=function(a){var b=a.serie,c=a.color,d=a.value,e=a.key,f=a.format;return"<div><span style=\"display:inline-block; margin-right:5px; border-radius:2px; width:10px; height:10px; \n        background-color:"+(c||b&&b.color&&b.color.value||"#ccc")+"\"></span>\n        "+(e?e+": ":"")+f(d.value)+"</div>"};return a.exports=h.extend(function(a,b){this.config={theme:{},chart:{background:"transparent",margin:{top:50,bottom:70,left:0,right:0,containLabel:!0}},axis:{xaxis:{tickSize:2},yaxis:{tickSize:2}},legend:{},series:[{value:"1",color:"#2F8FBE"}],tooltip:{show:!0,trigger:"item",triggerMethod:"hover",beforeFormat:null,formatter:"xyzAxisChart",enterFocus:!0,axisPointer:{show:!0,_type:"line",lineStyle:{color:"#f00",width:1,_type:"solid"}},hideDelay:300,textStyle:{color:"#fff",fontSize:14,fontFamily:"Microsoft Yahei",fontWeight:"normal"},bgBox:{color:"rgba(0, 0, 0, 0.65)",padding:10,xOffset:6,yOffset:10,customSize:{show:!1,width:300,height:150},borderColor:"#333",borderWidth:0}}},this.container=j(a),this.init(b)},{init:function(a){this.apis=a.apis;var b=this.mergeConfig(a);this.chart=new i(this.container[0],b.chart)},isSafeNumber:function(a){return k.isNumber(a)&&!k.isNaN(a)&&k.isFinite(a)?a:null},render:function(a,b){var c=this.mergeConfig(b);a=this.data(a,c),a&&a.length&&(a&&this.chart.render(a,f(c,a)),this.updateStyle())},updateStyle:function(){var a=this.chart.el;if(a){a.selectAll(".serie-bg").style("stroke","none"),a.select(".con-svg").style("background","transparent"),a.selectAll(".line-g .line").style("fill","none");var b=k.get(this.config,"yaxis.label.format"),c=k.get(this.config,"zaxis.label.format");if(b&&b.includes("%")){var e=l.format(""+b);a.selectAll(".axis2 .tick text").text(function(a){return k.isFunction(e)&&e(a)||a})}if(c&&c.includes("%")){var f=l.format(""+c);a.selectAll(".axis3 .tick text").text(function(a){return k.isFunction(f)&&f(a)||a})}}},setColors:function(){},hasS:function(a){var b=0;return k.map(a,function(a){void 0!==a.s&&b++}),b===a.length||0!==b&&!1},setOriginalData:function(a){this[n]=a},getOriginalData:function(){return this[n]},data:function(a,b){a&&this.setOriginalData(a),a||(a=this.getOriginalData());var c=b.chart.loadAmount||2e3;return c&&(a=a.slice(0,c)),a&&(this.__data=k.clone(a)),this._data=this.hasS(this.__data)?m.threeD2Two(this.__data,"x",["y","z"],"s",m.getSeriesValue(this.config.series,"value")):k.cloneDeep(this.__data).map(function(a){return a.y={value:a.y,data:k.omit(a,"z")},a.z={value:a.z,data:k.omit(a,"y")},a}),this._data},mergeConfig:function(a){return a?(this.config.theme=k.defaultsDeep(a.theme||{},this.config.theme),this.setColors(),a.series&&(this.config.series=a.series),this.config=k.defaultsDeep(a||{},this.config),this.config):this.config},resize:function(a,b){this.config.chart.width=a,this.config.chart.height=b,this.render()},clear:function(){this.chart&&this.chart.empty()},destroy:function(){this.chart&&this.chart.destroy(),this.chart&&this.chart.off(),this._data=this.__data=null}}),a.exports});;
Cube("datav:/com/ml-bar-with-line/2.5.21",["datav:/com/legend/0.1.2","datav:/npm/bcore/0.0.22/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.17.11"],function(a,b,c){var d=c("datav:/npm/bcore/0.0.22/event"),e=c("datav:/npm/jquery/2.1.4"),f=c("datav:/npm/lodash/4.17.11"),g=c("datav:/com/ml-bar-with-line/2.5.21/bar"),h=c("datav:/com/legend/0.1.2");return a.exports=d.extend(function(a,b){this.config={theme:{},chart:{background:"transparent",margin:{top:36,bottom:0,left:20,right:0}},label:{},axis:{xaxis:{tickSize:1,dy:10},yaxis:{tickSize:2}},legend:{innerStyle:{"line-height":1.3}},series:[{value:"1",color:"#2F8FBE"}],animation:{show:!0,animationDuration:1e3,animationEasing:"cubicInOut",animationDurationUpdate:300,animationUpdateFromPrevious:!0,animationAfterPreviousSeries:!1}},this.container=e(a).css("padding","10px 0"),this.chart=null,this.legend=null,this.init(b)},{init:function(a){this.apis=a.apis;var b=this.mergeConfig(a),c=b.legend,d=c.layout.loc.split("-")[0];this.chartDom=e("<div class=\"dchart-bar-basic\" style=\"width: 100%;\"></div>"),this.legendDom=e("<div class=\"dchart-legend\" style=\"left: 0;width: 100%;\"></div>"),"bottom"===d?(this.container.append(this.chartDom),this.container.append(this.legendDom)):(this.container.append(this.legendDom),this.container.append(this.chartDom)),this.legend=new h(this.legendDom[0],b.legend);var i=[];b.series.length&&b.series.forEach(function(a){a.bar.show&&i.push({showName:a.bar.showName,color:a.bar.color}),a.line.show&&i.push({showName:a.line.showName,color:a.line.color})}),this.legend.render(i,b.legend),this.chartDom.height(this.container.height()-(b.legend.show&&this.legendDom.height()||0)),this.chart=new g(this.chartDom[0],f.cloneDeep(b)),this.legendDom.css("display",c.show&&"block"||"none"),this._bindEvent(),this.observeStyle()},observeStyle:function(){var a=this,b=new MutationObserver(function(b){b.forEach(function(b){"attributes"==b.type&&"block"===f.get(b.target,"style.display")&&a.render(null,a.config)})});b.observe(e(this.container).parent()[0],{attributes:!0,attributeFilter:["style"]})},render:function(a,b){var c=this.mergeConfig(b);if(a=this.data(a),a&&a.length){var d=[];c.series.length&&c.series.forEach(function(a){a.bar.show&&d.push({showName:a.bar.showName,color:a.bar.color}),a.line.show&&d.push({showName:a.line.showName,color:a.line.color})}),this.legend.render(d,c.legend),this.chartDom.height(this.container.height()-(c.legend.show&&this.legendDom.height()||0)),a&&this.chart.render(a,c),this._cfg=c}},updateStyle:function(){},setColors:function(){},data:function(a){return a&&(this._data=f.clone(a)),this._data},mergeConfig:function(a){return a?(this.config.theme=f.defaultsDeep(a.theme||{},this.config.theme),this.setColors(),a.series&&(this.config.series=a.series),this.config=f.defaultsDeep(a||{},this.config),this.config.legend.textarea.fontFamily=this.config.chart.fontFamily,this.config):this.config},resize:function(a,b){this.chart.resize(a,b-(this.config.legend.show&&this.legendDom.outerHeight()||0)-20)},updateLegendLayout:function(a){var b=this.config.legend;if(b.show!==a.show&&(this.legendDom.css("display",a.show&&"block"||"none"),this.config.chart.height=this.container.height()-(a.show&&this.legendDom.outerHeight()||0)),b.textarea.fontSize!==a.textarea.fontSize&&(this.legendDom.find(".legend-item").css("fontSize",a.textarea.fontSize),this.config.chart.height=this.container.height()-(a.show&&this.legendDom.outerHeight()||0)),JSON.stringify(b.layout.margin)!==JSON.stringify(a.layout.margin)){var c=a.layout.margin;this.legendDom.find(".legend-item").css("margin",c.vertiInterval+"px "+c.horiInterval+"px"),this.config.chart.height=this.container.height()-(a.show&&this.legendDom.outerHeight()||0)}var d=b.layout.loc.split("-")[0],e=a.layout.loc.split("-")[0];d!==e&&("top"===e?this.container[0].appendChild(this.chartDom[0]):"bottom"===e&&this.container[0].appendChild(this.legendDom[0])),this.render(null,{legend:a})},clear:function(){this.chart&&this.chart.clear(),this.legend&&f.isFunction(this.legend.clear)&&this.legend.clear()},destroy:function(){this.chart&&this.chart.destroy(),this.chart=null,this.legend&&this.legend.destroy(),this.legend=null,this.chartDom=null,this.legendDom=null,this.container&&this.container.empty(),this._data=null},startAnimate:function(){if(!(this.chart&&this.chart.chart&&this.chart.chart))return!1;if(this._cfg){this.chart.chart.clearAllAnimation();var a=this._cfg.animation,b=a.animationUpdateFromPrevious;a.animationUpdateFromPrevious=!1;var c=a.animationDurationUpdate;a.animationDurationUpdate=a.animationDuration,this.chart.render(),a.animationDurationUpdate=c,a.animationUpdateFromPrevious=b}},clearAnimate:function(){this.chart&&this.chart.chart&&this.chart.chart.resumeToAnimationEnd()},_bindEvent:function(){var a=this;if(this.chart&&this.chart.chart){var b=this.chart.chart;["click"].forEach(function(c){b.on(c,function(b){var d=b.data;return a.emit(c,d)})})}},highlight:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=a.data,c=a.options,d=void 0===c?{}:c;return this.chart?b?void(d.hasOwnProperty("selectMode")&&(d.mode=d.selectMode,delete d.selectMode),d.hasOwnProperty("cancelHighlightFirst")&&d.cancelHighlightFirst&&this.cancelHighlight(),this.chart.chart&&this.chart.chart.highlight({targetData:b,options:d})):null:null},cancelHighlight:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=a.data,c=a.options,d=void 0===c?{}:c;return this.chart?void(d.hasOwnProperty("selectMode")&&(d.mode=d.selectMode,delete d.selectMode),this.chart&&this.chart.chart&&this.chart.chart.cancelHighlight({targetData:b,options:d})):null}}),a.exports});