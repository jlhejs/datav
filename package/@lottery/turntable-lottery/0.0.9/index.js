// env=undefined => env=publish 
Cube("datav:/com/@lottery/turntable-lottery/0.0.9/style.less", [], function(m){m.exports=".turntable{position:relative}.turntable .canvas{background-size:100% 100%;background-repeat:no-repeat}.turntable .btn{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);cursor:pointer;user-select:none}.turntable .imgBox{display:none}.turntable .imgBox .imgIcon{width:30px;height:30px}";return m.exports});;
Cube("datav:/com/@lottery/turntable-lottery/0.0.9/rotate.js",["datav:/npm/jquery/2.1.4"],function(module,exports,require,load,process,global){var jQuery=require("datav:/npm/jquery/2.1.4");return function($){for(var supportedCSS,styles=document.getElementsByTagName("head")[0].style,toCheck="transformProperty WebkitTransform OTransform msTransform MozTransform".split(" "),a=0;a<toCheck.length;a++)void 0!==styles[toCheck[a]]&&(supportedCSS=toCheck[a]);var IE=eval('"v"=="\v"'),V;jQuery.fn.extend({rotate:function(t){if(0!==this.length&&void 0!==t){"number"==typeof t&&(t={angle:t});for(var i=[],e=0,s=this.length;e<s;e++){var a,h=this.get(e);h.Wilq32&&h.Wilq32.PhotoEffect?h.Wilq32.PhotoEffect._handleRotation(t):(a=$.extend(!0,{},t),a=new Wilq32.PhotoEffect(h,a)._rootObj,i.push($(a)))}return i}},getRotateAngle:function(){for(var t=[],i=0,e=this.length;i<e;i++){var s=this.get(i);s.Wilq32&&s.Wilq32.PhotoEffect&&(t[i]=s.Wilq32.PhotoEffect._angle)}return t},stopRotate:function(){for(var t=0,i=this.length;t<i;t++){var e=this.get(t);e.Wilq32&&e.Wilq32.PhotoEffect&&clearTimeout(e.Wilq32.PhotoEffect._timer)}}}),Wilq32=window.Wilq32||{},Wilq32.PhotoEffect=supportedCSS?function(t,i){t.Wilq32={PhotoEffect:this},this._img=this._rootObj=this._eventObj=t,this._handleRotation(i)}:function(t,i){var e;this._img=t,this._rootObj=document.createElement("span"),this._rootObj.style.display="inline-block",this._rootObj.Wilq32={PhotoEffect:this},t.parentNode.insertBefore(this._rootObj,t),t.complete?this._Loader(i):jQuery((e=this)._img).bind("load",function(){e._Loader(i)})},Wilq32.PhotoEffect.prototype={_setupParameters:function(t){this._parameters=this._parameters||{},"number"!=typeof this._angle&&(this._angle=0),"number"==typeof t.angle&&(this._angle=t.angle),this._parameters.animateTo="number"==typeof t.animateTo?t.animateTo:this._angle,this._parameters.step=t.step||this._parameters.step||null,this._parameters.easing=t.easing||this._parameters.easing||function(t,i,e,s,a){return-s*((i=i/a-1)*i*i*i-1)+e},this._parameters.duration=t.duration||this._parameters.duration||1e3,this._parameters.callback=t.callback||this._parameters.callback||function(){},t.bind&&t.bind!=this._parameters.bind&&this._BindEvents(t.bind)},_handleRotation:function(t){this._setupParameters(t),this._angle==this._parameters.animateTo?this._rotate(this._angle):this._animateStart()},_BindEvents:function(t){if(t&&this._eventObj){if(this._parameters.bind){var i=this._parameters.bind;for(e in i)i.hasOwnProperty(e)&&jQuery(this._eventObj).unbind(e,i[e])}for(var e in this._parameters.bind=t)t.hasOwnProperty(e)&&jQuery(this._eventObj).bind(e,t[e])}},_Loader:IE?function(t){var i=this._img.width,e=this._img.height;this._img.parentNode.removeChild(this._img),this._vimage=this.createVMLNode("image"),this._vimage.src=this._img.src,this._vimage.style.height=e+"px",this._vimage.style.width=i+"px",this._vimage.style.position="absolute",this._vimage.style.top="0px",this._vimage.style.left="0px",this._container=this.createVMLNode("group"),this._container.style.width=i,this._container.style.height=e,this._container.style.position="absolute",this._container.setAttribute("coordsize",i-1+","+(e-1)),this._container.appendChild(this._vimage),this._rootObj.appendChild(this._container),this._rootObj.style.position="relative",this._rootObj.style.width=i+"px",this._rootObj.style.height=e+"px",this._rootObj.setAttribute("id",this._img.getAttribute("id")),this._rootObj.className=this._img.className,this._eventObj=this._rootObj,this._handleRotation(t)}:function(t){this._rootObj.setAttribute("id",this._img.getAttribute("id")),this._rootObj.className=this._img.className,this._width=this._img.width,this._height=this._img.height,this._widthHalf=this._width/2,this._heightHalf=this._height/2;var i=Math.sqrt(this._height*this._height+this._width*this._width);this._widthAdd=i-this._width,this._heightAdd=i-this._height,this._widthAddHalf=this._widthAdd/2,this._heightAddHalf=this._heightAdd/2,this._img.parentNode.removeChild(this._img),this._aspectW=(parseInt(this._img.style.width,10)||this._width)/this._img.width,this._aspectH=(parseInt(this._img.style.height,10)||this._height)/this._img.height,this._canvas=document.createElement("canvas"),this._canvas.setAttribute("width",this._width),this._canvas.style.position="relative",this._canvas.style.left=-this._widthAddHalf+"px",this._canvas.style.top=-this._heightAddHalf+"px",this._canvas.Wilq32=this._rootObj.Wilq32,this._rootObj.appendChild(this._canvas),this._rootObj.style.width=this._width+"px",this._rootObj.style.height=this._height+"px",this._eventObj=this._canvas,this._cnv=this._canvas.getContext("2d"),this._handleRotation(t)},_animateStart:function(){this._timer&&clearTimeout(this._timer),this._animateStartTime=+new Date,this._animateStartAngle=this._angle,this._animate()},_animate:function(){var t,i=+new Date,e=i-this._animateStartTime>this._parameters.duration;e&&!this._parameters.animatedGif?clearTimeout(this._timer):((this._canvas||this._vimage||this._img)&&(i=this._parameters.easing(0,i-this._animateStartTime,this._animateStartAngle,this._parameters.animateTo-this._animateStartAngle,this._parameters.duration),this._rotate(~~(10*i)/10)),this._parameters.step&&this._parameters.step(this._angle),(t=this)._timer=setTimeout(function(){t._animate.call(t)},10)),this._parameters.callback&&e&&(this._angle=this._parameters.animateTo,this._rotate(this._angle),this._parameters.callback.call(this._rootObj))},_rotate:(V=Math.PI/180,IE?function(t){this._angle=t,this._container.style.rotation=t%360+"deg"}:supportedCSS?function(t){this._angle=t,this._img.style[supportedCSS]="rotate("+t%360+"deg)"}:function(t){t=(this._angle=t)%360*V,this._canvas.width=this._width+this._widthAdd,this._canvas.height=this._height+this._heightAdd,this._cnv.translate(this._widthAddHalf,this._heightAddHalf),this._cnv.translate(this._widthHalf,this._heightHalf),this._cnv.rotate(t),this._cnv.translate(-this._widthHalf,-this._heightHalf),this._cnv.scale(this._aspectW,this._aspectH),this._cnv.drawImage(this._img,0,0)})},IE&&(Wilq32.PhotoEffect.prototype.createVMLNode=function(){document.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{return document.namespaces.rvml||document.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<rvml:"+t+' class="rvml">')}}catch(t){return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}}())}(jQuery),module.exports});;
Cube("datav:/com/@lottery/turntable-lottery/0.0.9",["datav:/npm/bcore/0.0.18/event","datav:/npm/jquery/2.1.4","datav:/npm/lodash/4.6.1"],function(t,i,n,e,a,s){var o=n("datav:/npm/bcore/0.0.18/event"),h=n("datav:/npm/jquery/2.1.4"),r=n("datav:/npm/lodash/4.6.1");return n("datav:/com/@lottery/turntable-lottery/0.0.9/rotate.js"),n("datav:/com/@lottery/turntable-lottery/0.0.9/style.less",""),t.exports=o.extend(function(t,i){this.config={theme:{},turntable:{colors:[{color:"#0a73ff"},{color:"#3dabff"},{color:"#0a73ff"},{color:"#3dabff"},{color:"#0a73ff"},{color:"#3dabff"},{color:"#0a73ff"},{color:"#3dabff"}]}},this.container=h(t),this.containSize={boxWidth:this.container&&this.container.width(),boxHeight:this.container&&this.container.height()},this.turntableSize=null,this.apis=i.apis,this._data=null,this.initData=null,this.chart=null,this.canvas=null,this.btn=null,this.imgBox=null,this.turntable=null,this.bRotate=!1,this.init(i)},{init:function(t){this.mergeConfig(t),this.updateLayout(),this.container.append('\n        <div class="turntable">\n          <canvas class="canvas"></canvas>\n          <img class="btn" src="" />\n          <div class="imgBox"></div>\n        </div>\n      '),this.container.css({display:"flex","align-items":"center","justify-content":"center"}),this.turntable=this.container.find(".turntable"),this.canvas=this.container.find(".canvas"),this.btn=this.container.find(".btn"),this.imgBox=this.container.find(".imgBox"),this.updateStyle()},render:function(t,i){t=this.data(t);this.mergeConfig(i);var n=this;r.isEqual(this.initData,this._data)||(this.rotateFn(1,"",!0),this.initData=this._data),this.btn.on("click",function(){n.lotteryFn(!1)});var e="";r.map(this._data,function(t){t=r.isUndefined(t.imgSrc)?"https://img.alicdn.com/imgextra/i2/O1CN01QVOfqd1C0Hml6lhWM_!!6000000000018-2-tps-32-32.png":t.imgSrc;e+='<img class="imgIcon" src='+t+" />"}),this.imgBox.empty(),this.imgBox.append(e);var a=this.container.find(".imgIcon"),s=0;r.map(a,function(t){t.onload=function(){++s===a.length&&(n.updateStyle(),n.drawRouletteWheel())}})},lotteryFn:function(){var t,i;this.bRotate||(this.bRotate=!this.bRotate,t=this.rnd(1,this._data.length),i=this._data[t-1],this.rotateFn(t,i,!1))},rotateFn:function(t,i,n){var e=this,a=this.config,s=a.time,a=a.turns,t=(t=t*(360/this._data.length)-360/(2*this._data.length))<270?270-t:360-t+270;this.canvas.stopRotate(),this.canvas.rotate({angle:0,animateTo:n?t:t+360*a,duration:n?100:s,callback:function(){n||(i&&e.emit("handleClick",i),e.bRotate=!e.bRotate)}})},drawRouletteWheel:function(){var t=this.canvas[0],i=this.containSize,n=i.boxWidth,e=i.boxHeight;this.turntableSize=Math.min(n,e);var a=this.turntableSize/2,i=this.config.turntable,s=i.imgSpace,o=i.textStyle,h=i.lineHeight,r=i.textWrapNum,l=i.textSpace,n=i.colors,e=i.strokeStyle,c=i.imgSize,u=i.isShowImg;if(t.getContext){var d=Math.PI/(this._data.length/2),f=t.getContext("2d");f.clearRect(0,0,this.turntableSize,this.turntableSize),f.strokeStyle=e,f.font=o.fontWeight+" "+o.fontSize+"px "+o.fontFamily;for(var g=this.handleMakeUpType(this._data,n),b=0;b<this._data.length;b++){var m=b*d;f.fillStyle=g[b].color,f.beginPath(),f.arc(a,a,a,m,m+d,!1),f.arc(a,a,0,m+d,m,!0),f.stroke(),f.fill(),f.save(),f.fillStyle=o.color;var p=this._data[b].name;if(f.translate(a+Math.cos(m+d/2)*(a-l),a+Math.sin(m+d/2)*(a-l)),f.rotate(m+d/2+Math.PI/2),0<p.indexOf("M"))for(var v=p.split("M"),x=0;x<v.length;x++)f.font=0==x?"bold 20px Microsoft YaHei":o.fontWeight+" "+o.fontSize+"px "+o.fontFamily,0==x?f.fillText(v[x]+"M",-f.measureText(v[x]+"M").width/2,x*h):f.fillText(v[x],-f.measureText(v[x]).width/2,x*h);else if(-1==p.indexOf("M")&&p.length>r)for(v=(p=p.substring(0,r)+"||"+p.substring(r)).split("||"),x=0;x<v.length;x++)f.fillText(v[x],-f.measureText(v[x]).width/2,x*h);else f.fillText(p,-f.measureText(p).width/2,0);p=this.container.find(".imgIcon")[b]&&this.container.find(".imgIcon")[b];u&&f.drawImage(p,-s.level,s.vertical,c.width,c.height),f.restore()}}},handleMakeUpType:function(t,n){var e=[],a=n.length;return e.length<t.length&&r.map(t,function(t,i){e.push(n[i%a])}),e},rnd:function(t,i){var n=new Uint32Array(1);return window.crypto.getRandomValues(n),n[0]%(i-t+1)+t},resize:function(t,i){this.containSize={boxWidth:t,boxHeight:i},this.render(this._data,this.config)},setColors:function(){},data:function(t){return t&&(this._data=t),this._data},mergeConfig:function(t){return t&&(this.config.theme=r.defaultsDeep(t.theme||{},this.config.theme),this.setColors(),t.turntable.colors&&(this.config.turntable.colors=t.turntable.colors),this.config=r.defaultsDeep(t||{},this.config)),this.config},updateLayout:function(){},updateStyle:function(){var t=this.config,i=t.button,n=i.buttonSize,e=i.buttonImg,a=i.verticalSpace,s=t.turntable.turntableImg,i=this.containSize,t=i.boxWidth,i=i.boxHeight;this.turntableSize=Math.min(t,i),this.btn.css({width:n.width,height:n.height,marginTop:a+"px"}),this.btn.attr("src",e),this.canvas.css({"background-image":"url("+s+")"}),this.canvas.attr("width",this.turntableSize+"px"),this.canvas.attr("height",this.turntableSize+"px"),this.turntable.css({width:this.turntableSize,height:this.turntableSize})},startTurning:function(){this.lotteryFn(!1)},destroy:function(){if(!this.container)return!1;this.container.innerHTML=""}}),t.exports});