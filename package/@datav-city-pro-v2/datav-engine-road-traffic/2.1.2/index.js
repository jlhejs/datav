// env=undefined => env=publish 
Cube("datav:/com/@datav-city-pro-v2/datav-engine-road-traffic/2.1.2/shader/line.frag.glsl",[],function(n,e,t,r,a,l){return n.exports="#define GLSLIFY 1\n#include <common>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#include <fog_pars_fragment>\n// uniform vec3 color;\n// uniform vec3 texture0Color;\n// uniform vec3 texture1Color;\n// varying vec4 v_color;\nflat in vec4 v_color;\n\nuniform float opacity;\nuniform float blurWidthRatio;\n\n#ifdef USE_MAP\n\nuniform sampler2D map;\nuniform sampler2D map1;\n\n#endif\n\n#ifdef USE_ALPHA_MAP\n\nuniform sampler2D alphaMap;\n\n#endif\n\nuniform float visibility;\n \nuniform float dashOffset0;\nuniform float dashOffset1;\n\nuniform float alphaTest;\nuniform vec2 uvScale0;\nuniform vec2 uvScale1;\n\nin vec2 vUv;\n// in float vCounters;\n// flat in float lineAspect;\n\nvarying vec2 v_normal;\n\nvoid main() {\n\n  #include <clipping_planes_fragment>\n  #include <logdepthbuf_fragment>\n\n    // vec4 c = vec4(color, opacity);\n    vec4 c = v_color;\n   \n    // antialiase\n    // reference from https://blog.mapbox.com/drawing-antialiased-lines-with-opengl-8766f34192dc\n    float blur = 1.0;\n    float featherLen = length(v_normal) - (1.0 - blurWidthRatio);\n    if(featherLen > 0.0){\n      blur =  1.0 - featherLen / blurWidthRatio;\n    }\n    blur *= blur;\n\n    #ifdef USE_MAP \n      vec2 uv0 = vUv * uvScale0;\n      uv0.x -= dashOffset0; \n      vec4 texture0 = texture2D(map, uv0);//线条纹理0\n      // texture0 *= blur; //对线条纹理做边缘模糊\n      // texture0 = mix(vec4(.0), texture0, texture0.a);\n      texture0 *= vec4(texture0Color, 1.0);\n\n      vec2 uv1 = vUv * uvScale1;\n      uv1.x -= dashOffset1;\n      vec4 texture1 =texture2D(map1, uv1);//线条纹理1\n      // texture1 *= blur; //对线条纹理做边缘模糊\n      // texture1 = mix(vec4(.0), texture1, texture1.a);\n      // texture1 = mix(texture1, vec4(1.0), texture1);\n      texture1 *= vec4(texture1Color, 1.0);\n\n      vec4 textureColor = texture0 + texture1;\n      c = mix(c, textureColor, textureColor);\n\n    #endif\n\n    #ifdef USE_ALPHA_MAP\n      // c.a *= texture2D(alphaMap, vUv * repeat).a;\n      c.a *= texture2D(alphaMap, uv0).a;\n    #endif\n\n    if (c.a < alphaTest)\n      discard;\n\n    gl_FragColor = v_color;//c\n    gl_FragColor.a *= blur;\n    \n    #include <premultiplied_alpha_fragment>\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n\n}",n.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-road-traffic/2.1.2/shader/line.vert.glsl",[],function(e,n,t,r,i,c){return e.exports="#define GLSLIFY 1\n#include <common>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#include <fog_pars_vertex>\n#include <encodings_pars_fragment>\n\nattribute vec3 previous;\nattribute vec3 next;\nattribute float side;\nattribute vec4 color;\n \n// attribute float counters;\nattribute float len;\n\nuniform vec2 resolution;\nuniform float lineWidth;\n \nuniform float near;\nuniform float far;\nuniform uint sizeAttenuation; \n\nout vec2 vUv;\n// out float vCounters;\n\nvarying vec2 v_normal;\n// varying vec4 v_color;\nflat out vec4 v_color;\n// flat out float lineAspect;\n\n// flat out uint vPick;\n// flat out uint vUnPick;\n\nvec2 fix(vec4 i, float aspect) {\n\n  vec2 res = i.xy / i.w;\n  res.x *= aspect;\n  return res;\n}\n\n// ShaderChunk/encodings_pars_fragment.glsl.js 中移除了 sRGBToLinear \nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\n\n// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n// perhaps there is a more elegant solution -- WestLangley\nvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n  // trim end segment so it terminates between the camera plane and the near plane\n\n  // conservative estimate of the near plane\n  float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n  float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n  float nearEstimate = - 0.5 * b / a;\n\n  float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n  end.xyz = mix( start.xyz, end.xyz, alpha );\n\n}\n\nvoid main() {\n  // vCounters = counters;\n  vUv = uv;\n  v_color = sRGBToLinear(color);\n  \n  float aspect = resolution.x / resolution.y;\n  float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);\n  vec2 aspectVec = vec2(aspect, 1.0);\n\n  // lineAspect = len / lineWidth / aspect;\n\n  // camera space\n  vec4 mvCur = modelViewMatrix * vec4(position, 1.);\n  vec4 mvPrev = modelViewMatrix * vec4(previous, 1.);\n  vec4 mvNext = modelViewMatrix * vec4(next, 1.);\n\n  if(mvCur.z < 0.0 && mvPrev.z >= 0.0){\n    trimSegment(mvCur, mvPrev);\n  }else if(mvPrev.z < 0.0 && mvCur.z >= 0.0){\n    trimSegment(mvPrev, mvCur);\n  }\n\n  if(mvCur.z < 0.0 && mvNext.z >= 0.0){\n    trimSegment(mvCur, mvNext);\n  }else if(mvNext.z < 0.0 && mvCur.z >= 0.0){\n    trimSegment(mvNext, mvCur);\n  }\n\n  // into clip space\n  vec4 currentProjected = projectionMatrix * mvCur;\n  vec4 previousProjected = projectionMatrix * mvPrev;\n  vec4 nextProjected = projectionMatrix * mvNext;\n\n  // into NDC space [-1,1] and correct for aspect ratio(screenWidth/screenHeight)\n  vec2 currentScreen = currentProjected.xy / currentProjected.w * aspectVec;\n  vec2 previousScreen = previousProjected.xy / previousProjected.w * aspectVec;\n  vec2 nextScreen = nextProjected.xy / nextProjected.w * aspectVec;\n   \n  float pixelWidth =\n      sizeAttenuation == 1u ? 1.0 : currentProjected.w * pixelWidthRatio;\n   \n  float width = lineWidth;\n\n  width *= 1.8 * pixelWidth;\n\n  vec2 dir = vec2(0.0);\n\n  if (nextScreen == currentScreen)  \n    dir = normalize(currentScreen - previousScreen);\n  else if (previousScreen == currentScreen)  \n    dir = normalize(nextScreen - currentScreen);\n  else {\n    vec2 dir1 = normalize(currentScreen - previousScreen);\n    vec2 dir2 = normalize(nextScreen - currentScreen);\n    dir = normalize(dir1 + dir2);\n\n    // vec2 perp = vec2(-dir1.y, dir1.x);\n    // vec2 miter = vec2(-dir.y, dir.x);\n    // width = clamp( width / dot( miter, perp ), width, 1.5 * width);\n  }\n\n  v_normal = normalize( vec2(-dir.y / aspect, dir.x) * side); //for antialiase line\n\n  vec4 normalVec4 = vec4( -dir.y, dir.x, 0., 1. );\n  normalVec4.xy *= .5 * width;\n  normalVec4 *= projectionMatrix;\n\n  vec2 normal = normalVec4.xy;\n\n  vec4 offset = vec4(normal * side, 0., 0.);\n\n  gl_Position = currentProjected + offset;\n\n  vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n  #include <logdepthbuf_vertex>\n  #include <clipping_planes_vertex>\n  #include <fog_vertex>\n\n}\n",e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-road-traffic/2.1.2/meshLine",[],function(t,e,i,r,n,s){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(e,t){var i,r=Object.keys(e);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(e),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)),r}function a(r){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){var e,i;e=r,i=n[t=t],t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(n,t))})}return r}function l(){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=p(t)););return t}(t,e);if(r)return(r=Object.getOwnPropertyDescriptor(r,e)).get?r.get.call(arguments.length<3?t:i):r.value}).apply(this,arguments)}function h(t,e){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function c(i){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=p(i),e=(t=r?(t=p(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return f(e)}}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function y(t){return function(t){if(Array.isArray(t))return v(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){var i;if(t)return"string"==typeof t?v(t,e):"Map"===(i="Object"===(i=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?v(t,e):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function d(t,e,i){e&&m(t.prototype,e),i&&m(t,i),Object.defineProperty(t,"prototype",{writable:!1})}function g(t,e,i){t*=6,e*=6;return i[t]===i[e]&&i[1+t]===i[1+e]&&i[2+t]===i[2+e]}function O(t,e){t*=6;return[e[t],e[1+t],e[2+t]]}function w(t,e,i,r,n){var s;if(t=t.subarray||t.slice?t:t.buffer,i=i.subarray||i.slice?i:i.buffer,t=e?t.subarray?t.subarray(e,n&&e+n):t.slice(e,n&&e+n):t,i.set)i.set(t,r);else for(s=0;s<t.length;s++)i[s+r]=t[s]}return t.exports=function(M){function t(){b(this,t),this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices=[],this.uvs=[],this.counters=[],this.colors=[],this.segItemCounts=[],this.geometry=new M.BufferGeometry,this.widthCallback=null,this.matrixWorld=new M.Matrix4,this.inverseMatrix=new M.Matrix4,this.ray=new M.Ray,this.sphere=new M.Sphere}return d(t,[{key:"setMatrixWorld",value:function(t){this.matrixWorld=t}},{key:"setGeometry",value:function(t,e,i){this.widthCallback=i,this.process(t,e)}},{key:"createGeometry",value:function(){var t=new M.BufferAttribute(new Float32Array(this.positions),3),e=new M.BufferAttribute(new Float32Array(this.previous),3),i=new M.BufferAttribute(new Float32Array(this.next),3),r=new M.BufferAttribute(new Float32Array(this.side),1),n=new M.BufferAttribute(new Float32Array(this.uvs),2),s=new M.BufferAttribute(new Uint32Array(this.indices),1),o=new M.BufferAttribute(new Float32Array(this.counters),1),u=new M.BufferAttribute(new Float32Array(this.colors),4);this.geometry.setAttribute("position",t),this.geometry.setAttribute("previous",e),this.geometry.setAttribute("next",i),this.geometry.setAttribute("side",r),this.geometry.setAttribute("uv",n),this.geometry.setAttribute("counters",o),this.geometry.setAttribute("color",u),this.geometry.setIndex(s)}},{key:"process",value:function(t,e){this._processIndex(t),this._processSide(t),this._processUV(t),this._processPosition(t),this._processColor(t,e),this.segItemCounts.push(t.length/3)}},{key:"_processIndex",value:function(t){for(var e=this.positions.length/3,i=t.length/6,r=0;r<i-1;r++){var n=2*r+e;this.indices.push(n,1+n,2+n),this.indices.push(2+n,1+n,3+n)}}},{key:"_processSide",value:function(t){for(var e=t.length/6,i=0;i<e;i++)this.side.push(1),this.side.push(-1)}},{key:"_processUV",value:function(t){for(var e=t.length/6,i=0;i<e;i++)this.uvs.push(i/(e-1),0),this.uvs.push(i/(e-1),1)}},{key:"_processPosition",value:function(t){for(var e,i,r=0,n=t.length/6;r<n;r++)this.counters.push(i=r/(n-1)),this.counters.push(i);(e=this.positions).push.apply(e,y(t));var s=t.length/6,o=g(0,s-1,t)?O(s-2,t):O(0,t);this.previous.push(o[0],o[1],o[2]),this.previous.push(o[0],o[1],o[2]);for(var u=0;u<s-1;u++)o=O(u,t),this.previous.push(o[0],o[1],o[2]),this.previous.push(o[0],o[1],o[2]);for(var a=1;a<s;a++)o=O(a,t),this.next.push(o[0],o[1],o[2]),this.next.push(o[0],o[1],o[2]);o=g(s-1,0,t)?O(1,t):O(s-1,t),this.next.push(o[0],o[1],o[2]),this.next.push(o[0],o[1],o[2])}},{key:"_processColor",value:function(t,e){for(var i,r=t.length/6,n=0;n<r;n++)(i=this.colors).push.apply(i,y(e)),(i=this.colors).push.apply(i,y(e))}},{key:"_processLen",value:function(t,e){for(var i=t.length/6,r=0;r<i;r++)this.lens.push(e||0),this.lens.push(e||0)}},{key:"clear",value:function(){this.positions.length=0,this.previous.length=0,this.next.length=0,this.side.length=0,this.width.length=0,this.indices.length=0,this.uvs.length=0,this.counters.length=0,this.segItemCounts.length=0}},{key:"raycast",value:function(t,e){var i=t.linePrecision,r=i*i,i=this.geometry,n=this.inverseMatrix,s=this.ray,o=this.sphere;if(null===i.boundingSphere&&i.computeBoundingSphere(),o.copy(i.boundingSphere),o.applyMatrix4(this.matrixWorld),!1!==t.ray.intersectSphere(o)){n.getInverse(this.matrixWorld),s.copy(t.ray).applyMatrix4(n);var u=new M.Vector3,a=new M.Vector3,l=new M.Vector3,h=new M.Vector3,c=this instanceof M.LineSegments?2:1;if(i instanceof M.BufferGeometry){o=i.index,n=o.index,o=o.attributes;if(null!==n)for(var f=n.array,p=o.position.array,y=0,v=f.length-1;y<v;y+=c){var b=f[y],m=f[y+1];u.fromArray(p,3*b),a.fromArray(p,3*m),r<s.distanceSqToSegment(u,a,h,l)||(h.applyMatrix4(this.matrixWorld),(b=t.ray.origin.distanceTo(h))<t.near||b>t.far||e.push({distance:b,point:l.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this}))}else for(var d,g=o.position.array,O=0,w=g.length/3-1;O<w;O+=c)u.fromArray(g,3*O),a.fromArray(g,3*O+3),r<s.distanceSqToSegment(u,a,h,l)||(h.applyMatrix4(this.matrixWorld),(d=t.ray.origin.distanceTo(h))<t.near||d>t.far||e.push({distance:d,point:l.clone().applyMatrix4(this.matrixWorld),index:O,face:null,faceIndex:null,object:this}))}else if(i instanceof M.Geometry)for(var S,A=i.vertices,x=A.length,j=0;j<x-1;j+=c)r<s.distanceSqToSegment(A[j],A[j+1],h,l)||(h.applyMatrix4(this.matrixWorld),(S=t.ray.origin.distanceTo(h))<t.near||S>t.far||e.push({distance:S,point:l.clone().applyMatrix4(this.matrixWorld),index:j,face:null,faceIndex:null,object:this}))}}},{key:"advance",value:function(t){var e=this.attributes.position.array,i=this.attributes.previous.array,r=this.attributes.next.array,n=e.length;w(e,0,i,0,n),w(e,6,e,0,n-6),e[n-6]=t.x,e[n-5]=t.y,e[n-4]=t.z,e[n-3]=t.x,e[n-2]=t.y,e[n-1]=t.z,w(e,6,r,0,n-6),r[n-6]=t.x,r[n-5]=t.y,r[n-4]=t.z,r[n-3]=t.x,r[n-2]=t.y,r[n-1]=t.z,this.attributes.position.needsUpdate=!0,this.attributes.previous.needsUpdate=!0,this.attributes.next.needsUpdate=!0}}]),{MeshLine:t,MeshLineMaterial:function(t){var e=s;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t);var n=c(s);function s(t,e,i){b(this,s);var r=a({lineWidth:{value:1},brightSegWidth:{value:1},blurWidthRatio:{value:.5},opacity:{value:1},brightSegOpacity:{value:1},map:{value:null},alphaMap:{value:null},resolution:{value:new M.Vector2(1,1)},sizeAttenuation:{value:1},near:{value:1},far:{value:1},visibility:{value:1},dashOffset0:{value:0},dashOffset1:{value:0},useDash:{value:0},alphaTest:{value:0},repeat:{value:new M.Vector2(1,1)},brightSegCount:{value:3},uvScale0:{value:new M.Vector2(1,1)},uvScale1:{value:new M.Vector2(1,1)},spaceRatio:{value:0},symbolCount:{value:1},symbolAspect:{value:1}},M.UniformsLib.fog),r=n.call(this,{uniforms:r,vertexShader:e,fragmentShader:i});return r.type="MeshLineMaterial",Object.defineProperties(f(r),{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(t){this.uniforms.lineWidth.value=t}},brightSegWidth:{enumerable:!0,get:function(){return this.uniforms.brightSegWidth.value},set:function(t){this.uniforms.brightSegWidth.value=t}},blurWidthRatio:{enumerable:!0,get:function(){return this.uniforms.blurWidthRatio.value},set:function(t){this.uniforms.blurWidthRatio.value=t}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(t){this.uniforms.map.value=t}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(t){this.uniforms.alphaMap.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},brightSegOpacity:{enumerable:!0,get:function(){return this.uniforms.brightSegOpacity.value},set:function(t){this.uniforms.brightSegOpacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(t){this.uniforms.sizeAttenuation.value=t}},near:{enumerable:!0,get:function(){return this.uniforms.near.value},set:function(t){this.uniforms.near.value=t}},far:{enumerable:!0,get:function(){return this.uniforms.far.value},set:function(t){this.uniforms.far.value=t}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(t){this.uniforms.visibility.value=t}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(t){this.uniforms.dashArray.value=t,this.useDash=0!==t?1:0}},dashOffset0:{enumerable:!0,get:function(){return this.uniforms.dashOffset0.value},set:function(t){this.uniforms.dashOffset0.value=t}},dashOffset1:{enumerable:!0,get:function(){return this.uniforms.dashOffset1.value},set:function(t){this.uniforms.dashOffset1.value=t}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(t){this.uniforms.dashRatio.value=t}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(t){this.uniforms.useDash.value=t}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(t){this.uniforms.alphaTest.value=t}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(t){this.uniforms.repeat.value.copy(t)}},uvScale0:{enumerable:!0,get:function(){return this.uniforms.uvScale0.value},set:function(t){this.uniforms.uvScale0.value.copy(t)}},uvScale1:{enumerable:!0,get:function(){return this.uniforms.uvScale1.value},set:function(t){this.uniforms.uvScale1.value.copy(t)}},symbolCount:{enumerable:!0,get:function(){return this.uniforms.symbolCount.value},set:function(t){this.uniforms.symbolCount.value=t}},brightSegCount:{enumerable:!0,get:function(){return this.uniforms.brightSegCount.value},set:function(t){this.uniforms.brightSegCount.value=t}},spaceRatio:{enumerable:!0,get:function(){return this.uniforms.spaceRatio.value},set:function(t){this.uniforms.spaceRatio.value=t}},symbolAspect:{enumerable:!0,get:function(){return this.uniforms.symbolAspect.value},set:function(t){this.uniforms.symbolAspect.value=t}}}),r.setValues(t),r}return d(s,[{key:"copy",value:function(t){return l(p(s.prototype),"copy",this).call(this,t),this.lineWidth=t.lineWidth,this.useMap=t.useMap,this.alphaMap=t.alphaMap,this.useAlphaMap=t.useAlphaMap,this.opacity=t.opacity,this.resolution.copy(t.resolution),this.sizeAttenuation=t.sizeAttenuation,this.near=t.near,this.far=t.far,this.dashArray.copy&&this.dashArray.copy(t.dashArray),this.dashOffset0.copy&&this.dashOffset0.copy(t.dashOffset0),this.dashOffset1.copy&&this.dashOffset1.copy(t.dashOffset1),this.dashRatio.copy&&this.dashRatio.copy(t.dashRatio),this.brightSegCount=t.brightSegCount,this.brightSegWidth=t.brightSegWidth,this.blurWidthRatio=t.blurWidthRatio,this.brightSegOpacity=t.brightSegOpacity,this.useDash=t.useDash,this.visibility=t.visibility,this.alphaTest=t.alphaTest,this.repeat.copy(t.repeat),this.spaceRatio.copy(t.spaceRatio),this.symbolCount=t.symbolCount,this.symbolAspect=t.symbolAspect,this}},{key:"dispose",value:function(){}}]),s}(M.ShaderMaterial)}},t.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-road-traffic/2.1.2/roadtraffic",[],function(e,t,c,a,r,i){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var a;if(e)return"string"==typeof e?n(e,t):"Map"===(a="Object"===(a=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function u(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,a){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=D(e)););return e}(e,t);if(r)return(r=Object.getOwnPropertyDescriptor(r,t)).get?r.get.call(arguments.length<3?e:a):r.value}).apply(this,arguments)}function f(e,t){return(f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function p(a){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=D(a),t=(e=r?(e=D(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}return e.exports=function(y){var m=y.THREE,g=y.Utils,a=y.VG,t=y.FormatTransformer,v=y.coordHelper,e=a.Layer,r=c("datav:/com/@datav-city-pro-v2/datav-engine-road-traffic/2.1.2/meshLine")(m),k=r.MeshLine,n=r.MeshLineMaterial,s=c("datav:/com/@datav-city-pro-v2/datav-engine-road-traffic/2.1.2/shader/line.vert.glsl"),l=c("datav:/com/@datav-city-pro-v2/datav-engine-road-traffic/2.1.2/shader/line.frag.glsl"),r=h;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&f(r,e);var i,o=p(h);function h(e){var t;if(this instanceof h)return(t=o.call(this)).classNameAlias="RoadTrafficLayer",t.layerName=t.classNameAlias,t.renderQueue=a.Geometry,t.options=Object.assign({visible:!0},e||{}),t.checkedGeoData=[],t.needRerender=!0,t;throw new TypeError("Cannot call a class as a function")}return r=h,(e=[{key:"addTo",value:function(e){d(D(h.prototype),"addTo",this).call(this,e),this.formatTransformer=new t,this.dataReadyPromises=[]}},{key:"setPromise",value:function(){var a=this;this.geoDataReadyPromise||(this.geoDataReadyPromise=new Promise(function(e,t){a.geoDataResolve=e,a.geoDataReject=t})),this.stateDataReadyPromise||(this.stateDataReadyPromise=new Promise(function(e,t){a.stateDataResolve=e,a.stateDataReject=t})),this.dataReadyPromises.length||(this.dataReadyPromises.push(this.geoDataReadyPromise,this.stateDataReadyPromise),Promise.all(this.dataReadyPromises).then(function(){a.render(),a.geoDataReadyPromise=null,a.stateDataReadyPromise=null,a.dataReadyPromises.length=0}))}},{key:"setGeoData",value:function(e){if(this.clear(),this.rawGeoData=e,this.needRerender=!0,this.checkGeoData(e),!this.checkedGeoData.length)return this.emit("rendered");this.setPromise(),this.geoDataResolve()}},{key:"setStateData",value:function(e){if(this.stateData&&this.stateData.length&&(this.stateData.length=0),!(this.stateData=e)||!e.length)return console.warn("".concat(this.classNameAlias,": the length of state data is 0."));this.needRerender?(this.setPromise(),this.stateDataResolve(),this.needRerender=!1):this.updateRoadState()}},{key:"checkGeoData",value:function(e){if(!e)return console.error("".concat(this.classNameAlias," no geographical data."));var t=e;if(!Array.isArray(e)){if("FeatureCollection"!==e.type)return console.error("".concat(this.classNameAlias,": invalid geographical data format, ").concat(e,"."));t=this.formatTransformer.geojson2datav(e)}if(!t.length)return console.warn("".concat(this.classNameAlias,": the length of geographical data is 0."));this.checkedGeoData.length=0;for(var a=this.options.options.graph.altitude,r=0,i=t.length;r<i;r++){var o=t[r];o&&o.geometry&&o.geometry.coordinates&&o.geometry.coordinates.length&&o.id&&((o=g.deepClone(o)).geometry.coordinates.forEach(function(e){return void 0===e[2]&&e.push(a),e}),this.checkedGeoData.push(o))}}},{key:"getRoadSegColor",value:function(e){for(var t=this.stateData,a=null,r=0,i=t.length;r<i;r++)t[r].id===e&&(a=t[r].state);var o=this.options.options.graph,n=o.color0,s=o.color1,l=o.color2,h=o.color3,c=65280;switch(a){case 0:c=h;break;case 1:c=l;break;case 2:c=s;break;case 3:c=n}return c}},{key:"render",value:function(){this.clear(),this.meshLine?this.meshLine.clear():(t=new k,this.meshLine=t);for(var e,t,a,r=function(e,t){for(var a=1/0,r=-1/0,i=1/0,o=-1/0,n=1/0,s=-1/0,l=0,h=e.length;l<h;l++)for(var c=e[l].geometry.coordinates,u=void 0===c?[]:c,d=0,f=u.length;d<f;d++){var p=u[d],p=(t.setFromArray(p),t.toArray());a=Math.min(p[0],a),r=Math.max(p[0],r),i=Math.min(p[1],i),o=Math.max(p[1],o),n=Math.min(p[2],n),s=Math.max(p[2],s)}return[.5*(a+r),.5*(i+o),.5*(n+s)]}(this.checkedGeoData,v),i=[],o=null,n=null,s=0,l=this.checkedGeoData.length;s<l;s++){for(var h,c=(h=this.checkedGeoData[s]).geometry.coordinates,u=void 0===c?[]:c,d=i.length=0,f=u.length;d<f;d++){p=u[d],v.setFromArray(p),o=v.toArray(),0<d&&(p=u[d-1],v.setFromArray(p),p=v.toArray(),n=(n=[.99*o[0]+.01*p[0],.99*o[1]+.01*p[1],.99*o[2]+.01*p[2]]).map(function(e,t){return e-r[t]}),i.push.apply(i,b(n).concat(b(n))));var p=o.map(function(e,t){return e-r[t]});i.push.apply(i,b(p).concat(b(p))),d<f-1&&(p=u[d+1],v.setFromArray(p),p=v.toArray(),n=(n=[.99*o[0]+.01*p[0],.99*o[1]+.01*p[1],.99*o[2]+.01*p[2]]).map(function(e,t){return e-r[t]}),i.push.apply(i,b(n).concat(b(n))))}c=g.Chroma(this.getRoadSegColor(h.id)).gl();this.meshLine.setGeometry(i,c)}this.meshLine.createGeometry(),this._linksGeometry&&this._linksGeometry.dispose&&this._linksGeometry.dispose(),this._linksGeometry=this.meshLine.geometry,this.setMaterial(),this.linksMesh?this.linksMesh.geometry=this._linksGeometry:(e=(t=y.viewer.engine).renderer,t=t.camera,a=new m.Vector2,e.getDrawingBufferSize(a),this._linkMaterial.resolution.set(a.width,a.height),this._linkMaterial.near=t.near,this._linkMaterial.far=t.far,this._linkMaterial.needsUpdate=!0,this.linksMesh=new m.Mesh(this._linksGeometry,this._linkMaterial),this.add(this.linksMesh)),this.linksMesh.position.fromArray(r),this.linksMesh.matrix.setPosition(this.linksMesh.position)}},{key:"updateRoadState",value:function(){this.updateColor()}},{key:"setMaterial",value:function(){var e=this.options.options,t=e.general,e=e.graph,a=t.sizeAttenuation,r=t.blurWidthRatio,i=t.blending,o=t.depthTest,t=t.depthWrite,e=e.baseWidth;this._linkMaterial?(this._linkMaterial.lineWidth=e,this._linkMaterial.sizeAttenuation=a,this._linkMaterial.blurWidthRatio=r,this._linkMaterial.depthTest=o,this._linkMaterial.depthWrite=t,this._linkMaterial.blending=m[i],this._linkMaterial.needsUpdate=!0):this._linkMaterial=new n({depthTest:o,transparent:!0,depthWrite:t,resolution:new m.Vector2,sizeAttenuation:a?1:0,side:m.DoubleSide,blending:m[i],near:1,far:1,visibility:1,blurWidthRatio:r,dashOffset0:0,dashOffset1:0,lineWidth:e},s,l)}},{key:"checkVisible",value:function(){this.options.visible?this.show():this.hide()}},{key:"updateColor",value:function(){if(this.meshLine){for(var e=this.meshLine.segItemCounts,t=this._linksGeometry.attributes.color,a=t.array,r=0,i=0,o=this.checkedGeoData.length;i<o;i++){for(var n=this.checkedGeoData[i],s=g.Chroma(this.getRoadSegColor(n.id)).gl(),l=r,h=r+e[i];l<h;l++)a[4*l]=s[0],a[4*l+1]=s[1],a[4*l+2]=s[2],a[4*l+3]=s[3];r+=e[i]}t.needsUpdate=!0}}},{key:"updateOptions",value:function(e){var t=g.deepClone(this.options);this.options=g.mergeOptions(this.options,e||{}),this.setMaterial(),t.options.graph.altitude!==e.options.graph.altitude&&(this.checkGeoData(this.rawGeoData),this.render()),t.options.graph.color0===e.options.graph.color0&&t.options.graph.color0===e.options.graph.color1&&t.options.graph.color0===e.options.graph.color2&&t.options.graph.color0===e.options.graph.color3||this.updateColor(),g.easyDiff(t.sceneId.length,e.sceneId.length)&&g.deepDiff(t.sceneId,e.sceneId)||this.updateSceneId(),this.checkVisible()}},{key:"show",value:function(){this.options.visible=!0,d(D(h.prototype),"show",this).call(this)}},{key:"hide",value:function(){this.options.visible=!1,d(D(h.prototype),"hide",this).call(this)}},{key:"clear",value:function(){d(D(h.prototype),"clear",this).call(this),this.meshLine&&this.meshLine.clear(),this.linksMesh=null}},{key:"destroy",value:function(){this.clear(),d(D(h.prototype),"destroy",this).call(this),this.rawGeoData&&(this.rawGeoData.length=0),this.checkedGeoData&&(this.checkedGeoData.length=0),this.rawGeoData=null,this.checkedGeoData=null}}])&&u(r.prototype,e),i&&u(r,i),Object.defineProperty(r,"prototype",{writable:!1}),h},e.exports});;
Cube("datav:/com/@datav-city-pro-v2/datav-engine-road-traffic/2.1.2",["datav:/npm/eventemitter3/3.0.0"],function(t,e,r,o,n,i){function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function u(t,e){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function y(r){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=f(r),e=(t=o?(t=f(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(t&&("object"===a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var s=r("datav:/npm/eventemitter3/3.0.0"),l=r("datav:/com/@datav-city-pro-v2/datav-engine-road-traffic/2.1.2/roadtraffic"),r=function(){var t=n,e=s;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e);var r,o=y(n);function n(t,e){var r;if(this instanceof n)return(r=o.call(this)).options=e,r.comId="",r.type="RoadTraffic",r;throw new TypeError("Cannot call a class as a function")}return t=n,(e=[{key:"addTo",value:function(t,e){this.cityproCore=t,this.comId=e,this.initLayer()}},{key:"initLayer",value:function(){var t=l(this.cityproCore);this.layer=new t(this.options),this.cityproCore.viewer.addLayer(this.comId,this.layer)}},{key:"setGeoData",value:function(t){this.layer&&this.layer.setGeoData(t)}},{key:"setStateData",value:function(t){this.layer&&this.layer.setStateData(t)}},{key:"updateOptions",value:function(t){this.layer&&this.layer.updateOptions&&this.layer.updateOptions(t)}},{key:"show",value:function(){this.layer&&this.layer.show&&this.layer.show()}},{key:"hide",value:function(){this.layer&&this.layer.hide&&this.layer.hide()}},{key:"clear",value:function(){this.layer&&this.layer.clear&&this.layer.clear()}},{key:"destroy",value:function(){this.layer&&this.layer.destroy&&this.layer.destroy()}}])&&c(t.prototype,e),r&&c(t,r),Object.defineProperty(t,"prototype",{writable:!1}),n}();return t.exports=r,t.exports});