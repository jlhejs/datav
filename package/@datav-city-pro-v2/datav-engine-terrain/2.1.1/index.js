// env=undefined => env=publish 
Cube("datav:/com/@datav-city-pro-v2/datav-engine-terrain/2.1.1",["datav:/npm/eventemitter3/3.0.0"],function(n,r,o,e,t,a){function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}return function(e,t){"object"==(void 0===r?"undefined":v(r))&&"object"==(void 0===n?"undefined":v(n))?n.exports=t(o("datav:/npm/eventemitter3/3.0.0")):"function"==typeof define&&define.amd?define(["eventemitter3"],t):"object"==(void 0===r?"undefined":v(r))?r.Chart=t(o("datav:/npm/eventemitter3/3.0.0")):e.Chart=t(e.eventemitter3)}(window,function(n){return function(n){var r={};function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}return o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==v(t)&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=6)}([function(e,t){e.exports="#define GLSLIFY 1\n#define GLSLIFY 1\n#include <vogo/citybase_defaultuniforms_fragment>\nuniform vec2 altRange;\nuniform vec3 blendCoeff;\n\nin float vAlt;\nin float vSlope;"},function(e,t){e.exports="#define GLSLIFY 1\n#define GLSLIFY 1\n#ifdef USE_LWB_MAP\n\n\tuniform sampler2D layerBlendWeightMap;\n\n#endif\n\n#include <vogo/citybase_map_pars_fragment>\n\n"},function(e,t){e.exports="#define GLSLIFY 1\n#define GLSLIFY 1\n  vec2 st = vUv * tilingScale[0];\n  \n  float randBlendCoeff = 1.0;\n\n\t#ifdef USE_LWB_MAP\n\n\t\trandBlendCoeff = texture( layerBlendWeightMap, st).r;\n\n\t#endif\n\n  float grassCoverage = blendCoeff.z;\n\tfloat grassCoverageOneTenth = grassCoverage * 0.1;\n\tfloat grassCoverageNineTenth = grassCoverage * 0.9;\n  float slope = abs(vSlope);\n\tfloat altRatio = smoothstep(0.0, 1.0, (vAlt - altRange[0]) / altRange[1]);\n \n\tfloat layerBlendCoeffA = 1.0;\n\tfloat layerBlendCoeffB = 0.0;\n  \n\tfloat altThreshold = blendCoeff.x + blendCoeff.y;\n\tif(altRatio <= altThreshold + blendCoeff.y)\n\t{ \n\t\tlayerBlendCoeffA = step(altThreshold, altRatio);\n\t\tlayerBlendCoeffA *= saturate((altRatio - altThreshold) / blendCoeff.y);\n\t}\n\t\n\tif(slope >= grassCoverageNineTenth)\n\t{\n\t\tlayerBlendCoeffB = saturate((slope - grassCoverageNineTenth) / grassCoverageOneTenth);\n\t}\n\n  vec4 layerATexel;\n\tvec4 layerBTexel;\n\tvec4 layerCTexel;\n\tvec4 layerDTexel;\n  // sand\n\tvec3 layerAUv = vec3(st * 10.0, 0.0);\n\t// grass a \n\tvec3 layerBUv = vec3(st * 12.0, 1.0);\n\t// grass b\n\tvec3 layerCUv = vec3(st * 8.0, 2.0);\n\t// rock\n\tvec3 layerDUv = vec3(st * vec2(1.0, 1.256), 3.0);\n\n  #ifdef USE_MAP\n\t\n\t  layerATexel = texture( map, layerAUv );\n\t\tlayerBTexel = texture( map, layerBUv );\n\t\tlayerCTexel = texture( map, layerCUv );\n\t\tlayerDTexel = texture( map, layerDUv );\n\n\t\tlayerBTexel.rgb = mix(layerBTexel.rgb * 1.3, layerBTexel.rgb * 0.75, randBlendCoeff) * 0.5;\n\t\tlayerBTexel = mix(layerDTexel, layerBTexel, layerBlendCoeffB);\n\t\ttexel = mix(layerATexel, layerBTexel, layerBlendCoeffA);\n\t\t\n\t\taoFactor = (texel.a - 1.0) * aoMapIntensity + 1.0;\n\n\t  diffuseColor.rgb *= texel.rgb;\n\n  #endif"},function(e,t){e.exports="#define GLSLIFY 1\n#define GLSLIFY 1\n#ifdef TANGENTSPACE_NORMALMAP\n    \n\t  layerATexel = texture( normalMap, layerAUv );\n\t\tlayerBTexel = texture( normalMap, layerBUv );\n\t\tlayerDTexel = texture( normalMap, layerDUv );\n\n\t\tlayerATexel.xyz = layerATexel.xyz * 2.0 - 1.0;\n\t\tlayerBTexel.xyz = layerBTexel.xyz * 2.0 - 1.0;\n\t\tlayerDTexel.xyz = layerDTexel.xyz * 2.0 - 1.0;\n\n\t\tlayerBTexel = mix(layerDTexel, layerBTexel, layerBlendCoeffB);\n\n\t\ttexel = mix(layerATexel, layerBTexel, layerBlendCoeffA);\n\n\t\troughnessFactor *= texel.a;\n\n\t  vec3 mapN = texel.xyz;\n\n\t  mapN.xy *= normalScale;\n\n\t  #ifdef USE_TANGENT\n\n\t\t  normal = normalize( vTBN * mapN );\n\n\t  #else\n\n\t\t  normal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\n\t  #endif\n\n  #endif"},function(e,t){e.exports="#define GLSLIFY 1\n#define GLSLIFY 1\n#ifdef USE_EMISSIVEMAP\n\n\t  layerATexel = texture( emissiveMap, layerAUv );\n\t\tlayerBTexel = texture( emissiveMap, layerBUv );\n\t\tlayerDTexel = texture( emissiveMap, layerDUv );\n\n\t\tlayerBTexel = mix(layerDTexel, layerBTexel, layerBlendCoeffB);\n\n\t\ttexel = mix(layerATexel, layerBTexel, layerBlendCoeffA);\n\n\t\tmetalnessFactor *= texel.a;\n  \n\t  totalEmissiveRadiance *= texel.rgb;\n  \n  #endif"},function(e,t){e.exports=function(e){var n=e.blend.uvScale,r=[[],[],[],[],[],[]],o=[[],[],[],[],[],[]],a=[];return[e.layerA,e.layerB,e.layerC,e.layerD].forEach(function(e){a.push(n.x,n.y),r[0].push(e.map),o[0].push(e.color),r[1].push(e.normalMap),o[1].push("rgb(255, 255, 255)"),r[2].push(e.emissiveMap),o[2].push(e.emissive);var t=parseInt(255*e.aoMapIntensity,10);r[3].push(e.aoMap),o[3].push("rgb(".concat(t,", ").concat(t,", ").concat(t,")")),r[4].push(e.roughnessMap),t=parseInt(255*e.roughness,10),o[4].push("rgb(".concat(t,", ").concat(t,", ").concat(t,")")),r[5].push(e.metalnessMap),t=parseInt(255*e.metalness,10),o[5].push("rgb(".concat(t,", ").concat(t,", ").concat(t,")"))}),{imageUrlArr:r,pbrMatCoeffArr:o,uvScaleData:a}}},function(e,t,n){function o(e){return(o="function"==typeof Symbol&&"symbol"==v(Symbol.iterator)?function(e){return v(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":v(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=u(n);return function(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r?(e=u(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=n(7),s=n(8),c=n(5),n=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(o,f);var e,t,r=l(o);function o(e,t){var n;return function(e){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}(this),(n=r.call(this)).options=t,n.visible=!0,n.isBasicFeature=!0,n.comId="",n.type="Terrain",n}return t=[{key:"editBeforePublish",value:function(e,t,n){var a=e.componentData,i=n.UI,e=a.config.options.graphic,n=c(e),e=(n.vtbuffer=e.vtbuffer,o.pack(t,n));return e.then(function(e){if(e.isError||!e.data||!e.data.url)return Promise.reject(new Error(e.message));i.Notify.success("".concat(a.alias," 材质打包成功"));var t=JSON.parse(JSON.stringify(a.config)),n=t.sceneId,t=t.options,r=t.general,t=t.graphic,o=t.vtbuffer,t=t.blend;return o.url=e.data.url,{config:{sceneId:n,options:{general:r,graphic:{blend:t,vtbuffer:o}}}}})}},{key:"pack",value:function(e,t){return fetch(e.staticPackingEndpoint,{method:"POST",headers:{"content-type":"application/json","X-Auth-Token":"datav","xsrf-token":e.csrf,"from-app":e.fromApp},body:JSON.stringify({comConfig:t})}).then(function(e){return e.json()})}}],a((e=o).prototype,[{key:"addTo",value:function(e,t){return this.cityproCore=e,this.comId=t,this.initLayer()}},{key:"setEnvMap",value:function(e){this.layer&&(this.layer.envMapIntensity=e.properties,this.layer.envMap=e.value)}},{key:"initLayer",value:function(){var e=this,t=s(this.cityproCore),t=(this.layer=new t(this.options),this.cityproCore.viewer.addLayer(this.comId,this.layer));return this.visible?this.layer.show():this.layer.hide(),this.layer.on("rendered",function(){e.emit("rendered","地形渲染完成")}),t}},{key:"setData",value:function(e){var t=this;this.layer&&(e instanceof ArrayBuffer?this.layer.setData(e):e&&e.url&&""!==e.url&&(this.layer.hide(),fetch(e.url,{headers:{"accept-encoding":"deflate,gzip"}}).then(function(e){return e.arrayBuffer()}).then(function(e){t.layer&&(t.visible?t.layer.show():t.layer.hide(),t.layer.setData(e))})))}},{key:"errorRender",value:function(){console.log("地形L1组件数据错误"),this.layer&&this.layer.dataErrorHandler()}},{key:"updateOptions",value:function(e){this.layer&&this.layer.updateOptions(e)}},{key:"show",value:function(){this.visible=!0,this.layer&&this.layer.show()}},{key:"hide",value:function(){this.visible=!1,this.layer&&this.layer.hide()}},{key:"destroy",value:function(){this.layer&&(this.layer.destroy&&this.layer.destroy(),this.layer=null)}}]),a(e,t),Object.defineProperty(e,"prototype",{writable:!1}),o}();e.exports=n},function(e,t){e.exports=n},function(e,t,n){function o(e){return(o="function"==typeof Symbol&&"symbol"==v(Symbol.iterator)?function(e){return v(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":v(e)})(e)}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=a(n);return function(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}(this,r?(e=a(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}e.exports=function(e){var o=e.VG,t=e.THREE,a=e.Utils,e=t.TextureLoader,i=t.RepeatWrapping,l=n(9)(o),u=n(10)(o),f=n(5),s=new e;return s.setCrossOrigin("*"),function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}(r,o.CityBaseLayer);var e,n=d(r);function r(e){!function(e){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(t=n.call(this,"TerrainLayer")).options=Object.assign({isSceneGroup:!1,sceneId:["scene1"]},e||{});var t,e=t.options.options.graphic.vtbuffer;return t.resolution.set(256*Math.pow(2,e.resExp),256*Math.pow(2,e.resExp),e.styleNum),t.emitWorldVaried=t.emitWorldVaried.bind(h(t)),t}return p((e=r).prototype,[{key:"emitWorldVaried",value:function(){this.viewer.onWorldVaried()}},{key:"initializeMaterial",value:function(){this.material=new l(this.resolution.z),this.customGBufferMaterial=new u(this.material)}},{key:"setData",value:function(e){this.disposeGeometry();var e=o.CityBaseLayer.decodeMeshBuffer(e),t=e.fAttr0,n=e.fAttr1,r=e.indices;r&&0<r.length&&(e=(r=o.CityBaseLayer.parseDataVMesh(e,{as:{fieldName:"fAttr2",itemSize:2}})).geometry,r=r.compressed,this.geometry=e,this.geometry.deleteAttribute("faceType"),this.compressed=r,e=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,l=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(l)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,3),this.center[0]=e[0],this.center[1]=e[1],this.center[2]=e[2],this.fAttr0=t,this.material&&this.material.altRange.set(n[0],n[1]-n[0]),this.updateMesh()),this.emitWorldVaried(),this.resolve(),this.emit("rendered")}},{key:"dataErrorHandler",value:function(){this.needsWait&&(this.needsWait=!1),this.emit("rendered")}},{key:"updateMaterialRuntime",value:function(e){var t=this;fetch(e.vtbuffer.url,{headers:{"accept-encoding":"deflate,gzip"}}).then(function(e){return e.arrayBuffer()}).then(function(e){t.setVTBuffer(e),t.emitWorldVaried()})}},{key:"updateMaterialEditor",value:function(e){var e=f(e),t=e.uvScaleData,n=e.imageUrlArr,e=e.pbrMatCoeffArr;this.updateVT(t,n,e,this.emitWorldVaried)}},{key:"updateMaterial",value:function(e){var t;this.updateLight(),this.material&&(""!==(t=this.options.options.graphic).vtbuffer.url?this.updateMaterialRuntime(t):this.updateMaterialEditor(t),this.material.blendCoeff.copy(t.blend.coeff),e&&e.blend.weightMap===t.blend.weightMap||((e=s.load(t.blend.weightMap)).wrapS=i,e.wrapT=i,this.material.layerBlendWeightMap=e,this.customGBufferMaterial.layerBlendWeightMap=e),this.emitWorldVaried())}},{key:"updateOptions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=a.deepClone(this.options);this.options=a.mergeOptions(this.options,e||{}),this.options.options,this.updateMaterial(t.options.graphic),this.updateShadow(),a.easyDiff(t.sceneId.length,this.options.sceneId.length)&&a.deepDiff(t.sceneId,this.options.sceneId)||this.updateSceneId()}},{key:"updateShadow",value:function(){this.mesh&&(this.mesh.canCastShadow=!0,this.mesh.canReceiveShadow=!0);var e=this.options.options.general;this.castShadow=e.shadow.castShadow,this.receiveShadow=e.shadow.receiveShadow,this.emitWorldVaried()}},{key:"updateLight",value:function(){var e=this.options.options.general;this.envMapIntensityFactor=e.light.envMapIntensityFactor,this.emissiveIntensity=e.light.emissiveIntensity,this.emitWorldVaried()}}]),Object.defineProperty(e,"prototype",{writable:!1}),r}()}},function(e,t,n){function o(e){return(o="function"==typeof Symbol&&"symbol"==v(Symbol.iterator)?function(e){return v(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":v(e)})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(r)return(r=Object.getOwnPropertyDescriptor(r,t)).get?r.get.call(arguments.length<3?e:n):r.value}).apply(this,arguments)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=s(n);return function(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r?(e=s(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c=n(0),p=n(1),y=n(2),d=n(3),h=n(4);e.exports=function(r){var e=r.THREE,o=e.Vector2,a=e.Vector3;return function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(n,r.CityBaseMaterial);var e,t=f(n);function n(e){return function(e){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this),(e=t.call(this,e)).type="CityBaseTerrainMaterial",e.vertexShader=e.vertexShader.replace("attribute float faceType;","attribute vec2 as;").replace("flat out vec4 vVertexInfo;","flat out vec4 vVertexInfo;\nout float vAlt;\nout float vSlope;").replace(/vVertexInfo.x\s*\=\s*faceType;/,"vAlt = as.x;\nvSlope = as.y;"),e.fragmentShader=e.fragmentShader.replace("#include <vogo/citybase_defaultuniforms_fragment>",c).replace("#include <vogo/citybase_map_pars_fragment>",p).replace("#include <vogo/citybase_map_fragment>",y).replace("#include <vogo/citybase_normal_fragment_maps>",d).replace("#include <vogo/citybase_emissive_fragment>",h),e.uniforms.blendCoeff={value:new a},e.uniforms.altRange={value:new o},e.uniforms.layerBlendWeightMap={value:null},e}return i((e=n).prototype,[{key:"blendCoeff",get:function(){return this.uniforms.blendCoeff.value}},{key:"altRange",get:function(){return this.uniforms.altRange.value}},{key:"layerBlendWeightMap",get:function(){return this.uniforms.layerBlendWeightMap.value},set:function(e){var t=!1;e!==this.uniforms.layerBlendWeightMap.value&&(this.disposeLayerBlendWeightTextures(),this.uniforms.layerBlendWeightMap.value=e,t=!0),this.uniforms.layerBlendWeightMap.value&&!this.defines.USE_LWB_MAP&&(t=this.defines.USE_LWB_MAP=!0),!this.uniforms.layerBlendWeightMap.value&&this.defines.USE_LWB_MAP&&(delete this.defines.USE_LWB_MAP,t=!0),this.needsUpdate=t}},{key:"disposeLayerBlendWeightTextures",value:function(){var e=this.layerBlendWeightMap;e&&(e.dispose(),e.image&&e.image.src&&(e.image.src=""))}},{key:"disposeTextures",value:function(){l(s(n.prototype),"disposeTextures",this).call(this),this.disposeLayerBlendWeightTextures()}}]),Object.defineProperty(e,"prototype",{writable:!1}),n}()}},function(e,t,n){function o(e){return(o="function"==typeof Symbol&&"symbol"==v(Symbol.iterator)?function(e){return v(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":v(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=u(n);return function(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r?(e=u(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=n(0),s=n(1),c=n(2),p=n(3),y=n(4);e.exports=function(t){return function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(r,t.CityBaseGBufferMaterial);var e,n=l(r);function r(e){var t;return function(e){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(t=n.call(this,e)).type="CityBaseGBufferTerrainMaterial",t.vertexShader=t.vertexShader.replace("attribute float faceType;","attribute vec2 as;").replace("flat out vec4 vVertexInfo;","flat out vec4 vVertexInfo;\nout float vAlt;\nout float vSlope;").replace(/vVertexInfo.x\s*\=\s*faceType;/,"vAlt = as.x;\nvSlope = as.y;"),t.fragmentShader=t.fragmentShader.replace("#include <vogo/citybase_defaultuniforms_fragment>",f).replace("#include <vogo/citybase_map_pars_fragment>",s).replace("#include <vogo/citybase_map_fragment>",c).replace("#include <vogo/citybase_normal_fragment_maps>",p).replace("#include <vogo/citybase_emissive_fragment>",y),t.uniforms.blendCoeff=e.uniforms.blendCoeff,t.uniforms.altRange=e.uniforms.altRange,t.uniforms.layerBlendWeightMap=e.uniforms.layerBlendWeightMap,t}return a((e=r).prototype,[{key:"layerBlendWeightMap",set:function(e){var t=!1;e!==this.uniforms.layerBlendWeightMap.value&&(this.uniforms.layerBlendWeightMap.value=e,t=!0),this.uniforms.layerBlendWeightMap.value&&!this.defines.USE_LWB_MAP&&(t=this.defines.USE_LWB_MAP=!0),!this.uniforms.layerBlendWeightMap.value&&this.defines.USE_LWB_MAP&&(delete this.defines.USE_LWB_MAP,t=!0),this.needsUpdate=t}}]),Object.defineProperty(e,"prototype",{writable:!1}),r}()}}])}),n.exports});