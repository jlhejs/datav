"use strict";var l=require("vue"),$=require("accounting"),u=require("datav-vue");function G(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var s=G($);const k=t=>typeof t=="number"?t:parseFloat(t)||null,v=t=>t==="dataMin"||t==="dataMax"?t:k(t),S=(t,r)=>r==="d"?s.default.toFixed(+t):r===".1f"?s.default.toFixed(+t,1):r===".2f"?s.default.toFixed(+t,2):r===".0%"?`${s.default.toFixed(parseFloat(t)*100)}%`:r===".1%"?`${s.default.toFixed(parseFloat(t)*100,1)}%`:r===".2%"?`${s.default.toFixed(parseFloat(t)*100,2)}%`:r==="th"?s.default.formatNumber(+t):r===".1t"?s.default.formatNumber(+t,1):r===".2t"?s.default.formatNumber(+t,2):t;var B=(t,r)=>{const p=t.__vccOpts||t;for(const[h,y]of r)p[h]=y;return p};const N=l.defineComponent({name:"DatavBasicBar",components:{},props:{com:{type:Object,required:!0}},setup(t){const r=u.useApiStore(),{datavEmit:p}=u.useDataCenter(t.com),h=l.computed(()=>{var o,e;return(e=(o=r.dataMap[t.com.id])==null?void 0:o.source)!=null?e:[]}),y=l.computed(()=>u.getFieldMap(t.com.apis.source.fields)),x=l.toRef(t.com,"config"),m=l.toRef(t.com,"attr"),F=l.computed(()=>({width:`${m.value.w}px`,height:`${m.value.h}px`})),w=l.computed(()=>{const o=u._.groupBy(h.value,e=>e[y.value.x]);return{keys:Object.keys(o),values:Object.values(o)}}),_=()=>{const{global:o,label:e,series:a}=x.value,{values:n}=w.value;return a.map((i,c)=>({type:i.type,name:i.name,label:{show:e.show,position:e.position,...e.textStyle,offset:[e.offsetX,e.offsetY]},itemStyle:{color:i.color.type==="gradient"?new u.echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:i.color.from},{offset:1,color:i.color.to}]):i.color.value},barGap:`${o.innerPadding}%`,barCategoryGap:`${o.outerPadding}%`,showBackground:o.background.show,backgroundStyle:{color:o.background.color},data:n.map(b=>{const d=b[c];return{value:d?d[y.value.y]:null,dataRef:d!=null?d:{}}})}))},C=l.computed(()=>{const{global:o,xAxis:e,yAxis:a,tooltip:n,legend:i,animation:c}=x.value,[b,d]=i.position.split("-"),L={type:n.pointer.line.type==="dashed"?[n.pointer.line.dashedLength,n.pointer.line.dashedSpace]:n.pointer.line.type,width:n.pointer.line.width,color:n.pointer.line.color},T={textStyle:{fontFamily:o.fontFamily},grid:{...o.margin},tooltip:{show:n.show,textStyle:{...n.textStyle},padding:[n.background.padding.v,n.background.padding.h],backgroundColor:n.background.color,trigger:n.pointer.show?"axis":"item",axisPointer:{type:n.pointer.show?"cross":"none",label:{show:!1},lineStyle:L,crossStyle:L},borderWidth:0},legend:{show:i.show,top:b,left:d,orient:i.orient,textStyle:{...i.textStyle},icon:i.symbol.show?i.symbol.icon==="auto"?null:i.symbol.icon:"none",itemWidth:i.symbol.width,itemHeight:i.symbol.height,itemGap:i.symbol.gap,type:i.page.enabled?"scroll":"plain",width:i.page.enabled?i.page.size.width:"auto",height:i.page.enabled?i.page.size.height:"auto",pageIconSize:i.page.button.size,pageIconColor:i.page.button.color,pageIconInactiveColor:i.page.button.inactiveColor,pageTextStyle:{color:i.page.pageNumColor}},xAxis:{show:e.show,type:e.type,boundaryGap:e.boundaryGap,name:e.title.show?e.title.name:"",nameLocation:e.title.location,nameRotate:e.title.display.rotate,nameGap:e.title.display.offset,nameTextStyle:{...e.title.textStyle},axisLine:{show:e.axisLine.show,lineStyle:{type:e.axisLine.type,width:e.axisLine.width,color:e.axisLine.color}},axisTick:{show:e.axisTick.show,lineStyle:{type:e.axisTick.type,width:e.axisTick.width,color:e.axisTick.color},alignWithLabel:!0},axisLabel:{show:e.axisLabel.show,interval:k(e.axisLabel.interval),rotate:e.axisLabel.display.rotate,margin:e.axisLabel.display.margin,align:e.axisLabel.align,...e.axisLabel.textStyle,timeFormat:e.axisLabel.timeFormat,valueFormat:e.axisLabel.valueFormat,formatter:g=>e.type==="time"?u.dayjs(g).format(e.axisLabel.timeFormat):e.type==="value"?S(g,e.axisLabel.valueFormat):g},splitLine:{show:e.grid.show,lineStyle:{type:e.grid.line.type==="dashed"?[e.grid.line.dashedLength,e.grid.line.dashedSpace]:e.grid.line.type,width:e.grid.line.width,color:e.grid.line.color}},data:w.value.keys},yAxis:{show:a.show,type:"value",name:a.title.show?a.title.name:"",nameLocation:a.title.location,nameRotate:a.title.display.rotate,nameGap:a.title.display.offset,nameTextStyle:{...a.title.textStyle},axisLine:{show:a.axisLine.show,lineStyle:{type:a.axisLine.type,width:a.axisLine.width,color:a.axisLine.color}},axisTick:{show:a.axisTick.show,lineStyle:{type:a.axisTick.type,width:a.axisTick.width,color:a.axisTick.color},alignWithLabel:!0},boundaryGap:[`${a.axisLabel.boundaryGap}%`,`${a.axisLabel.boundaryGap}%`],axisLabel:{show:a.axisLabel.show,rotate:a.axisLabel.display.rotate,margin:a.axisLabel.display.margin,align:a.axisLabel.align,...a.axisLabel.textStyle,valueFormat:a.axisLabel.valueFormat,formatter:g=>S(g,a.axisLabel.valueFormat)},splitLine:{show:a.grid.show,lineStyle:{type:a.grid.line.type==="dashed"?[a.grid.line.dashedLength,a.grid.line.dashedSpace]:a.grid.line.type,width:a.grid.line.width,color:a.grid.line.color}},min:v(a.extent.min),max:v(a.extent.max),splitNumber:a.splitNumber>0?a.splitNumber:null},animation:c.enabled,animationDuration:c.duration,animationEasing:c.easing,animationDelay:c.delay,series:_()};return JSON.parse(JSON.stringify(T))});return{wrapperStyle:F,option:C,onClick:o=>{p("click",{...o.data.dataRef,x:o.name,y:o.value})}}}});function A(t,r,p,h,y,x){const m=l.resolveComponent("v-echart");return l.openBlock(),l.createElementBlock("div",{class:"datav-wrapper",style:l.normalizeStyle(t.wrapperStyle)},[l.createVNode(m,{option:t.option,autoresize:"",onClick:t.onClick},null,8,["option","onClick"])],4)}var f=B(N,[["render",A],["__file","F:/datav-jlhe/src/components/bar/basic-bar/src/index.vue"]]);f.install=t=>{t.component("DatavBasicBar",f)};window.datavVue&&window.datavVue.app&&window.datavVue.app.use(f);
